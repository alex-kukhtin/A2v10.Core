!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";const t=t=>t>=26?String.fromCharCode(Math.floor(t/26)+64)+String.fromCharCode(t%26+65):String.fromCharCode(t+65),e=t=>t+"px",s=23;Vue.component("a2-scroll-bar",{template:'\n<div class="a2-sb" :class="sbClass">\n\t<button @click.stop=dec :disabled=decDisabled v-text=decLabel></button>\n\t<div class="sb-body" @click.self="clickBody" ref=body>\n\t\t<div class="thumb" @pointerdown.self.stop=thumbDown\n\t\t\t@pointerup.self.stop=thumbUp @pointermove.self.stop=thumbMove\n\t\t\t:style=thumbStyle :class="{horz: horz, vert: !horz }"></div>\n\t</div>\n\t<button @click.stop=inc :disabled=incDisabled v-text=incLabel></button>\n</div>\n',props:{horz:Boolean,page:Number,pos:Number,min:Number,max:Number,setPos:Function},data:()=>({tempClientSize:0,moving:!1,delta:0,thumbMovePos:0}),computed:{sbClass(){return this.horz?"horz":"vert"},thumbPos(){if(this.moving)return this.thumbMovePos;return this.clientSize/this.size*(this.pos-this.min)},size(){return this.max-this.min},clientSize(){let t=this.tempClientSize;return this.$refs.body&&(t=this.horz?this.$refs.body.clientWidth:this.$refs.body.clientHeight),t},thumbSize(){let t=this.clientSize;return this.page*t/this.size},thumbStyle(){return this.horz?{left:e(this.thumbPos),width:e(this.thumbSize)}:{top:e(this.thumbPos),height:e(this.thumbSize)}},decDisabled(){return this.pos<=this.min},incDisabled(){return this.pos>=this.max-this.page},decLabel(){return this.horz?"◂":"▴"},incLabel(){return this.horz?"▸":"▾"}},methods:{dec(){this.setPosCheck(this.pos-1)},inc(){this.setPosCheck(this.pos+1)},setPosCheck(t){t<this.min&&(t=this.min),t>this.max-this.page&&(t=this.max-this.page),this.setPos(t)},clickBody(t){let e=0;e=(this.horz?t.offsetX:t.offsetY)<this.thumbPos?this.pos-this.page:this.pos+this.page,this.setPosCheck(e)},thumbDown(t){t.target.setPointerCapture(t.pointerId),this.delta=this.hors?t.offsetX:t.offsetY,this.thumbMovePos=this.thumbPos,this.moving=!0},thumbMove(t){if(!this.moving)return;let e=this.$refs.body.getBoundingClientRect(),s=this.horz?t.clientX-this.delta-e.left:t.clientY-this.delta-e.top;s<0&&(s=0);let i=this.thumbSize,o=this.horz?e.width-i:e.height-i;s>o&&(s=o),this.thumbMovePos=s},thumbUp(t){t.target.releasePointerCapture(t.pointerId);let e=this.thumbMovePos;this.moving=!1;let s=this.clientSize/(this.max-this.min),i=Math.min(+(e/s).toFixed(),this.max-this.page);this.setPosCheck(i+this.min)}},mounted(){this.tempClientSize=this.horz?this.$refs.body.clientWidth:this.$refs.body.clientHeight}});var i={data:()=>({rType:"",rItem:-1,rPt:-1,rSize:-1,delta:0}),methods:{clearData(){this.rType="",this.rItem=-1,this.rSize=0,this.rPt=0,this.delta=0},onUp(t,e){if(t.target.releasePointerCapture(t.pointerId),t.stopPropagation(),this.rItem<0)return;let s=this.rPt-this.rSize;s<5&&(s=5),e(s),this.clearData()},hMouseDown(t){t.stopPropagation();let e=this.$parent.pointFromEvent(t),s=this.$parent.colFromPoint(e.x);s&&(t.target.setPointerCapture(t.pointerId),this.rType="C",this.rItem=s.col,this.rPt=s.left+s.width,this.rSize=s.left,this.delta=this.rPt-t.clientX)},hMouseUp(t){this.onUp(t,(t=>{let e=this.$parent.getOrCreateColumn(this.rItem);Vue.set(e,"Width",t)}))},hMouseMove(t){this.rItem<0||(this.rPt=t.clientX+this.delta)},vMouseDown(t){t.stopPropagation();let e=this.$parent.pointFromEvent(t),s=this.$parent.rowFromPoint(e.y);s&&(t.target.setPointerCapture(t.pointerId),this.rType="R",this.rItem=s.row,this.rPt=s.top+s.height,this.rSize=s.top,this.delta=this.rPt-t.clientY)},vMouseUp(t){this.onUp(t,(t=>{let e=this.$parent.getOrCreateRow(this.rItem);Vue.set(e,"Height",t)}))},vMouseMove(t){this.rItem<0||(this.rPt=t.clientY+this.delta)}},render(i){let o=this.$parent,l=o.sheet,r=o.$refs.container;if(!r)return;let h=r.clientWidth,n=r.clientHeight,a=[],c=this,d=o.startX,p={right:0,bottom:0};return o.headers?(a.push(i("div",{class:"r-top"})),function(){let s=d;for(const r of o.renderedColumns()){let n=t(r),d=o.colWidth(r),p="thc";if(o.isInSelection(((t,e)=>r>=t.left&&r<=t.left+(e?.ColSpan-1||0)))&&(p+=" thc-sel"),r===l.Size.Columns-1&&(p+=" last",d+=1),a.push(i("div",{class:p,style:{width:e(d),left:e(s)}},[n,i("div",{class:"h-size no-me",on:{pointerdown:c.hMouseDown,pointerup:c.hMouseUp,pointermove:c.hMouseMove}})])),s+=d,s>=h)break}p.right=s-32-1}(),function(){let t=s;for(const s of o.renderedRows()){let r=o.rowHeight(s),h="thr";if(o.isInSelection(((t,e)=>s>=t.top&&s<=t.top+(e?.RowSpan-1||0)))&&(h+=" thr-sel"),s===l.Size.Rows-1&&(h+=" last",r+=1),a.push(i("div",{class:h,style:{height:e(r),top:e(t)}},[""+(s+1),i("div",{class:"v-size no-me",on:{pointerdown:c.vMouseDown,pointerup:c.vMouseUp,pointermove:c.vMouseMove}})])),t+=r,t>=n)break}p.bottom=t-s-1}()):o.gridLines&&console.dir("calc maxPos"),o.gridLines&&(function(){let t=d;for(const s of o.renderedColumns()){if(t+=o.colWidth(s),t>=h)break;let r="vline";s==l.Fixed.Columns-1&&(r+=" freeze"),a.push(i("div",{class:r,style:{left:e(t),height:e(p.bottom)}}))}}(),function(){let t=s;for(const s of o.renderedRows()){if(t+=o.rowHeight(s),t>=n)break;let r="hline";s===l.Fixed.Rows-1&&(r+=" freeze"),a.push(i("div",{class:r,style:{top:e(t),width:e(p.right)}}))}}()),this.rItem>=0&&("C"==this.rType?a.push(i("div",{class:"h-resize-line",style:{left:e(this.rPt)}})):a.push(i("div",{class:"v-resize-line",style:{top:e(this.rPt)}}))),i("div",{class:"canvas"},a)}},o={render(e){let s=this.$parent,i=s.sheet,o=s.$refs.container;if(!o)return;let l=o.clientWidth,r=o.clientHeight,h=[],n=columnHeaderHeigth;const a=s.startX;for(const o of s.renderedRows()){let c=a,d=this.$parent.rowHeight(o);for(const r of s.renderedColumns()){let a=t(r),p=s.colWidth(r);const f=`${a}${o+1}`;let u=i.Cells[f];if(u){if(u.ColSpan>1||u.RowSpan>1){let t=p,i=d;for(let e=1;e<u.ColSpan;e++)t+=s.colWidth(e+r);for(let t=1;t<u.RowSpan;t++)i+=s.rowHeight(t+o);h.push(e("div",{class:"cell-ph",style:{left:toPx(c+1),top:toPx(n+1),width:toPx(t-1),height:toPx(i-1)}}))}let t="cell"+s.cellClass(u);h.push(e("div",{class:t,style:{left:toPx(c),top:toPx(n),width:toPx(p+1),height:toPx(d+1)}},u.Content))}if(c+=p,c>=l)break}if(n+=d,n>=r)break}return e("div",{class:"cells"},h)}},l={render(i){let o=this.$parent,l=o.sheet,r=o.$refs.container;if(!r)return;let h=r.clientWidth,n=r.clientHeight,a=[],c=s;const d=o.startX;for(const s of o.renderedRows()){let r=d,p=this.$parent.rowHeight(s);for(const n of o.renderedColumns()){let d=t(n),f=o.colWidth(n);const u=`${d}${s+1}`;let m=l.Cells[u];if(m){if(m.ColSpan>1||m.RowSpan>1){let t=f,l=p;for(let e=1;e<m.ColSpan;e++)t+=o.colWidth(e+n);for(let t=1;t<m.RowSpan;t++)l+=o.rowHeight(t+s);a.push(i("div",{class:"cell-ph",style:{left:e(r+1),top:e(c+1),width:e(t-1),height:e(l-1)}}))}let t="cell"+o.cellClass(m);a.push(i("div",{class:t,style:{left:e(r),top:e(c),width:e(f+1),height:e(p+1)}},m.Content))}if(r+=f,r>=h)break}if(c+=p,c>=n)break}return i("div",{class:"cells"},a)}},r={render(t){let s=this.$parent.sheet.$selection,i=[];for(let o=0;o<s.length;o++){let l=s[o],r=this.$parent.selRect(l);if(r&&r.left>=0&&r.top>=0){for(let t=l.left+1;t<l.right;t++)r.width+=this.$parent.colWidth(t);for(let t=l.top+1;t<l.bottom;t++)r.height+=this.$parent.rowHeight(t);let s="sel";(l.bottom>l.top+1||l.right>l.left+1)&&(s+=" multiply"),i.push(t("div",{class:s,style:{left:e(r.left),top:e(r.top),width:e(r.width+1),height:e(r.height+1)}}))}}return t("div",{class:"selections"},i)}},h={methods:{blur(t){this.$parent.endEdit(t.target.innerText)}},render(s){let i=this.$parent,o=i.editRect,l=`${t(o.c)}${o.r+1}`,r=i.sheet.Cells[l];return s("div",{class:"input cell-edit no-me"+i.cellClass(r),style:{left:e(o.l+1),top:e(o.t+1),width:e(o.w-1),height:e(o.h-1)},domProps:{contentEditable:!0},on:{blur:this.blur}},i.editText)},mounted(){this.$el.focus()}};var n={template:'\n<div class="ss-toolbar">TOOLBAR\n\t<button @click="forAll(\'Bold\')">B</button>\n\t<button @click="forAll(\'Italic\')">I</button>\n</div>\n',props:{},methods:{forAll(t){let e=this.$parent.sheet.$selection;if(!e.length)return;for(let s of e)for(let e=s.top;e<s.bottom;e++)for(let i=s.left;i<s.right;i++)this.$parent.setProp(i,e,(e=>Vue.set(e,t,true)),true)}}};Vue.component("a2-spreadsheet",{template:'\n<div class="ss-container" :class="{editable}">\n\t<ss-toolbar v-if="editable" />\n\t<div class="ss-body" :key=updateCount ref=container tabindex=0\n\t\t@pointerup=pointerup @pointerdown=pointerdown @pointermove=pointermove\n\t\t@dblclick=dblclick @keydown.self.stop.prevent=keydown @wheel.prevent=mousewheel>\n\t\t<ss-canvas />\n\t\t<ss-rows-combo v-if="rowsCombo" />\n\t\t<ss-cells />\n\t\t<ss-selection />\n\t\t<ss-edit v-if=editing text=editText />\n\t</div>\n\t<a2-scroll-bar class="no-me" :horz=true :min="sheet.Fixed.Columns" :max="sheet.Size.Columns"\n\t\t:pos="scrollPos.x" :page="hScrollPageSize()"" :setPos=setPosX></a2-scroll-bar>\n\t<a2-scroll-bar class="no-me" :horz=false :min="sheet.Fixed.Rows" :max="sheet.Size.Rows"\n\t\t:pos="scrollPos.y" :page="vScrollPageSize()" :setPos=setPosY></a2-scroll-bar>\n</div>\n',components:{"ss-canvas":i,"ss-cell":o,"ss-cells":l,"ss-selection":r,"ss-edit":h,"ss-toolbar":n},props:{sheet:Object,gridLines:{type:Boolean,default:!0},headers:{type:Boolean,default:!0},rowsCombo:Boolean,editable:{type:Boolean,default:!0}},data:()=>({updateCount:0,scrollPos:{x:0,y:0},editing:!1,selecting:!1,editRect:{l:0,t:0,w:0,h:0,c:"",r:-1},editText:"",selStart:{c:0,r:0}}),computed:{startX(){return 32+(this.rowsCombo?75:0)}},methods:{rowFromPoint(t){let e=s;for(const s of this.renderedRows()){let i=this.rowHeight(s);if(t>=e&&t<=e+i)return{row:s,top:e,height:i};e+=i}return null},colFromPoint(t){let e=this.startX;for(const s of this.renderedColumns()){let i=this.colWidth(s);if(t>=e&&t<=e+i)return{col:s,left:e,width:i};e+=i}return null},colWidth(e){let s=this.sheet.Columns[t(e)];return s?s.Width:100},rowHeight(t){let e=this.sheet.Rows[t+1];return e?e.Height:23},getOrCreateRow(t){let e=this.sheet.Rows[t+1];return e||(e={},Vue.set(this.sheet.Rows,t+1,e)),e},getOrCreateColumn(e){let s=t(e),i=this.sheet.Columns[s];return i||(i={},Vue.set(this.sheet.Columns,s,i)),i},selRect(t){let e=t.left,i=t.top,o=s,l={left:0,top:0,height:0,width:0};for(const t of this.renderedRows()){let e=this.rowHeight(t);if(t===i){l.top=o,l.height=e;break}if(t>i)break;o+=e}let r=this.startX;for(const t of this.renderedColumns()){let s=this.colWidth(t);if(t===e){l.left=r,l.width=s;break}if(t>e)break;r+=s}return l},pointFromEvent(t){let e=this.$refs.container.getBoundingClientRect(),s=t.clientY-e.top;return{x:t.clientX-e.left,y:s}},setPosX(t){this.scrollPos.x=t},setPosY(t){this.scrollPos.y=t},renderedRows:function*(){let t=this.sheet;for(let e=0;e<t.Fixed.Rows;e++)yield e;for(let e=this.scrollPos.y;e<t.Size.Rows;e++)yield e},renderedColumns:function*(){let t=this.sheet;for(let e=0;e<t.Fixed.Columns;e++)yield e;for(let e=this.scrollPos.x;e<t.Size.Columns;e++)yield e},setPos(t,e){let s=this.sheet.$selection;if(!s||!s.length)return;let i=s[0],o=this.sheet;o.Fixed;let l=o.Size;t<0&&(t=0),t>l.Columns-1&&(t=l.Columns-1),e<0&&(e=0),e>l.Rows-1&&(e=l.Rows-1),i.left=t,i.right=t+1,i.top=e,i.bottom=e+1,this.fitScrollPos()},mousewheel(t){let e=+(t.deltaY/100).toFixed();this.scrollPos.y=e>0?Math.min(this.scrollPos.y+e,this.sheet.Size.Rows-this.vScrollPageSize()):Math.max(this.scrollPos.y+e,this.sheet.Fixed.Rows)},keydown(t){let e=this.sheet.$selection;if(!e||!e.length)return;let s=e[0];switch(t.which){case 37:this.setPos(s.left-1,s.top);break;case 38:this.setPos(s.left,s.top-1);break;case 39:this.setPos(s.left+1,s.top);break;case 40:this.setPos(s.left,s.top+1);break;case 34:this.setPos(s.left,s.top+this.vScrollPageSize()+this.sheet.Fixed.Rows);break;case 33:this.setPos(s.left,s.top-this.vScrollPageSize());break;case 36:this.setPos(0,s.top);break;case 35:this.setPos(this.sheet.Size.Columns-1,s.top);break;case 113:let e=this.selRect(s);this.doEdit({col:s.left,left:e.left,width:e.width},{row:s.top,top:e.top,heigth:e.height});break;default:console.dir(t.which)}},fitSpan(e,s){if(!e||!s)return;let i=`${t(e.col)}${s.row+1}`,o=this.sheet.Cells[i];if(o){if(o.ColSpan>1)for(let t=1;t<o.ColSpan;t++)e.width+=this.colWidth(e.col+t);if(o.RowSpan>1)for(let t=1;t<o.RowSpan;t++)s.height+=this.rowHeight(s.row+t)}},dblclick(t){if(t.srcElement.classList.contains("no-me"))return;let e=this.pointFromEvent(t),s=this.colFromPoint(e.x),i=this.rowFromPoint(e.y);this.fitSpan(s,i),this.doEdit(s,i)},setProp(e,s,i,o){let l=`${t(e)}${s+1}`,r=this.sheet.Cells[l];!r&&o&&(r={},Vue.set(this.sheet.Cells,l,r)),r&&i(r)},endEdit(e){let s=this.editRect,i=`${t(s.c)}${s.r+1}`,o=this.sheet.Cells[i];if(o)o.Content=e;else{if(!e)return;o={Content:e},Vue.set(this.sheet.Cells,i,o)}},startEdit:(t,e)=>({control:"editor"}),doEdit(e,s){if(!e||!s)return;if(!this.startEdit(t(e.col),s.row))return;let i=this.editRect;i.l=e.left,i.t=s.top,i.w=e.width,i.h=s.height,i.c=e.col,i.r=s.row;let o=this.sheet.Cells[`${t(e.col)}${s.row+1}`];this.editText=o?o.Content:"",this.editing=!0},pointerdown(t){if(t.srcElement.classList.contains("no-me"))return;t.target.setPointerCapture(t.pointerId),this.editing=!1,this.editText=!1,this.selecting=!0;let e=this.sheet,i=e.$selection,o=this.pointFromEvent(t);if(o.x<this.startX){let t=this.rowFromPoint(o.y);i.length=0;let s={left:0,top:t.row,right:e.Size.Columns+1,bottom:t.row+1};i.push(s)}else if(o.y<s){let t=this.colFromPoint(o.x);i.length=0;let s={left:t.col,top:0,right:t.col+1,bottom:e.Size.Rows+1};i.push(s)}else{let t=this.createSelRect(o.x,o.y);t&&(i.length=0,i.push(t),this.selStart.x=t.left,this.selStart.y=t.top)}},pointermove(t){if(!this.selecting)return;if(t.srcElement.classList.contains("no-me"))return;let e=this.pointFromEvent(t),i=this.sheet.$selection;if(!i||!i.length)return;let o=i[0];if(e.x<this.startX)this.rowFromPoint(e.y),console.dir("select rows");else if(e.y<s)this.colFromPoint(e.x),console.dir("select columns");else{let t=this.createSelRect(e.x,e.y);t.left==this.selStart.x&&(o.left=t.left,o.right=t.right),t.left<this.selStart.x?o.left=t.left:o.right=t.right,t.top==this.selStart.y?(o.top=t.top,o.bottom=t.bottom):t.top<this.selStart.y?o.top=t.top:o.bottom=t.bottom,this.fitScrollPos()}},pointerup(t){t.target.setPointerCapture(t.pointerId),this.selecting=!1,this.selStart.x=0,this.selStart.y=0,this.fitScrollPos()},fitScrollPos(){let t=this.sheet.$selection;if(!t||!t.length)return;let e=t[0],s=this.$refs.container,i=s.clientWidth-1,o=s.clientHeight-1,l=this.sheet.Fixed,r=this.scrollPos,h=null;if(r.y>l.Rows&&e.top<r.y)r.y=Math.max(e.top,l.Rows);else{h=h||this.selRect(e),h.top+h.height+1>o&&(r.y+=1)}if(r.x>l.Columns&&e.left<r.x)r.x=Math.max(e.left,l.Columns);else{h=h||this.selRect(e),h.left+h.width+1>i&&(r.x+=1)}},createSelRect(e,s){let i=this.rowFromPoint(s),o=this.colFromPoint(e);if(o&&i){let e=`${t(o.col)}${i.row+1}`,s=this.sheet.Cells[e];return{left:o.col,top:i.row,right:o.col+1+(s?.ColSpan-1||0),bottom:i.row+1+(s?.RowSpan-1||0)}}return null},isInSelection(e,s){return this.sheet.$selection.some((s=>e(s,this.sheet.Cells[`${t(s.left)}${s.top+1}`])))},cellClass(t){if(!t)return"";let e="";return t.Bold&&(e+=" bold"),t.Italic&&(e+=" italic"),e},hScrollPageSize(){let t=this.$refs.container;if(!t)return 0;let e=this.startX,s=t.clientWidth,i=0;for(let t of this.renderedColumns()){if(e+=this.colWidth(t),e>s)break;t>=this.sheet.Fixed.Columns&&(i+=1)}return i},vScrollPageSize(){let t=this.$refs.container;if(!t)return 0;let e=s,i=t.clientHeight,o=0;for(let t of this.renderedRows()){if(e+=this.rowHeight(t),e>i)break;t>=this.sheet.Fixed.Rows&&(o+=1)}return o}},mounted(){this.updateCount+=1;this.sheet.$selection.push({left:0,top:0,right:1,bottom:1}),this.scrollPos.x=this.sheet.Fixed.Columns,this.scrollPos.y=this.sheet.Fixed.Rows,this.__ro=new ResizeObserver((t=>{this.updateCount+=1,this.fitScrollPos()})),this.__ro.observe(this.$el)},beforeDestroy(){this.__ro&&this.__ro.unobserve(this.$el)}})}));
//# sourceMappingURL=a2v10spreadsheet.min.js.map
