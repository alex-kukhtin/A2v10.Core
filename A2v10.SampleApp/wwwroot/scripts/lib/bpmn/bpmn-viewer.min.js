!function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,(function(r){return o(e[i][1][r]||r)}),p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){"use strict";var _NavigatedViewer=_interopRequireDefault(require("bpmn-js/lib/NavigatedViewer")),_modeling=_interopRequireDefault(require("bpmn-js/lib/features/modeling"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}window.BpmnViewer={create:function(canvas){return"string"==typeof canvas&&(canvas=document.getElementById(canvas)),new _NavigatedViewer.default({container:canvas,keyboard:{bindTo:document.getRootNode()},additionalModules:[_modeling.default]})}}},{"bpmn-js/lib/NavigatedViewer":3,"bpmn-js/lib/features/modeling":73}],2:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BaseViewer;var _minDash=require("min-dash"),_minDom=require("min-dom"),_tinySvg=require("tiny-svg"),_diagramJs=_interopRequireDefault(require("diagram-js")),_bpmnModdle=_interopRequireDefault(require("bpmn-moddle")),_inherits=_interopRequireDefault(require("inherits")),_Importer=require("./import/Importer"),_CompatibilityUtil=require("./util/CompatibilityUtil"),_PoweredByUtil=require("./util/PoweredByUtil");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function BaseViewer(options){var container,img,linkMarkup,linkElement;options=(0,_minDash.assign)({},DEFAULT_OPTIONS,options),this._moddle=this._createModdle(options),this._container=this._createContainer(options),container=this._container,img=_PoweredByUtil.BPMNIO_IMG,linkMarkup='<a href="http://bpmn.io" target="_blank" class="bjs-powered-by" title="Powered by bpmn.io" style="position: absolute; bottom: 15px; right: 15px; z-index: 100; '+_PoweredByUtil.LINK_STYLES+'">'+img+"</a>",linkElement=(0,_minDom.domify)(linkMarkup),container.appendChild(linkElement),_minDom.event.bind(linkElement,"click",(function(event){(0,_PoweredByUtil.open)(),event.preventDefault()})),this._init(this._container,this._moddle,options)}function addWarningsToError(err,warningsAry){return err.warnings=warningsAry,err}(0,_inherits.default)(BaseViewer,_diagramJs.default),BaseViewer.prototype.importXML=(0,_CompatibilityUtil.wrapForCompatibility)((function(xml,bpmnDiagram){var self=this;return new Promise((function(resolve,reject){xml=self._emit("import.parse.start",{xml})||xml,self._moddle.fromXML(xml,"bpmn:Definitions").then((function(result){var data,event,definitions=result.rootElement,references=result.references,parseWarnings=result.warnings,elementsById=result.elementsById;definitions=self._emit("import.parse.complete",(data={error:null,definitions,elementsById,references,warnings:parseWarnings},event=self.get("eventBus").createEvent(data),Object.defineProperty(event,"context",{enumerable:!0,get:function(){return console.warn(new Error("import.parse.complete <context> is deprecated and will be removed in future library versions")),{warnings:data.warnings,references:data.references,elementsById:data.elementsById}}}),event))||definitions,self.importDefinitions(definitions,bpmnDiagram).then((function(result){var allWarnings=[].concat(parseWarnings,result.warnings||[]);return self._emit("import.done",{error:null,warnings:allWarnings}),resolve({warnings:allWarnings})})).catch((function(err){var allWarnings=[].concat(parseWarnings,err.warnings||[]);return self._emit("import.done",{error:err,warnings:allWarnings}),reject(addWarningsToError(err,allWarnings))}))})).catch((function(err){return self._emit("import.parse.complete",{error:err}),err=function(err){var match=/unparsable content <([^>]+)> detected([\s\S]*)$/.exec(err.message);match&&(err.message="unparsable content <"+match[1]+"> detected; this may indicate an invalid BPMN 2.0 diagram file"+match[2]);return err}(err),self._emit("import.done",{error:err,warnings:err.warnings}),reject(err)}))}))})),BaseViewer.prototype.importDefinitions=(0,_CompatibilityUtil.wrapForCompatibility)((function(definitions,bpmnDiagram){var self=this;return new Promise((function(resolve,reject){self._setDefinitions(definitions),self.open(bpmnDiagram).then((function(result){var warnings=result.warnings;return resolve({warnings})})).catch((function(err){return reject(err)}))}))})),BaseViewer.prototype.open=(0,_CompatibilityUtil.wrapForCompatibility)((function(bpmnDiagramOrId){var definitions=this._definitions,bpmnDiagram=bpmnDiagramOrId,self=this;return new Promise((function(resolve,reject){if(!definitions){var err1=new Error("no XML imported");return reject(addWarningsToError(err1,[]))}if("string"==typeof bpmnDiagramOrId&&!(bpmnDiagram=function(definitions,diagramId){if(!diagramId)return null;return(0,_minDash.find)(definitions.diagrams,(function(element){return element.id===diagramId}))||null}(definitions,bpmnDiagramOrId))){var err2=new Error("BPMNDiagram <"+bpmnDiagramOrId+"> not found");return reject(addWarningsToError(err2,[]))}try{self.clear()}catch(error){return reject(addWarningsToError(error,[]))}(0,_Importer.importBpmnDiagram)(self,definitions,bpmnDiagram).then((function(result){var warnings=result.warnings;return resolve({warnings})})).catch((function(err){return reject(err)}))}))})),BaseViewer.prototype.saveXML=(0,_CompatibilityUtil.wrapForCompatibility)((function(options){options=options||{};var self=this,definitions=this._definitions;return new Promise((function(resolve){if(!definitions)return resolve({error:new Error("no definitions loaded")});definitions=self._emit("saveXML.start",{definitions})||definitions,self._moddle.toXML(definitions,options).then((function(result){var xml=result.xml;return xml=self._emit("saveXML.serialized",{xml})||xml,resolve({xml})}))})).catch((function(error){return{error}})).then((function(result){self._emit("saveXML.done",result);var error=result.error;return error?Promise.reject(error):result}))})),BaseViewer.prototype.saveSVG=(0,_CompatibilityUtil.wrapForCompatibility)((function(options){options=options||{};var self=this;return new Promise((function(resolve,reject){var svg,err;self._emit("saveSVG.start");try{var canvas=self.get("canvas"),contentNode=canvas.getDefaultLayer(),defsNode=(0,_minDom.query)("defs",canvas._svg),contents=(0,_tinySvg.innerSVG)(contentNode),defs=defsNode?"<defs>"+(0,_tinySvg.innerSVG)(defsNode)+"</defs>":"",bbox=contentNode.getBBox();svg='<?xml version="1.0" encoding="utf-8"?>\n\x3c!-- created with bpmn-js / http://bpmn.io --\x3e\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+bbox.width+'" height="'+bbox.height+'" viewBox="'+bbox.x+" "+bbox.y+" "+bbox.width+" "+bbox.height+'" version="1.1">'+defs+contents+"</svg>"}catch(e){err=e}return self._emit("saveSVG.done",{error:err,svg}),err?reject(err):resolve({svg})}))})),BaseViewer.prototype._setDefinitions=function(definitions){this._definitions=definitions},BaseViewer.prototype.getModules=function(){return this._modules},BaseViewer.prototype.clear=function(){this.getDefinitions()&&(this.get("elementRegistry").forEach((function(element){var bo=element.businessObject;bo&&bo.di&&delete bo.di})),_diagramJs.default.prototype.clear.call(this))},BaseViewer.prototype.destroy=function(){_diagramJs.default.prototype.destroy.call(this),(0,_minDom.remove)(this._container)},BaseViewer.prototype.on=function(event,priority,callback,target){return this.get("eventBus").on(event,priority,callback,target)},BaseViewer.prototype.off=function(event,callback){this.get("eventBus").off(event,callback)},BaseViewer.prototype.attachTo=function(parentNode){if(!parentNode)throw new Error("parentNode required");this.detach(),parentNode.get&&parentNode.constructor.prototype.jquery&&(parentNode=parentNode.get(0)),"string"==typeof parentNode&&(parentNode=(0,_minDom.query)(parentNode)),parentNode.appendChild(this._container),this._emit("attach",{}),this.get("canvas").resized()},BaseViewer.prototype.getDefinitions=function(){return this._definitions},BaseViewer.prototype.detach=function(){var container=this._container,parentNode=container.parentNode;parentNode&&(this._emit("detach",{}),parentNode.removeChild(container))},BaseViewer.prototype._init=function(container,moddle,options){var baseModules=options.modules||this.getModules(),additionalModules=options.additionalModules||[],diagramModules=[].concat([{bpmnjs:["value",this],moddle:["value",moddle]}],baseModules,additionalModules),diagramOptions=(0,_minDash.assign)((0,_minDash.omit)(options,["additionalModules"]),{canvas:(0,_minDash.assign)({},options.canvas,{container}),modules:diagramModules});_diagramJs.default.call(this,diagramOptions),options&&options.container&&this.attachTo(options.container)},BaseViewer.prototype._emit=function(type,event){return this.get("eventBus").fire(type,event)},BaseViewer.prototype._createContainer=function(options){var container=(0,_minDom.domify)('<div class="bjs-container"></div>');return(0,_minDash.assign)(container.style,{width:ensureUnit(options.width),height:ensureUnit(options.height),position:options.position}),container},BaseViewer.prototype._createModdle=function(options){var moddleOptions=(0,_minDash.assign)({},this._moddleExtensions,options.moddleExtensions);return new _bpmnModdle.default(moddleOptions)},BaseViewer.prototype._modules=[];var DEFAULT_OPTIONS={width:"100%",height:"100%",position:"relative"};function ensureUnit(val){return val+((0,_minDash.isNumber)(val)?"px":"")}},{"./import/Importer":85,"./util/CompatibilityUtil":88,"./util/PoweredByUtil":92,"bpmn-moddle":93,"diagram-js":94,inherits:218,"min-dash":219,"min-dom":220,"tiny-svg":228}],3:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=NavigatedViewer;var _inherits=_interopRequireDefault(require("inherits")),_Viewer=_interopRequireDefault(require("./Viewer")),_keyboardMove=_interopRequireDefault(require("diagram-js/lib/navigation/keyboard-move")),_movecanvas=_interopRequireDefault(require("diagram-js/lib/navigation/movecanvas")),_zoomscroll=_interopRequireDefault(require("diagram-js/lib/navigation/zoomscroll"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function NavigatedViewer(options){_Viewer.default.call(this,options)}(0,_inherits.default)(NavigatedViewer,_Viewer.default),NavigatedViewer.prototype._navigationModules=[_keyboardMove.default,_movecanvas.default,_zoomscroll.default],NavigatedViewer.prototype._modules=[].concat(_Viewer.default.prototype._modules,NavigatedViewer.prototype._navigationModules)},{"./Viewer":4,"diagram-js/lib/navigation/keyboard-move":192,"diagram-js/lib/navigation/movecanvas":194,"diagram-js/lib/navigation/zoomscroll":197,inherits:218}],4:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Viewer;var _inherits=_interopRequireDefault(require("inherits")),_core=_interopRequireDefault(require("./core")),_translate=_interopRequireDefault(require("diagram-js/lib/i18n/translate")),_selection=_interopRequireDefault(require("diagram-js/lib/features/selection")),_overlays=_interopRequireDefault(require("diagram-js/lib/features/overlays")),_BaseViewer=_interopRequireDefault(require("./BaseViewer"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function Viewer(options){_BaseViewer.default.call(this,options)}(0,_inherits.default)(Viewer,_BaseViewer.default),Viewer.prototype._modules=[_core.default,_translate.default,_selection.default,_overlays.default],Viewer.prototype._moddleExtensions={}},{"./BaseViewer":2,"./core":5,"diagram-js/lib/features/overlays":163,"diagram-js/lib/features/selection":175,"diagram-js/lib/i18n/translate":184,inherits:218}],5:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _draw=_interopRequireDefault(require("../draw")),_import=_interopRequireDefault(require("../import"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _default={__depends__:[_draw.default,_import.default]};exports.default=_default},{"../draw":10,"../import":87}],6:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isTypedEvent=function(event,eventDefinitionType,filter){return(0,_minDash.some)(event.eventDefinitions,(function(definition){return definition.$type===eventDefinitionType&&function(definition,filter){return(0,_minDash.every)(filter,(function(val,key){return definition[key]==val}))}(event,filter)}))},exports.isThrowEvent=function(event){return"bpmn:IntermediateThrowEvent"===event.$type||"bpmn:EndEvent"===event.$type},exports.isCollection=function(element){var dataObject=element.dataObjectRef;return element.isCollection||dataObject&&dataObject.isCollection},exports.getDi=getDi,exports.getSemantic=function(element){return element.businessObject},exports.getFillColor=function(element,defaultColor){var di=getDi(element);return di.get("color:background-color")||di.get("bioc:fill")||defaultColor||"white"},exports.getStrokeColor=getStrokeColor,exports.getLabelColor=function(element,defaultColor,defaultStrokeColor){var label=getDi(element).get("label");return label&&label.get("color:color")||defaultColor||getStrokeColor(element,defaultStrokeColor)},exports.getCirclePath=function(shape){var cx=shape.x+shape.width/2,cy=shape.y+shape.height/2,radius=shape.width/2,circlePath=[["M",cx,cy],["m",0,-radius],["a",radius,radius,0,1,1,0,2*radius],["a",radius,radius,0,1,1,0,-2*radius],["z"]];return(0,_RenderUtil.componentsToPath)(circlePath)},exports.getRoundRectPath=function(shape,borderRadius){var x=shape.x,y=shape.y,width=shape.width,height=shape.height,roundRectPath=[["M",x+borderRadius,y],["l",width-2*borderRadius,0],["a",borderRadius,borderRadius,0,0,1,borderRadius,borderRadius],["l",0,height-2*borderRadius],["a",borderRadius,borderRadius,0,0,1,-borderRadius,borderRadius],["l",2*borderRadius-width,0],["a",borderRadius,borderRadius,0,0,1,-borderRadius,-borderRadius],["l",0,2*borderRadius-height],["a",borderRadius,borderRadius,0,0,1,borderRadius,-borderRadius],["z"]];return(0,_RenderUtil.componentsToPath)(roundRectPath)},exports.getDiamondPath=function(shape){var width=shape.width,height=shape.height,x=shape.x,y=shape.y,halfWidth=width/2,halfHeight=height/2,diamondPath=[["M",x+halfWidth,y],["l",halfWidth,halfHeight],["l",-halfWidth,halfHeight],["l",-halfWidth,-halfHeight],["z"]];return(0,_RenderUtil.componentsToPath)(diamondPath)},exports.getRectPath=function(shape){var x=shape.x,y=shape.y,width=shape.width,height=shape.height,rectPath=[["M",x,y],["l",width,0],["l",0,height],["l",-width,0],["z"]];return(0,_RenderUtil.componentsToPath)(rectPath)};var _minDash=require("min-dash"),_RenderUtil=require("diagram-js/lib/util/RenderUtil");function getDi(element){return element.businessObject.di}function getStrokeColor(element,defaultColor){var di=getDi(element);return di.get("color:border-color")||di.get("bioc:stroke")||defaultColor||"black"}},{"diagram-js/lib/util/RenderUtil":213,"min-dash":219}],7:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BpmnRenderer;var _inherits=_interopRequireDefault(require("inherits")),_minDash=require("min-dash"),_BaseRenderer=_interopRequireDefault(require("diagram-js/lib/draw/BaseRenderer")),_DiUtil=require("../util/DiUtil"),_LabelUtil=require("../features/label-editing/LabelUtil"),_ModelUtil=require("../util/ModelUtil"),_RenderUtil=require("diagram-js/lib/util/RenderUtil"),_BpmnRenderUtil=require("./BpmnRenderUtil"),_minDom=require("min-dom"),_tinySvg=require("tiny-svg"),_SvgTransformUtil=require("diagram-js/lib/util/SvgTransformUtil");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var RENDERER_IDS=new(_interopRequireDefault(require("ids")).default);function BpmnRenderer(config,eventBus,styles,pathMap,canvas,textRenderer,priority){_BaseRenderer.default.call(this,eventBus,priority);var defaultFillColor=config&&config.defaultFillColor,defaultStrokeColor=config&&config.defaultStrokeColor,defaultLabelColor=config&&config.defaultLabelColor,rendererId=RENDERER_IDS.next(),markers={},computeStyle=styles.computeStyle;function addMarker(id,options){var attrs=(0,_minDash.assign)({fill:"black",strokeWidth:1,strokeLinecap:"round",strokeDasharray:"none"},options.attrs),ref=options.ref||{x:0,y:0},scale=options.scale||1;"none"===attrs.strokeDasharray&&(attrs.strokeDasharray=[1e4,1]);var marker=(0,_tinySvg.create)("marker");(0,_tinySvg.attr)(options.element,attrs),(0,_tinySvg.append)(marker,options.element),(0,_tinySvg.attr)(marker,{id,viewBox:"0 0 20 20",refX:ref.x,refY:ref.y,markerWidth:20*scale,markerHeight:20*scale,orient:"auto"});var defs=(0,_minDom.query)("defs",canvas._svg);defs||(defs=(0,_tinySvg.create)("defs"),(0,_tinySvg.append)(canvas._svg,defs)),(0,_tinySvg.append)(defs,marker),markers[id]=marker}function colorEscape(str){return str.replace(/[^0-9a-zA-z]+/g,"_")}function marker(type,fill,stroke){var id=type+"-"+colorEscape(fill)+"-"+colorEscape(stroke)+"-"+rendererId;return markers[id]||function(id,type,fill,stroke){if("sequenceflow-end"===type){var sequenceflowEnd=(0,_tinySvg.create)("path");(0,_tinySvg.attr)(sequenceflowEnd,{d:"M 1 5 L 11 10 L 1 15 Z"}),addMarker(id,{element:sequenceflowEnd,ref:{x:11,y:10},scale:.5,attrs:{fill:stroke,stroke}})}if("messageflow-start"===type){var messageflowStart=(0,_tinySvg.create)("circle");(0,_tinySvg.attr)(messageflowStart,{cx:6,cy:6,r:3.5}),addMarker(id,{element:messageflowStart,attrs:{fill,stroke},ref:{x:6,y:6}})}if("messageflow-end"===type){var messageflowEnd=(0,_tinySvg.create)("path");(0,_tinySvg.attr)(messageflowEnd,{d:"m 1 5 l 0 -3 l 7 3 l -7 3 z"}),addMarker(id,{element:messageflowEnd,attrs:{fill,stroke,strokeLinecap:"butt"},ref:{x:8.5,y:5}})}if("association-start"===type){var associationStart=(0,_tinySvg.create)("path");(0,_tinySvg.attr)(associationStart,{d:"M 11 5 L 1 10 L 11 15"}),addMarker(id,{element:associationStart,attrs:{fill:"none",stroke,strokeWidth:1.5},ref:{x:1,y:10},scale:.5})}if("association-end"===type){var associationEnd=(0,_tinySvg.create)("path");(0,_tinySvg.attr)(associationEnd,{d:"M 1 5 L 11 10 L 1 15"}),addMarker(id,{element:associationEnd,attrs:{fill:"none",stroke,strokeWidth:1.5},ref:{x:12,y:10},scale:.5})}if("conditional-flow-marker"===type){var conditionalflowMarker=(0,_tinySvg.create)("path");(0,_tinySvg.attr)(conditionalflowMarker,{d:"M 0 10 L 8 6 L 16 10 L 8 14 Z"}),addMarker(id,{element:conditionalflowMarker,attrs:{fill,stroke},ref:{x:-1,y:10},scale:.5})}if("conditional-default-flow-marker"===type){var conditionaldefaultflowMarker=(0,_tinySvg.create)("path");(0,_tinySvg.attr)(conditionaldefaultflowMarker,{d:"M 6 4 L 10 16"}),addMarker(id,{element:conditionaldefaultflowMarker,attrs:{stroke},ref:{x:0,y:10},scale:.5})}}(id,type,fill,stroke),"url(#"+id+")"}function drawCircle(parentGfx,width,height,offset,attrs){(0,_minDash.isObject)(offset)&&(attrs=offset,offset=0),offset=offset||0,"none"===(attrs=computeStyle(attrs,{stroke:"black",strokeWidth:2,fill:"white"})).fill&&delete attrs.fillOpacity;var cx=width/2,cy=height/2,circle=(0,_tinySvg.create)("circle");return(0,_tinySvg.attr)(circle,{cx,cy,r:Math.round((width+height)/4-offset)}),(0,_tinySvg.attr)(circle,attrs),(0,_tinySvg.append)(parentGfx,circle),circle}function drawRect(parentGfx,width,height,r,offset,attrs){(0,_minDash.isObject)(offset)&&(attrs=offset,offset=0),offset=offset||0,attrs=computeStyle(attrs,{stroke:"black",strokeWidth:2,fill:"white"});var rect=(0,_tinySvg.create)("rect");return(0,_tinySvg.attr)(rect,{x:offset,y:offset,width:width-2*offset,height:height-2*offset,rx:r,ry:r}),(0,_tinySvg.attr)(rect,attrs),(0,_tinySvg.append)(parentGfx,rect),rect}function drawLine(parentGfx,waypoints,attrs){attrs=computeStyle(attrs,["no-fill"],{stroke:"black",strokeWidth:2,fill:"none"});var line=(0,_RenderUtil.createLine)(waypoints,attrs);return(0,_tinySvg.append)(parentGfx,line),line}function drawPath(parentGfx,d,attrs){attrs=computeStyle(attrs,["no-fill"],{strokeWidth:2,stroke:"black"});var path=(0,_tinySvg.create)("path");return(0,_tinySvg.attr)(path,{d}),(0,_tinySvg.attr)(path,attrs),(0,_tinySvg.append)(parentGfx,path),path}function drawMarker(type,parentGfx,path,attrs){return drawPath(parentGfx,path,(0,_minDash.assign)({"data-marker":type},attrs))}function as(type){return function(parentGfx,element){return handlers[type](parentGfx,element)}}function renderer(type){return handlers[type]}function renderEventContent(element,parentGfx){var event=(0,_BpmnRenderUtil.getSemantic)(element),isThrowing=(0,_BpmnRenderUtil.isThrowEvent)(event);return event.eventDefinitions&&event.eventDefinitions.length>1?event.parallelMultiple?renderer("bpmn:ParallelMultipleEventDefinition")(parentGfx,element,isThrowing):renderer("bpmn:MultipleEventDefinition")(parentGfx,element,isThrowing):(0,_BpmnRenderUtil.isTypedEvent)(event,"bpmn:MessageEventDefinition")?renderer("bpmn:MessageEventDefinition")(parentGfx,element,isThrowing):(0,_BpmnRenderUtil.isTypedEvent)(event,"bpmn:TimerEventDefinition")?renderer("bpmn:TimerEventDefinition")(parentGfx,element,isThrowing):(0,_BpmnRenderUtil.isTypedEvent)(event,"bpmn:ConditionalEventDefinition")?renderer("bpmn:ConditionalEventDefinition")(parentGfx,element):(0,_BpmnRenderUtil.isTypedEvent)(event,"bpmn:SignalEventDefinition")?renderer("bpmn:SignalEventDefinition")(parentGfx,element,isThrowing):(0,_BpmnRenderUtil.isTypedEvent)(event,"bpmn:EscalationEventDefinition")?renderer("bpmn:EscalationEventDefinition")(parentGfx,element,isThrowing):(0,_BpmnRenderUtil.isTypedEvent)(event,"bpmn:LinkEventDefinition")?renderer("bpmn:LinkEventDefinition")(parentGfx,element,isThrowing):(0,_BpmnRenderUtil.isTypedEvent)(event,"bpmn:ErrorEventDefinition")?renderer("bpmn:ErrorEventDefinition")(parentGfx,element,isThrowing):(0,_BpmnRenderUtil.isTypedEvent)(event,"bpmn:CancelEventDefinition")?renderer("bpmn:CancelEventDefinition")(parentGfx,element,isThrowing):(0,_BpmnRenderUtil.isTypedEvent)(event,"bpmn:CompensateEventDefinition")?renderer("bpmn:CompensateEventDefinition")(parentGfx,element,isThrowing):(0,_BpmnRenderUtil.isTypedEvent)(event,"bpmn:TerminateEventDefinition")?renderer("bpmn:TerminateEventDefinition")(parentGfx,element,isThrowing):null}function renderLabel(parentGfx,label,options){options=(0,_minDash.assign)({size:{width:100}},options);var text=textRenderer.createText(label||"",options);return(0,_tinySvg.classes)(text).add("djs-label"),(0,_tinySvg.append)(parentGfx,text),text}function renderEmbeddedLabel(parentGfx,element,align){return renderLabel(parentGfx,(0,_BpmnRenderUtil.getSemantic)(element).name,{box:element,align,padding:5,style:{fill:(0,_BpmnRenderUtil.getLabelColor)(element,defaultLabelColor,defaultStrokeColor)}})}function renderLaneLabel(parentGfx,text,element){var textBox=renderLabel(parentGfx,text,{box:{height:30,width:element.height},align:"center-middle",style:{fill:(0,_BpmnRenderUtil.getLabelColor)(element,defaultLabelColor,defaultStrokeColor)}}),top=-1*element.height;(0,_SvgTransformUtil.transform)(textBox,0,-top,270)}function createPathFromConnection(connection){for(var waypoints=connection.waypoints,pathData="m  "+waypoints[0].x+","+waypoints[0].y,i=1;i<waypoints.length;i++)pathData+="L"+waypoints[i].x+","+waypoints[i].y+" ";return pathData}var handlers=this.handlers={"bpmn:Event":function(parentGfx,element,attrs){return"fillOpacity"in attrs||(attrs.fillOpacity=.95),drawCircle(parentGfx,element.width,element.height,attrs)},"bpmn:StartEvent":function(parentGfx,element){var attrs={fill:(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor),stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)};(0,_BpmnRenderUtil.getSemantic)(element).isInterrupting||(attrs={strokeDasharray:"6",strokeLinecap:"round",fill:(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor),stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)});var circle=renderer("bpmn:Event")(parentGfx,element,attrs);return renderEventContent(element,parentGfx),circle},"bpmn:MessageEventDefinition":function(parentGfx,element,isThrowing){return drawPath(parentGfx,pathMap.getScaledPath("EVENT_MESSAGE",{xScaleFactor:.9,yScaleFactor:.9,containerWidth:element.width,containerHeight:element.height,position:{mx:.235,my:.315}}),{strokeWidth:1,fill:isThrowing?(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor):(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor),stroke:isThrowing?(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor):(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)})},"bpmn:TimerEventDefinition":function(parentGfx,element){var circle=drawCircle(parentGfx,element.width,element.height,.2*element.height,{strokeWidth:2,fill:(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor),stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)});drawPath(parentGfx,pathMap.getScaledPath("EVENT_TIMER_WH",{xScaleFactor:.75,yScaleFactor:.75,containerWidth:element.width,containerHeight:element.height,position:{mx:.5,my:.5}}),{strokeWidth:2,strokeLinecap:"square",stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)});for(var i=0;i<12;i++){var linePathData=pathMap.getScaledPath("EVENT_TIMER_LINE",{xScaleFactor:.75,yScaleFactor:.75,containerWidth:element.width,containerHeight:element.height,position:{mx:.5,my:.5}}),width=element.width/2;drawPath(parentGfx,linePathData,{strokeWidth:1,strokeLinecap:"square",transform:"rotate("+30*i+","+element.height/2+","+width+")",stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)})}return circle},"bpmn:EscalationEventDefinition":function(parentGfx,event,isThrowing){return drawPath(parentGfx,pathMap.getScaledPath("EVENT_ESCALATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:event.width,containerHeight:event.height,position:{mx:.5,my:.2}}),{strokeWidth:1,fill:isThrowing?(0,_BpmnRenderUtil.getStrokeColor)(event,defaultStrokeColor):"none",stroke:(0,_BpmnRenderUtil.getStrokeColor)(event,defaultStrokeColor)})},"bpmn:ConditionalEventDefinition":function(parentGfx,event){return drawPath(parentGfx,pathMap.getScaledPath("EVENT_CONDITIONAL",{xScaleFactor:1,yScaleFactor:1,containerWidth:event.width,containerHeight:event.height,position:{mx:.5,my:.222}}),{strokeWidth:1,stroke:(0,_BpmnRenderUtil.getStrokeColor)(event,defaultStrokeColor)})},"bpmn:LinkEventDefinition":function(parentGfx,event,isThrowing){return drawPath(parentGfx,pathMap.getScaledPath("EVENT_LINK",{xScaleFactor:1,yScaleFactor:1,containerWidth:event.width,containerHeight:event.height,position:{mx:.57,my:.263}}),{strokeWidth:1,fill:isThrowing?(0,_BpmnRenderUtil.getStrokeColor)(event,defaultStrokeColor):"none",stroke:(0,_BpmnRenderUtil.getStrokeColor)(event,defaultStrokeColor)})},"bpmn:ErrorEventDefinition":function(parentGfx,event,isThrowing){return drawPath(parentGfx,pathMap.getScaledPath("EVENT_ERROR",{xScaleFactor:1.1,yScaleFactor:1.1,containerWidth:event.width,containerHeight:event.height,position:{mx:.2,my:.722}}),{strokeWidth:1,fill:isThrowing?(0,_BpmnRenderUtil.getStrokeColor)(event,defaultStrokeColor):"none",stroke:(0,_BpmnRenderUtil.getStrokeColor)(event,defaultStrokeColor)})},"bpmn:CancelEventDefinition":function(parentGfx,event,isThrowing){var path=drawPath(parentGfx,pathMap.getScaledPath("EVENT_CANCEL_45",{xScaleFactor:1,yScaleFactor:1,containerWidth:event.width,containerHeight:event.height,position:{mx:.638,my:-.055}}),{strokeWidth:1,fill:isThrowing?(0,_BpmnRenderUtil.getStrokeColor)(event,defaultStrokeColor):"none",stroke:(0,_BpmnRenderUtil.getStrokeColor)(event,defaultStrokeColor)});return(0,_SvgTransformUtil.rotate)(path,45),path},"bpmn:CompensateEventDefinition":function(parentGfx,event,isThrowing){return drawPath(parentGfx,pathMap.getScaledPath("EVENT_COMPENSATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:event.width,containerHeight:event.height,position:{mx:.22,my:.5}}),{strokeWidth:1,fill:isThrowing?(0,_BpmnRenderUtil.getStrokeColor)(event,defaultStrokeColor):"none",stroke:(0,_BpmnRenderUtil.getStrokeColor)(event,defaultStrokeColor)})},"bpmn:SignalEventDefinition":function(parentGfx,event,isThrowing){return drawPath(parentGfx,pathMap.getScaledPath("EVENT_SIGNAL",{xScaleFactor:.9,yScaleFactor:.9,containerWidth:event.width,containerHeight:event.height,position:{mx:.5,my:.2}}),{strokeWidth:1,fill:isThrowing?(0,_BpmnRenderUtil.getStrokeColor)(event,defaultStrokeColor):"none",stroke:(0,_BpmnRenderUtil.getStrokeColor)(event,defaultStrokeColor)})},"bpmn:MultipleEventDefinition":function(parentGfx,event,isThrowing){return drawPath(parentGfx,pathMap.getScaledPath("EVENT_MULTIPLE",{xScaleFactor:1.1,yScaleFactor:1.1,containerWidth:event.width,containerHeight:event.height,position:{mx:.222,my:.36}}),{strokeWidth:1,fill:isThrowing?(0,_BpmnRenderUtil.getStrokeColor)(event,defaultStrokeColor):"none"})},"bpmn:ParallelMultipleEventDefinition":function(parentGfx,event){return drawPath(parentGfx,pathMap.getScaledPath("EVENT_PARALLEL_MULTIPLE",{xScaleFactor:1.2,yScaleFactor:1.2,containerWidth:event.width,containerHeight:event.height,position:{mx:.458,my:.194}}),{strokeWidth:1,fill:(0,_BpmnRenderUtil.getStrokeColor)(event,defaultStrokeColor),stroke:(0,_BpmnRenderUtil.getStrokeColor)(event,defaultStrokeColor)})},"bpmn:EndEvent":function(parentGfx,element){var circle=renderer("bpmn:Event")(parentGfx,element,{strokeWidth:4,fill:(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor),stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)});return renderEventContent(element,parentGfx),circle},"bpmn:TerminateEventDefinition":function(parentGfx,element){return drawCircle(parentGfx,element.width,element.height,8,{strokeWidth:4,fill:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor),stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)})},"bpmn:IntermediateEvent":function(parentGfx,element){var outer=renderer("bpmn:Event")(parentGfx,element,{strokeWidth:1,fill:(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor),stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)});return drawCircle(parentGfx,element.width,element.height,3,{strokeWidth:1,fill:(0,_BpmnRenderUtil.getFillColor)(element,"none"),stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)}),renderEventContent(element,parentGfx),outer},"bpmn:IntermediateCatchEvent":as("bpmn:IntermediateEvent"),"bpmn:IntermediateThrowEvent":as("bpmn:IntermediateEvent"),"bpmn:Activity":function(parentGfx,element,attrs){return"fillOpacity"in(attrs=attrs||{})||(attrs.fillOpacity=.95),drawRect(parentGfx,element.width,element.height,10,attrs)},"bpmn:Task":function(parentGfx,element){var attrs={fill:(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor),stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)},rect=renderer("bpmn:Activity")(parentGfx,element,attrs);return renderEmbeddedLabel(parentGfx,element,"center-middle"),attachTaskMarkers(parentGfx,element),rect},"bpmn:ServiceTask":function(parentGfx,element){var task=renderer("bpmn:Task")(parentGfx,element);return drawPath(parentGfx,pathMap.getScaledPath("TASK_TYPE_SERVICE",{abspos:{x:12,y:18}}),{strokeWidth:1,fill:(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor),stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)}),drawPath(parentGfx,pathMap.getScaledPath("TASK_TYPE_SERVICE_FILL",{abspos:{x:17.2,y:18}}),{strokeWidth:0,fill:(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor)}),drawPath(parentGfx,pathMap.getScaledPath("TASK_TYPE_SERVICE",{abspos:{x:17,y:22}}),{strokeWidth:1,fill:(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor),stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)}),task},"bpmn:UserTask":function(parentGfx,element){var task=renderer("bpmn:Task")(parentGfx,element);return drawPath(parentGfx,pathMap.getScaledPath("TASK_TYPE_USER_1",{abspos:{x:15,y:12}}),{strokeWidth:.5,fill:(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor),stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)}),drawPath(parentGfx,pathMap.getScaledPath("TASK_TYPE_USER_2",{abspos:{x:15,y:12}}),{strokeWidth:.5,fill:(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor),stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)}),drawPath(parentGfx,pathMap.getScaledPath("TASK_TYPE_USER_3",{abspos:{x:15,y:12}}),{strokeWidth:.5,fill:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor),stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)}),task},"bpmn:ManualTask":function(parentGfx,element){var task=renderer("bpmn:Task")(parentGfx,element);return drawPath(parentGfx,pathMap.getScaledPath("TASK_TYPE_MANUAL",{abspos:{x:17,y:15}}),{strokeWidth:.5,fill:(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor),stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)}),task},"bpmn:SendTask":function(parentGfx,element){var task=renderer("bpmn:Task")(parentGfx,element);return drawPath(parentGfx,pathMap.getScaledPath("TASK_TYPE_SEND",{xScaleFactor:1,yScaleFactor:1,containerWidth:21,containerHeight:14,position:{mx:.285,my:.357}}),{strokeWidth:1,fill:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor),stroke:(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor)}),task},"bpmn:ReceiveTask":function(parentGfx,element){var pathData,semantic=(0,_BpmnRenderUtil.getSemantic)(element),task=renderer("bpmn:Task")(parentGfx,element);return semantic.instantiate?(drawCircle(parentGfx,28,28,4.4,{strokeWidth:1}),pathData=pathMap.getScaledPath("TASK_TYPE_INSTANTIATING_SEND",{abspos:{x:7.77,y:9.52}})):pathData=pathMap.getScaledPath("TASK_TYPE_SEND",{xScaleFactor:.9,yScaleFactor:.9,containerWidth:21,containerHeight:14,position:{mx:.3,my:.4}}),drawPath(parentGfx,pathData,{strokeWidth:1,fill:(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor),stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)}),task},"bpmn:ScriptTask":function(parentGfx,element){var task=renderer("bpmn:Task")(parentGfx,element);return drawPath(parentGfx,pathMap.getScaledPath("TASK_TYPE_SCRIPT",{abspos:{x:15,y:20}}),{strokeWidth:1,stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)}),task},"bpmn:BusinessRuleTask":function(parentGfx,element){var task=renderer("bpmn:Task")(parentGfx,element),businessHeaderPath=drawPath(parentGfx,pathMap.getScaledPath("TASK_TYPE_BUSINESS_RULE_HEADER",{abspos:{x:8,y:8}}));(0,_tinySvg.attr)(businessHeaderPath,{strokeWidth:1,fill:(0,_BpmnRenderUtil.getFillColor)(element,"#aaaaaa"),stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)});var businessPath=drawPath(parentGfx,pathMap.getScaledPath("TASK_TYPE_BUSINESS_RULE_MAIN",{abspos:{x:8,y:8}}));return(0,_tinySvg.attr)(businessPath,{strokeWidth:1,stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)}),task},"bpmn:SubProcess":function(parentGfx,element,attrs){attrs=(0,_minDash.assign)({fill:(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor),stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)},attrs);var rect=renderer("bpmn:Activity")(parentGfx,element,attrs),expanded=(0,_DiUtil.isExpanded)(element);return(0,_DiUtil.isEventSubProcess)(element)&&(0,_tinySvg.attr)(rect,{strokeDasharray:"1,2"}),renderEmbeddedLabel(parentGfx,element,expanded?"center-top":"center-middle"),expanded?attachTaskMarkers(parentGfx,element):attachTaskMarkers(parentGfx,element,["SubProcessMarker"]),rect},"bpmn:AdHocSubProcess":function(parentGfx,element){return renderer("bpmn:SubProcess")(parentGfx,element)},"bpmn:Transaction":function(parentGfx,element){var outer=renderer("bpmn:SubProcess")(parentGfx,element),innerAttrs=styles.style(["no-fill","no-events"],{stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)});return drawRect(parentGfx,element.width,element.height,8,3,innerAttrs),outer},"bpmn:CallActivity":function(parentGfx,element){return renderer("bpmn:SubProcess")(parentGfx,element,{strokeWidth:5})},"bpmn:Participant":function(parentGfx,element){var attrs={fillOpacity:.95,fill:(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor),stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)},lane=renderer("bpmn:Lane")(parentGfx,element,attrs);(0,_DiUtil.isExpanded)(element)?(drawLine(parentGfx,[{x:30,y:0},{x:30,y:element.height}],{stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)}),renderLaneLabel(parentGfx,(0,_BpmnRenderUtil.getSemantic)(element).name,element)):renderLabel(parentGfx,(0,_BpmnRenderUtil.getSemantic)(element).name,{box:element,align:"center-middle",style:{fill:(0,_BpmnRenderUtil.getLabelColor)(element,defaultLabelColor,defaultStrokeColor)}});return!!(0,_BpmnRenderUtil.getSemantic)(element).participantMultiplicity&&renderer("ParticipantMultiplicityMarker")(parentGfx,element),lane},"bpmn:Lane":function(parentGfx,element,attrs){var rect=drawRect(parentGfx,element.width,element.height,0,(0,_minDash.assign)({fill:(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor),fillOpacity:.35,stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)},attrs)),semantic=(0,_BpmnRenderUtil.getSemantic)(element);"bpmn:Lane"===semantic.$type&&renderLaneLabel(parentGfx,semantic.name,element);return rect},"bpmn:InclusiveGateway":function(parentGfx,element){var diamond=renderer("bpmn:Gateway")(parentGfx,element);return drawCircle(parentGfx,element.width,element.height,.24*element.height,{strokeWidth:2.5,fill:(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor),stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)}),diamond},"bpmn:ExclusiveGateway":function(parentGfx,element){var diamond=renderer("bpmn:Gateway")(parentGfx,element),pathData=pathMap.getScaledPath("GATEWAY_EXCLUSIVE",{xScaleFactor:.4,yScaleFactor:.4,containerWidth:element.width,containerHeight:element.height,position:{mx:.32,my:.3}});return(0,_BpmnRenderUtil.getDi)(element).isMarkerVisible&&drawPath(parentGfx,pathData,{strokeWidth:1,fill:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor),stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)}),diamond},"bpmn:ComplexGateway":function(parentGfx,element){var diamond=renderer("bpmn:Gateway")(parentGfx,element);return drawPath(parentGfx,pathMap.getScaledPath("GATEWAY_COMPLEX",{xScaleFactor:.5,yScaleFactor:.5,containerWidth:element.width,containerHeight:element.height,position:{mx:.46,my:.26}}),{strokeWidth:1,fill:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor),stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)}),diamond},"bpmn:ParallelGateway":function(parentGfx,element){var diamond=renderer("bpmn:Gateway")(parentGfx,element);return drawPath(parentGfx,pathMap.getScaledPath("GATEWAY_PARALLEL",{xScaleFactor:.6,yScaleFactor:.6,containerWidth:element.width,containerHeight:element.height,position:{mx:.46,my:.2}}),{strokeWidth:1,fill:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor),stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)}),diamond},"bpmn:EventBasedGateway":function(parentGfx,element){var semantic=(0,_BpmnRenderUtil.getSemantic)(element),diamond=renderer("bpmn:Gateway")(parentGfx,element);drawCircle(parentGfx,element.width,element.height,.2*element.height,{strokeWidth:1,fill:"none",stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)});var type=semantic.eventGatewayType,instantiate=!!semantic.instantiate;if("Parallel"===type){var pathData=pathMap.getScaledPath("GATEWAY_PARALLEL",{xScaleFactor:.4,yScaleFactor:.4,containerWidth:element.width,containerHeight:element.height,position:{mx:.474,my:.296}}),parallelPath=drawPath(parentGfx,pathData);(0,_tinySvg.attr)(parallelPath,{strokeWidth:1,fill:"none"})}else if("Exclusive"===type){if(!instantiate){var innerCircle=drawCircle(parentGfx,element.width,element.height,.26*element.height);(0,_tinySvg.attr)(innerCircle,{strokeWidth:1,fill:"none",stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)})}!function(){var pathData=pathMap.getScaledPath("GATEWAY_EVENT_BASED",{xScaleFactor:.18,yScaleFactor:.18,containerWidth:element.width,containerHeight:element.height,position:{mx:.36,my:.44}}),attrs={strokeWidth:2,fill:(0,_BpmnRenderUtil.getFillColor)(element,"none"),stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)};drawPath(parentGfx,pathData,attrs)}()}return diamond},"bpmn:Gateway":function(parentGfx,element){var attrs={fill:(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor),fillOpacity:.95,stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)};return function(parentGfx,width,height,attrs){var x_2=width/2,y_2=height/2,pointsString=[{x:x_2,y:0},{x:width,y:y_2},{x:x_2,y:height},{x:0,y:y_2}].map((function(point){return point.x+","+point.y})).join(" ");attrs=computeStyle(attrs,{stroke:"black",strokeWidth:2,fill:"white"});var polygon=(0,_tinySvg.create)("polygon");return(0,_tinySvg.attr)(polygon,{points:pointsString}),(0,_tinySvg.attr)(polygon,attrs),(0,_tinySvg.append)(parentGfx,polygon),polygon}(parentGfx,element.width,element.height,attrs)},"bpmn:SequenceFlow":function(parentGfx,element){var source,pathData=createPathFromConnection(element),fill=(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor),stroke=(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor),path=drawPath(parentGfx,pathData,{strokeLinejoin:"round",markerEnd:marker("sequenceflow-end",fill,stroke),stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)}),sequenceFlow=(0,_BpmnRenderUtil.getSemantic)(element);return element.source&&(source=element.source.businessObject,sequenceFlow.conditionExpression&&source.$instanceOf("bpmn:Activity")&&(0,_tinySvg.attr)(path,{markerStart:marker("conditional-flow-marker",fill,stroke)}),source.default&&(source.$instanceOf("bpmn:Gateway")||source.$instanceOf("bpmn:Activity"))&&source.default===sequenceFlow&&(0,_tinySvg.attr)(path,{markerStart:marker("conditional-default-flow-marker",fill,stroke)})),path},"bpmn:Association":function(parentGfx,element,attrs){var semantic=(0,_BpmnRenderUtil.getSemantic)(element),fill=(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor),stroke=(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor);return attrs=(0,_minDash.assign)({strokeDasharray:"0.5, 5",strokeLinecap:"round",strokeLinejoin:"round",stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)},attrs||{}),"One"!==semantic.associationDirection&&"Both"!==semantic.associationDirection||(attrs.markerEnd=marker("association-end",fill,stroke)),"Both"===semantic.associationDirection&&(attrs.markerStart=marker("association-start",fill,stroke)),drawLine(parentGfx,element.waypoints,attrs)},"bpmn:DataInputAssociation":function(parentGfx,element){var fill=(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor),stroke=(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor);return renderer("bpmn:Association")(parentGfx,element,{markerEnd:marker("association-end",fill,stroke)})},"bpmn:DataOutputAssociation":function(parentGfx,element){var fill=(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor),stroke=(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor);return renderer("bpmn:Association")(parentGfx,element,{markerEnd:marker("association-end",fill,stroke)})},"bpmn:MessageFlow":function(parentGfx,element){var semantic=(0,_BpmnRenderUtil.getSemantic)(element),di=(0,_BpmnRenderUtil.getDi)(element),fill=(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor),stroke=(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor),path=drawPath(parentGfx,createPathFromConnection(element),{markerEnd:marker("messageflow-end",fill,stroke),markerStart:marker("messageflow-start",fill,stroke),strokeDasharray:"10, 12",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5px",stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)});if(semantic.messageRef){var midPoint=path.getPointAtLength(path.getTotalLength()/2),markerPathData=pathMap.getScaledPath("MESSAGE_FLOW_MARKER",{abspos:{x:midPoint.x,y:midPoint.y}}),messageAttrs={strokeWidth:1};"initiating"===di.messageVisibleKind?(messageAttrs.fill="white",messageAttrs.stroke="black"):(messageAttrs.fill="#888",messageAttrs.stroke="white");var message=drawPath(parentGfx,markerPathData,messageAttrs),label=renderLabel(parentGfx,semantic.messageRef.name,{align:"center-top",fitBox:!0,style:{fill:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultLabelColor,defaultStrokeColor)}}),messageBounds=message.getBBox(),labelBounds=label.getBBox(),translateX=midPoint.x-labelBounds.width/2,translateY=midPoint.y+messageBounds.height/2+10;(0,_SvgTransformUtil.transform)(label,translateX,translateY,0)}return path},"bpmn:DataObject":function(parentGfx,element){var elementObject=drawPath(parentGfx,pathMap.getScaledPath("DATA_OBJECT_PATH",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:.474,my:.296}}),{fill:(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor),fillOpacity:.95,stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)}),semantic=(0,_BpmnRenderUtil.getSemantic)(element);return(0,_BpmnRenderUtil.isCollection)(semantic)&&function(parentGfx,element){var yPosition=(element.height-18)/element.height,pathData=pathMap.getScaledPath("DATA_OBJECT_COLLECTION_PATH",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:.33,my:yPosition}});drawPath(parentGfx,pathData,{strokeWidth:2})}(parentGfx,element),elementObject},"bpmn:DataObjectReference":as("bpmn:DataObject"),"bpmn:DataInput":function(parentGfx,element){var arrowPathData=pathMap.getRawPath("DATA_ARROW"),elementObject=renderer("bpmn:DataObject")(parentGfx,element);return drawPath(parentGfx,arrowPathData,{strokeWidth:1}),elementObject},"bpmn:DataOutput":function(parentGfx,element){var arrowPathData=pathMap.getRawPath("DATA_ARROW"),elementObject=renderer("bpmn:DataObject")(parentGfx,element);return drawPath(parentGfx,arrowPathData,{strokeWidth:1,fill:"black"}),elementObject},"bpmn:DataStoreReference":function(parentGfx,element){return drawPath(parentGfx,pathMap.getScaledPath("DATA_STORE",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:0,my:.133}}),{strokeWidth:2,fill:(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor),fillOpacity:.95,stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)})},"bpmn:BoundaryEvent":function(parentGfx,element){var cancel=(0,_BpmnRenderUtil.getSemantic)(element).cancelActivity,attrs={strokeWidth:1,fill:(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor),stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)};cancel||(attrs.strokeDasharray="6",attrs.strokeLinecap="round");var outerAttrs=(0,_minDash.assign)({},attrs,{fillOpacity:1}),innerAttrs=(0,_minDash.assign)({},attrs,{fill:"none"}),outer=renderer("bpmn:Event")(parentGfx,element,outerAttrs);return drawCircle(parentGfx,element.width,element.height,3,innerAttrs),renderEventContent(element,parentGfx),outer},"bpmn:Group":function(parentGfx,element){return drawRect(parentGfx,element.width,element.height,10,{stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor),strokeWidth:1,strokeDasharray:"8,3,1,3",fill:"none",pointerEvents:"none"})},label:function(parentGfx,element){return function(parentGfx,element){var box={width:90,height:30,x:element.width/2+element.x,y:element.height/2+element.y};return renderLabel(parentGfx,(0,_LabelUtil.getLabel)(element),{box,fitBox:!0,style:(0,_minDash.assign)({},textRenderer.getExternalStyle(),{fill:(0,_BpmnRenderUtil.getLabelColor)(element,defaultLabelColor,defaultStrokeColor)})})}(parentGfx,element)},"bpmn:TextAnnotation":function(parentGfx,element){var textElement=drawRect(parentGfx,element.width,element.height,0,0,{fill:"none",stroke:"none"});return drawPath(parentGfx,pathMap.getScaledPath("TEXT_ANNOTATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:0,my:0}}),{stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)}),renderLabel(parentGfx,(0,_BpmnRenderUtil.getSemantic)(element).text||"",{box:element,align:"left-top",padding:5,style:{fill:(0,_BpmnRenderUtil.getLabelColor)(element,defaultLabelColor,defaultStrokeColor)}}),textElement},ParticipantMultiplicityMarker:function(parentGfx,element){drawMarker("participant-multiplicity",parentGfx,pathMap.getScaledPath("MARKER_PARALLEL",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:element.width/2/element.width,my:(element.height-15)/element.height}}),{strokeWidth:2,fill:(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor),stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)})},SubProcessMarker:function(parentGfx,element){var markerRect=drawRect(parentGfx,14,14,0,{strokeWidth:1,fill:(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor),stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)});(0,_SvgTransformUtil.translate)(markerRect,element.width/2-7.5,element.height-20),drawMarker("sub-process",parentGfx,pathMap.getScaledPath("MARKER_SUB_PROCESS",{xScaleFactor:1.5,yScaleFactor:1.5,containerWidth:element.width,containerHeight:element.height,position:{mx:(element.width/2-7.5)/element.width,my:(element.height-20)/element.height}}),{fill:(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor),stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)})},ParallelMarker:function(parentGfx,element,position){drawMarker("parallel",parentGfx,pathMap.getScaledPath("MARKER_PARALLEL",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:(element.width/2+position.parallel)/element.width,my:(element.height-20)/element.height}}),{fill:(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor),stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)})},SequentialMarker:function(parentGfx,element,position){drawMarker("sequential",parentGfx,pathMap.getScaledPath("MARKER_SEQUENTIAL",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:(element.width/2+position.seq)/element.width,my:(element.height-19)/element.height}}),{fill:(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor),stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)})},CompensationMarker:function(parentGfx,element,position){drawMarker("compensation",parentGfx,pathMap.getScaledPath("MARKER_COMPENSATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:(element.width/2+position.compensation)/element.width,my:(element.height-13)/element.height}}),{strokeWidth:1,fill:(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor),stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)})},LoopMarker:function(parentGfx,element,position){drawMarker("loop",parentGfx,pathMap.getScaledPath("MARKER_LOOP",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:(element.width/2+position.loop)/element.width,my:(element.height-7)/element.height}}),{strokeWidth:1,fill:(0,_BpmnRenderUtil.getFillColor)(element,defaultFillColor),stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor),strokeLinecap:"round",strokeMiterlimit:.5})},AdhocMarker:function(parentGfx,element,position){drawMarker("adhoc",parentGfx,pathMap.getScaledPath("MARKER_ADHOC",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:(element.width/2+position.adhoc)/element.width,my:(element.height-15)/element.height}}),{strokeWidth:1,fill:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor),stroke:(0,_BpmnRenderUtil.getStrokeColor)(element,defaultStrokeColor)})}};function attachTaskMarkers(parentGfx,element,taskMarkers){var position,obj=(0,_BpmnRenderUtil.getSemantic)(element),subprocess=taskMarkers&&-1!==taskMarkers.indexOf("SubProcessMarker");position=subprocess?{seq:-21,parallel:-22,compensation:-42,loop:-18,adhoc:10}:{seq:-3,parallel:-6,compensation:-27,loop:0,adhoc:10},(0,_minDash.forEach)(taskMarkers,(function(marker){renderer(marker)(parentGfx,element,position)})),obj.isForCompensation&&renderer("CompensationMarker")(parentGfx,element,position),"bpmn:AdHocSubProcess"===obj.$type&&renderer("AdhocMarker")(parentGfx,element,position);var loopCharacteristics=obj.loopCharacteristics,isSequential=loopCharacteristics&&loopCharacteristics.isSequential;loopCharacteristics&&(void 0===isSequential&&renderer("LoopMarker")(parentGfx,element,position),!1===isSequential&&renderer("ParallelMarker")(parentGfx,element,position),!0===isSequential&&renderer("SequentialMarker")(parentGfx,element,position))}this._drawPath=drawPath}(0,_inherits.default)(BpmnRenderer,_BaseRenderer.default),BpmnRenderer.$inject=["config.bpmnRenderer","eventBus","styles","pathMap","canvas","textRenderer"],BpmnRenderer.prototype.canRender=function(element){return(0,_ModelUtil.is)(element,"bpmn:BaseElement")},BpmnRenderer.prototype.drawShape=function(parentGfx,element){var type=element.type;return(0,this.handlers[type])(parentGfx,element)},BpmnRenderer.prototype.drawConnection=function(parentGfx,element){var type=element.type;return(0,this.handlers[type])(parentGfx,element)},BpmnRenderer.prototype.getShapePath=function(element){return(0,_ModelUtil.is)(element,"bpmn:Event")?(0,_BpmnRenderUtil.getCirclePath)(element):(0,_ModelUtil.is)(element,"bpmn:Activity")?(0,_BpmnRenderUtil.getRoundRectPath)(element,10):(0,_ModelUtil.is)(element,"bpmn:Gateway")?(0,_BpmnRenderUtil.getDiamondPath)(element):(0,_BpmnRenderUtil.getRectPath)(element)}},{"../features/label-editing/LabelUtil":16,"../util/DiUtil":89,"../util/ModelUtil":91,"./BpmnRenderUtil":6,"diagram-js/lib/draw/BaseRenderer":105,"diagram-js/lib/util/RenderUtil":213,"diagram-js/lib/util/SvgTransformUtil":214,ids:217,inherits:218,"min-dash":219,"min-dom":220,"tiny-svg":228}],8:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(){this.pathMap={EVENT_MESSAGE:{d:"m {mx},{my} l 0,{e.y1} l {e.x1},0 l 0,-{e.y1} z l {e.x0},{e.y0} l {e.x0},-{e.y0}",height:36,width:36,heightElements:[6,14],widthElements:[10.5,21]},EVENT_SIGNAL:{d:"M {mx},{my} l {e.x0},{e.y0} l -{e.x1},0 Z",height:36,width:36,heightElements:[18],widthElements:[10,20]},EVENT_ESCALATION:{d:"M {mx},{my} l {e.x0},{e.y0} l -{e.x0},-{e.y1} l -{e.x0},{e.y1} Z",height:36,width:36,heightElements:[20,7],widthElements:[8]},EVENT_CONDITIONAL:{d:"M {e.x0},{e.y0} l {e.x1},0 l 0,{e.y2} l -{e.x1},0 Z M {e.x2},{e.y3} l {e.x0},0 M {e.x2},{e.y4} l {e.x0},0 M {e.x2},{e.y5} l {e.x0},0 M {e.x2},{e.y6} l {e.x0},0 M {e.x2},{e.y7} l {e.x0},0 M {e.x2},{e.y8} l {e.x0},0 ",height:36,width:36,heightElements:[8.5,14.5,18,11.5,14.5,17.5,20.5,23.5,26.5],widthElements:[10.5,14.5,12.5]},EVENT_LINK:{d:"m {mx},{my} 0,{e.y0} -{e.x1},0 0,{e.y1} {e.x1},0 0,{e.y0} {e.x0},-{e.y2} -{e.x0},-{e.y2} z",height:36,width:36,heightElements:[4.4375,6.75,7.8125],widthElements:[9.84375,13.5]},EVENT_ERROR:{d:"m {mx},{my} {e.x0},-{e.y0} {e.x1},-{e.y1} {e.x2},{e.y2} {e.x3},-{e.y3} -{e.x4},{e.y4} -{e.x5},-{e.y5} z",height:36,width:36,heightElements:[.023,8.737,8.151,16.564,10.591,8.714],widthElements:[.085,6.672,6.97,4.273,5.337,6.636]},EVENT_CANCEL_45:{d:"m {mx},{my} -{e.x1},0 0,{e.x0} {e.x1},0 0,{e.y1} {e.x0},0 0,-{e.y1} {e.x1},0 0,-{e.y0} -{e.x1},0 0,-{e.y1} -{e.x0},0 z",height:36,width:36,heightElements:[4.75,8.5],widthElements:[4.75,8.5]},EVENT_COMPENSATION:{d:"m {mx},{my} {e.x0},-{e.y0} 0,{e.y1} z m {e.x1},-{e.y2} {e.x2},-{e.y3} 0,{e.y1} -{e.x2},-{e.y3} z",height:36,width:36,heightElements:[6.5,13,.4,6.1],widthElements:[9,9.3,8.7]},EVENT_TIMER_WH:{d:"M {mx},{my} l {e.x0},-{e.y0} m -{e.x0},{e.y0} l {e.x1},{e.y1} ",height:36,width:36,heightElements:[10,2],widthElements:[3,7]},EVENT_TIMER_LINE:{d:"M {mx},{my} m {e.x0},{e.y0} l -{e.x1},{e.y1} ",height:36,width:36,heightElements:[10,3],widthElements:[0,0]},EVENT_MULTIPLE:{d:"m {mx},{my} {e.x1},-{e.y0} {e.x1},{e.y0} -{e.x0},{e.y1} -{e.x2},0 z",height:36,width:36,heightElements:[6.28099,12.56199],widthElements:[3.1405,9.42149,12.56198]},EVENT_PARALLEL_MULTIPLE:{d:"m {mx},{my} {e.x0},0 0,{e.y1} {e.x1},0 0,{e.y0} -{e.x1},0 0,{e.y1} -{e.x0},0 0,-{e.y1} -{e.x1},0 0,-{e.y0} {e.x1},0 z",height:36,width:36,heightElements:[2.56228,7.68683],widthElements:[2.56228,7.68683]},GATEWAY_EXCLUSIVE:{d:"m {mx},{my} {e.x0},{e.y0} {e.x1},{e.y0} {e.x2},0 {e.x4},{e.y2} {e.x4},{e.y1} {e.x2},0 {e.x1},{e.y3} {e.x0},{e.y3} {e.x3},0 {e.x5},{e.y1} {e.x5},{e.y2} {e.x3},0 z",height:17.5,width:17.5,heightElements:[8.5,6.5312,-6.5312,-8.5],widthElements:[6.5,-6.5,3,-3,5,-5]},GATEWAY_PARALLEL:{d:"m {mx},{my} 0,{e.y1} -{e.x1},0 0,{e.y0} {e.x1},0 0,{e.y1} {e.x0},0 0,-{e.y1} {e.x1},0 0,-{e.y0} -{e.x1},0 0,-{e.y1} -{e.x0},0 z",height:30,width:30,heightElements:[5,12.5],widthElements:[5,12.5]},GATEWAY_EVENT_BASED:{d:"m {mx},{my} {e.x0},{e.y0} {e.x0},{e.y1} {e.x1},{e.y2} {e.x2},0 z",height:11,width:11,heightElements:[-6,6,12,-12],widthElements:[9,-3,-12]},GATEWAY_COMPLEX:{d:"m {mx},{my} 0,{e.y0} -{e.x0},-{e.y1} -{e.x1},{e.y2} {e.x0},{e.y1} -{e.x2},0 0,{e.y3} {e.x2},0  -{e.x0},{e.y1} l {e.x1},{e.y2} {e.x0},-{e.y1} 0,{e.y0} {e.x3},0 0,-{e.y0} {e.x0},{e.y1} {e.x1},-{e.y2} -{e.x0},-{e.y1} {e.x2},0 0,-{e.y3} -{e.x2},0 {e.x0},-{e.y1} -{e.x1},-{e.y2} -{e.x0},{e.y1} 0,-{e.y0} -{e.x3},0 z",height:17.125,width:17.125,heightElements:[4.875,3.4375,2.125,3],widthElements:[3.4375,2.125,4.875,3]},DATA_OBJECT_PATH:{d:"m 0,0 {e.x1},0 {e.x0},{e.y0} 0,{e.y1} -{e.x2},0 0,-{e.y2} {e.x1},0 0,{e.y0} {e.x0},0",height:61,width:51,heightElements:[10,50,60],widthElements:[10,40,50,60]},DATA_OBJECT_COLLECTION_PATH:{d:"m{mx},{my} m 3,2 l 0,10 m 3,-10 l 0,10 m 3,-10 l 0,10",height:10,width:10,heightElements:[],widthElements:[]},DATA_ARROW:{d:"m 5,9 9,0 0,-3 5,5 -5,5 0,-3 -9,0 z",height:61,width:51,heightElements:[],widthElements:[]},DATA_STORE:{d:"m  {mx},{my} l  0,{e.y2} c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0 l  0,-{e.y2} c -{e.x0},-{e.y1} -{e.x1},-{e.y1} -{e.x2},0c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0 m  -{e.x2},{e.y0}c  {e.x0},{e.y1} {e.x1},{e.y1} {e.x2},0m  -{e.x2},{e.y0}c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0",height:61,width:61,heightElements:[7,10,45],widthElements:[2,58,60]},TEXT_ANNOTATION:{d:"m {mx}, {my} m 10,0 l -10,0 l 0,{e.y0} l 10,0",height:30,width:10,heightElements:[30],widthElements:[10]},MARKER_SUB_PROCESS:{d:"m{mx},{my} m 7,2 l 0,10 m -5,-5 l 10,0",height:10,width:10,heightElements:[],widthElements:[]},MARKER_PARALLEL:{d:"m{mx},{my} m 3,2 l 0,10 m 3,-10 l 0,10 m 3,-10 l 0,10",height:10,width:10,heightElements:[],widthElements:[]},MARKER_SEQUENTIAL:{d:"m{mx},{my} m 0,3 l 10,0 m -10,3 l 10,0 m -10,3 l 10,0",height:10,width:10,heightElements:[],widthElements:[]},MARKER_COMPENSATION:{d:"m {mx},{my} 7,-5 0,10 z m 7.1,-0.3 6.9,-4.7 0,10 -6.9,-4.7 z",height:10,width:21,heightElements:[],widthElements:[]},MARKER_LOOP:{d:"m {mx},{my} c 3.526979,0 6.386161,-2.829858 6.386161,-6.320661 0,-3.490806 -2.859182,-6.320661 -6.386161,-6.320661 -3.526978,0 -6.38616,2.829855 -6.38616,6.320661 0,1.745402 0.714797,3.325567 1.870463,4.469381 0.577834,0.571908 1.265885,1.034728 2.029916,1.35457 l -0.718163,-3.909793 m 0.718163,3.909793 -3.885211,0.802902",height:13.9,width:13.7,heightElements:[],widthElements:[]},MARKER_ADHOC:{d:"m {mx},{my} m 0.84461,2.64411 c 1.05533,-1.23780996 2.64337,-2.07882 4.29653,-1.97997996 2.05163,0.0805 3.85579,1.15803 5.76082,1.79107 1.06385,0.34139996 2.24454,0.1438 3.18759,-0.43767 0.61743,-0.33642 1.2775,-0.64078 1.7542,-1.17511 0,0.56023 0,1.12046 0,1.6807 -0.98706,0.96237996 -2.29792,1.62393996 -3.6918,1.66181996 -1.24459,0.0927 -2.46671,-0.2491 -3.59505,-0.74812 -1.35789,-0.55965 -2.75133,-1.33436996 -4.27027,-1.18121996 -1.37741,0.14601 -2.41842,1.13685996 -3.44288,1.96782996 z",height:4,width:15,heightElements:[],widthElements:[]},TASK_TYPE_SEND:{d:"m {mx},{my} l 0,{e.y1} l {e.x1},0 l 0,-{e.y1} z l {e.x0},{e.y0} l {e.x0},-{e.y0}",height:14,width:21,heightElements:[6,14],widthElements:[10.5,21]},TASK_TYPE_SCRIPT:{d:"m {mx},{my} c 9.966553,-6.27276 -8.000926,-7.91932 2.968968,-14.938 l -8.802728,0 c -10.969894,7.01868 6.997585,8.66524 -2.968967,14.938 z m -7,-12 l 5,0 m -4.5,3 l 4.5,0 m -3,3 l 5,0m -4,3 l 5,0",height:15,width:12.6,heightElements:[6,14],widthElements:[10.5,21]},TASK_TYPE_USER_1:{d:"m {mx},{my} c 0.909,-0.845 1.594,-2.049 1.594,-3.385 0,-2.554 -1.805,-4.62199999 -4.357,-4.62199999 -2.55199998,0 -4.28799998,2.06799999 -4.28799998,4.62199999 0,1.348 0.974,2.562 1.89599998,3.405 -0.52899998,0.187 -5.669,2.097 -5.794,4.7560005 v 6.718 h 17 v -6.718 c 0,-2.2980005 -5.5279996,-4.5950005 -6.0509996,-4.7760005 zm -8,6 l 0,5.5 m 11,0 l 0,-5"},TASK_TYPE_USER_2:{d:"m {mx},{my} m 2.162,1.009 c 0,2.4470005 -2.158,4.4310005 -4.821,4.4310005 -2.66499998,0 -4.822,-1.981 -4.822,-4.4310005 "},TASK_TYPE_USER_3:{d:"m {mx},{my} m -6.9,-3.80 c 0,0 2.25099998,-2.358 4.27399998,-1.177 2.024,1.181 4.221,1.537 4.124,0.965 -0.098,-0.57 -0.117,-3.79099999 -4.191,-4.13599999 -3.57499998,0.001 -4.20799998,3.36699999 -4.20699998,4.34799999 z"},TASK_TYPE_MANUAL:{d:"m {mx},{my} c 0.234,-0.01 5.604,0.008 8.029,0.004 0.808,0 1.271,-0.172 1.417,-0.752 0.227,-0.898 -0.334,-1.314 -1.338,-1.316 -2.467,-0.01 -7.886,-0.004 -8.108,-0.004 -0.014,-0.079 0.016,-0.533 0,-0.61 0.195,-0.042 8.507,0.006 9.616,0.002 0.877,-0.007 1.35,-0.438 1.353,-1.208 0.003,-0.768 -0.479,-1.09 -1.35,-1.091 -2.968,-0.002 -9.619,-0.013 -9.619,-0.013 v -0.591 c 0,0 5.052,-0.016 7.225,-0.016 0.888,-0.002 1.354,-0.416 1.351,-1.193 -0.006,-0.761 -0.492,-1.196 -1.361,-1.196 -3.473,-0.005 -10.86,-0.003 -11.0829995,-0.003 -0.022,-0.047 -0.045,-0.094 -0.069,-0.139 0.3939995,-0.319 2.0409995,-1.626 2.4149995,-2.017 0.469,-0.4870005 0.519,-1.1650005 0.162,-1.6040005 -0.414,-0.511 -0.973,-0.5 -1.48,-0.236 -1.4609995,0.764 -6.5999995,3.6430005 -7.7329995,4.2710005 -0.9,0.499 -1.516,1.253 -1.882,2.19 -0.37000002,0.95 -0.17,2.01 -0.166,2.979 0.004,0.718 -0.27300002,1.345 -0.055,2.063 0.629,2.087 2.425,3.312 4.859,3.318 4.6179995,0.014 9.2379995,-0.139 13.8569995,-0.158 0.755,-0.004 1.171,-0.301 1.182,-1.033 0.012,-0.754 -0.423,-0.969 -1.183,-0.973 -1.778,-0.01 -5.824,-0.004 -6.04,-0.004 10e-4,-0.084 0.003,-0.586 10e-4,-0.67 z"},TASK_TYPE_INSTANTIATING_SEND:{d:"m {mx},{my} l 0,8.4 l 12.6,0 l 0,-8.4 z l 6.3,3.6 l 6.3,-3.6"},TASK_TYPE_SERVICE:{d:"m {mx},{my} v -1.71335 c 0.352326,-0.0705 0.703932,-0.17838 1.047628,-0.32133 0.344416,-0.14465 0.665822,-0.32133 0.966377,-0.52145 l 1.19431,1.18005 1.567487,-1.57688 -1.195028,-1.18014 c 0.403376,-0.61394 0.683079,-1.29908 0.825447,-2.01824 l 1.622133,-0.01 v -2.2196 l -1.636514,0.01 c -0.07333,-0.35153 -0.178319,-0.70024 -0.323564,-1.04372 -0.145244,-0.34406 -0.321407,-0.6644 -0.522735,-0.96217 l 1.131035,-1.13631 -1.583305,-1.56293 -1.129598,1.13589 c -0.614052,-0.40108 -1.302883,-0.68093 -2.022633,-0.82247 l 0.0093,-1.61852 h -2.241173 l 0.0042,1.63124 c -0.353763,0.0736 -0.705369,0.17977 -1.049785,0.32371 -0.344415,0.14437 -0.665102,0.32092 -0.9635006,0.52046 l -1.1698628,-1.15823 -1.5667691,1.5792 1.1684265,1.15669 c -0.4026573,0.61283 -0.68308,1.29797 -0.8247287,2.01713 l -1.6588041,0.003 v 2.22174 l 1.6724648,-0.006 c 0.073327,0.35077 0.1797598,0.70243 0.3242851,1.04472 0.1452428,0.34448 0.3214064,0.6644 0.5227339,0.96066 l -1.1993431,1.19723 1.5840256,1.56011 1.1964668,-1.19348 c 0.6140517,0.40346 1.3028827,0.68232 2.0233517,0.82331 l 7.19e-4,1.69892 h 2.226848 z m 0.221462,-3.9957 c -1.788948,0.7502 -3.8576,-0.0928 -4.6097055,-1.87438 -0.7521065,-1.78321 0.090598,-3.84627 1.8802645,-4.59604 1.78823,-0.74936 3.856881,0.0929 4.608987,1.87437 0.752106,1.78165 -0.0906,3.84612 -1.879546,4.59605 z"},TASK_TYPE_SERVICE_FILL:{d:"m {mx},{my} c -1.788948,0.7502 -3.8576,-0.0928 -4.6097055,-1.87438 -0.7521065,-1.78321 0.090598,-3.84627 1.8802645,-4.59604 1.78823,-0.74936 3.856881,0.0929 4.608987,1.87437 0.752106,1.78165 -0.0906,3.84612 -1.879546,4.59605 z"},TASK_TYPE_BUSINESS_RULE_HEADER:{d:"m {mx},{my} 0,4 20,0 0,-4 z"},TASK_TYPE_BUSINESS_RULE_MAIN:{d:"m {mx},{my} 0,12 20,0 0,-12 zm 0,8 l 20,0 m -13,-4 l 0,8"},MESSAGE_FLOW_MARKER:{d:"m {mx},{my} m -10.5 ,-7 l 0,14 l 21,0 l 0,-14 z l 10.5,6 l 10.5,-6"}},this.getRawPath=function(pathId){return this.pathMap[pathId].d},this.getScaledPath=function(pathId,param){var mx,my,rawPath=this.pathMap[pathId];param.abspos?(mx=param.abspos.x,my=param.abspos.y):(mx=param.containerWidth*param.position.mx,my=param.containerHeight*param.position.my);var str,obj,coordinates={};if(param.position){for(var heightRatio=param.containerHeight/rawPath.height*param.yScaleFactor,widthRatio=param.containerWidth/rawPath.width*param.xScaleFactor,heightIndex=0;heightIndex<rawPath.heightElements.length;heightIndex++)coordinates["y"+heightIndex]=rawPath.heightElements[heightIndex]*heightRatio;for(var widthIndex=0;widthIndex<rawPath.widthElements.length;widthIndex++)coordinates["x"+widthIndex]=rawPath.widthElements[widthIndex]*widthRatio}return str=rawPath.d,obj={mx,my,e:coordinates},String(str).replace(tokenRegex,(function(all,key){return function(all,key,obj){var res=obj;return key.replace(objNotationRegex,(function(all,name,quote,quotedName,isFunc){name=name||quotedName,res&&(name in res&&(res=res[name]),"function"==typeof res&&isFunc&&(res=res()))})),res=(null==res||res==obj?all:res)+""}(all,key,obj)}))}};var tokenRegex=/\{([^{}]+)\}/g,objNotationRegex=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g},{}],9:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=TextRenderer;var obj,_minDash=require("min-dash"),_Text=(obj=require("diagram-js/lib/util/Text"))&&obj.__esModule?obj:{default:obj};function TextRenderer(config){var defaultStyle=(0,_minDash.assign)({fontFamily:"Arial, sans-serif",fontSize:12,fontWeight:"normal",lineHeight:1.2},config&&config.defaultStyle||{}),fontSize=parseInt(defaultStyle.fontSize,10)-1,externalStyle=(0,_minDash.assign)({},defaultStyle,{fontSize},config&&config.externalStyle||{}),textUtil=new _Text.default({style:defaultStyle});this.getExternalLabelBounds=function(bounds,text){var layoutedDimensions=textUtil.getDimensions(text,{box:{width:90,height:30,x:bounds.width/2+bounds.x,y:bounds.height/2+bounds.y},style:externalStyle});return{x:Math.round(bounds.x+bounds.width/2-layoutedDimensions.width/2),y:Math.round(bounds.y),width:Math.ceil(layoutedDimensions.width),height:Math.ceil(layoutedDimensions.height)}},this.getTextAnnotationBounds=function(bounds,text){var layoutedDimensions=textUtil.getDimensions(text,{box:bounds,style:defaultStyle,align:"left-top",padding:5});return{x:bounds.x,y:bounds.y,width:bounds.width,height:Math.max(30,Math.round(layoutedDimensions.height))}},this.createText=function(text,options){return textUtil.createText(text,options||{})},this.getDefaultStyle=function(){return defaultStyle},this.getExternalStyle=function(){return externalStyle}}TextRenderer.$inject=["config.textRenderer"]},{"diagram-js/lib/util/Text":215,"min-dash":219}],10:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _BpmnRenderer=_interopRequireDefault(require("./BpmnRenderer")),_TextRenderer=_interopRequireDefault(require("./TextRenderer")),_PathMap=_interopRequireDefault(require("./PathMap"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _default={__init__:["bpmnRenderer"],bpmnRenderer:["type",_BpmnRenderer.default],textRenderer:["type",_TextRenderer.default],pathMap:["type",_PathMap.default]};exports.default=_default},{"./BpmnRenderer":7,"./PathMap":8,"./TextRenderer":9}],11:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BpmnCopyPaste;var _ModelUtil=require("../../util/ModelUtil"),_minDash=require("min-dash");function copyProperties(source,target,properties){(0,_minDash.isArray)(properties)||(properties=[properties]),(0,_minDash.forEach)(properties,(function(property){(0,_minDash.isUndefined)(source[property])||(target[property]=source[property])}))}function BpmnCopyPaste(bpmnFactory,eventBus,moddleCopy){var references;eventBus.on("copyPaste.copyElement",750,(function(context){var descriptor=context.descriptor,element=context.element,businessObject=descriptor.oldBusinessObject=(0,_ModelUtil.getBusinessObject)(element);if(descriptor.type=element.type,copyProperties(businessObject,descriptor,"name"),descriptor.di={},copyProperties(businessObject.di,descriptor.di,["fill","stroke","background-color","border-color","color"]),copyProperties(businessObject.di,descriptor,"isExpanded"),isLabel(descriptor))return descriptor;businessObject.default&&(descriptor.default=businessObject.default.id)})),eventBus.on("moddleCopy.canCopyProperty",(function(context){var bpmnProcess,parent=context.parent,property=context.property;if("processRef"===context.propertyName&&(0,_ModelUtil.is)(parent,"bpmn:Participant")&&(0,_ModelUtil.is)(property,"bpmn:Process"))return bpmnProcess=bpmnFactory.create("bpmn:Process"),moddleCopy.copyElement(property,bpmnProcess)})),eventBus.on("copyPaste.pasteElements",(function(){references={}})),eventBus.on("copyPaste.pasteElement",(function(context){var newBusinessObject,element,properties,cache=context.cache,descriptor=context.descriptor,oldBusinessObject=descriptor.oldBusinessObject;isLabel(descriptor)?descriptor.businessObject=(0,_ModelUtil.getBusinessObject)(cache[descriptor.labelTarget]):(newBusinessObject=bpmnFactory.create(oldBusinessObject.$type),descriptor.businessObject=moddleCopy.copyElement(oldBusinessObject,newBusinessObject),function(descriptor,cache){var businessObject=(0,_ModelUtil.getBusinessObject)(descriptor);descriptor.default&&(references[descriptor.default]={element:businessObject,property:"default"}),descriptor.host&&((0,_ModelUtil.getBusinessObject)(descriptor).attachedToRef=(0,_ModelUtil.getBusinessObject)(cache[descriptor.host])),references=(0,_minDash.omit)(references,(0,_minDash.reduce)(references,(function(array,reference,key){var element=reference.element,property=reference.property;return key===descriptor.id&&(element[property]=businessObject,array.push(descriptor.id)),array}),[]))}(descriptor,cache),copyProperties(descriptor,newBusinessObject,["isExpanded","name"]),element=descriptor,properties="oldBusinessObject",(0,_minDash.isArray)(properties)||(properties=[properties]),(0,_minDash.forEach)(properties,(function(property){element[property]&&delete element[property]})))}))}function isLabel(element){return!!element.labelTarget}BpmnCopyPaste.$inject=["bpmnFactory","eventBus","moddleCopy"]},{"../../util/ModelUtil":91,"min-dash":219}],12:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ModdleCopy,exports.getPropertyNames=getPropertyNames;var _minDash=require("min-dash"),DISALLOWED_PROPERTIES=["artifacts","dataInputAssociations","dataOutputAssociations","default","flowElements","lanes","incoming","outgoing"];function ModdleCopy(eventBus,bpmnFactory,moddle){this._bpmnFactory=bpmnFactory,this._eventBus=eventBus,this._moddle=moddle,eventBus.on("moddleCopy.canCopyProperties",(function(context){var propertyNames=context.propertyNames;if(propertyNames&&propertyNames.length)return(0,_minDash.sortBy)(propertyNames,(function(propertyName){return"extensionElements"===propertyName}))})),eventBus.on("moddleCopy.canCopyProperty",(function(context){var parent=context.parent,parentDescriptor=(0,_minDash.isObject)(parent)&&parent.$descriptor,propertyName=context.propertyName;return(!propertyName||-1===DISALLOWED_PROPERTIES.indexOf(propertyName))&&(!(propertyName&&parentDescriptor&&!(0,_minDash.find)(parentDescriptor.properties,(0,_minDash.matchPattern)({name:propertyName})))&&void 0)})),eventBus.on("moddleCopy.canSetCopiedProperty",(function(context){var element,type,property=context.property;if(type="bpmn:ExtensionElements",(element=property)&&"function"==typeof element.$instanceOf&&element.$instanceOf(type)&&(!property.values||!property.values.length))return!1}))}function getPropertyNames(descriptor,keepDefaultProperties){return(0,_minDash.reduce)(descriptor.properties,(function(properties,property){return keepDefaultProperties&&property.default?properties:properties.concat(property.name)}),[])}ModdleCopy.$inject=["eventBus","bpmnFactory","moddle"],ModdleCopy.prototype.copyElement=function(sourceElement,targetElement,propertyNames){var self=this;propertyNames&&!(0,_minDash.isArray)(propertyNames)&&(propertyNames=[propertyNames]),propertyNames=propertyNames||getPropertyNames(sourceElement.$descriptor);var canCopyProperties=this._eventBus.fire("moddleCopy.canCopyProperties",{propertyNames,sourceElement,targetElement});return!1===canCopyProperties||((0,_minDash.isArray)(canCopyProperties)&&(propertyNames=canCopyProperties),(0,_minDash.forEach)(propertyNames,(function(propertyName){var sourceProperty;(0,_minDash.has)(sourceElement,propertyName)&&(sourceProperty=sourceElement.get(propertyName));var copiedProperty=self.copyProperty(sourceProperty,targetElement,propertyName);!1!==self._eventBus.fire("moddleCopy.canSetCopiedProperty",{parent:targetElement,property:copiedProperty,propertyName})&&(0,_minDash.isDefined)(copiedProperty)&&targetElement.set(propertyName,copiedProperty)}))),targetElement},ModdleCopy.prototype.copyProperty=function(property,parent,propertyName){var self=this,copiedProperty=this._eventBus.fire("moddleCopy.canCopyProperty",{parent,property,propertyName});if(!1!==copiedProperty){if(copiedProperty)return(0,_minDash.isObject)(copiedProperty)&&copiedProperty.$type&&!copiedProperty.$parent&&(copiedProperty.$parent=parent),copiedProperty;var propertyDescriptor=this._moddle.getPropertyDescriptor(parent,propertyName);if(!propertyDescriptor.isReference){if(propertyDescriptor.isId)return this._copyId(property,parent);if((0,_minDash.isArray)(property))return(0,_minDash.reduce)(property,(function(childProperties,childProperty){return(copiedProperty=self.copyProperty(childProperty,parent,propertyName))?(copiedProperty.$parent=parent,childProperties.concat(copiedProperty)):childProperties}),[]);if((0,_minDash.isObject)(property)&&property.$type){if(this._moddle.getElementDescriptor(property).isGeneric)return;return(copiedProperty=self._bpmnFactory.create(property.$type)).$parent=parent,copiedProperty=self.copyElement(property,copiedProperty)}return property}}},ModdleCopy.prototype._copyId=function(id,element){return this._moddle.ids.assigned(id)?void 0:(this._moddle.ids.claim(id,element),id)}},{"min-dash":219}],13:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _copyPaste=_interopRequireDefault(require("diagram-js/lib/features/copy-paste")),_BpmnCopyPaste=_interopRequireDefault(require("./BpmnCopyPaste")),_ModdleCopy=_interopRequireDefault(require("./ModdleCopy"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _default={__depends__:[_copyPaste.default],__init__:["bpmnCopyPaste","moddleCopy"],bpmnCopyPaste:["type",_BpmnCopyPaste.default],moddleCopy:["type",_ModdleCopy.default]};exports.default=_default},{"./BpmnCopyPaste":11,"./ModdleCopy":12,"diagram-js/lib/features/copy-paste":116}],14:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BpmnDiOrdering;var _BpmnRenderUtil=require("../../draw/BpmnRenderUtil"),_ModelUtil=require("../../util/ModelUtil"),_minDash=require("min-dash"),_Elements=require("diagram-js/lib/util/Elements");function BpmnDiOrdering(eventBus,canvas){eventBus.on("saveXML.start",2e3,(function(){var elements,diElements,root=canvas.getRootElement(),rootDi=(0,_ModelUtil.getBusinessObject)(root).di;elements=(0,_Elements.selfAndAllChildren)([root],!1),elements=(0,_minDash.filter)(elements,(function(element){return element!==root&&!element.labelTarget})),diElements=(0,_minDash.map)(elements,_BpmnRenderUtil.getDi),rootDi.set("planeElement",diElements)}))}BpmnDiOrdering.$inject=["eventBus","canvas"]},{"../../draw/BpmnRenderUtil":6,"../../util/ModelUtil":91,"diagram-js/lib/util/Elements":202,"min-dash":219}],15:[function(require,module,exports){"use strict";var obj;Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={__init__:["bpmnDiOrdering"],bpmnDiOrdering:["type",((obj=require("../di-ordering/BpmnDiOrdering"))&&obj.__esModule?obj:{default:obj}).default]};exports.default=_default},{"../di-ordering/BpmnDiOrdering":14}],16:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getLabel=function(element){var semantic=element.businessObject,attr=getLabelAttr(semantic);if(attr)return"categoryValueRef"===attr?function(semantic){var categoryValueRef=semantic.categoryValueRef;if(!categoryValueRef)return"";return categoryValueRef.value||""}(semantic):semantic[attr]||""},exports.setLabel=function(element,text,isExternal){var semantic=element.businessObject,attr=getLabelAttr(semantic);attr&&("categoryValueRef"===attr?semantic.categoryValueRef.value=text:semantic[attr]=text);return element};var _ModelUtil=require("../../util/ModelUtil");function getLabelAttr(semantic){return(0,_ModelUtil.is)(semantic,"bpmn:FlowElement")||(0,_ModelUtil.is)(semantic,"bpmn:Participant")||(0,_ModelUtil.is)(semantic,"bpmn:Lane")||(0,_ModelUtil.is)(semantic,"bpmn:SequenceFlow")||(0,_ModelUtil.is)(semantic,"bpmn:MessageFlow")||(0,_ModelUtil.is)(semantic,"bpmn:DataInput")||(0,_ModelUtil.is)(semantic,"bpmn:DataOutput")?"name":(0,_ModelUtil.is)(semantic,"bpmn:TextAnnotation")?"text":(0,_ModelUtil.is)(semantic,"bpmn:Group")?"categoryValueRef":void 0}},{"../../util/ModelUtil":91}],17:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=UpdateLabelHandler;var _LabelUtil=require("../LabelUtil"),_LabelUtil2=require("../../../util/LabelUtil"),_ModelUtil=require("../../../util/ModelUtil"),NULL_DIMENSIONS={width:0,height:0};function UpdateLabelHandler(modeling,textRenderer){function setText(element,text){var label=element.label||element,labelTarget=element.labelTarget||element;return(0,_LabelUtil.setLabel)(label,text,labelTarget!==label),[label,labelTarget]}this.preExecute=function(ctx){var element=ctx.element,businessObject=element.businessObject,newLabel=ctx.newLabel;if(!(0,_LabelUtil2.isLabel)(element)&&(0,_LabelUtil2.isLabelExternal)(element)&&!(0,_LabelUtil2.hasExternalLabel)(element)&&!isEmptyText(newLabel)){var labelCenter=(0,_LabelUtil2.getExternalLabelMid)(element);labelCenter={x:labelCenter.x,y:labelCenter.y+7},modeling.createLabel(element,labelCenter,{id:businessObject.id+"_label",businessObject})}},this.execute=function(ctx){return ctx.oldLabel=(0,_LabelUtil.getLabel)(ctx.element),setText(ctx.element,ctx.newLabel)},this.revert=function(ctx){return setText(ctx.element,ctx.oldLabel)},this.postExecute=function(ctx){var element=ctx.element,label=element.label||element,newLabel=ctx.newLabel,newBounds=ctx.newBounds,hints=ctx.hints||{};if((0,_LabelUtil2.isLabel)(label)||(0,_ModelUtil.is)(label,"bpmn:TextAnnotation"))if((0,_LabelUtil2.isLabel)(label)&&isEmptyText(newLabel))!1!==hints.removeShape&&modeling.removeShape(label,{unsetLabel:!1});else{var text=(0,_LabelUtil.getLabel)(label);void 0===newBounds&&(newBounds=textRenderer.getExternalLabelBounds(label,text)),newBounds&&modeling.resizeShape(label,newBounds,NULL_DIMENSIONS)}}}function isEmptyText(label){return!label||!label.trim()}UpdateLabelHandler.$inject=["modeling","textRenderer"]},{"../../../util/LabelUtil":90,"../../../util/ModelUtil":91,"../LabelUtil":16}],18:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BpmnFactory;var _minDash=require("min-dash"),_ModelingUtil=require("./util/ModelingUtil"),_ModelUtil=require("../../util/ModelUtil");function BpmnFactory(moddle){this._model=moddle}BpmnFactory.$inject=["moddle"],BpmnFactory.prototype._needsId=function(element){return(0,_ModelingUtil.isAny)(element,["bpmn:RootElement","bpmn:FlowElement","bpmn:MessageFlow","bpmn:DataAssociation","bpmn:Artifact","bpmn:Participant","bpmn:Lane","bpmn:LaneSet","bpmn:Process","bpmn:Collaboration","bpmndi:BPMNShape","bpmndi:BPMNEdge","bpmndi:BPMNDiagram","bpmndi:BPMNPlane","bpmn:Property","bpmn:CategoryValue"])},BpmnFactory.prototype._ensureId=function(element){var prefix;element.id?this._model.ids.claim(element.id,element):(prefix=(0,_ModelUtil.is)(element,"bpmn:Activity")?"Activity":(0,_ModelUtil.is)(element,"bpmn:Event")?"Event":(0,_ModelUtil.is)(element,"bpmn:Gateway")?"Gateway":(0,_ModelingUtil.isAny)(element,["bpmn:SequenceFlow","bpmn:MessageFlow"])?"Flow":(element.$type||"").replace(/^[^:]*:/g,""),prefix+="_",!element.id&&this._needsId(element)&&(element.id=this._model.ids.nextPrefixed(prefix,element)))},BpmnFactory.prototype.create=function(type,attrs){var element=this._model.create(type,attrs||{});return this._ensureId(element),element},BpmnFactory.prototype.createDiLabel=function(){return this.create("bpmndi:BPMNLabel",{bounds:this.createDiBounds()})},BpmnFactory.prototype.createDiShape=function(semantic,bounds,attrs){return this.create("bpmndi:BPMNShape",(0,_minDash.assign)({bpmnElement:semantic,bounds:this.createDiBounds(bounds)},attrs))},BpmnFactory.prototype.createDiBounds=function(bounds){return this.create("dc:Bounds",bounds)},BpmnFactory.prototype.createDiWaypoints=function(waypoints){var self=this;return(0,_minDash.map)(waypoints,(function(pos){return self.createDiWaypoint(pos)}))},BpmnFactory.prototype.createDiWaypoint=function(point){return this.create("dc:Point",(0,_minDash.pick)(point,["x","y"]))},BpmnFactory.prototype.createDiEdge=function(semantic,waypoints,attrs){return this.create("bpmndi:BPMNEdge",(0,_minDash.assign)({bpmnElement:semantic,waypoint:this.createDiWaypoints(waypoints)},attrs))},BpmnFactory.prototype.createDiPlane=function(semantic){return this.create("bpmndi:BPMNPlane",{bpmnElement:semantic})}},{"../../util/ModelUtil":91,"./util/ModelingUtil":75,"min-dash":219}],19:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BpmnLayouter;var _inherits=_interopRequireDefault(require("inherits")),_minDash=require("min-dash"),_BaseLayouter=_interopRequireDefault(require("diagram-js/lib/layout/BaseLayouter")),_ManhattanLayout=require("diagram-js/lib/layout/ManhattanLayout"),_LayoutUtil=require("diagram-js/lib/layout/LayoutUtil"),_DiUtil=require("../../util/DiUtil"),_ModelUtil=require("../../util/ModelUtil");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var oppositeOrientationMapping={top:"bottom","top-right":"bottom-left","top-left":"bottom-right",right:"left",bottom:"top","bottom-right":"top-left","bottom-left":"top-right",left:"right"},orientationDirectionMapping={top:"t",right:"r",bottom:"b",left:"l"};function BpmnLayouter(){}function getMessageFlowPreserveDocking(source,target){return(0,_ModelUtil.is)(target,"bpmn:Participant")?"source":(0,_ModelUtil.is)(source,"bpmn:Participant")?"target":isExpandedSubProcess(target)?"source":isExpandedSubProcess(source)||(0,_ModelUtil.is)(target,"bpmn:Event")?"target":(0,_ModelUtil.is)(source,"bpmn:Event")?"source":null}function getSubProcessPreserveDocking(source){return isExpandedSubProcess(source)?"target":"source"}function getConnectionDocking(point,shape){return point?point.original||point:(0,_LayoutUtil.getMid)(shape)}function isCompensationAssociation(source,target){return(0,_ModelUtil.is)(target,"bpmn:Activity")&&(0,_ModelUtil.is)(source,"bpmn:BoundaryEvent")&&target.businessObject.isForCompensation}function isExpandedSubProcess(element){return(0,_ModelUtil.is)(element,"bpmn:SubProcess")&&(0,_DiUtil.isExpanded)(element)}function isSame(a,b){return a===b}function getHorizontalOrientation(orientation){var matches=/right|left/.exec(orientation);return matches&&matches[0]}function getVerticalOrientation(orientation){var matches=/top|bottom/.exec(orientation);return matches&&matches[0]}function isHorizontalOrientation(orientation){return"right"===orientation||"left"===orientation}function getLoopPreferredLayout(source,connection){var waypoints=connection.waypoints,orientation=waypoints&&waypoints.length&&(0,_LayoutUtil.getOrientation)(waypoints[0],source);return"top"===orientation?["t:r"]:"right"===orientation?["r:b"]:"left"===orientation?["l:t"]:["b:l"]}function getBoundaryEventPreferredLayouts(source,target,end){var attachedElement,hostElement,sourceMid=(0,_LayoutUtil.getMid)(source),targetMid=(0,_LayoutUtil.getMid)(target),attachOrientation=(hostElement=(attachedElement=source).host,(0,_LayoutUtil.getOrientation)((0,_LayoutUtil.getMid)(attachedElement),hostElement,-10)),isLoop=isSame(source.host,target),attachedToSide=-1!==["top","right","bottom","left"].indexOf(attachOrientation),targetOrientation=(0,_LayoutUtil.getOrientation)(targetMid,sourceMid,{x:source.width/2+target.width/2,y:source.height/2+target.height/2});return isLoop?function(attachOrientation,attachedToSide,source,target,end){var targetLayout,orientation=attachedToSide?attachOrientation:getVerticalOrientation(attachOrientation),sourceLayout=orientationDirectionMapping[orientation];targetLayout=attachedToSide?isHorizontalOrientation(attachOrientation)?shouldConnectToSameSide("y",source,target,end)?"h":"b":shouldConnectToSameSide("x",source,target,end)?"v":"l":"v";return[sourceLayout+":"+targetLayout]}(attachOrientation,attachedToSide,source,target,end):[function(attachOrientation,targetOrientation,attachedToSide){if(attachedToSide)return orientationDirectionMapping[attachOrientation];if(isSame(getVerticalOrientation(attachOrientation),getVerticalOrientation(targetOrientation))||(a=getHorizontalOrientation(attachOrientation),b=getHorizontalOrientation(targetOrientation),oppositeOrientationMapping[a]===b))return orientationDirectionMapping[getVerticalOrientation(attachOrientation)];var a,b;return orientationDirectionMapping[getHorizontalOrientation(attachOrientation)]}(attachOrientation,targetOrientation,attachedToSide)+":"+function(attachOrientation,targetOrientation,attachedToSide){if(attachedToSide)return isHorizontalOrientation(attachOrientation)?(b=targetOrientation,horizontalOrientation=getHorizontalOrientation(attachOrientation),oppositeHorizontalOrientation=oppositeOrientationMapping[horizontalOrientation],-1!==b.indexOf(oppositeHorizontalOrientation)||isSame(attachOrientation,targetOrientation)?"h":"v"):function(a,b){var verticalOrientation=getVerticalOrientation(a),oppositeVerticalOrientation=oppositeOrientationMapping[verticalOrientation];return-1!==b.indexOf(oppositeVerticalOrientation)}(attachOrientation,targetOrientation)||isSame(attachOrientation,targetOrientation)?"v":"h";var b,horizontalOrientation,oppositeHorizontalOrientation;return isHorizontalOrientation(targetOrientation)||isSame(getVerticalOrientation(attachOrientation),getVerticalOrientation(targetOrientation))&&getHorizontalOrientation(targetOrientation)?"h":"v"}(attachOrientation,targetOrientation,attachedToSide)]}function shouldConnectToSameSide(axis,source,target,end){return!(areCloseOnAxis(axis,end,target,40)||areCloseOnAxis(axis,end,{x:target.x+target.width,y:target.y+target.height},40)||areCloseOnAxis(axis,end,(0,_LayoutUtil.getMid)(source),40))}function areCloseOnAxis(axis,a,b,threshold){return Math.abs(a[axis]-b[axis])<threshold}(0,_inherits.default)(BpmnLayouter,_BaseLayouter.default),BpmnLayouter.prototype.layoutConnection=function(connection,hints){hints||(hints={});var manhattanOptions,updatedWaypoints,source=hints.source||connection.source,target=hints.target||connection.target,waypoints=hints.waypoints||connection.waypoints,connectionStart=hints.connectionStart,connectionEnd=hints.connectionEnd;return connectionStart||(connectionStart=getConnectionDocking(waypoints&&waypoints[0],source)),connectionEnd||(connectionEnd=getConnectionDocking(waypoints&&waypoints[waypoints.length-1],target)),((0,_ModelUtil.is)(connection,"bpmn:Association")||(0,_ModelUtil.is)(connection,"bpmn:DataAssociation"))&&waypoints&&!isCompensationAssociation(source,target)?[].concat([connectionStart],waypoints.slice(1,-1),[connectionEnd]):((0,_ModelUtil.is)(connection,"bpmn:MessageFlow")?manhattanOptions=function(source,target){return{preferredLayouts:["straight","v:v"],preserveDocking:getMessageFlowPreserveDocking(source,target)}}(source,target):((0,_ModelUtil.is)(connection,"bpmn:SequenceFlow")||isCompensationAssociation(source,target))&&(manhattanOptions=source===target?{preferredLayouts:getLoopPreferredLayout(source,connection)}:(0,_ModelUtil.is)(source,"bpmn:BoundaryEvent")?{preferredLayouts:getBoundaryEventPreferredLayouts(source,target,connectionEnd)}:isExpandedSubProcess(source)||isExpandedSubProcess(target)?function(source){return{preferredLayouts:["straight","h:h"],preserveDocking:getSubProcessPreserveDocking(source)}}(source):(0,_ModelUtil.is)(source,"bpmn:Gateway")?{preferredLayouts:["v:h"]}:(0,_ModelUtil.is)(target,"bpmn:Gateway")?{preferredLayouts:["h:v"]}:{preferredLayouts:["h:h"]}),manhattanOptions&&(manhattanOptions=(0,_minDash.assign)(manhattanOptions,hints),updatedWaypoints=(0,_ManhattanLayout.withoutRedundantPoints)((0,_ManhattanLayout.repairConnection)(source,target,connectionStart,connectionEnd,waypoints,manhattanOptions))),updatedWaypoints||[connectionStart,connectionEnd])}},{"../../util/DiUtil":89,"../../util/ModelUtil":91,"diagram-js/lib/layout/BaseLayouter":186,"diagram-js/lib/layout/LayoutUtil":188,"diagram-js/lib/layout/ManhattanLayout":189,inherits:218,"min-dash":219}],20:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BpmnUpdater;var _minDash=require("min-dash"),_inherits=_interopRequireDefault(require("inherits")),_Collections=require("diagram-js/lib/util/Collections"),_model=require("diagram-js/lib/model"),_ModelUtil=require("../../util/ModelUtil"),_ModelingUtil=require("./util/ModelingUtil"),_CommandInterceptor=_interopRequireDefault(require("diagram-js/lib/command/CommandInterceptor"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function BpmnUpdater(eventBus,bpmnFactory,connectionDocking,translate){_CommandInterceptor.default.call(this,eventBus),this._bpmnFactory=bpmnFactory,this._translate=translate;var self=this;function updateRoot(event){var children=event.context.oldRoot.children;(0,_minDash.forEach)(children,(function(child){(0,_ModelUtil.is)(child,"bpmn:BaseElement")&&self.updateParent(child)}))}function updateBounds(e){var shape=e.context.shape;(0,_ModelUtil.is)(shape,"bpmn:BaseElement")&&self.updateBounds(shape)}function updateConnection(e){self.updateConnection(e.context)}function updateConnectionWaypoints(e){self.updateConnectionWaypoints(e.context.connection)}function updateAttachment(e){self.updateAttachment(e.context)}this.executed(["connection.layout","connection.create"],(function(e){var connection,context=e.context,hints=context.hints||{};context.cropped||!1===hints.createElementsBehavior||((connection=context.connection).waypoints=connectionDocking.getCroppedWaypoints(connection),context.cropped=!0)})),this.reverted(["connection.layout"],(function(e){delete e.context.cropped})),this.executed(["shape.move","shape.create","shape.delete","connection.create","connection.move","connection.delete"],ifBpmn((function(e){var context=e.context;self.updateParent(context.shape||context.connection,context.oldParent)}))),this.reverted(["shape.move","shape.create","shape.delete","connection.create","connection.move","connection.delete"],ifBpmn((function(e){var context=e.context,element=context.shape||context.connection,oldParent=context.parent||context.newParent;self.updateParent(element,oldParent)}))),this.executed(["canvas.updateRoot"],updateRoot),this.reverted(["canvas.updateRoot"],updateRoot),this.executed(["shape.move","shape.create","shape.resize"],ifBpmn((function(event){"label"!==event.context.shape.type&&updateBounds(event)}))),this.reverted(["shape.move","shape.create","shape.resize"],ifBpmn((function(event){"label"!==event.context.shape.type&&updateBounds(event)}))),eventBus.on("shape.changed",(function(event){"label"===event.element.type&&updateBounds({context:{shape:event.element}})})),this.executed(["connection.create","connection.move","connection.delete","connection.reconnect"],ifBpmn(updateConnection)),this.reverted(["connection.create","connection.move","connection.delete","connection.reconnect"],ifBpmn(updateConnection)),this.executed(["connection.layout","connection.move","connection.updateWaypoints"],ifBpmn(updateConnectionWaypoints)),this.reverted(["connection.layout","connection.move","connection.updateWaypoints"],ifBpmn(updateConnectionWaypoints)),this.executed("connection.reconnect",ifBpmn((function(event){var context=event.context,connection=context.connection,oldSource=context.oldSource,newSource=context.newSource,connectionBo=(0,_ModelUtil.getBusinessObject)(connection),oldSourceBo=(0,_ModelUtil.getBusinessObject)(oldSource),newSourceBo=(0,_ModelUtil.getBusinessObject)(newSource);connectionBo.conditionExpression&&!(0,_ModelingUtil.isAny)(newSourceBo,["bpmn:Activity","bpmn:ExclusiveGateway","bpmn:InclusiveGateway"])&&(context.oldConditionExpression=connectionBo.conditionExpression,delete connectionBo.conditionExpression),oldSource!==newSource&&oldSourceBo.default===connectionBo&&(context.oldDefault=oldSourceBo.default,delete oldSourceBo.default)}))),this.reverted("connection.reconnect",ifBpmn((function(event){var context=event.context,connection=context.connection,oldSource=context.oldSource,newSource=context.newSource,connectionBo=(0,_ModelUtil.getBusinessObject)(connection),oldSourceBo=(0,_ModelUtil.getBusinessObject)(oldSource),newSourceBo=(0,_ModelUtil.getBusinessObject)(newSource);context.oldConditionExpression&&(connectionBo.conditionExpression=context.oldConditionExpression),context.oldDefault&&(oldSourceBo.default=context.oldDefault,delete newSourceBo.default)}))),this.executed(["element.updateAttachment"],ifBpmn(updateAttachment)),this.reverted(["element.updateAttachment"],ifBpmn(updateAttachment))}function ifBpmn(fn){return function(event){var context=event.context,element=context.shape||context.connection;(0,_ModelUtil.is)(element,"bpmn:BaseElement")&&fn(event)}}(0,_inherits.default)(BpmnUpdater,_CommandInterceptor.default),BpmnUpdater.$inject=["eventBus","bpmnFactory","connectionDocking","translate"],BpmnUpdater.prototype.updateAttachment=function(context){var shape=context.shape,businessObject=shape.businessObject,host=shape.host;businessObject.attachedToRef=host&&host.businessObject},BpmnUpdater.prototype.updateParent=function(element,oldParent){if(!(element instanceof _model.Label||(0,_ModelUtil.is)(element,"bpmn:DataStoreReference")&&element.parent&&(0,_ModelUtil.is)(element.parent,"bpmn:Collaboration"))){var parentShape=element.parent,businessObject=element.businessObject,parentBusinessObject=parentShape&&parentShape.businessObject,parentDi=parentBusinessObject&&parentBusinessObject.di;(0,_ModelUtil.is)(element,"bpmn:FlowNode")&&this.updateFlowNodeRefs(businessObject,parentBusinessObject,oldParent&&oldParent.businessObject),(0,_ModelUtil.is)(element,"bpmn:DataOutputAssociation")&&(parentBusinessObject=element.source?element.source.businessObject:null),(0,_ModelUtil.is)(element,"bpmn:DataInputAssociation")&&(parentBusinessObject=element.target?element.target.businessObject:null),this.updateSemanticParent(businessObject,parentBusinessObject),(0,_ModelUtil.is)(element,"bpmn:DataObjectReference")&&businessObject.dataObjectRef&&this.updateSemanticParent(businessObject.dataObjectRef,parentBusinessObject),this.updateDiParent(businessObject.di,parentDi)}},BpmnUpdater.prototype.updateBounds=function(shape){var di=shape.businessObject.di,target=shape instanceof _model.Label?this._getLabel(di):di,bounds=target.bounds;bounds||(bounds=this._bpmnFactory.createDiBounds(),target.set("bounds",bounds)),(0,_minDash.assign)(bounds,{x:shape.x,y:shape.y,width:shape.width,height:shape.height})},BpmnUpdater.prototype.updateFlowNodeRefs=function(businessObject,newContainment,oldContainment){var oldRefs,newRefs;oldContainment!==newContainment&&((0,_ModelUtil.is)(oldContainment,"bpmn:Lane")&&(oldRefs=oldContainment.get("flowNodeRef"),(0,_Collections.remove)(oldRefs,businessObject)),(0,_ModelUtil.is)(newContainment,"bpmn:Lane")&&(newRefs=newContainment.get("flowNodeRef"),(0,_Collections.add)(newRefs,businessObject)))},BpmnUpdater.prototype.updateDiConnection=function(di,newSource,newTarget){di.sourceElement&&di.sourceElement.bpmnElement!==newSource&&(di.sourceElement=newSource&&newSource.di),di.targetElement&&di.targetElement.bpmnElement!==newTarget&&(di.targetElement=newTarget&&newTarget.di)},BpmnUpdater.prototype.updateDiParent=function(di,parentDi){if(parentDi&&!(0,_ModelUtil.is)(parentDi,"bpmndi:BPMNPlane")&&(parentDi=parentDi.$parent),di.$parent!==parentDi){var planeElements=(parentDi||di.$parent).get("planeElement");parentDi?(planeElements.push(di),di.$parent=parentDi):((0,_Collections.remove)(planeElements,di),di.$parent=null)}},BpmnUpdater.prototype.getLaneSet=function(container){var laneSet,laneSets;return(0,_ModelUtil.is)(container,"bpmn:Lane")?((laneSet=container.childLaneSet)||(laneSet=this._bpmnFactory.create("bpmn:LaneSet"),container.childLaneSet=laneSet,laneSet.$parent=container),laneSet):((0,_ModelUtil.is)(container,"bpmn:Participant")&&(container=container.processRef),(laneSet=(laneSets=container.get("laneSets"))[0])||((laneSet=this._bpmnFactory.create("bpmn:LaneSet")).$parent=container,laneSets.push(laneSet)),laneSet)},BpmnUpdater.prototype.updateSemanticParent=function(businessObject,newParent,visualParent){var containment,translate=this._translate;if(businessObject.$parent!==newParent&&(!(0,_ModelUtil.is)(businessObject,"bpmn:DataInput")&&!(0,_ModelUtil.is)(businessObject,"bpmn:DataOutput")||((0,_ModelUtil.is)(newParent,"bpmn:Participant")&&"processRef"in newParent&&(newParent=newParent.processRef),!("ioSpecification"in newParent)||newParent.ioSpecification!==businessObject.$parent))){if((0,_ModelUtil.is)(businessObject,"bpmn:Lane"))newParent&&(newParent=this.getLaneSet(newParent)),containment="lanes";else if((0,_ModelUtil.is)(businessObject,"bpmn:FlowElement")){if(newParent)if((0,_ModelUtil.is)(newParent,"bpmn:Participant"))newParent=newParent.processRef;else if((0,_ModelUtil.is)(newParent,"bpmn:Lane"))do{newParent=newParent.$parent.$parent}while((0,_ModelUtil.is)(newParent,"bpmn:Lane"));containment="flowElements"}else if((0,_ModelUtil.is)(businessObject,"bpmn:Artifact")){for(;newParent&&!(0,_ModelUtil.is)(newParent,"bpmn:Process")&&!(0,_ModelUtil.is)(newParent,"bpmn:SubProcess")&&!(0,_ModelUtil.is)(newParent,"bpmn:Collaboration");){if((0,_ModelUtil.is)(newParent,"bpmn:Participant")){newParent=newParent.processRef;break}newParent=newParent.$parent}containment="artifacts"}else if((0,_ModelUtil.is)(businessObject,"bpmn:MessageFlow"))containment="messageFlows";else if((0,_ModelUtil.is)(businessObject,"bpmn:Participant")){containment="participants";var definitions,process=businessObject.processRef;process&&(definitions=function(element){for(;element&&!(0,_ModelUtil.is)(element,"bpmn:Definitions");)element=element.$parent;return element}(businessObject.$parent||newParent),businessObject.$parent&&((0,_Collections.remove)(definitions.get("rootElements"),process),process.$parent=null),newParent&&((0,_Collections.add)(definitions.get("rootElements"),process),process.$parent=definitions))}else(0,_ModelUtil.is)(businessObject,"bpmn:DataOutputAssociation")?containment="dataOutputAssociations":(0,_ModelUtil.is)(businessObject,"bpmn:DataInputAssociation")&&(containment="dataInputAssociations");if(!containment)throw new Error(translate("no parent for {element} in {parent}",{element:businessObject.id,parent:newParent.id}));var children;if(businessObject.$parent&&(children=businessObject.$parent.get(containment),(0,_Collections.remove)(children,businessObject)),newParent?((children=newParent.get(containment)).push(businessObject),businessObject.$parent=newParent):businessObject.$parent=null,visualParent){var diChildren=visualParent.get(containment);(0,_Collections.remove)(children,businessObject),newParent&&(diChildren||(diChildren=[],newParent.set(containment,diChildren)),diChildren.push(businessObject))}}},BpmnUpdater.prototype.updateConnectionWaypoints=function(connection){connection.businessObject.di.set("waypoint",this._bpmnFactory.createDiWaypoints(connection.waypoints))},BpmnUpdater.prototype.updateConnection=function(context){var visualParent,connection=context.connection,businessObject=(0,_ModelUtil.getBusinessObject)(connection),newSource=(0,_ModelUtil.getBusinessObject)(connection.source),newTarget=(0,_ModelUtil.getBusinessObject)(connection.target);if((0,_ModelUtil.is)(businessObject,"bpmn:DataAssociation"))(0,_ModelUtil.is)(businessObject,"bpmn:DataInputAssociation")?(businessObject.get("sourceRef")[0]=newSource,visualParent=context.parent||context.newParent||newTarget,this.updateSemanticParent(businessObject,newTarget,visualParent)):(0,_ModelUtil.is)(businessObject,"bpmn:DataOutputAssociation")&&(visualParent=context.parent||context.newParent||newSource,this.updateSemanticParent(businessObject,newSource,visualParent),businessObject.targetRef=newTarget);else{var inverseSet=(0,_ModelUtil.is)(businessObject,"bpmn:SequenceFlow");businessObject.sourceRef!==newSource&&(inverseSet&&((0,_Collections.remove)(businessObject.sourceRef&&businessObject.sourceRef.get("outgoing"),businessObject),newSource&&newSource.get("outgoing")&&newSource.get("outgoing").push(businessObject)),businessObject.sourceRef=newSource),businessObject.targetRef!==newTarget&&(inverseSet&&((0,_Collections.remove)(businessObject.targetRef&&businessObject.targetRef.get("incoming"),businessObject),newTarget&&newTarget.get("incoming")&&newTarget.get("incoming").push(businessObject)),businessObject.targetRef=newTarget)}this.updateConnectionWaypoints(connection),this.updateDiConnection(businessObject.di,newSource,newTarget)},BpmnUpdater.prototype._getLabel=function(di){return di.label||(di.label=this._bpmnFactory.createDiLabel()),di.label}},{"../../util/ModelUtil":91,"./util/ModelingUtil":75,"diagram-js/lib/command/CommandInterceptor":96,"diagram-js/lib/model":190,"diagram-js/lib/util/Collections":200,inherits:218,"min-dash":219}],21:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ElementFactory;var _minDash=require("min-dash"),_inherits=_interopRequireDefault(require("inherits")),_ModelUtil=require("../../util/ModelUtil"),_DiUtil=require("../../util/DiUtil"),_ElementFactory=_interopRequireDefault(require("diagram-js/lib/core/ElementFactory")),_LabelUtil=require("../../util/LabelUtil");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ElementFactory(bpmnFactory,moddle,translate){_ElementFactory.default.call(this),this._bpmnFactory=bpmnFactory,this._moddle=moddle,this._translate=translate}function applyAttribute(element,attrs,attributeName){element[attributeName]=attrs[attributeName],delete attrs[attributeName]}(0,_inherits.default)(ElementFactory,_ElementFactory.default),ElementFactory.$inject=["bpmnFactory","moddle","translate"],ElementFactory.prototype.baseCreate=_ElementFactory.default.prototype.create,ElementFactory.prototype.create=function(elementType,attrs){return"label"===elementType?this.baseCreate(elementType,(0,_minDash.assign)({type:"label"},_LabelUtil.DEFAULT_LABEL_SIZE,attrs)):this.createBpmnElement(elementType,attrs)},ElementFactory.prototype.createBpmnElement=function(elementType,attrs){var size,eventDefinitions,newEventDefinition,translate=this._translate,businessObject=(attrs=attrs||{}).businessObject;if(!businessObject){if(!attrs.type)throw new Error(translate("no shape type specified"));businessObject=this._bpmnFactory.create(attrs.type)}return businessObject.di||(businessObject.di="root"===elementType?this._bpmnFactory.createDiPlane(businessObject,[],{id:businessObject.id+"_di"}):"connection"===elementType?this._bpmnFactory.createDiEdge(businessObject,[],{id:businessObject.id+"_di"}):this._bpmnFactory.createDiShape(businessObject,{},{id:businessObject.id+"_di"})),(0,_ModelUtil.is)(businessObject,"bpmn:Group")&&(attrs=(0,_minDash.assign)({isFrame:!0},attrs)),attrs.di&&((0,_minDash.assign)(businessObject.di,attrs.di),delete attrs.di),function(element,attrs,attributeNames){(0,_minDash.forEach)(attributeNames,(function(property){void 0!==attrs[property]&&applyAttribute(element,attrs,property)}))}(businessObject,attrs,["processRef","isInterrupting","associationDirection","isForCompensation"]),attrs.isExpanded&&applyAttribute(businessObject.di,attrs,"isExpanded"),(0,_ModelUtil.is)(businessObject,"bpmn:ExclusiveGateway")&&(businessObject.di.isMarkerVisible=!0),attrs.eventDefinitionType&&(eventDefinitions=businessObject.get("eventDefinitions")||[],newEventDefinition=this._bpmnFactory.create(attrs.eventDefinitionType,attrs.eventDefinitionAttrs),"bpmn:ConditionalEventDefinition"===attrs.eventDefinitionType&&(newEventDefinition.condition=this._bpmnFactory.create("bpmn:FormalExpression")),eventDefinitions.push(newEventDefinition),newEventDefinition.$parent=businessObject,businessObject.eventDefinitions=eventDefinitions,delete attrs.eventDefinitionType),size=this._getDefaultSize(businessObject),attrs=(0,_minDash.assign)({businessObject,id:businessObject.id},size,attrs),this.baseCreate(elementType,attrs)},ElementFactory.prototype._getDefaultSize=function(semantic){return(0,_ModelUtil.is)(semantic,"bpmn:SubProcess")?(0,_DiUtil.isExpanded)(semantic)?{width:350,height:200}:{width:100,height:80}:(0,_ModelUtil.is)(semantic,"bpmn:Task")?{width:100,height:80}:(0,_ModelUtil.is)(semantic,"bpmn:Gateway")?{width:50,height:50}:(0,_ModelUtil.is)(semantic,"bpmn:Event")?{width:36,height:36}:(0,_ModelUtil.is)(semantic,"bpmn:Participant")?(0,_DiUtil.isExpanded)(semantic)?{width:600,height:250}:{width:400,height:60}:(0,_ModelUtil.is)(semantic,"bpmn:Lane")?{width:400,height:100}:(0,_ModelUtil.is)(semantic,"bpmn:DataObjectReference")?{width:36,height:50}:(0,_ModelUtil.is)(semantic,"bpmn:DataStoreReference")?{width:50,height:50}:(0,_ModelUtil.is)(semantic,"bpmn:TextAnnotation")?{width:100,height:30}:(0,_ModelUtil.is)(semantic,"bpmn:Group")?{width:300,height:300}:{width:100,height:80}},ElementFactory.prototype.createParticipantShape=function(attrs){return(0,_minDash.isObject)(attrs)||(attrs={isExpanded:attrs}),!1!==(attrs=(0,_minDash.assign)({type:"bpmn:Participant"},attrs||{})).isExpanded&&(attrs.processRef=this._bpmnFactory.create("bpmn:Process")),this.createShape(attrs)}},{"../../util/DiUtil":89,"../../util/LabelUtil":90,"../../util/ModelUtil":91,"diagram-js/lib/core/ElementFactory":100,inherits:218,"min-dash":219}],22:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Modeling;var _inherits=_interopRequireDefault(require("inherits")),_Modeling=_interopRequireDefault(require("diagram-js/lib/features/modeling/Modeling")),_UpdateModdlePropertiesHandler=_interopRequireDefault(require("./cmd/UpdateModdlePropertiesHandler")),_UpdatePropertiesHandler=_interopRequireDefault(require("./cmd/UpdatePropertiesHandler")),_UpdateCanvasRootHandler=_interopRequireDefault(require("./cmd/UpdateCanvasRootHandler")),_AddLaneHandler=_interopRequireDefault(require("./cmd/AddLaneHandler")),_SplitLaneHandler=_interopRequireDefault(require("./cmd/SplitLaneHandler")),_ResizeLaneHandler=_interopRequireDefault(require("./cmd/ResizeLaneHandler")),_UpdateFlowNodeRefsHandler=_interopRequireDefault(require("./cmd/UpdateFlowNodeRefsHandler")),_IdClaimHandler=_interopRequireDefault(require("./cmd/IdClaimHandler")),_SetColorHandler=_interopRequireDefault(require("./cmd/SetColorHandler")),_UpdateLabelHandler=_interopRequireDefault(require("../label-editing/cmd/UpdateLabelHandler"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function Modeling(eventBus,elementFactory,commandStack,bpmnRules){_Modeling.default.call(this,eventBus,elementFactory,commandStack),this._bpmnRules=bpmnRules}(0,_inherits.default)(Modeling,_Modeling.default),Modeling.$inject=["eventBus","elementFactory","commandStack","bpmnRules"],Modeling.prototype.getHandlers=function(){var handlers=_Modeling.default.prototype.getHandlers.call(this);return handlers["element.updateModdleProperties"]=_UpdateModdlePropertiesHandler.default,handlers["element.updateProperties"]=_UpdatePropertiesHandler.default,handlers["canvas.updateRoot"]=_UpdateCanvasRootHandler.default,handlers["lane.add"]=_AddLaneHandler.default,handlers["lane.resize"]=_ResizeLaneHandler.default,handlers["lane.split"]=_SplitLaneHandler.default,handlers["lane.updateRefs"]=_UpdateFlowNodeRefsHandler.default,handlers["id.updateClaim"]=_IdClaimHandler.default,handlers["element.setColor"]=_SetColorHandler.default,handlers["element.updateLabel"]=_UpdateLabelHandler.default,handlers},Modeling.prototype.updateLabel=function(element,newLabel,newBounds,hints){this._commandStack.execute("element.updateLabel",{element,newLabel,newBounds,hints:hints||{}})},Modeling.prototype.connect=function(source,target,attrs,hints){var bpmnRules=this._bpmnRules;if(attrs||(attrs=bpmnRules.canConnect(source,target)),attrs)return this.createConnection(source,target,attrs,source.parent,hints)},Modeling.prototype.updateModdleProperties=function(element,moddleElement,properties){this._commandStack.execute("element.updateModdleProperties",{element,moddleElement,properties})},Modeling.prototype.updateProperties=function(element,properties){this._commandStack.execute("element.updateProperties",{element,properties})},Modeling.prototype.resizeLane=function(laneShape,newBounds,balanced){this._commandStack.execute("lane.resize",{shape:laneShape,newBounds,balanced})},Modeling.prototype.addLane=function(targetLaneShape,location){var context={shape:targetLaneShape,location};return this._commandStack.execute("lane.add",context),context.newLane},Modeling.prototype.splitLane=function(targetLane,count){this._commandStack.execute("lane.split",{shape:targetLane,count})},Modeling.prototype.makeCollaboration=function(){var collaborationElement=this._create("root",{type:"bpmn:Collaboration"}),context={newRoot:collaborationElement};return this._commandStack.execute("canvas.updateRoot",context),collaborationElement},Modeling.prototype.updateLaneRefs=function(flowNodeShapes,laneShapes){this._commandStack.execute("lane.updateRefs",{flowNodeShapes,laneShapes})},Modeling.prototype.makeProcess=function(){var context={newRoot:this._create("root",{type:"bpmn:Process"})};this._commandStack.execute("canvas.updateRoot",context)},Modeling.prototype.claimId=function(id,moddleElement){this._commandStack.execute("id.updateClaim",{id,element:moddleElement,claiming:!0})},Modeling.prototype.unclaimId=function(id,moddleElement){this._commandStack.execute("id.updateClaim",{id,element:moddleElement})},Modeling.prototype.setColor=function(elements,colors){elements.length||(elements=[elements]),this._commandStack.execute("element.setColor",{elements,colors})}},{"../label-editing/cmd/UpdateLabelHandler":17,"./cmd/AddLaneHandler":63,"./cmd/IdClaimHandler":64,"./cmd/ResizeLaneHandler":65,"./cmd/SetColorHandler":66,"./cmd/SplitLaneHandler":67,"./cmd/UpdateCanvasRootHandler":68,"./cmd/UpdateFlowNodeRefsHandler":69,"./cmd/UpdateModdlePropertiesHandler":70,"./cmd/UpdatePropertiesHandler":71,"diagram-js/lib/features/modeling/Modeling":132,inherits:218}],23:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=AdaptiveLabelPositioningBehavior;var _inherits=_interopRequireDefault(require("inherits")),_LayoutUtil=require("diagram-js/lib/layout/LayoutUtil"),_Math=require("diagram-js/lib/util/Math"),_LabelUtil=require("../../../util/LabelUtil"),_CommandInterceptor=_interopRequireDefault(require("diagram-js/lib/command/CommandInterceptor"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ALIGNMENTS=["top","bottom","left","right"];function AdaptiveLabelPositioningBehavior(eventBus,modeling){function checkLabelAdjustment(element){if((0,_LabelUtil.hasExternalLabel)(element)){var optimalPosition=function(element){var labelMid=(0,_LayoutUtil.getMid)(element.label),labelOrientation=getApproximateOrientation((0,_LayoutUtil.getMid)(element),labelMid);if(orientation=labelOrientation,-1===ALIGNMENTS.indexOf(orientation))return;var orientation;var takenAlignments=function(element){var elementMid=(0,_LayoutUtil.getMid)(element);return[].concat(element.incoming.map((function(c){return c.waypoints[c.waypoints.length-2]})),element.outgoing.map((function(c){return c.waypoints[1]}))).map((function(point){return getApproximateOrientation(elementMid,point)}))}(element);if(element.host){var takenHostAlignments=function(element){var freeAlignments,hostElement=element.host,elementMid=(0,_LayoutUtil.getMid)(element),hostOrientation=(0,_LayoutUtil.getOrientation)(elementMid,hostElement);freeAlignments=hostOrientation.indexOf("-")>=0?hostOrientation.split("-"):[hostOrientation];return ALIGNMENTS.filter((function(alignment){return-1===freeAlignments.indexOf(alignment)}))}(element);takenAlignments=takenAlignments.concat(takenHostAlignments)}var freeAlignments=ALIGNMENTS.filter((function(alignment){return-1===takenAlignments.indexOf(alignment)}));if(-1!==freeAlignments.indexOf(labelOrientation))return;return freeAlignments[0]}(element);optimalPosition&&function(element,orientation){var elementMid=(0,_LayoutUtil.getMid)(element),label=element.label,labelMid=(0,_LayoutUtil.getMid)(label);if(!label.parent)return;var newLabelMid,elementTrbl=(0,_LayoutUtil.asTRBL)(element);switch(orientation){case"top":newLabelMid={x:elementMid.x,y:elementTrbl.top-10-label.height/2};break;case"left":newLabelMid={x:elementTrbl.left-10-label.width/2,y:elementMid.y};break;case"bottom":newLabelMid={x:elementMid.x,y:elementTrbl.bottom+10+label.height/2};break;case"right":newLabelMid={x:elementTrbl.right+10+label.width/2,y:elementMid.y}}var delta=(0,_Math.substract)(newLabelMid,labelMid);modeling.moveShape(label,delta)}(element,optimalPosition)}}_CommandInterceptor.default.call(this,eventBus),this.postExecuted(["connection.create","connection.layout","connection.updateWaypoints"],(function(event){var context=event.context,connection=context.connection,source=connection.source,target=connection.target;!1!==(context.hints||{}).createElementsBehavior&&(checkLabelAdjustment(source),checkLabelAdjustment(target))})),this.postExecuted(["label.create"],(function(event){var context=event.context,shape=context.shape;!1!==(context.hints||{}).createElementsBehavior&&checkLabelAdjustment(shape.labelTarget)})),this.postExecuted(["elements.create"],(function(event){var context=event.context,elements=context.elements;!1!==(context.hints||{}).createElementsBehavior&&elements.forEach((function(element){checkLabelAdjustment(element)}))}))}function getApproximateOrientation(p0,p1){return(0,_LayoutUtil.getOrientation)(p1,p0,5)}(0,_inherits.default)(AdaptiveLabelPositioningBehavior,_CommandInterceptor.default),AdaptiveLabelPositioningBehavior.$inject=["eventBus","modeling"]},{"../../../util/LabelUtil":90,"diagram-js/lib/command/CommandInterceptor":96,"diagram-js/lib/layout/LayoutUtil":188,"diagram-js/lib/util/Math":208,inherits:218}],24:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=AppendBehavior;var _inherits=_interopRequireDefault(require("inherits")),_ModelUtil=require("../../../util/ModelUtil"),_CommandInterceptor=_interopRequireDefault(require("diagram-js/lib/command/CommandInterceptor"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function AppendBehavior(eventBus,elementFactory,bpmnRules){_CommandInterceptor.default.call(this,eventBus),this.preExecute("shape.append",(function(context){var source=context.source,shape=context.shape;context.position||((0,_ModelUtil.is)(shape,"bpmn:TextAnnotation")?context.position={x:source.x+source.width/2+75,y:source.y-50-shape.height/2}:context.position={x:source.x+source.width+80+shape.width/2,y:source.y+source.height/2})}),!0)}(0,_inherits.default)(AppendBehavior,_CommandInterceptor.default),AppendBehavior.$inject=["eventBus","elementFactory","bpmnRules"]},{"../../../util/ModelUtil":91,"diagram-js/lib/command/CommandInterceptor":96,inherits:218}],25:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=AssociationBehavior;var _inherits=_interopRequireDefault(require("inherits")),_ModelUtil=require("../../../util/ModelUtil"),_CommandInterceptor=_interopRequireDefault(require("diagram-js/lib/command/CommandInterceptor")),_minDash=require("min-dash");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function AssociationBehavior(injector,modeling){injector.invoke(_CommandInterceptor.default,this),this.postExecute("shape.move",(function(context){var newParent=context.newParent,shape=context.shape,associations=(0,_minDash.filter)(shape.incoming.concat(shape.outgoing),(function(connection){return(0,_ModelUtil.is)(connection,"bpmn:Association")}));(0,_minDash.forEach)(associations,(function(association){modeling.moveConnection(association,{x:0,y:0},newParent)}))}),!0)}(0,_inherits.default)(AssociationBehavior,_CommandInterceptor.default),AssociationBehavior.$inject=["injector","modeling"]},{"../../../util/ModelUtil":91,"diagram-js/lib/command/CommandInterceptor":96,inherits:218,"min-dash":219}],26:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=AttachEventBehavior;var _inherits=_interopRequireDefault(require("inherits")),_CommandInterceptor=_interopRequireDefault(require("diagram-js/lib/command/CommandInterceptor")),_ModelUtil=require("../../../util/ModelUtil"),_ModelingUtil=require("../util/ModelingUtil"),_LabelUtil=require("../../../util/LabelUtil");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function AttachEventBehavior(bpmnReplace,injector){injector.invoke(_CommandInterceptor.default,this),this._bpmnReplace=bpmnReplace;var self=this;this.postExecuted("elements.create",500,(function(context){var elements=context.elements;1===(elements=elements.filter((function(shape){return shouldReplace(shape,shape.host)}))).length&&elements.map((function(element){return elements.indexOf(element)})).forEach((function(index){var host=elements[index];context.elements[index]=self.replaceShape(elements[index],host)}))}),!0),this.preExecute("elements.move",500,(function(context){var shapes=context.shapes,host=context.newHost;if(1===shapes.length){var shape=shapes[0];shouldReplace(shape,host)&&(context.shapes=[self.replaceShape(shape,host)])}}),!0)}function shouldReplace(shape,host){return!(0,_LabelUtil.isLabel)(shape)&&(0,_ModelingUtil.isAny)(shape,["bpmn:IntermediateThrowEvent","bpmn:IntermediateCatchEvent"])&&!!host}AttachEventBehavior.$inject=["bpmnReplace","injector"],(0,_inherits.default)(AttachEventBehavior,_CommandInterceptor.default),AttachEventBehavior.prototype.replaceShape=function(shape,host){var element,eventDefinitions,eventDefinition=(element=shape,(eventDefinitions=(0,_ModelUtil.getBusinessObject)(element).eventDefinitions)&&eventDefinitions[0]),boundaryEvent={type:"bpmn:BoundaryEvent",host};return eventDefinition&&(boundaryEvent.eventDefinitionType=eventDefinition.$type),this._bpmnReplace.replaceElement(shape,boundaryEvent,{layoutConnection:!1})}},{"../../../util/LabelUtil":90,"../../../util/ModelUtil":91,"../util/ModelingUtil":75,"diagram-js/lib/command/CommandInterceptor":96,inherits:218}],27:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BoundaryEventBehavior;var _inherits=_interopRequireDefault(require("inherits")),_CommandInterceptor=_interopRequireDefault(require("diagram-js/lib/command/CommandInterceptor")),_ModelUtil=require("../../../util/ModelUtil"),_minDash=require("min-dash");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function BoundaryEventBehavior(eventBus,moddle,modeling){function getBoundaryEvents(element){return(0,_minDash.filter)(element.attachers,(function(attacher){return(0,_ModelUtil.is)(attacher,"bpmn:BoundaryEvent")}))}_CommandInterceptor.default.call(this,eventBus),this.postExecute("connection.create",(function(event){var source=event.context.source,target=event.context.target,boundaryEvents=getBoundaryEvents(target);(0,_ModelUtil.is)(source,"bpmn:EventBasedGateway")&&(0,_ModelUtil.is)(target,"bpmn:ReceiveTask")&&boundaryEvents.length>0&&modeling.removeElements(boundaryEvents)})),this.postExecute("connection.reconnect",(function(event){var oldSource=event.context.oldSource,newSource=event.context.newSource;(0,_ModelUtil.is)(oldSource,"bpmn:Gateway")&&(0,_ModelUtil.is)(newSource,"bpmn:EventBasedGateway")&&(0,_minDash.forEach)(newSource.outgoing,(function(connection){var target=connection.target,attachedboundaryEvents=getBoundaryEvents(target);(0,_ModelUtil.is)(target,"bpmn:ReceiveTask")&&attachedboundaryEvents.length>0&&modeling.removeElements(attachedboundaryEvents)}))})),eventBus.on("moddleCopy.canCopyProperty",2e3,(function(context){var parent=context.parent,property=context.property,propertyName=context.propertyName,propertyDescriptor=moddle.getPropertyDescriptor(parent,propertyName);propertyDescriptor&&propertyDescriptor.isReference&&(0,_ModelUtil.is)(property,"bpmn:RootElement")&&parent.set(propertyName,property)}))}BoundaryEventBehavior.$inject=["eventBus","moddle","modeling"],(0,_inherits.default)(BoundaryEventBehavior,_CommandInterceptor.default)},{"../../../util/ModelUtil":91,"diagram-js/lib/command/CommandInterceptor":96,inherits:218,"min-dash":219}],28:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=CreateBehavior;var _inherits=_interopRequireDefault(require("inherits")),_ModelUtil=require("../../../util/ModelUtil"),_CommandInterceptor=_interopRequireDefault(require("diagram-js/lib/command/CommandInterceptor")),_ModelingUtil=require("../util/ModelingUtil");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function CreateBehavior(injector){injector.invoke(_CommandInterceptor.default,this),this.preExecute("shape.create",1500,(function(event){var context=event.context,parent=context.parent,shape=context.shape;(0,_ModelUtil.is)(parent,"bpmn:Lane")&&!(0,_ModelUtil.is)(shape,"bpmn:Lane")&&(context.parent=(0,_ModelingUtil.getParent)(parent,"bpmn:Participant"))}))}CreateBehavior.$inject=["injector"],(0,_inherits.default)(CreateBehavior,_CommandInterceptor.default)},{"../../../util/ModelUtil":91,"../util/ModelingUtil":75,"diagram-js/lib/command/CommandInterceptor":96,inherits:218}],29:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=CreateDataObjectBehavior;var _inherits=_interopRequireDefault(require("inherits")),_CommandInterceptor=_interopRequireDefault(require("diagram-js/lib/command/CommandInterceptor")),_ModelUtil=require("../../../util/ModelUtil");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function CreateDataObjectBehavior(eventBus,bpmnFactory,moddle){_CommandInterceptor.default.call(this,eventBus),this.preExecute("shape.create",(function(event){var shape=event.context.shape;if((0,_ModelUtil.is)(shape,"bpmn:DataObjectReference")&&"label"!==shape.type){var dataObject=bpmnFactory.create("bpmn:DataObject");shape.businessObject.dataObjectRef=dataObject}}))}CreateDataObjectBehavior.$inject=["eventBus","bpmnFactory","moddle"],(0,_inherits.default)(CreateDataObjectBehavior,_CommandInterceptor.default)},{"../../../util/ModelUtil":91,"diagram-js/lib/command/CommandInterceptor":96,inherits:218}],30:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=CreateParticipantBehavior,exports.PARTICIPANT_BORDER_WIDTH=void 0;var _inherits=_interopRequireDefault(require("inherits")),_CommandInterceptor=_interopRequireDefault(require("diagram-js/lib/command/CommandInterceptor")),_ModelUtil=require("../../../util/ModelUtil"),_LabelUtil=require("../../../util/LabelUtil"),_Elements=require("diagram-js/lib/util/Elements"),_minDash=require("min-dash"),_LayoutUtil=require("diagram-js/lib/layout/LayoutUtil");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.PARTICIPANT_BORDER_WIDTH=30;function CreateParticipantBehavior(canvas,eventBus,modeling){function getOrCreateCollaboration(){var rootElement=canvas.getRootElement();return(0,_ModelUtil.is)(rootElement,"bpmn:Collaboration")?rootElement:modeling.makeCollaboration()}_CommandInterceptor.default.call(this,eventBus),eventBus.on(["create.start","shape.move.start"],2e3,(function(event){var context=event.context,shape=context.shape,rootElement=canvas.getRootElement();if((0,_ModelUtil.is)(shape,"bpmn:Participant")&&(0,_ModelUtil.is)(rootElement,"bpmn:Process")&&rootElement.children.length){var children=rootElement.children.filter((function(element){return!(0,_ModelUtil.is)(element,"bpmn:Group")&&!(0,_LabelUtil.isLabel)(element)&&!function(element){return!!element.waypoints}(element)}));if(children.length){var childrenBBox=(0,_Elements.getBBox)(children),participantBounds=function(shape,childrenBBox){childrenBBox={width:childrenBBox.width+40+30,height:childrenBBox.height+40};var width=Math.max(shape.width,childrenBBox.width),height=Math.max(shape.height,childrenBBox.height);return{x:-width/2,y:-height/2,width,height}}(shape,childrenBBox);(0,_minDash.assign)(shape,participantBounds),context.createConstraints=function(shape,childrenBBox){return{bottom:(childrenBBox=(0,_LayoutUtil.asTRBL)(childrenBBox)).top+shape.height/2-20,left:childrenBBox.right-shape.width/2+20,top:childrenBBox.bottom-shape.height/2+20,right:childrenBBox.left+shape.width/2-20-30}}(shape,childrenBBox)}}})),eventBus.on("create.start",2e3,(function(event){var shape=event.context.shape,rootElement=canvas.getRootElement(),rootElementGfx=canvas.getGraphics(rootElement);function ensureHoveringProcess(event){event.element=rootElement,event.gfx=rootElementGfx}(0,_ModelUtil.is)(shape,"bpmn:Participant")&&(0,_ModelUtil.is)(rootElement,"bpmn:Process")&&(eventBus.on("element.hover",2e3,ensureHoveringProcess),eventBus.once("create.cleanup",(function(){eventBus.off("element.hover",ensureHoveringProcess)})))})),this.preExecute("elements.create",2e3,(function(context){var hints,elements=context.elements,parent=context.parent,participant=function(elements){return(0,_minDash.find)(elements,(function(element){return(0,_ModelUtil.is)(element,"bpmn:Participant")}))}(elements);participant&&(0,_ModelUtil.is)(parent,"bpmn:Process")&&(context.parent=getOrCreateCollaboration(),(hints=context.hints=context.hints||{}).participant=participant,hints.process=parent,hints.processRef=(0,_ModelUtil.getBusinessObject)(participant).get("processRef"))}),!0),this.preExecute("shape.create",(function(context){var parent=context.parent,shape=context.shape;(0,_ModelUtil.is)(shape,"bpmn:Participant")&&(0,_ModelUtil.is)(parent,"bpmn:Process")&&(context.parent=getOrCreateCollaboration(),context.process=parent,context.processRef=(0,_ModelUtil.getBusinessObject)(shape).get("processRef"))}),!0),this.execute("shape.create",(function(context){var hints=context.hints||{},process=context.process||hints.process,shape=context.shape,participant=hints.participant;!process||participant&&shape!==participant||(0,_ModelUtil.getBusinessObject)(shape).set("processRef",(0,_ModelUtil.getBusinessObject)(process))}),!0),this.revert("shape.create",(function(context){var hints=context.hints||{},process=context.process||hints.process,processRef=context.processRef||hints.processRef,shape=context.shape,participant=hints.participant;!process||participant&&shape!==participant||(0,_ModelUtil.getBusinessObject)(shape).set("processRef",processRef)}),!0),this.postExecute("shape.create",(function(context){var hints=context.hints||{},process=context.process||context.hints.process,shape=context.shape,participant=hints.participant;if(process){var children=process.children.slice();participant?shape===participant&&modeling.moveElements(children,{x:0,y:0},participant):modeling.moveElements(children,{x:0,y:0},shape)}}),!0)}CreateParticipantBehavior.$inject=["canvas","eventBus","modeling"],(0,_inherits.default)(CreateParticipantBehavior,_CommandInterceptor.default)},{"../../../util/LabelUtil":90,"../../../util/ModelUtil":91,"diagram-js/lib/command/CommandInterceptor":96,"diagram-js/lib/layout/LayoutUtil":188,"diagram-js/lib/util/Elements":202,inherits:218,"min-dash":219}],31:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=DataInputAssociationBehavior;var _inherits=_interopRequireDefault(require("inherits")),_CommandInterceptor=_interopRequireDefault(require("diagram-js/lib/command/CommandInterceptor")),_Collections=require("diagram-js/lib/util/Collections"),_minDash=require("min-dash"),_ModelUtil=require("../../../util/ModelUtil");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function DataInputAssociationBehavior(eventBus,bpmnFactory){function getTargetRef(element,create){var properties=element.get("properties"),targetRefProp=(0,_minDash.find)(properties,(function(p){return"__targetRef_placeholder"===p.name}));return!targetRefProp&&create&&(targetRefProp=bpmnFactory.create("bpmn:Property",{name:"__targetRef_placeholder"}),(0,_Collections.add)(properties,targetRefProp)),targetRefProp}function cleanupTargetRef(element,connection){var targetRefProp=getTargetRef(element);targetRefProp&&(function(element,targetRef,removedConnection){var inputAssociations=element.get("dataInputAssociations");return(0,_minDash.find)(inputAssociations,(function(association){return association!==removedConnection&&association.targetRef===targetRef}))}(element,targetRefProp,connection)||(0,_Collections.remove)(element.get("properties"),targetRefProp))}function fixTargetRef(event){var targetRefProp,context=event.context,connection=context.connection,connectionBo=connection.businessObject,target=connection.target,targetBo=target&&target.businessObject,newTarget=context.newTarget,newTargetBo=newTarget&&newTarget.businessObject,oldTarget=context.oldTarget||context.target,oldTargetBo=oldTarget&&oldTarget.businessObject,dataAssociation=connection.businessObject;oldTargetBo&&oldTargetBo!==targetBo&&cleanupTargetRef(oldTargetBo,connectionBo),newTargetBo&&newTargetBo!==targetBo&&cleanupTargetRef(newTargetBo,connectionBo),targetBo?(targetRefProp=getTargetRef(targetBo,!0),dataAssociation.targetRef=targetRefProp):dataAssociation.targetRef=null}_CommandInterceptor.default.call(this,eventBus),this.executed(["connection.create","connection.delete","connection.move","connection.reconnect"],ifDataInputAssociation(fixTargetRef)),this.reverted(["connection.create","connection.delete","connection.move","connection.reconnect"],ifDataInputAssociation(fixTargetRef))}function ifDataInputAssociation(fn){return function(event){var connection=event.context.connection;if((0,_ModelUtil.is)(connection,"bpmn:DataInputAssociation"))return fn(event)}}DataInputAssociationBehavior.$inject=["eventBus","bpmnFactory"],(0,_inherits.default)(DataInputAssociationBehavior,_CommandInterceptor.default)},{"../../../util/ModelUtil":91,"diagram-js/lib/command/CommandInterceptor":96,"diagram-js/lib/util/Collections":200,inherits:218,"min-dash":219}],32:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=DataStoreBehavior;var _inherits=_interopRequireDefault(require("inherits")),_CommandInterceptor=_interopRequireDefault(require("diagram-js/lib/command/CommandInterceptor")),_ModelUtil=require("../../../util/ModelUtil"),_ModelingUtil=require("../util/ModelingUtil"),_UpdateSemanticParentHandler=_interopRequireDefault(require("../cmd/UpdateSemanticParentHandler"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function DataStoreBehavior(canvas,commandStack,elementRegistry,eventBus){function getDataStores(element){return element.children.filter((function(child){return(0,_ModelUtil.is)(child,"bpmn:DataStoreReference")&&!child.labelTarget}))}function updateDataStoreParent(dataStore,newDataStoreParent){var dataStoreBo=dataStore.businessObject||dataStore;if(newDataStoreParent=newDataStoreParent||elementRegistry.filter((function(element){return(0,_ModelUtil.is)(element,"bpmn:Participant")&&(0,_ModelUtil.getBusinessObject)(element).processRef}))[0]){var newDataStoreParentBo=newDataStoreParent.businessObject||newDataStoreParent;commandStack.execute("dataStore.updateContainment",{dataStoreBo,newSemanticParent:newDataStoreParentBo.processRef||newDataStoreParentBo,newDiParent:newDataStoreParentBo.di})}}_CommandInterceptor.default.call(this,eventBus),commandStack.registerHandler("dataStore.updateContainment",_UpdateSemanticParentHandler.default),this.preExecute("shape.create",(function(event){var context=event.context,shape=context.shape;(0,_ModelUtil.is)(shape,"bpmn:DataStoreReference")&&"label"!==shape.type&&(context.hints||(context.hints={}),context.hints.autoResize=!1)})),this.preExecute("elements.move",(function(event){var context=event.context,shapes=context.shapes;shapes.filter((function(shape){return(0,_ModelUtil.is)(shape,"bpmn:DataStoreReference")})).length&&(context.hints||(context.hints={}),context.hints.autoResize=shapes.filter((function(shape){return!(0,_ModelUtil.is)(shape,"bpmn:DataStoreReference")})))})),this.postExecute("shape.create",(function(event){var shape=event.context.shape,parent=shape.parent;(0,_ModelUtil.is)(shape,"bpmn:DataStoreReference")&&"label"!==shape.type&&(0,_ModelUtil.is)(parent,"bpmn:Collaboration")&&updateDataStoreParent(shape)})),this.postExecute("shape.move",(function(event){var context=event.context,shape=context.shape,oldParent=context.oldParent,parent=shape.parent;(0,_ModelUtil.is)(oldParent,"bpmn:Collaboration")||(0,_ModelUtil.is)(shape,"bpmn:DataStoreReference")&&"label"!==shape.type&&(0,_ModelUtil.is)(parent,"bpmn:Collaboration")&&updateDataStoreParent(shape,(0,_ModelUtil.is)(oldParent,"bpmn:Participant")?oldParent:function(element,type){for(;element.parent;){if((0,_ModelUtil.is)(element.parent,type))return element.parent;element=element.parent}}(oldParent,"bpmn:Participant"))})),this.postExecute("shape.delete",(function(event){var shape=event.context.shape,rootElement=canvas.getRootElement();(0,_ModelingUtil.isAny)(shape,["bpmn:Participant","bpmn:SubProcess"])&&(0,_ModelUtil.is)(rootElement,"bpmn:Collaboration")&&getDataStores(rootElement).filter((function(dataStore){return function(descendant,ancestor){var descendantBo=descendant.businessObject||descendant,ancestorBo=ancestor.businessObject||ancestor;for(;descendantBo.$parent;){if(descendantBo.$parent===ancestorBo.processRef||ancestorBo)return!0;descendantBo=descendantBo.$parent}return!1}(dataStore,shape)})).forEach((function(dataStore){updateDataStoreParent(dataStore)}))})),this.postExecute("canvas.updateRoot",(function(event){var context=event.context,oldRoot=context.oldRoot,newRoot=context.newRoot;getDataStores(oldRoot).forEach((function(dataStore){(0,_ModelUtil.is)(newRoot,"bpmn:Process")&&updateDataStoreParent(dataStore,newRoot)}))}))}DataStoreBehavior.$inject=["canvas","commandStack","elementRegistry","eventBus"],(0,_inherits.default)(DataStoreBehavior,_CommandInterceptor.default)},{"../../../util/ModelUtil":91,"../cmd/UpdateSemanticParentHandler":72,"../util/ModelingUtil":75,"diagram-js/lib/command/CommandInterceptor":96,inherits:218}],33:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=DeleteLaneBehavior;var _inherits=_interopRequireDefault(require("inherits")),_CommandInterceptor=_interopRequireDefault(require("diagram-js/lib/command/CommandInterceptor")),_ModelUtil=require("../../../util/ModelUtil"),_LaneUtil=require("../util/LaneUtil"),_Elements=require("diagram-js/lib/util/Elements");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function DeleteLaneBehavior(eventBus,modeling,spaceTool){_CommandInterceptor.default.call(this,eventBus),this.postExecuted("shape.delete",500,(function(event){var context=event.context,hints=context.hints,shape=context.shape,oldParent=context.oldParent;(0,_ModelUtil.is)(shape,"bpmn:Lane")&&(hints&&hints.nested||function(shape,oldParent){var offset,topAdjustments,bottomAdjustments,siblings=(0,_LaneUtil.getChildLanes)(oldParent),topAffected=[],bottomAffected=[];(0,_Elements.eachElement)(siblings,(function(element){return element.y>shape.y?bottomAffected.push(element):topAffected.push(element),element.children})),siblings.length&&(offset=bottomAffected.length&&topAffected.length?shape.height/2:shape.height,topAffected.length&&(topAdjustments=spaceTool.calculateAdjustments(topAffected,"y",offset,shape.y-10),spaceTool.makeSpace(topAdjustments.movingShapes,topAdjustments.resizingShapes,{x:0,y:offset},"s")),bottomAffected.length&&(bottomAdjustments=spaceTool.calculateAdjustments(bottomAffected,"y",-offset,shape.y+shape.height+10),spaceTool.makeSpace(bottomAdjustments.movingShapes,bottomAdjustments.resizingShapes,{x:0,y:-offset},"n")))}(shape,oldParent))}))}DeleteLaneBehavior.$inject=["eventBus","modeling","spaceTool"],(0,_inherits.default)(DeleteLaneBehavior,_CommandInterceptor.default)},{"../../../util/ModelUtil":91,"../util/LaneUtil":74,"diagram-js/lib/command/CommandInterceptor":96,"diagram-js/lib/util/Elements":202,inherits:218}],34:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=DetachEventBehavior;var _inherits=_interopRequireDefault(require("inherits")),_CommandInterceptor=_interopRequireDefault(require("diagram-js/lib/command/CommandInterceptor")),_ModelUtil=require("../../../util/ModelUtil"),_LabelUtil=require("../../../util/LabelUtil");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function DetachEventBehavior(bpmnReplace,injector){injector.invoke(_CommandInterceptor.default,this),this._bpmnReplace=bpmnReplace;var self=this;this.postExecuted("elements.create",500,(function(context){var elements=context.elements;elements.filter((function(shape){return shouldReplace(shape,shape.host)})).map((function(shape){return elements.indexOf(shape)})).forEach((function(index){context.elements[index]=self.replaceShape(elements[index])}))}),!0),this.preExecute("elements.move",500,(function(context){var shapes=context.shapes,newHost=context.newHost;shapes.forEach((function(shape,index){var item,host=shape.host;shouldReplace(shape,(item=host,-1!==shapes.indexOf(item)?host:newHost))&&(shapes[index]=self.replaceShape(shape))}))}),!0)}function shouldReplace(shape,host){return!(0,_LabelUtil.isLabel)(shape)&&(0,_ModelUtil.is)(shape,"bpmn:BoundaryEvent")&&!host}DetachEventBehavior.$inject=["bpmnReplace","injector"],(0,_inherits.default)(DetachEventBehavior,_CommandInterceptor.default),DetachEventBehavior.prototype.replaceShape=function(shape){var intermediateEvent,element,eventDefinitions,eventDefinition=(element=shape,(eventDefinitions=(0,_ModelUtil.getBusinessObject)(element).eventDefinitions)&&eventDefinitions[0]);return intermediateEvent=eventDefinition?{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:eventDefinition.$type}:{type:"bpmn:IntermediateThrowEvent"},this._bpmnReplace.replaceElement(shape,intermediateEvent,{layoutConnection:!1})}},{"../../../util/LabelUtil":90,"../../../util/ModelUtil":91,"diagram-js/lib/command/CommandInterceptor":96,inherits:218}],35:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=DropOnFlowBehavior;var _inherits=_interopRequireDefault(require("inherits")),_minDash=require("min-dash"),_LayoutUtil=require("diagram-js/lib/layout/LayoutUtil"),_CommandInterceptor=_interopRequireDefault(require("diagram-js/lib/command/CommandInterceptor")),_LineIntersection=require("diagram-js/lib/util/LineIntersection");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function DropOnFlowBehavior(eventBus,bpmnRules,modeling){function insertShape(shape,targetFlow,positionOrBounds){var waypointsBefore,waypointsAfter,dockingPoint,source,target,incomingConnection,outgoingConnection,mid,waypoints=targetFlow.waypoints,oldOutgoing=shape.outgoing.slice(),oldIncoming=shape.incoming.slice();mid=(0,_minDash.isNumber)(positionOrBounds.width)?(0,_LayoutUtil.getMid)(positionOrBounds):positionOrBounds;var intersection=(0,_LineIntersection.getApproxIntersection)(waypoints,mid);if(intersection){if(waypointsBefore=waypoints.slice(0,intersection.index),waypointsAfter=waypoints.slice(intersection.index+(intersection.bendpoint?1:0)),!waypointsBefore.length||!waypointsAfter.length)return;dockingPoint=intersection.bendpoint?waypoints[intersection.index]:mid,1!==waypointsBefore.length&&isPointInsideBBox(shape,waypointsBefore[waypointsBefore.length-1])||waypointsBefore.push(copy(dockingPoint)),1!==waypointsAfter.length&&isPointInsideBBox(shape,waypointsAfter[0])||waypointsAfter.unshift(copy(dockingPoint))}source=targetFlow.source,target=targetFlow.target,bpmnRules.canConnect(source,shape,targetFlow)&&(modeling.reconnectEnd(targetFlow,shape,waypointsBefore||mid),incomingConnection=targetFlow),bpmnRules.canConnect(shape,target,targetFlow)&&(incomingConnection?outgoingConnection=modeling.connect(shape,target,{type:targetFlow.type,waypoints:waypointsAfter}):(modeling.reconnectStart(targetFlow,shape,waypointsAfter||mid),outgoingConnection=targetFlow));var duplicateConnections=[].concat(incomingConnection&&(0,_minDash.filter)(oldIncoming,(function(connection){return connection.source===incomingConnection.source}))||[],outgoingConnection&&(0,_minDash.filter)(oldOutgoing,(function(connection){return connection.target===outgoingConnection.target}))||[]);duplicateConnections.length&&modeling.removeElements(duplicateConnections)}_CommandInterceptor.default.call(this,eventBus),this.preExecute("elements.move",(function(context){var newParent=context.newParent,shapes=context.shapes,delta=context.delta,shape=shapes[0];if(shape&&newParent){newParent&&newParent.waypoints&&(context.newParent=newParent=newParent.parent);var shapeMid=(0,_LayoutUtil.getMid)(shape),newShapeMid={x:shapeMid.x+delta.x,y:shapeMid.y+delta.y},connection=(0,_minDash.find)(newParent.children,(function(element){return bpmnRules.canInsert(shapes,element)&&(0,_LineIntersection.getApproxIntersection)(element.waypoints,newShapeMid)}));connection&&(context.targetFlow=connection,context.position=newShapeMid)}}),!0),this.postExecuted("elements.move",(function(context){var shapes=context.shapes,targetFlow=context.targetFlow,position=context.position;targetFlow&&insertShape(shapes[0],targetFlow,position)}),!0),this.preExecute("shape.create",(function(context){var parent=context.parent,shape=context.shape;bpmnRules.canInsert(shape,parent)&&(context.targetFlow=parent,context.parent=parent.parent)}),!0),this.postExecuted("shape.create",(function(context){var shape=context.shape,targetFlow=context.targetFlow,positionOrBounds=context.position;targetFlow&&insertShape(shape,targetFlow,positionOrBounds)}),!0)}function isPointInsideBBox(bbox,point){var x=point.x,y=point.y;return x>=bbox.x&&x<=bbox.x+bbox.width&&y>=bbox.y&&y<=bbox.y+bbox.height}function copy(obj){return(0,_minDash.assign)({},obj)}(0,_inherits.default)(DropOnFlowBehavior,_CommandInterceptor.default),DropOnFlowBehavior.$inject=["eventBus","bpmnRules","modeling"]},{"diagram-js/lib/command/CommandInterceptor":96,"diagram-js/lib/layout/LayoutUtil":188,"diagram-js/lib/util/LineIntersection":207,inherits:218,"min-dash":219}],36:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=EventBasedGatewayBehavior;var _inherits=_interopRequireDefault(require("inherits")),_CommandInterceptor=_interopRequireDefault(require("diagram-js/lib/command/CommandInterceptor")),_ModelUtil=require("../../../util/ModelUtil");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function EventBasedGatewayBehavior(eventBus,modeling){_CommandInterceptor.default.call(this,eventBus),this.preExecuted("connection.create",(function(event){var context=event.context,source=context.source,target=context.target,existingIncomingConnections=target.incoming.slice();context.hints&&!1===context.hints.createElementsBehavior||(0,_ModelUtil.is)(source,"bpmn:EventBasedGateway")&&target.incoming.length&&existingIncomingConnections.filter(isSequenceFlow).forEach((function(sequenceFlow){modeling.removeConnection(sequenceFlow)}))})),this.preExecuted("shape.replace",(function(event){var newShape=event.context.newShape;(0,_ModelUtil.is)(newShape,"bpmn:EventBasedGateway")&&newShape.outgoing.filter(isSequenceFlow).map((function(sequenceFlow){return sequenceFlow.target})).reduce((function(sequenceFlows,target){var incomingSequenceFlows=target.incoming.filter(isSequenceFlow);return sequenceFlows.concat(incomingSequenceFlows)}),[]).forEach((function(sequenceFlow){sequenceFlow.source!==newShape&&modeling.removeConnection(sequenceFlow)}))}))}function isSequenceFlow(connection){return(0,_ModelUtil.is)(connection,"bpmn:SequenceFlow")}EventBasedGatewayBehavior.$inject=["eventBus","modeling"],(0,_inherits.default)(EventBasedGatewayBehavior,_CommandInterceptor.default)},{"../../../util/ModelUtil":91,"diagram-js/lib/command/CommandInterceptor":96,inherits:218}],37:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=FixHoverBehavior;var _LaneUtil=require("../util/LaneUtil"),_ModelUtil=require("../../../util/ModelUtil"),_ModelingUtil=require("../util/ModelingUtil");function FixHoverBehavior(elementRegistry,eventBus,canvas){eventBus.on(["create.hover","create.move","create.out","create.end","shape.move.hover","shape.move.move","shape.move.out","shape.move.end"],1500,(function(event){var shape=event.context.shape||event.shape,hover=event.hover;(0,_ModelUtil.is)(hover,"bpmn:Lane")&&!(0,_ModelingUtil.isAny)(shape,["bpmn:Lane","bpmn:Participant"])&&(event.hover=(0,_LaneUtil.getLanesRoot)(hover),event.hoverGfx=elementRegistry.getGraphics(event.hover));var rootElement=canvas.getRootElement();hover!==rootElement&&(shape.labelTarget||(0,_ModelUtil.is)(shape,"bpmn:Group"))&&(event.hover=rootElement,event.hoverGfx=elementRegistry.getGraphics(event.hover))})),eventBus.on(["connect.hover","connect.out","connect.end","connect.cleanup","global-connect.hover","global-connect.out","global-connect.end","global-connect.cleanup"],1500,(function(event){var hover=event.hover;(0,_ModelUtil.is)(hover,"bpmn:Lane")&&(event.hover=(0,_LaneUtil.getLanesRoot)(hover)||hover,event.hoverGfx=elementRegistry.getGraphics(event.hover))})),eventBus.on(["bendpoint.move.hover"],1500,(function(event){var context=event.context,hover=event.hover,type=context.type;(0,_ModelUtil.is)(hover,"bpmn:Lane")&&/reconnect/.test(type)&&(event.hover=(0,_LaneUtil.getLanesRoot)(hover)||hover,event.hoverGfx=elementRegistry.getGraphics(event.hover))})),eventBus.on(["connect.start"],1500,(function(event){var context=event.context,start=context.start;(0,_ModelUtil.is)(start,"bpmn:Lane")&&(context.start=(0,_LaneUtil.getLanesRoot)(start)||start)})),eventBus.on("shape.move.start",2e3,(function(event){var shape=event.shape;(0,_ModelUtil.is)(shape,"bpmn:Lane")&&(event.shape=(0,_LaneUtil.getLanesRoot)(shape)||shape)}))}FixHoverBehavior.$inject=["elementRegistry","eventBus","canvas"]},{"../../../util/ModelUtil":91,"../util/LaneUtil":74,"../util/ModelingUtil":75}],38:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=GroupBehavior;var _inherits=_interopRequireDefault(require("inherits")),_CommandInterceptor=_interopRequireDefault(require("diagram-js/lib/command/CommandInterceptor")),_Collections=require("diagram-js/lib/util/Collections"),_ModelUtil=require("../../../util/ModelUtil"),_CategoryUtil=require("./util/CategoryUtil");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function GroupBehavior(bpmnFactory,canvas,elementRegistry,eventBus,injector,moddleCopy){function getDefinitions(){var rootElement=canvas.getRootElement();return(0,_ModelUtil.getBusinessObject)(rootElement).$parent}function removeReferencedCategoryValue(shape){var categoryValue=(0,_ModelUtil.getBusinessObject)(shape).categoryValueRef;if(categoryValue){var category=categoryValue.$parent;categoryValue&&((0,_Collections.remove)(category.categoryValue,categoryValue),category&&!category.categoryValue.length&&function(category){var definitions=getDefinitions();(0,_Collections.remove)(definitions.get("rootElements"),category)}(category))}}injector.invoke(_CommandInterceptor.default,this),this.executed("shape.delete",(function(event){var categoryValue,shape=event.context.shape;if((0,_ModelUtil.is)(shape,"bpmn:Group")){var categoryValueRef=(0,_ModelUtil.getBusinessObject)(shape).categoryValueRef,groupElements=elementRegistry.filter((function(e){return(0,_ModelUtil.is)(e,"bpmn:Group")}));categoryValue=categoryValueRef,groupElements.some((function(e){var businessObject=(0,_ModelUtil.getBusinessObject)(e);return businessObject.categoryValueRef&&businessObject.categoryValueRef===categoryValue}))||removeReferencedCategoryValue(shape)}})),this.reverted("shape.delete",(function(event){var shape=event.context.shape;if((0,_ModelUtil.is)(shape,"bpmn:Group")){var categoryValueRef=(0,_ModelUtil.getBusinessObject)(shape).categoryValueRef,definitions=getDefinitions(),category=categoryValueRef?categoryValueRef.$parent:null;(0,_Collections.add)(category.get("categoryValue"),categoryValueRef),(0,_Collections.add)(definitions.get("rootElements"),category)}})),this.execute("shape.create",(function(event){var shape=event.context.shape,businessObject=(0,_ModelUtil.getBusinessObject)(shape);if((0,_ModelUtil.is)(businessObject,"bpmn:Group")&&!businessObject.categoryValueRef){var definitions=getDefinitions(),categoryValue=(0,_CategoryUtil.createCategoryValue)(definitions,bpmnFactory);businessObject.categoryValueRef=categoryValue}})),this.revert("shape.create",(function(event){var shape=event.context.shape;(0,_ModelUtil.is)(shape,"bpmn:Group")&&(removeReferencedCategoryValue(shape),delete(0,_ModelUtil.getBusinessObject)(shape).categoryValueRef)})),eventBus.on("moddleCopy.canCopyProperty",2e3,(function(context){var categoryValue,property=context.property;if((0,_ModelUtil.is)(property,"bpmn:CategoryValue"))return categoryValue=(0,_CategoryUtil.createCategoryValue)(getDefinitions(),bpmnFactory),moddleCopy.copyElement(property,categoryValue)}))}GroupBehavior.$inject=["bpmnFactory","canvas","elementRegistry","eventBus","injector","moddleCopy"],(0,_inherits.default)(GroupBehavior,_CommandInterceptor.default)},{"../../../util/ModelUtil":91,"./util/CategoryUtil":58,"diagram-js/lib/command/CommandInterceptor":96,"diagram-js/lib/util/Collections":200,inherits:218}],39:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ImportDockingFix;var obj,_LayoutUtil=require("diagram-js/lib/layout/LayoutUtil"),_LineIntersect=(obj=require("./util/LineIntersect"))&&obj.__esModule?obj:{default:obj};function ImportDockingFix(eventBus){function adjustDocking(startPoint,nextPoint,elementMid){var centerIntersect,elementTop={x:elementMid.x,y:elementMid.y-50},elementLeft={x:elementMid.x-50,y:elementMid.y},verticalIntersect=(0,_LineIntersect.default)(startPoint,nextPoint,elementMid,elementTop),horizontalIntersect=(0,_LineIntersect.default)(startPoint,nextPoint,elementMid,elementLeft);centerIntersect=verticalIntersect&&horizontalIntersect?getDistance(verticalIntersect,elementMid)>getDistance(horizontalIntersect,elementMid)?horizontalIntersect:verticalIntersect:verticalIntersect||horizontalIntersect,startPoint.original=centerIntersect}eventBus.on("bpmnElement.added",(function(e){var connection,waypoints,element=e.element;element.waypoints&&(adjustDocking((waypoints=(connection=element).waypoints)[0],waypoints[1],(0,_LayoutUtil.getMid)(connection.source)),adjustDocking(waypoints[waypoints.length-1],waypoints[waypoints.length-2],(0,_LayoutUtil.getMid)(connection.target)))}))}function getDistance(p1,p2){return Math.sqrt(Math.pow(p1.x-p2.x,2)+Math.pow(p1.y-p2.y,2))}ImportDockingFix.$inject=["eventBus"]},{"./util/LineIntersect":62,"diagram-js/lib/layout/LayoutUtil":188}],40:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=IsHorizontalFix;var _inherits=_interopRequireDefault(require("inherits")),_CommandInterceptor=_interopRequireDefault(require("diagram-js/lib/command/CommandInterceptor")),_ModelUtil=require("../../../util/ModelUtil"),_ModelingUtil=require("../util/ModelingUtil");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function IsHorizontalFix(eventBus){_CommandInterceptor.default.call(this,eventBus);var elementTypesToUpdate=["bpmn:Participant","bpmn:Lane"];this.executed(["shape.move","shape.create","shape.resize"],(function(event){var bo=(0,_ModelUtil.getBusinessObject)(event.context.shape);(0,_ModelingUtil.isAny)(bo,elementTypesToUpdate)&&!bo.di.get("isHorizontal")&&bo.di.set("isHorizontal",!0)}))}IsHorizontalFix.$inject=["eventBus"],(0,_inherits.default)(IsHorizontalFix,_CommandInterceptor.default)},{"../../../util/ModelUtil":91,"../util/ModelingUtil":75,"diagram-js/lib/command/CommandInterceptor":96,inherits:218}],41:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=LabelBehavior,exports.getReferencePointDelta=getReferencePointDelta,exports.getReferencePoint=getReferencePoint,exports.asEdges=asEdges;var _minDash=require("min-dash"),_inherits=_interopRequireDefault(require("inherits")),_ModelUtil=require("../../../util/ModelUtil"),_LabelUtil=require("../../../util/LabelUtil"),_LabelUtil2=require("../../label-editing/LabelUtil"),_LabelLayoutUtil=require("./util/LabelLayoutUtil"),_CommandInterceptor=_interopRequireDefault(require("diagram-js/lib/command/CommandInterceptor")),_AttachUtil=require("diagram-js/lib/util/AttachUtil"),_LayoutUtil=require("diagram-js/lib/layout/LayoutUtil"),_PositionUtil=require("diagram-js/lib/util/PositionUtil"),_GeometricUtil=require("./util/GeometricUtil");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var DEFAULT_LABEL_DIMENSIONS={width:90,height:20};function LabelBehavior(eventBus,modeling,bpmnFactory,textRenderer){_CommandInterceptor.default.call(this,eventBus),this.postExecute("element.updateProperties",(function(e){var context=e.context,element=context.element,properties=context.properties;if("name"in properties&&modeling.updateLabel(element,properties.name),"text"in properties&&(0,_ModelUtil.is)(element,"bpmn:TextAnnotation")){var newBounds=textRenderer.getTextAnnotationBounds({x:element.x,y:element.y,width:element.width,height:element.height},properties.text||"");modeling.updateLabel(element,properties.text,newBounds)}})),this.postExecute(["shape.create","connection.create"],(function(e){var context=e.context;if(!1!==(context.hints||{}).createElementsBehavior){var element=context.shape||context.connection,businessObject=element.businessObject;if(!(0,_LabelUtil.isLabel)(element)&&(0,_LabelUtil.isLabelExternal)(element)&&(0,_LabelUtil2.getLabel)(element)){var labelCenter=(0,_LabelUtil.getExternalLabelMid)(element),labelDimensions=textRenderer.getExternalLabelBounds(DEFAULT_LABEL_DIMENSIONS,(0,_LabelUtil2.getLabel)(element));modeling.createLabel(element,labelCenter,{id:businessObject.id+"_label",businessObject,width:labelDimensions.width,height:labelDimensions.height})}}})),this.postExecute("shape.delete",(function(event){var context=event.context,labelTarget=context.labelTarget,hints=context.hints||{};labelTarget&&!1!==hints.unsetLabel&&modeling.updateLabel(labelTarget,null,null,{removeShape:!1})})),this.postExecute(["label.create"],(function(event){var di,element=event.context.shape;element.labelTarget&&(0,_ModelUtil.is)(element.labelTarget||element,"bpmn:BaseElement")&&((di=element.businessObject.di).label||(di.label=bpmnFactory.create("bpmndi:BPMNLabel",{bounds:bpmnFactory.create("dc:Bounds")})),(0,_minDash.assign)(di.label.bounds,{x:element.x,y:element.y,width:element.width,height:element.height}))})),this.postExecute(["connection.layout","connection.updateWaypoints"],(function(event){var context=event.context;if(!1!==(context.hints||{}).labelBehavior){var labelAdjustment,label=context.connection.label;label&&label.parent&&(labelAdjustment=function(event){var context=event.context,connection=context.connection,label=connection.label,hints=(0,_minDash.assign)({},context.hints),newWaypoints=context.newWaypoints||connection.waypoints,oldWaypoints=context.oldWaypoints;return void 0===hints.startChanged&&(hints.startChanged=!!hints.connectionStart),void 0===hints.endChanged&&(hints.endChanged=!!hints.connectionEnd),(0,_LabelLayoutUtil.getLabelAdjustment)(label,newWaypoints,oldWaypoints,hints)}(event),modeling.moveShape(label,labelAdjustment))}})),this.postExecute(["shape.replace"],(function(event){var context=event.context,newShape=context.newShape,oldShape=context.oldShape,businessObject=(0,_ModelUtil.getBusinessObject)(newShape);businessObject&&(0,_LabelUtil.isLabelExternal)(businessObject)&&oldShape.label&&newShape.label&&(newShape.label.x=oldShape.label.x,newShape.label.y=oldShape.label.y)})),this.postExecute("shape.resize",(function(event){var context=event.context,shape=context.shape,newBounds=context.newBounds,oldBounds=context.oldBounds;if((0,_LabelUtil.hasExternalLabel)(shape)){var label=shape.label,delta=getReferencePointDelta(getReferencePoint((0,_LayoutUtil.getMid)(label),asEdges(oldBounds)),oldBounds,newBounds);modeling.moveShape(label,delta)}}))}function getReferencePointDelta(referencePoint,oldBounds,newBounds){var newReferencePoint=(0,_AttachUtil.getNewAttachPoint)(referencePoint,oldBounds,newBounds);return(0,_LayoutUtil.roundPoint)((0,_PositionUtil.delta)(newReferencePoint,referencePoint))}function getReferencePoint(point,lines){if(lines.length){var nearestLine=function(point,lines){var distances=lines.map((function(l){return{line:l,distance:(0,_GeometricUtil.getDistancePointLine)(point,l)}}));return(0,_minDash.sortBy)(distances,"distance")[0].line}(point,lines);return(0,_GeometricUtil.perpendicularFoot)(point,nearestLine)}}function asEdges(bounds){return[[{x:bounds.x,y:bounds.y},{x:bounds.x+(bounds.width||0),y:bounds.y}],[{x:bounds.x+(bounds.width||0),y:bounds.y},{x:bounds.x+(bounds.width||0),y:bounds.y+(bounds.height||0)}],[{x:bounds.x,y:bounds.y+(bounds.height||0)},{x:bounds.x+(bounds.width||0),y:bounds.y+(bounds.height||0)}],[{x:bounds.x,y:bounds.y},{x:bounds.x,y:bounds.y+(bounds.height||0)}]]}(0,_inherits.default)(LabelBehavior,_CommandInterceptor.default),LabelBehavior.$inject=["eventBus","modeling","bpmnFactory","textRenderer"]},{"../../../util/LabelUtil":90,"../../../util/ModelUtil":91,"../../label-editing/LabelUtil":16,"./util/GeometricUtil":59,"./util/LabelLayoutUtil":60,"diagram-js/lib/command/CommandInterceptor":96,"diagram-js/lib/layout/LayoutUtil":188,"diagram-js/lib/util/AttachUtil":198,"diagram-js/lib/util/PositionUtil":211,inherits:218,"min-dash":219}],42:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=MessageFlowBehavior;var _inherits=_interopRequireDefault(require("inherits")),_CommandInterceptor=_interopRequireDefault(require("diagram-js/lib/command/CommandInterceptor")),_ModelUtil=require("../../../util/ModelUtil"),_DiUtil=require("../../../util/DiUtil"),_Elements=require("diagram-js/lib/util/Elements"),_AnchorsHelper=require("diagram-js/lib/features/modeling/cmd/helper/AnchorsHelper");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function MessageFlowBehavior(eventBus,modeling){_CommandInterceptor.default.call(this,eventBus),this.postExecute("shape.replace",(function(context){var oldShape=context.oldShape,newShape=context.newShape;if(function(oldShape,newShape){return(0,_ModelUtil.is)(oldShape,"bpmn:Participant")&&(0,_DiUtil.isExpanded)(oldShape)&&(0,_ModelUtil.is)(newShape,"bpmn:Participant")&&!(0,_DiUtil.isExpanded)(newShape)}(oldShape,newShape)){var parent,elements,incoming,outgoing,messageFlows=(parent=oldShape,elements=(0,_Elements.selfAndAllChildren)([parent],!1),incoming=[],outgoing=[],elements.forEach((function(element){element!==parent&&(element.incoming.forEach((function(connection){(0,_ModelUtil.is)(connection,"bpmn:MessageFlow")&&incoming.push(connection)})),element.outgoing.forEach((function(connection){(0,_ModelUtil.is)(connection,"bpmn:MessageFlow")&&outgoing.push(connection)})))}),[]),{incoming,outgoing});messageFlows.incoming.forEach((function(incoming){var anchor=(0,_AnchorsHelper.getResizedTargetAnchor)(incoming,newShape,oldShape);modeling.reconnectEnd(incoming,newShape,anchor)})),messageFlows.outgoing.forEach((function(outgoing){var anchor=(0,_AnchorsHelper.getResizedSourceAnchor)(outgoing,newShape,oldShape);modeling.reconnectStart(outgoing,newShape,anchor)}))}}),!0)}MessageFlowBehavior.$inject=["eventBus","modeling"],(0,_inherits.default)(MessageFlowBehavior,_CommandInterceptor.default)},{"../../../util/DiUtil":89,"../../../util/ModelUtil":91,"diagram-js/lib/command/CommandInterceptor":96,"diagram-js/lib/features/modeling/cmd/helper/AnchorsHelper":154,"diagram-js/lib/util/Elements":202,inherits:218}],43:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ModelingFeedback;var _ModelUtil=require("../../../util/ModelUtil");function ModelingFeedback(eventBus,tooltips,translate){eventBus.on(["shape.move.rejected","create.rejected"],(function(event){var position,message,timeout,context=event.context,shape=context.shape,target=context.target;(0,_ModelUtil.is)(target,"bpmn:Collaboration")&&(0,_ModelUtil.is)(shape,"bpmn:FlowNode")&&(position=event,message=translate("flow elements must be children of pools/participants"),tooltips.add({position:{x:position.x+5,y:position.y+5},type:"error",timeout:timeout||2e3,html:"<div>"+message+"</div>"}))}))}ModelingFeedback.$inject=["eventBus","tooltips","translate"]},{"../../../util/ModelUtil":91}],44:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=RemoveElementBehavior;var _inherits=_interopRequireDefault(require("inherits")),_ModelUtil=require("../../../util/ModelUtil"),_CommandInterceptor=_interopRequireDefault(require("diagram-js/lib/command/CommandInterceptor")),_LineIntersect=_interopRequireDefault(require("./util/LineIntersect"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function RemoveElementBehavior(eventBus,bpmnRules,modeling){_CommandInterceptor.default.call(this,eventBus),this.preExecute("shape.delete",(function(e){var shape=e.context.shape;if(1===shape.incoming.length&&1===shape.outgoing.length){var inWaypoints,outWaypoints,intersection,inConnection=shape.incoming[0],outConnection=shape.outgoing[0];if((0,_ModelUtil.is)(inConnection,"bpmn:SequenceFlow")&&(0,_ModelUtil.is)(outConnection,"bpmn:SequenceFlow"))if(bpmnRules.canConnect(inConnection.source,outConnection.target,inConnection)){var newWaypoints=(inWaypoints=inConnection.waypoints,outWaypoints=outConnection.waypoints,(intersection=(0,_LineIntersect.default)(getDocking(inWaypoints[inWaypoints.length-2]),getDocking(inWaypoints[inWaypoints.length-1]),getDocking(outWaypoints[1]),getDocking(outWaypoints[0])))?[].concat(inWaypoints.slice(0,inWaypoints.length-1),[intersection],outWaypoints.slice(1)):[getDocking(inWaypoints[0]),getDocking(outWaypoints[outWaypoints.length-1])]);modeling.reconnectEnd(inConnection,outConnection.target,newWaypoints)}}}))}function getDocking(point){return point.original||point}(0,_inherits.default)(RemoveElementBehavior,_CommandInterceptor.default),RemoveElementBehavior.$inject=["eventBus","bpmnRules","modeling"]},{"../../../util/ModelUtil":91,"./util/LineIntersect":62,"diagram-js/lib/command/CommandInterceptor":96,inherits:218}],45:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=RemoveParticipantBehavior;var _inherits=_interopRequireDefault(require("inherits")),_CommandInterceptor=_interopRequireDefault(require("diagram-js/lib/command/CommandInterceptor")),_ModelUtil=require("../../../util/ModelUtil");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function RemoveParticipantBehavior(eventBus,modeling){_CommandInterceptor.default.call(this,eventBus),this.preExecute("shape.delete",(function(context){var shape=context.shape,parent=shape.parent;(0,_ModelUtil.is)(shape,"bpmn:Participant")&&(context.collaborationRoot=parent)}),!0),this.postExecute("shape.delete",(function(context){var collaborationRoot=context.collaborationRoot;collaborationRoot&&!collaborationRoot.businessObject.participants.length&&modeling.makeProcess()}),!0)}RemoveParticipantBehavior.$inject=["eventBus","modeling"],(0,_inherits.default)(RemoveParticipantBehavior,_CommandInterceptor.default)},{"../../../util/ModelUtil":91,"diagram-js/lib/command/CommandInterceptor":96,inherits:218}],46:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ReplaceConnectionBehavior;var _minDash=require("min-dash"),_inherits=_interopRequireDefault(require("inherits")),_CommandInterceptor=_interopRequireDefault(require("diagram-js/lib/command/CommandInterceptor")),_ModelUtil=require("../../../util/ModelUtil");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ReplaceConnectionBehavior(eventBus,modeling,bpmnRules,injector){_CommandInterceptor.default.call(this,eventBus);var dragging=injector.get("dragging",!1);function fixConnection(connection){var replacementType,remove,source=connection.source,target=connection.target;connection.parent&&((0,_ModelUtil.is)(connection,"bpmn:SequenceFlow")&&(bpmnRules.canConnectSequenceFlow(source,target)||(remove=!0),bpmnRules.canConnectMessageFlow(source,target)&&(replacementType="bpmn:MessageFlow")),(0,_ModelUtil.is)(connection,"bpmn:MessageFlow")&&(bpmnRules.canConnectMessageFlow(source,target)||(remove=!0),bpmnRules.canConnectSequenceFlow(source,target)&&(replacementType="bpmn:SequenceFlow")),(0,_ModelUtil.is)(connection,"bpmn:Association")&&!bpmnRules.canConnectAssociation(source,target)&&(remove=!0),remove&&modeling.removeConnection(connection),replacementType&&modeling.connect(source,target,{type:replacementType,waypoints:connection.waypoints.slice()}))}this.postExecuted("elements.move",(function(context){var allConnections=context.closure.allConnections;(0,_minDash.forEach)(allConnections,fixConnection)}),!0),this.preExecute("connection.reconnect",(function(event){var allowed,replacement,context=event.context,connection=context.connection,source=context.newSource||connection.source,target=context.newTarget||connection.target;(allowed=bpmnRules.canConnect(source,target))&&allowed.type!==connection.type&&(replacement=modeling.connect(source,target,{type:allowed.type,waypoints:connection.waypoints.slice()}),modeling.removeConnection(connection),context.connection=replacement,dragging&&function(oldConnection,newConnection){var index,context=dragging.context(),previousSelection=context&&context.payload.previousSelection;if(!previousSelection||!previousSelection.length)return;if(-1===(index=previousSelection.indexOf(oldConnection)))return;previousSelection.splice(index,1,newConnection)}(connection,replacement))})),this.postExecuted("element.updateProperties",(function(event){var connection,context=event.context,properties=context.properties,element=context.element,businessObject=element.businessObject;properties.default&&(connection=(0,_minDash.find)(element.outgoing,(0,_minDash.matchPattern)({id:element.businessObject.default.id})))&&modeling.updateProperties(connection,{conditionExpression:void 0}),properties.conditionExpression&&businessObject.sourceRef.default===businessObject&&modeling.updateProperties(element.source,{default:void 0})}))}(0,_inherits.default)(ReplaceConnectionBehavior,_CommandInterceptor.default),ReplaceConnectionBehavior.$inject=["eventBus","modeling","bpmnRules","injector"]},{"../../../util/ModelUtil":91,"diagram-js/lib/command/CommandInterceptor":96,inherits:218,"min-dash":219}],47:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ReplaceElementBehaviour;var _inherits=_interopRequireDefault(require("inherits")),_minDash=require("min-dash"),_CommandInterceptor=_interopRequireDefault(require("diagram-js/lib/command/CommandInterceptor")),_DiUtil=require("../../../util/DiUtil");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ReplaceElementBehaviour(bpmnReplace,bpmnRules,elementRegistry,injector,modeling,selection){injector.invoke(_CommandInterceptor.default,this),this._bpmnReplace=bpmnReplace,this._elementRegistry=elementRegistry,this._selection=selection,this.postExecuted(["elements.create"],500,(function(event){var context=event.context,target=context.parent,elements=context.elements,canReplace=bpmnRules.canReplace(elements,target);canReplace&&this.replaceElements(elements,canReplace.replacements)}),this),this.postExecuted(["elements.move"],500,(function(event){var context=event.context,target=context.newParent,newHost=context.newHost,elements=[];(0,_minDash.forEach)(context.closure.topLevel,(function(topLevelElements){elements=(0,_DiUtil.isEventSubProcess)(topLevelElements)?elements.concat(topLevelElements.children):elements.concat(topLevelElements)})),1===elements.length&&newHost&&(target=newHost);var canReplace=bpmnRules.canReplace(elements,target);canReplace&&this.replaceElements(elements,canReplace.replacements,newHost)}),this),this.postExecute(["shape.replace"],1500,(function(e){var canReplace,context=e.context,oldShape=context.oldShape,newShape=context.newShape,attachers=oldShape.attachers;attachers&&attachers.length&&(canReplace=bpmnRules.canReplace(attachers,newShape),this.replaceElements(attachers,canReplace.replacements))}),this),this.postExecuted(["shape.replace"],1500,(function(e){var context=e.context,oldShape=context.oldShape,newShape=context.newShape;modeling.unclaimId(oldShape.businessObject.id,oldShape.businessObject),modeling.updateProperties(newShape,{id:oldShape.id})}))}(0,_inherits.default)(ReplaceElementBehaviour,_CommandInterceptor.default),ReplaceElementBehaviour.prototype.replaceElements=function(elements,newElements){var elementRegistry=this._elementRegistry,bpmnReplace=this._bpmnReplace,selection=this._selection;(0,_minDash.forEach)(newElements,(function(replacement){var newElement={type:replacement.newElementType},oldElement=elementRegistry.get(replacement.oldElementId),idx=elements.indexOf(oldElement);elements[idx]=bpmnReplace.replaceElement(oldElement,newElement,{select:!1})})),newElements&&selection.select(elements)},ReplaceElementBehaviour.$inject=["bpmnReplace","bpmnRules","elementRegistry","injector","modeling","selection"]},{"../../../util/DiUtil":89,"diagram-js/lib/command/CommandInterceptor":96,inherits:218,"min-dash":219}],48:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ResizeBehavior,exports.getParticipantResizeConstraints=getParticipantResizeConstraints,exports.TEXT_ANNOTATION_MIN_DIMENSIONS=exports.SUB_PROCESS_MIN_DIMENSIONS=exports.PARTICIPANT_MIN_DIMENSIONS=exports.LANE_MIN_DIMENSIONS=void 0;var _ModelUtil=require("../../../util/ModelUtil"),_DiUtil=require("../../../util/DiUtil"),_LayoutUtil=require("diagram-js/lib/layout/LayoutUtil"),_LaneUtil=require("../util/LaneUtil"),LANE_MIN_DIMENSIONS={width:300,height:60};exports.LANE_MIN_DIMENSIONS=LANE_MIN_DIMENSIONS;var PARTICIPANT_MIN_DIMENSIONS={width:300,height:150};exports.PARTICIPANT_MIN_DIMENSIONS=PARTICIPANT_MIN_DIMENSIONS;var SUB_PROCESS_MIN_DIMENSIONS={width:140,height:120};exports.SUB_PROCESS_MIN_DIMENSIONS=SUB_PROCESS_MIN_DIMENSIONS;var TEXT_ANNOTATION_MIN_DIMENSIONS={width:50,height:30};function ResizeBehavior(eventBus){eventBus.on("resize.start",1500,(function(event){var context=event.context,shape=context.shape,direction=context.direction,balanced=context.balanced;((0,_ModelUtil.is)(shape,"bpmn:Lane")||(0,_ModelUtil.is)(shape,"bpmn:Participant"))&&(context.resizeConstraints=getParticipantResizeConstraints(shape,direction,balanced)),(0,_ModelUtil.is)(shape,"bpmn:Participant")&&(context.minDimensions=PARTICIPANT_MIN_DIMENSIONS),(0,_ModelUtil.is)(shape,"bpmn:SubProcess")&&(0,_DiUtil.isExpanded)(shape)&&(context.minDimensions=SUB_PROCESS_MIN_DIMENSIONS),(0,_ModelUtil.is)(shape,"bpmn:TextAnnotation")&&(context.minDimensions=TEXT_ANNOTATION_MIN_DIMENSIONS)}))}exports.TEXT_ANNOTATION_MIN_DIMENSIONS=TEXT_ANNOTATION_MIN_DIMENSIONS,ResizeBehavior.$inject=["eventBus"];var abs=Math.abs,min=Math.min,max=Math.max;function addToTrbl(trbl,attr,value,choice){var current=trbl[attr];trbl[attr]=void 0===current?value:choice(value,current)}function addMin(trbl,attr,value){return addToTrbl(trbl,attr,value,min)}function addMax(trbl,attr,value){return addToTrbl(trbl,attr,value,max)}function getParticipantResizeConstraints(laneShape,resizeDirection,balanced){var lanesRoot=(0,_LaneUtil.getLanesRoot)(laneShape),isFirst=!0,isLast=!0,allLanes=(0,_LaneUtil.collectLanes)(lanesRoot,[lanesRoot]),laneTrbl=(0,_LayoutUtil.asTRBL)(laneShape),maxTrbl={},minTrbl={};return/e/.test(resizeDirection)?minTrbl.right=laneTrbl.left+LANE_MIN_DIMENSIONS.width:/w/.test(resizeDirection)&&(minTrbl.left=laneTrbl.right-LANE_MIN_DIMENSIONS.width),allLanes.forEach((function(other){var otherTrbl=(0,_LayoutUtil.asTRBL)(other);/n/.test(resizeDirection)&&(otherTrbl.top<laneTrbl.top-10&&(isFirst=!1),balanced&&abs(laneTrbl.top-otherTrbl.bottom)<10&&addMax(maxTrbl,"top",otherTrbl.top+LANE_MIN_DIMENSIONS.height),abs(laneTrbl.top-otherTrbl.top)<5&&addMin(minTrbl,"top",otherTrbl.bottom-LANE_MIN_DIMENSIONS.height)),/s/.test(resizeDirection)&&(otherTrbl.bottom>laneTrbl.bottom+10&&(isLast=!1),balanced&&abs(laneTrbl.bottom-otherTrbl.top)<10&&addMin(maxTrbl,"bottom",otherTrbl.bottom-LANE_MIN_DIMENSIONS.height),abs(laneTrbl.bottom-otherTrbl.bottom)<5&&addMax(minTrbl,"bottom",otherTrbl.top+LANE_MIN_DIMENSIONS.height))})),lanesRoot.children.filter((function(s){return!s.hidden&&!s.waypoints&&((0,_ModelUtil.is)(s,"bpmn:FlowElement")||(0,_ModelUtil.is)(s,"bpmn:Artifact"))})).forEach((function(flowElement){var flowElementTrbl=(0,_LayoutUtil.asTRBL)(flowElement);isFirst&&/n/.test(resizeDirection)&&addMin(minTrbl,"top",flowElementTrbl.top-20),/e/.test(resizeDirection)&&addMax(minTrbl,"right",flowElementTrbl.right+20),isLast&&/s/.test(resizeDirection)&&addMax(minTrbl,"bottom",flowElementTrbl.bottom+20),/w/.test(resizeDirection)&&addMin(minTrbl,"left",flowElementTrbl.left-50)})),{min:minTrbl,max:maxTrbl}}},{"../../../util/DiUtil":89,"../../../util/ModelUtil":91,"../util/LaneUtil":74,"diagram-js/lib/layout/LayoutUtil":188}],49:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ResizeLaneBehavior;var _ModelUtil=require("../../../util/ModelUtil"),_LayoutUtil=require("diagram-js/lib/layout/LayoutUtil"),_Mouse=require("diagram-js/lib/util/Mouse");function ResizeLaneBehavior(eventBus,modeling){eventBus.on("resize.start",1501,(function(event){var context=event.context,shape=context.shape;((0,_ModelUtil.is)(shape,"bpmn:Lane")||(0,_ModelUtil.is)(shape,"bpmn:Participant"))&&(context.balanced=!(0,_Mouse.hasPrimaryModifier)(event))})),eventBus.on("resize.end",1001,(function(event){var context=event.context,shape=context.shape,canExecute=context.canExecute,newBounds=context.newBounds;if((0,_ModelUtil.is)(shape,"bpmn:Lane")||(0,_ModelUtil.is)(shape,"bpmn:Participant"))return canExecute&&(newBounds=(0,_LayoutUtil.roundBounds)(newBounds),modeling.resizeLane(shape,newBounds,context.balanced)),!1}))}ResizeLaneBehavior.$inject=["eventBus","modeling"]},{"../../../util/ModelUtil":91,"diagram-js/lib/layout/LayoutUtil":188,"diagram-js/lib/util/Mouse":209}],50:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=RootElementReferenceBehavior;var _inherits=_interopRequireDefault(require("inherits")),_minDash=require("min-dash"),_CommandInterceptor=_interopRequireDefault(require("diagram-js/lib/command/CommandInterceptor")),_Collections=require("diagram-js/lib/util/Collections"),_ModelUtil=require("../../../util/ModelUtil"),_ModelingUtil=require("../util/ModelingUtil"),_DiUtil=require("../../../util/DiUtil");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function RootElementReferenceBehavior(bpmnjs,eventBus,injector,moddleCopy,bpmnFactory){function canHaveRootElementReference(element){return(0,_ModelingUtil.isAny)(element,["bpmn:ReceiveTask","bpmn:SendTask"])||function(element,types){(0,_minDash.isArray)(types)||(types=[types]);return(0,_minDash.some)(types,(function(type){return(0,_DiUtil.hasEventDefinition)(element,type)}))}(element,["bpmn:ErrorEventDefinition","bpmn:EscalationEventDefinition","bpmn:MessageEventDefinition","bpmn:SignalEventDefinition"])}function hasRootElement(rootElement){var rootElements=bpmnjs.getDefinitions().get("rootElements");return!!(0,_minDash.find)(rootElements,(0,_minDash.matchPattern)({id:rootElement.id}))}function getRootElementReferencePropertyName(eventDefinition){return(0,_ModelUtil.is)(eventDefinition,"bpmn:ErrorEventDefinition")?"errorRef":(0,_ModelUtil.is)(eventDefinition,"bpmn:EscalationEventDefinition")?"escalationRef":(0,_ModelUtil.is)(eventDefinition,"bpmn:MessageEventDefinition")?"messageRef":(0,_ModelUtil.is)(eventDefinition,"bpmn:SignalEventDefinition")?"signalRef":void 0}function getRootElement(businessObject){if((0,_ModelingUtil.isAny)(businessObject,["bpmn:ReceiveTask","bpmn:SendTask"]))return businessObject.get("messageRef");var eventDefinition=businessObject.get("eventDefinitions")[0];return eventDefinition.get(getRootElementReferencePropertyName(eventDefinition))}injector.invoke(_CommandInterceptor.default,this),this.executed("shape.create",(function(context){var shape=context.shape;if(canHaveRootElementReference(shape)){var rootElements,rootElement=getRootElement((0,_ModelUtil.getBusinessObject)(shape));rootElement&&!hasRootElement(rootElement)&&(rootElements=bpmnjs.getDefinitions().get("rootElements"),(0,_Collections.add)(rootElements,rootElement),context.addedRootElement=rootElement)}}),!0),this.reverted("shape.create",(function(context){var addedRootElement=context.addedRootElement;if(addedRootElement){var rootElements=bpmnjs.getDefinitions().get("rootElements");(0,_Collections.remove)(rootElements,addedRootElement)}}),!0),eventBus.on("copyPaste.copyElement",(function(context){var descriptor=context.descriptor,element=context.element;if(canHaveRootElementReference(element)){var rootElement=getRootElement((0,_ModelUtil.getBusinessObject)(element));rootElement&&(descriptor.referencedRootElement=rootElement)}})),eventBus.on("copyPaste.pasteElement",500,(function(context){var descriptor=context.descriptor,businessObject=descriptor.businessObject;if(canHaveRootElementReference(businessObject)){var referencedRootElement=descriptor.referencedRootElement;referencedRootElement&&(hasRootElement(referencedRootElement)||(referencedRootElement=moddleCopy.copyElement(referencedRootElement,bpmnFactory.create(referencedRootElement.$type))),function(businessObject,rootElement){if((0,_ModelingUtil.isAny)(businessObject,["bpmn:ReceiveTask","bpmn:SendTask"]))return businessObject.set("messageRef",rootElement);var eventDefinition=businessObject.get("eventDefinitions")[0];eventDefinition.set(getRootElementReferencePropertyName(eventDefinition),rootElement)}(businessObject,referencedRootElement))}}))}RootElementReferenceBehavior.$inject=["bpmnjs","eventBus","injector","moddleCopy","bpmnFactory"],(0,_inherits.default)(RootElementReferenceBehavior,_CommandInterceptor.default)},{"../../../util/DiUtil":89,"../../../util/ModelUtil":91,"../util/ModelingUtil":75,"diagram-js/lib/command/CommandInterceptor":96,"diagram-js/lib/util/Collections":200,inherits:218,"min-dash":219}],51:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=SpaceToolBehavior;var _minDash=require("min-dash"),_ModelUtil=require("../../../util/ModelUtil"),_DiUtil=require("../../../util/DiUtil"),_ResizeBehavior=require("./ResizeBehavior"),_LaneUtil=require("../util/LaneUtil"),max=Math.max;function SpaceToolBehavior(eventBus){eventBus.on("spaceTool.getMinDimensions",(function(context){var shapes=context.shapes,axis=context.axis,start=context.start,minDimensions={};return(0,_minDash.forEach)(shapes,(function(shape){var id=shape.id;(0,_ModelUtil.is)(shape,"bpmn:Participant")&&(!function(axis){return"x"===axis}(axis)?minDimensions[id]={width:_ResizeBehavior.PARTICIPANT_MIN_DIMENSIONS.width,height:getParticipantMinHeight(shape,start)}:minDimensions[id]=_ResizeBehavior.PARTICIPANT_MIN_DIMENSIONS),(0,_ModelUtil.is)(shape,"bpmn:SubProcess")&&(0,_DiUtil.isExpanded)(shape)&&(minDimensions[id]=_ResizeBehavior.SUB_PROCESS_MIN_DIMENSIONS),(0,_ModelUtil.is)(shape,"bpmn:TextAnnotation")&&(minDimensions[id]=_ResizeBehavior.TEXT_ANNOTATION_MIN_DIMENSIONS)})),minDimensions}))}function getParticipantMinHeight(participant,start){var lanesMinHeight,element;return element=participant,(0,_LaneUtil.getChildLanes)(element).length?(lanesMinHeight=function(participant,resizeStart){var resizedLane,lanes=(0,_LaneUtil.getChildLanes)(participant);return resizedLane=function findResizedLane(lanes,resizeStart){var i,lane,childLanes;for(i=0;i<lanes.length;i++)if(lane=lanes[i],resizeStart>=lane.y&&resizeStart<=lane.y+lane.height)return(childLanes=(0,_LaneUtil.getChildLanes)(lane)).length?findResizedLane(childLanes,resizeStart):lane}(lanes,resizeStart),participant.height-resizedLane.height+_ResizeBehavior.LANE_MIN_DIMENSIONS.height}(participant,start),max(_ResizeBehavior.PARTICIPANT_MIN_DIMENSIONS.height,lanesMinHeight)):_ResizeBehavior.PARTICIPANT_MIN_DIMENSIONS.height}SpaceToolBehavior.$inject=["eventBus"]},{"../../../util/DiUtil":89,"../../../util/ModelUtil":91,"../util/LaneUtil":74,"./ResizeBehavior":48,"min-dash":219}],52:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=SubProcessStartEventBehavior;var _inherits=_interopRequireDefault(require("inherits")),_CommandInterceptor=_interopRequireDefault(require("diagram-js/lib/command/CommandInterceptor")),_ModelUtil=require("../../../util/ModelUtil"),_DiUtil=require("../../../util/DiUtil.js");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function SubProcessStartEventBehavior(injector,modeling){injector.invoke(_CommandInterceptor.default,this),this.postExecuted("shape.replace",(function(event){var oldShape=event.context.oldShape,newShape=event.context.newShape;if((0,_ModelUtil.is)(newShape,"bpmn:SubProcess")&&(0,_ModelUtil.is)(oldShape,"bpmn:Task")&&(0,_DiUtil.isExpanded)(newShape)){var shape,position={x:(shape=newShape).x+shape.width/6,y:shape.y+shape.height/2};modeling.createShape({type:"bpmn:StartEvent"},position,newShape)}}))}SubProcessStartEventBehavior.$inject=["injector","modeling"],(0,_inherits.default)(SubProcessStartEventBehavior,_CommandInterceptor.default)},{"../../../util/DiUtil.js":89,"../../../util/ModelUtil":91,"diagram-js/lib/command/CommandInterceptor":96,inherits:218}],53:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ToggleElementCollapseBehaviour;var _inherits=_interopRequireDefault(require("inherits")),_CommandInterceptor=_interopRequireDefault(require("diagram-js/lib/command/CommandInterceptor")),_ModelUtil=require("../../../util/ModelUtil"),_ResizeUtil=require("diagram-js/lib/features/resize/ResizeUtil");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ToggleElementCollapseBehaviour(eventBus,elementFactory,modeling,resize){_CommandInterceptor.default.call(this,eventBus),this.executed(["shape.toggleCollapse"],500,(function(e){var children,shape=e.context.shape;(0,_ModelUtil.is)(shape,"bpmn:SubProcess")&&(shape.collapsed?(0,_ModelUtil.getBusinessObject)(shape).di.isExpanded=!1:((children=shape.children).length&&children.forEach((function(child){"label"!==child.type||child.businessObject.name||(child.hidden=!0)})),(0,_ModelUtil.getBusinessObject)(shape).di.isExpanded=!0))})),this.reverted(["shape.toggleCollapse"],500,(function(e){var shape=e.context.shape;shape.collapsed?(0,_ModelUtil.getBusinessObject)(shape).di.isExpanded=!1:(0,_ModelUtil.getBusinessObject)(shape).di.isExpanded=!0})),this.postExecuted(["shape.toggleCollapse"],500,(function(e){var newBounds,shape=e.context.shape,defaultSize=elementFactory._getDefaultSize(shape);newBounds=shape.collapsed?function(shape,defaultSize){return{x:shape.x+(shape.width-defaultSize.width)/2,y:shape.y+(shape.height-defaultSize.height)/2,width:defaultSize.width,height:defaultSize.height}}(shape,defaultSize):function(shape,defaultSize){var visibleElements,visibleBBox,elements,children=shape.children,newBounds=defaultSize;return visibleElements=(elements=children,elements.filter((function(e){return!e.hidden}))).concat([shape]),(visibleBBox=(0,_ResizeUtil.computeChildrenBBox)(visibleElements))?(newBounds.width=Math.max(visibleBBox.width,newBounds.width),newBounds.height=Math.max(visibleBBox.height,newBounds.height),newBounds.x=visibleBBox.x+(visibleBBox.width-newBounds.width)/2,newBounds.y=visibleBBox.y+(visibleBBox.height-newBounds.height)/2):(newBounds.x=shape.x+(shape.width-newBounds.width)/2,newBounds.y=shape.y+(shape.height-newBounds.height)/2),newBounds}(shape,defaultSize),modeling.resizeShape(shape,newBounds,null,{autoResize:!shape.collapsed&&"nwse"})}))}(0,_inherits.default)(ToggleElementCollapseBehaviour,_CommandInterceptor.default),ToggleElementCollapseBehaviour.$inject=["eventBus","elementFactory","modeling"]},{"../../../util/ModelUtil":91,"diagram-js/lib/command/CommandInterceptor":96,"diagram-js/lib/features/resize/ResizeUtil":168,inherits:218}],54:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=UnclaimIdBehavior;var _inherits=_interopRequireDefault(require("inherits")),_CommandInterceptor=_interopRequireDefault(require("diagram-js/lib/command/CommandInterceptor")),_ModelUtil=require("../../../util/ModelUtil"),_DiUtil=require("../../../util/DiUtil"),_LabelUtil=require("../../../util/LabelUtil");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function UnclaimIdBehavior(canvas,injector,moddle,modeling){injector.invoke(_CommandInterceptor.default,this),this.preExecute("shape.delete",(function(event){var shape=event.context.shape,shapeBo=shape.businessObject;(0,_LabelUtil.isLabel)(shape)||((0,_ModelUtil.is)(shape,"bpmn:Participant")&&(0,_DiUtil.isExpanded)(shape)&&moddle.ids.unclaim(shapeBo.processRef.id),modeling.unclaimId(shapeBo.id,shapeBo))})),this.preExecute("connection.delete",(function(event){var connectionBo=event.context.connection.businessObject;modeling.unclaimId(connectionBo.id,connectionBo)})),this.preExecute("canvas.updateRoot",(function(){var rootElement=canvas.getRootElement(),rootElementBo=rootElement.businessObject;(0,_ModelUtil.is)(rootElement,"bpmn:Collaboration")&&moddle.ids.unclaim(rootElementBo.id)}))}(0,_inherits.default)(UnclaimIdBehavior,_CommandInterceptor.default),UnclaimIdBehavior.$inject=["canvas","injector","moddle","modeling"]},{"../../../util/DiUtil":89,"../../../util/LabelUtil":90,"../../../util/ModelUtil":91,"diagram-js/lib/command/CommandInterceptor":96,inherits:218}],55:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=DeleteSequenceFlowBehavior;var _inherits=_interopRequireDefault(require("inherits")),_CommandInterceptor=_interopRequireDefault(require("diagram-js/lib/command/CommandInterceptor")),_ModelUtil=require("../../../util/ModelUtil");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function DeleteSequenceFlowBehavior(eventBus,modeling){_CommandInterceptor.default.call(this,eventBus),this.preExecute("connection.delete",(function(event){var connection=event.context.connection,source=connection.source;(function(connection,source){if(!(0,_ModelUtil.is)(connection,"bpmn:SequenceFlow"))return!1;var sourceBo=(0,_ModelUtil.getBusinessObject)(source),sequenceFlow=(0,_ModelUtil.getBusinessObject)(connection);return sourceBo.get("default")===sequenceFlow})(connection,source)&&modeling.updateProperties(source,{default:null})}))}(0,_inherits.default)(DeleteSequenceFlowBehavior,_CommandInterceptor.default),DeleteSequenceFlowBehavior.$inject=["eventBus","modeling"]},{"../../../util/ModelUtil":91,"diagram-js/lib/command/CommandInterceptor":96,inherits:218}],56:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=UpdateFlowNodeRefsBehavior;var _inherits=_interopRequireDefault(require("inherits")),_CommandInterceptor=_interopRequireDefault(require("diagram-js/lib/command/CommandInterceptor")),_ModelUtil=require("../../../util/ModelUtil");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function UpdateFlowNodeRefsBehavior(eventBus,modeling,translate){var context;function getContext(){if(!context)throw new Error(translate("out of bounds release"));return context}_CommandInterceptor.default.call(this,eventBus);var laneRefUpdateEvents=["spaceTool","lane.add","lane.resize","lane.split","elements.create","elements.delete","elements.move","shape.create","shape.delete","shape.move","shape.resize"];this.preExecute(laneRefUpdateEvents,5e3,(function(event){(context=context||new UpdateContext).enter()})),this.postExecuted(laneRefUpdateEvents,500,(function(event){!function(){if(!context)throw new Error(translate("out of bounds release"));var triggerUpdate=context.leave();triggerUpdate&&(modeling.updateLaneRefs(context.flowNodes,context.lanes),context=null)}()})),this.preExecute(["shape.create","shape.move","shape.delete","shape.resize"],(function(event){var shape=event.context.shape,updateContext=getContext();shape.labelTarget||((0,_ModelUtil.is)(shape,"bpmn:Lane")&&updateContext.addLane(shape),(0,_ModelUtil.is)(shape,"bpmn:FlowNode")&&updateContext.addFlowNode(shape))}))}function UpdateContext(){this.flowNodes=[],this.lanes=[],this.counter=0,this.addLane=function(lane){this.lanes.push(lane)},this.addFlowNode=function(flowNode){this.flowNodes.push(flowNode)},this.enter=function(){this.counter++},this.leave=function(){return this.counter--,!this.counter}}UpdateFlowNodeRefsBehavior.$inject=["eventBus","modeling","translate"],(0,_inherits.default)(UpdateFlowNodeRefsBehavior,_CommandInterceptor.default)},{"../../../util/ModelUtil":91,"diagram-js/lib/command/CommandInterceptor":96,inherits:218}],57:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _AdaptiveLabelPositioningBehavior=_interopRequireDefault(require("./AdaptiveLabelPositioningBehavior")),_AppendBehavior=_interopRequireDefault(require("./AppendBehavior")),_AssociationBehavior=_interopRequireDefault(require("./AssociationBehavior")),_AttachEventBehavior=_interopRequireDefault(require("./AttachEventBehavior")),_BoundaryEventBehavior=_interopRequireDefault(require("./BoundaryEventBehavior")),_RootElementReferenceBehavior=_interopRequireDefault(require("./RootElementReferenceBehavior")),_CreateBehavior=_interopRequireDefault(require("./CreateBehavior")),_FixHoverBehavior=_interopRequireDefault(require("./FixHoverBehavior")),_CreateDataObjectBehavior=_interopRequireDefault(require("./CreateDataObjectBehavior")),_CreateParticipantBehavior=_interopRequireDefault(require("./CreateParticipantBehavior")),_DataInputAssociationBehavior=_interopRequireDefault(require("./DataInputAssociationBehavior")),_DataStoreBehavior=_interopRequireDefault(require("./DataStoreBehavior")),_DeleteLaneBehavior=_interopRequireDefault(require("./DeleteLaneBehavior")),_DetachEventBehavior=_interopRequireDefault(require("./DetachEventBehavior")),_DropOnFlowBehavior=_interopRequireDefault(require("./DropOnFlowBehavior")),_EventBasedGatewayBehavior=_interopRequireDefault(require("./EventBasedGatewayBehavior")),_GroupBehavior=_interopRequireDefault(require("./GroupBehavior")),_ImportDockingFix=_interopRequireDefault(require("./ImportDockingFix")),_IsHorizontalFix=_interopRequireDefault(require("./IsHorizontalFix")),_LabelBehavior=_interopRequireDefault(require("./LabelBehavior")),_MessageFlowBehavior=_interopRequireDefault(require("./MessageFlowBehavior")),_ModelingFeedback=_interopRequireDefault(require("./ModelingFeedback")),_ReplaceConnectionBehavior=_interopRequireDefault(require("./ReplaceConnectionBehavior")),_RemoveParticipantBehavior=_interopRequireDefault(require("./RemoveParticipantBehavior")),_ReplaceElementBehaviour=_interopRequireDefault(require("./ReplaceElementBehaviour")),_ResizeBehavior=_interopRequireDefault(require("./ResizeBehavior")),_ResizeLaneBehavior=_interopRequireDefault(require("./ResizeLaneBehavior")),_RemoveElementBehavior=_interopRequireDefault(require("./RemoveElementBehavior")),_SpaceToolBehavior=_interopRequireDefault(require("./SpaceToolBehavior")),_SubProcessStartEventBehavior=_interopRequireDefault(require("./SubProcessStartEventBehavior")),_ToggleElementCollapseBehaviour=_interopRequireDefault(require("./ToggleElementCollapseBehaviour")),_UnclaimIdBehavior=_interopRequireDefault(require("./UnclaimIdBehavior")),_UpdateFlowNodeRefsBehavior=_interopRequireDefault(require("./UpdateFlowNodeRefsBehavior")),_UnsetDefaultFlowBehavior=_interopRequireDefault(require("./UnsetDefaultFlowBehavior"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _default={__init__:["adaptiveLabelPositioningBehavior","appendBehavior","associationBehavior","attachEventBehavior","boundaryEventBehavior","rootElementReferenceBehavior","createBehavior","fixHoverBehavior","createDataObjectBehavior","createParticipantBehavior","dataStoreBehavior","dataInputAssociationBehavior","deleteLaneBehavior","detachEventBehavior","dropOnFlowBehavior","eventBasedGatewayBehavior","groupBehavior","importDockingFix","isHorizontalFix","labelBehavior","messageFlowBehavior","modelingFeedback","removeElementBehavior","removeParticipantBehavior","replaceConnectionBehavior","replaceElementBehaviour","resizeBehavior","resizeLaneBehavior","toggleElementCollapseBehaviour","spaceToolBehavior","subProcessStartEventBehavior","unclaimIdBehavior","unsetDefaultFlowBehavior","updateFlowNodeRefsBehavior"],adaptiveLabelPositioningBehavior:["type",_AdaptiveLabelPositioningBehavior.default],appendBehavior:["type",_AppendBehavior.default],associationBehavior:["type",_AssociationBehavior.default],attachEventBehavior:["type",_AttachEventBehavior.default],boundaryEventBehavior:["type",_BoundaryEventBehavior.default],rootElementReferenceBehavior:["type",_RootElementReferenceBehavior.default],createBehavior:["type",_CreateBehavior.default],fixHoverBehavior:["type",_FixHoverBehavior.default],createDataObjectBehavior:["type",_CreateDataObjectBehavior.default],createParticipantBehavior:["type",_CreateParticipantBehavior.default],dataInputAssociationBehavior:["type",_DataInputAssociationBehavior.default],dataStoreBehavior:["type",_DataStoreBehavior.default],deleteLaneBehavior:["type",_DeleteLaneBehavior.default],detachEventBehavior:["type",_DetachEventBehavior.default],dropOnFlowBehavior:["type",_DropOnFlowBehavior.default],eventBasedGatewayBehavior:["type",_EventBasedGatewayBehavior.default],groupBehavior:["type",_GroupBehavior.default],importDockingFix:["type",_ImportDockingFix.default],isHorizontalFix:["type",_IsHorizontalFix.default],labelBehavior:["type",_LabelBehavior.default],messageFlowBehavior:["type",_MessageFlowBehavior.default],modelingFeedback:["type",_ModelingFeedback.default],replaceConnectionBehavior:["type",_ReplaceConnectionBehavior.default],removeParticipantBehavior:["type",_RemoveParticipantBehavior.default],replaceElementBehaviour:["type",_ReplaceElementBehaviour.default],resizeBehavior:["type",_ResizeBehavior.default],resizeLaneBehavior:["type",_ResizeLaneBehavior.default],removeElementBehavior:["type",_RemoveElementBehavior.default],toggleElementCollapseBehaviour:["type",_ToggleElementCollapseBehaviour.default],spaceToolBehavior:["type",_SpaceToolBehavior.default],subProcessStartEventBehavior:["type",_SubProcessStartEventBehavior.default],unclaimIdBehavior:["type",_UnclaimIdBehavior.default],updateFlowNodeRefsBehavior:["type",_UpdateFlowNodeRefsBehavior.default],unsetDefaultFlowBehavior:["type",_UnsetDefaultFlowBehavior.default]};exports.default=_default},{"./AdaptiveLabelPositioningBehavior":23,"./AppendBehavior":24,"./AssociationBehavior":25,"./AttachEventBehavior":26,"./BoundaryEventBehavior":27,"./CreateBehavior":28,"./CreateDataObjectBehavior":29,"./CreateParticipantBehavior":30,"./DataInputAssociationBehavior":31,"./DataStoreBehavior":32,"./DeleteLaneBehavior":33,"./DetachEventBehavior":34,"./DropOnFlowBehavior":35,"./EventBasedGatewayBehavior":36,"./FixHoverBehavior":37,"./GroupBehavior":38,"./ImportDockingFix":39,"./IsHorizontalFix":40,"./LabelBehavior":41,"./MessageFlowBehavior":42,"./ModelingFeedback":43,"./RemoveElementBehavior":44,"./RemoveParticipantBehavior":45,"./ReplaceConnectionBehavior":46,"./ReplaceElementBehaviour":47,"./ResizeBehavior":48,"./ResizeLaneBehavior":49,"./RootElementReferenceBehavior":50,"./SpaceToolBehavior":51,"./SubProcessStartEventBehavior":52,"./ToggleElementCollapseBehaviour":53,"./UnclaimIdBehavior":54,"./UnsetDefaultFlowBehavior":55,"./UpdateFlowNodeRefsBehavior":56}],58:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.createCategoryValue=function(definitions,bpmnFactory){var categoryValue=bpmnFactory.create("bpmn:CategoryValue"),category=bpmnFactory.create("bpmn:Category",{categoryValue:[categoryValue]});return(0,_Collections.add)(definitions.get("rootElements"),category),(0,_ModelUtil.getBusinessObject)(category).$parent=definitions,(0,_ModelUtil.getBusinessObject)(categoryValue).$parent=category,categoryValue};var _Collections=require("diagram-js/lib/util/Collections"),_ModelUtil=require("../../../../util/ModelUtil")},{"../../../../util/ModelUtil":91,"diagram-js/lib/util/Collections":200}],59:[function(require,module,exports){"use strict";function vectorLength(v){return Math.sqrt(Math.pow(v.x,2)+Math.pow(v.y,2))}function perpendicularFoot(point,line){var a=line[0],b=line[1],bd={x:b.x-a.x,y:b.y-a.y},r=function(a,b,c){var system=[{n:a[0]-c[0],lambda:b[0]},{n:a[1]-c[1],lambda:b[1]}];return-(system[0].n*b[0]+system[1].n*b[1])/(system[0].lambda*b[0]+system[1].lambda*b[1])}([a.x,a.y],[bd.x,bd.y],[point.x,point.y]);return{x:a.x+r*bd.x,y:a.y+r*bd.y}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.vectorLength=vectorLength,exports.getAngle=function(line){return Math.atan((line[1].y-line[0].y)/(line[1].x-line[0].x))},exports.rotateVector=function(vector,angle){return angle?{x:Math.cos(angle)*vector.x-Math.sin(angle)*vector.y,y:Math.sin(angle)*vector.x+Math.cos(angle)*vector.y}:vector},exports.perpendicularFoot=perpendicularFoot,exports.getDistancePointLine=function(point,line){var pfPoint=perpendicularFoot(point,line);return vectorLength({x:pfPoint.x-point.x,y:pfPoint.y-point.y})},exports.getDistancePointPoint=function(point1,point2){return vectorLength({x:point1.x-point2.x,y:point1.y-point2.y})}},{}],60:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.findNewLabelLineStartIndex=findNewLabelLineStartIndex,exports.getLabelAdjustment=function(label,newWaypoints,oldWaypoints,hints){var x=0,y=0,labelPosition=function(label){return{x:label.x+label.width/2,y:label.y+label.height/2}}(label),attachment=(0,_LineAttachmentUtil.getAttachment)(labelPosition,oldWaypoints),oldLabelLineIndex=attachment.segmentIndex,newLabelLineIndex=findNewLabelLineStartIndex(oldWaypoints,newWaypoints,attachment,hints);if(null===newLabelLineIndex)return{x,y};if(newLabelLineIndex<0||newLabelLineIndex>newWaypoints.length-2)return{x,y};var oldLabelLine=getLine(oldWaypoints,oldLabelLineIndex),newLabelLine=getLine(newWaypoints,newLabelLineIndex),oldFoot=attachment.position,relativeFootPosition=(line=oldLabelLine,foot=oldFoot,length=(0,_GeometricUtil.getDistancePointPoint)(line[0],line[1]),lengthToFoot=(0,_GeometricUtil.getDistancePointPoint)(line[0],foot),0===length?0:lengthToFoot/length),angleDelta=(l1=oldLabelLine,l2=newLabelLine,a1=(0,_GeometricUtil.getAngle)(l1),(0,_GeometricUtil.getAngle)(l2)-a1);var l1,l2,a1;var line,foot,length,lengthToFoot;if("bendpoint"===attachment.type){var offset=newWaypoints.length-oldWaypoints.length,oldBendpointIndex=attachment.bendpointIndex,oldBendpoint=oldWaypoints[oldBendpointIndex];if(-1!==newWaypoints.indexOf(oldBendpoint))return{x,y};if(0===offset){var newBendpoint=newWaypoints[oldBendpointIndex];return{x:newBendpoint.x-attachment.position.x,y:newBendpoint.y-attachment.position.y}}offset<0&&0!==oldBendpointIndex&&oldBendpointIndex<oldWaypoints.length-1&&(relativeFootPosition=relativePositionMidWaypoint(oldWaypoints,oldBendpointIndex))}var newFoot={x:(newLabelLine[1].x-newLabelLine[0].x)*relativeFootPosition+newLabelLine[0].x,y:(newLabelLine[1].y-newLabelLine[0].y)*relativeFootPosition+newLabelLine[0].y},newLabelVector=(0,_GeometricUtil.rotateVector)({x:labelPosition.x-oldFoot.x,y:labelPosition.y-oldFoot.y},angleDelta);return x=newFoot.x+newLabelVector.x-labelPosition.x,y=newFoot.y+newLabelVector.y-labelPosition.y,(0,_LayoutUtil.roundPoint)({x,y})};var _GeometricUtil=require("./GeometricUtil"),_LineAttachmentUtil=require("./LineAttachmentUtil"),_LayoutUtil=require("diagram-js/lib/layout/LayoutUtil");function findNewLabelLineStartIndex(oldWaypoints,newWaypoints,attachment,hints){var index=attachment.segmentIndex,offset=newWaypoints.length-oldWaypoints.length;if(hints.segmentMove){var oldSegmentStartIndex=hints.segmentMove.segmentStartIndex,newSegmentStartIndex=hints.segmentMove.newSegmentStartIndex;return index===oldSegmentStartIndex?newSegmentStartIndex:index>=newSegmentStartIndex?index+offset<newSegmentStartIndex?newSegmentStartIndex:index+offset:index}if(hints.bendpointMove){var newIndex,insert=hints.bendpointMove.insert,bendpointIndex=hints.bendpointMove.bendpointIndex;if(0===offset)return index;if(index>=bendpointIndex&&(newIndex=insert?index+1:index-1),index<bendpointIndex)if(newIndex=index,insert&&"bendpoint"!==attachment.type&&bendpointIndex-1===index)relativePositionMidWaypoint(newWaypoints,bendpointIndex)<attachment.relativeLocation&&newIndex++;return newIndex}return 0===offset?index:hints.connectionStart?0===index?0:null:hints.connectionEnd&&index===oldWaypoints.length-2?newWaypoints.length-2:null}function relativePositionMidWaypoint(waypoints,idx){var distanceSegment1=(0,_GeometricUtil.getDistancePointPoint)(waypoints[idx-1],waypoints[idx]);return distanceSegment1/(distanceSegment1+(0,_GeometricUtil.getDistancePointPoint)(waypoints[idx],waypoints[idx+1]))}function getLine(waypoints,idx){return[waypoints[idx],waypoints[idx+1]]}},{"./GeometricUtil":59,"./LineAttachmentUtil":61,"diagram-js/lib/layout/LayoutUtil":188}],61:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getAttachment=function(point,line){var segmentStart,segmentEnd,segmentStartDistance,segmentEndDistance,attachmentPosition,minDistance,intersections,attachment,attachmentDistance,closestAttachmentDistance,closestAttachment,idx=0;for(idx=0;idx<line.length-1;idx++){if(segmentStart=line[idx],segmentEnd=line[idx+1],pointsEqual(segmentStart,segmentEnd)?intersections=[segmentStart]:(segmentStartDistance=getDistance(point,segmentStart),segmentEndDistance=getDistance(point,segmentEnd),minDistance=min(segmentStartDistance,segmentEndDistance),intersections=getCircleSegmentIntersections(segmentStart,segmentEnd,point,minDistance)),intersections.length<1)throw new Error("expected between [1, 2] circle -> line intersections");1===intersections.length&&(attachment={type:"bendpoint",position:intersections[0],segmentIndex:idx,bendpointIndex:pointsEqual(segmentStart,intersections[0])?idx:idx+1}),2===intersections.length&&(p1=intersections[0],p2=intersections[1],attachmentPosition={x:(p1.x+p2.x)/2,y:(p1.y+p2.y)/2},attachment={type:"segment",position:attachmentPosition,segmentIndex:idx,relativeLocation:getDistance(segmentStart,attachmentPosition)/getDistance(segmentStart,segmentEnd)}),attachmentDistance=getDistance(attachment.position,point),(!closestAttachment||closestAttachmentDistance>attachmentDistance)&&(closestAttachment=attachment,closestAttachmentDistance=attachmentDistance)}var p1,p2;return closestAttachment};var sqrt=Math.sqrt,min=Math.min,max=Math.max,abs=Math.abs;function sq(n){return Math.pow(n,2)}function getDistance(p1,p2){return sqrt(sq(p1.x-p2.x)+sq(p1.y-p2.y))}function getCircleSegmentIntersections(s1,s2,cc,cr){var baX=s2.x-s1.x,baY=s2.y-s1.y,caX=cc.x-s1.x,caY=cc.y-s1.y,a=baX*baX+baY*baY,pBy2=(baX*caX+baY*caY)/a,disc=pBy2*pBy2-(caX*caX+caY*caY-cr*cr)/a;if(disc<0&&disc>-1e-6&&(disc=0),disc<0)return[];var tmpSqrt=sqrt(disc),abScalingFactor1=-pBy2+tmpSqrt,abScalingFactor2=-pBy2-tmpSqrt,i1={x:s1.x-baX*abScalingFactor1,y:s1.y-baY*abScalingFactor1};return 0===disc?[i1]:[i1,{x:s1.x-baX*abScalingFactor2,y:s1.y-baY*abScalingFactor2}].filter((function(p){return function(p,segmentStart,segmentEnd){return fenced(p.x,segmentStart.x,segmentEnd.x)&&fenced(p.y,segmentStart.y,segmentEnd.y)}(p,s1,s2)}))}function fenced(n,rangeStart,rangeEnd){return n>=min(rangeStart,rangeEnd)-EQUAL_THRESHOLD&&n<=max(rangeStart,rangeEnd)+EQUAL_THRESHOLD}var EQUAL_THRESHOLD=.1;function pointsEqual(p1,p2){return abs(p1.x-p2.x)<=EQUAL_THRESHOLD&&abs(p1.y-p2.y)<=EQUAL_THRESHOLD}},{}],62:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(l1s,l1e,l2s,l2e){var denominator,a,b,c,numerator;if(0==(denominator=(l2e.y-l2s.y)*(l1e.x-l1s.x)-(l2e.x-l2s.x)*(l1e.y-l1s.y)))return null;return a=l1s.y-l2s.y,b=l1s.x-l2s.x,numerator=(l2e.x-l2s.x)*a-(l2e.y-l2s.y)*b,c=numerator/denominator,{x:Math.round(l1s.x+c*(l1e.x-l1s.x)),y:Math.round(l1s.y+c*(l1e.y-l1s.y))}}},{}],63:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=AddLaneHandler;var _minDash=require("min-dash"),_Elements=require("diagram-js/lib/util/Elements"),_LaneUtil=require("../util/LaneUtil");function AddLaneHandler(modeling,spaceTool){this._modeling=modeling,this._spaceTool=spaceTool}AddLaneHandler.$inject=["modeling","spaceTool"],AddLaneHandler.prototype.preExecute=function(context){var spaceTool=this._spaceTool,modeling=this._modeling,shape=context.shape,location=context.location,lanesRoot=(0,_LaneUtil.getLanesRoot)(shape),isRoot=lanesRoot===shape,laneParent=isRoot?shape:shape.parent;(0,_LaneUtil.getChildLanes)(laneParent).length||modeling.createShape({type:"bpmn:Lane"},{x:shape.x+_LaneUtil.LANE_INDENTATION,y:shape.y,width:shape.width-_LaneUtil.LANE_INDENTATION,height:shape.height},laneParent);var allAffected=[];(0,_Elements.eachElement)(lanesRoot,(function(element){return allAffected.push(element),element.label&&allAffected.push(element.label),element===shape?[]:(0,_minDash.filter)(element.children,(function(c){return c!==shape}))}));var offset="top"===location?-120:120,lanePosition="top"===location?shape.y:shape.y+shape.height,spacePos=lanePosition+("top"===location?10:-10),direction="top"===location?"n":"s",adjustments=spaceTool.calculateAdjustments(allAffected,"y",offset,spacePos);spaceTool.makeSpace(adjustments.movingShapes,adjustments.resizingShapes,{x:0,y:offset},direction,spacePos),context.newLane=modeling.createShape({type:"bpmn:Lane"},{x:shape.x+(isRoot?_LaneUtil.LANE_INDENTATION:0),y:lanePosition-("top"===location?120:0),width:shape.width-(isRoot?_LaneUtil.LANE_INDENTATION:0),height:120},laneParent)}},{"../util/LaneUtil":74,"diagram-js/lib/util/Elements":202,"min-dash":219}],64:[function(require,module,exports){"use strict";function IdClaimHandler(moddle){this._moddle=moddle}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=IdClaimHandler,IdClaimHandler.$inject=["moddle"],IdClaimHandler.prototype.execute=function(context){var ids=this._moddle.ids,id=context.id,element=context.element;context.claiming?ids.claim(id,element):ids.unclaim(id)},IdClaimHandler.prototype.revert=function(context){var ids=this._moddle.ids,id=context.id,element=context.element;context.claiming?ids.unclaim(id):ids.claim(id,element)}},{}],65:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ResizeLaneHandler;var _ModelUtil=require("../../../util/ModelUtil"),_LaneUtil=require("../util/LaneUtil"),_Elements=require("diagram-js/lib/util/Elements"),_LayoutUtil=require("diagram-js/lib/layout/LayoutUtil"),_ResizeUtil=require("diagram-js/lib/features/resize/ResizeUtil");function ResizeLaneHandler(modeling,spaceTool){this._modeling=modeling,this._spaceTool=spaceTool}ResizeLaneHandler.$inject=["modeling","spaceTool"],ResizeLaneHandler.prototype.preExecute=function(context){var shape=context.shape,newBounds=context.newBounds;!1!==context.balanced?this.resizeBalanced(shape,newBounds):this.resizeSpace(shape,newBounds)},ResizeLaneHandler.prototype.resizeBalanced=function(shape,newBounds){var modeling=this._modeling,resizeNeeded=(0,_LaneUtil.computeLanesResize)(shape,newBounds);modeling.resizeShape(shape,newBounds),resizeNeeded.forEach((function(r){modeling.resizeShape(r.shape,r.newBounds)}))},ResizeLaneHandler.prototype.resizeSpace=function(shape,newBounds){var change,spacePos,direction,offset,adjustments,spaceTool=this._spaceTool,shapeTrbl=(0,_LayoutUtil.asTRBL)(shape),newTrbl=(0,_LayoutUtil.asTRBL)(newBounds),trblDiff=(0,_ResizeUtil.substractTRBL)(newTrbl,shapeTrbl),lanesRoot=(0,_LaneUtil.getLanesRoot)(shape),allAffected=[],allLanes=[];(0,_Elements.eachElement)(lanesRoot,(function(element){return allAffected.push(element),((0,_ModelUtil.is)(element,"bpmn:Lane")||(0,_ModelUtil.is)(element,"bpmn:Participant"))&&allLanes.push(element),element.children})),(trblDiff.bottom||trblDiff.top)&&(change=trblDiff.bottom||trblDiff.top,spacePos=shape.y+(trblDiff.bottom?shape.height:0)+(trblDiff.bottom?-10:10),direction=trblDiff.bottom?"s":"n",offset=trblDiff.top>0||trblDiff.bottom<0?-change:change,adjustments=spaceTool.calculateAdjustments(allAffected,"y",offset,spacePos),spaceTool.makeSpace(adjustments.movingShapes,adjustments.resizingShapes,{x:0,y:change},direction)),(trblDiff.left||trblDiff.right)&&(change=trblDiff.right||trblDiff.left,spacePos=shape.x+(trblDiff.right?shape.width:0)+(trblDiff.right?-10:100),direction=trblDiff.right?"e":"w",offset=trblDiff.left>0||trblDiff.right<0?-change:change,adjustments=spaceTool.calculateAdjustments(allLanes,"x",offset,spacePos),spaceTool.makeSpace(adjustments.movingShapes,adjustments.resizingShapes,{x:change,y:0},direction))}},{"../../../util/ModelUtil":91,"../util/LaneUtil":74,"diagram-js/lib/features/resize/ResizeUtil":168,"diagram-js/lib/layout/LayoutUtil":188,"diagram-js/lib/util/Elements":202}],66:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=SetColorHandler;var _minDash=require("min-dash"),DEFAULT_COLORS={fill:void 0,stroke:void 0};function SetColorHandler(commandStack){this._commandStack=commandStack,this._normalizeColor=function(color){if(color){if((0,_minDash.isString)(color)){var hexColor=function(color){var context=document.createElement("canvas").getContext("2d");return context.fillStyle="transparent",context.fillStyle=color,/^#[0-9a-fA-F]{6}$/.test(context.fillStyle)?context.fillStyle:null}(color);if(hexColor)return hexColor}throw new Error("invalid color value: "+color)}}}SetColorHandler.$inject=["commandStack"],SetColorHandler.prototype.postExecute=function(context){var elements=context.elements,colors=context.colors||DEFAULT_COLORS,self=this,di={};"fill"in colors&&(0,_minDash.assign)(di,{"background-color":this._normalizeColor(colors.fill)}),"stroke"in colors&&(0,_minDash.assign)(di,{"border-color":this._normalizeColor(colors.stroke)}),(0,_minDash.forEach)(elements,(function(element){var assignedDi=function(element){return!!element.waypoints}(element)?(0,_minDash.pick)(di,["border-color"]):di;!function(di){"border-color"in di&&(di.stroke=di["border-color"]);"background-color"in di&&(di.fill=di["background-color"])}(assignedDi),element.labelTarget?self._commandStack.execute("element.updateModdleProperties",{element,moddleElement:element.businessObject.di.label,properties:{color:di["background-color"]}}):self._commandStack.execute("element.updateProperties",{element,properties:{di:assignedDi}})}))}},{"min-dash":219}],67:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=SplitLaneHandler;var _LaneUtil=require("../util/LaneUtil");function SplitLaneHandler(modeling,translate){this._modeling=modeling,this._translate=translate}SplitLaneHandler.$inject=["modeling","translate"],SplitLaneHandler.prototype.preExecute=function(context){var modeling=this._modeling,translate=this._translate,shape=context.shape,newLanesCount=context.count,childLanes=(0,_LaneUtil.getChildLanes)(shape),existingLanesCount=childLanes.length;if(existingLanesCount>newLanesCount)throw new Error(translate("more than {count} child lanes",{count:newLanesCount}));var laneY,laneHeight,laneBounds,newLaneAttrs,idx,newLanesHeight=Math.round(shape.height/newLanesCount);for(idx=0;idx<newLanesCount;idx++)laneY=shape.y+idx*newLanesHeight,laneHeight=idx===newLanesCount-1?shape.height-newLanesHeight*idx:newLanesHeight,laneBounds={x:shape.x+_LaneUtil.LANE_INDENTATION,y:laneY,width:shape.width-_LaneUtil.LANE_INDENTATION,height:laneHeight},idx<existingLanesCount?modeling.resizeShape(childLanes[idx],laneBounds):(newLaneAttrs={type:"bpmn:Lane"},modeling.createShape(newLaneAttrs,laneBounds,shape))}},{"../util/LaneUtil":74}],68:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=UpdateCanvasRootHandler;var _Collections=require("diagram-js/lib/util/Collections");function UpdateCanvasRootHandler(canvas,modeling){this._canvas=canvas,this._modeling=modeling}UpdateCanvasRootHandler.$inject=["canvas","modeling"],UpdateCanvasRootHandler.prototype.execute=function(context){var canvas=this._canvas,newRoot=context.newRoot,newRootBusinessObject=newRoot.businessObject,oldRoot=canvas.getRootElement(),oldRootBusinessObject=oldRoot.businessObject,bpmnDefinitions=oldRootBusinessObject.$parent,diPlane=oldRootBusinessObject.di;canvas.setRootElement(newRoot,!0),(0,_Collections.add)(bpmnDefinitions.rootElements,newRootBusinessObject),newRootBusinessObject.$parent=bpmnDefinitions,(0,_Collections.remove)(bpmnDefinitions.rootElements,oldRootBusinessObject),oldRootBusinessObject.$parent=null,oldRootBusinessObject.di=null,diPlane.bpmnElement=newRootBusinessObject,newRootBusinessObject.di=diPlane,context.oldRoot=oldRoot},UpdateCanvasRootHandler.prototype.revert=function(context){var canvas=this._canvas,newRootBusinessObject=context.newRoot.businessObject,oldRoot=context.oldRoot,oldRootBusinessObject=oldRoot.businessObject,bpmnDefinitions=newRootBusinessObject.$parent,diPlane=newRootBusinessObject.di;canvas.setRootElement(oldRoot,!0),(0,_Collections.remove)(bpmnDefinitions.rootElements,newRootBusinessObject),newRootBusinessObject.$parent=null,(0,_Collections.add)(bpmnDefinitions.rootElements,oldRootBusinessObject),oldRootBusinessObject.$parent=bpmnDefinitions,newRootBusinessObject.di=null,diPlane.bpmnElement=oldRootBusinessObject,oldRootBusinessObject.di=diPlane}},{"diagram-js/lib/util/Collections":200}],69:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=UpdateFlowNodeRefsHandler;var _LaneUtil=require("../util/LaneUtil"),_ModelUtil=require("../../../util/ModelUtil"),_Collections=require("diagram-js/lib/util/Collections"),_LayoutUtil=require("diagram-js/lib/layout/LayoutUtil");function UpdateFlowNodeRefsHandler(elementRegistry){this._elementRegistry=elementRegistry}UpdateFlowNodeRefsHandler.$inject=["elementRegistry"],UpdateFlowNodeRefsHandler.prototype.computeUpdates=function(flowNodeShapes,laneShapes){var handledNodes=[],updates=[],participantCache={},allFlowNodeShapes=[];function addFlowNodeShape(flowNodeShape){-1===handledNodes.indexOf(flowNodeShape)&&(allFlowNodeShapes.push(flowNodeShape),handledNodes.push(flowNodeShape))}function getNewLanes(flowNodeShape){return flowNodeShape.parent?function(flowNodeShape){var root=(0,_LaneUtil.getLanesRoot)(flowNodeShape);return participantCache[root.id]||(participantCache[root.id]=(0,_LaneUtil.collectLanes)(root)),participantCache[root.id]}(flowNodeShape).filter((function(l){return element=flowNodeShape,laneShape=l,laneTrbl=(0,_LayoutUtil.asTRBL)(laneShape),elementMid_x=element.x+element.width/2,elementMid_y=element.y+element.height/2,elementMid_x>laneTrbl.left&&elementMid_x<laneTrbl.right&&elementMid_y>laneTrbl.top&&elementMid_y<laneTrbl.bottom;var element,laneShape,laneTrbl,elementMid_x,elementMid_y})).map((function(shape){return shape.businessObject})):[]}return laneShapes.forEach((function(laneShape){var root=(0,_LaneUtil.getLanesRoot)(laneShape);root&&-1===handledNodes.indexOf(root)&&(root.children.filter((function(c){return(0,_ModelUtil.is)(c,"bpmn:FlowNode")})).forEach(addFlowNodeShape),handledNodes.push(root))})),flowNodeShapes.forEach(addFlowNodeShape),allFlowNodeShapes.forEach((function(flowNodeShape){var flowNode=flowNodeShape.businessObject,remove=flowNode.get("lanes").slice(),add=getNewLanes(flowNodeShape);updates.push({flowNode,remove,add})})),laneShapes.forEach((function(laneShape){var lane=laneShape.businessObject;laneShape.parent||lane.get("flowNodeRef").forEach((function(flowNode){updates.push({flowNode,remove:[lane],add:[]})}))})),updates},UpdateFlowNodeRefsHandler.prototype.execute=function(context){var updates=context.updates;updates||(updates=context.updates=this.computeUpdates(context.flowNodeShapes,context.laneShapes)),updates.forEach((function(update){var flowNode=update.flowNode,lanes=flowNode.get("lanes");update.remove.forEach((function(oldLane){(0,_Collections.remove)(lanes,oldLane),(0,_Collections.remove)(oldLane.get("flowNodeRef"),flowNode)})),update.add.forEach((function(newLane){(0,_Collections.add)(lanes,newLane),(0,_Collections.add)(newLane.get("flowNodeRef"),flowNode)}))}))},UpdateFlowNodeRefsHandler.prototype.revert=function(context){context.updates.forEach((function(update){var flowNode=update.flowNode,lanes=flowNode.get("lanes");update.add.forEach((function(newLane){(0,_Collections.remove)(lanes,newLane),(0,_Collections.remove)(newLane.get("flowNodeRef"),flowNode)})),update.remove.forEach((function(oldLane){(0,_Collections.add)(lanes,oldLane),(0,_Collections.add)(oldLane.get("flowNodeRef"),flowNode)}))}))}},{"../../../util/ModelUtil":91,"../util/LaneUtil":74,"diagram-js/lib/layout/LayoutUtil":188,"diagram-js/lib/util/Collections":200}],70:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=UpdateModdlePropertiesHandler;var _minDash=require("min-dash"),_ModelUtil=require("../../../util/ModelUtil");function UpdateModdlePropertiesHandler(elementRegistry){this._elementRegistry=elementRegistry}function setModdleProperties(moddleElement,properties){(0,_minDash.forEach)(properties,(function(value,key){moddleElement.set(key,value)}))}UpdateModdlePropertiesHandler.$inject=["elementRegistry"],UpdateModdlePropertiesHandler.prototype.execute=function(context){var element=context.element,moddleElement=context.moddleElement,properties=context.properties;if(!moddleElement)throw new Error("<moddleElement> required");var changed=context.changed||this.getVisualReferences(moddleElement).concat(element),oldProperties=context.oldProperties||function(moddleElement,propertyNames){return(0,_minDash.reduce)(propertyNames,(function(result,key){return result[key]=moddleElement.get(key),result}),{})}(moddleElement,(0,_minDash.keys)(properties));return setModdleProperties(moddleElement,properties),context.oldProperties=oldProperties,context.changed=changed,changed},UpdateModdlePropertiesHandler.prototype.revert=function(context){var oldProperties=context.oldProperties,moddleElement=context.moddleElement,changed=context.changed;return setModdleProperties(moddleElement,oldProperties),changed},UpdateModdlePropertiesHandler.prototype.getVisualReferences=function(moddleElement){var elementRegistry=this._elementRegistry;return(0,_ModelUtil.is)(moddleElement,"bpmn:DataObject")?function(dataObject,elementRegistry){return elementRegistry.filter((function(element){return(0,_ModelUtil.is)(element,"bpmn:DataObjectReference")&&(0,_ModelUtil.getBusinessObject)(element).dataObjectRef===dataObject}))}(moddleElement,elementRegistry):[]}},{"../../../util/ModelUtil":91,"min-dash":219}],71:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=UpdatePropertiesHandler;var _minDash=require("min-dash"),_ModelUtil=require("../../../util/ModelUtil"),ID="id",NULL_DIMENSIONS={width:0,height:0};function UpdatePropertiesHandler(elementRegistry,moddle,translate,modeling,textRenderer){this._elementRegistry=elementRegistry,this._moddle=moddle,this._translate=translate,this._modeling=modeling,this._textRenderer=textRenderer}function isIdChange(properties,businessObject){return ID in properties&&properties.id!==businessObject.id}function setProperties(businessObject,properties){(0,_minDash.forEach)(properties,(function(value,key){"di"!==key?businessObject.set(key,value):businessObject.di&&function(di,properties){(0,_minDash.forEach)(properties,(function(value,key){di.set(key,value)}))}(businessObject.di,value)}))}UpdatePropertiesHandler.$inject=["elementRegistry","moddle","translate","modeling","textRenderer"],UpdatePropertiesHandler.prototype.execute=function(context){var element=context.element,changed=[element],translate=this._translate;if(!element)throw new Error(translate("element required"));var elementRegistry=this._elementRegistry,ids=this._moddle.ids,businessObject=element.businessObject,properties=function(properties){var unwrappedProps=(0,_minDash.assign)({},properties);return referencePropertyNames.forEach((function(name){name in properties&&(unwrappedProps[name]=(0,_ModelUtil.getBusinessObject)(unwrappedProps[name]))})),unwrappedProps}(context.properties),oldProperties=context.oldProperties||function(businessObject,properties){var propertyNames=(0,_minDash.keys)(properties);return(0,_minDash.reduce)(propertyNames,(function(result,key){return result[key]="di"!==key?businessObject.get(key):function(di,propertyNames){return(0,_minDash.reduce)(propertyNames,(function(result,key){return result[key]=di.get(key),result}),{})}(businessObject.di,(0,_minDash.keys)(properties.di)),result}),{})}(businessObject,properties);return isIdChange(properties,businessObject)&&(ids.unclaim(businessObject.id),elementRegistry.updateId(element,properties.id),ids.claim(properties.id,businessObject)),"default"in properties&&(properties.default&&changed.push(elementRegistry.get(properties.default.id)),businessObject.default&&changed.push(elementRegistry.get(businessObject.default.id))),setProperties(businessObject,properties),context.oldProperties=oldProperties,context.changed=changed,changed},UpdatePropertiesHandler.prototype.postExecute=function(context){var label=context.element.label,text=label&&(0,_ModelUtil.getBusinessObject)(label).name;if(text){var newLabelBounds=this._textRenderer.getExternalLabelBounds(label,text);this._modeling.resizeShape(label,newLabelBounds,NULL_DIMENSIONS)}},UpdatePropertiesHandler.prototype.revert=function(context){var element=context.element,properties=context.properties,oldProperties=context.oldProperties,businessObject=element.businessObject,elementRegistry=this._elementRegistry,ids=this._moddle.ids;return setProperties(businessObject,oldProperties),isIdChange(properties,businessObject)&&(ids.unclaim(properties.id),elementRegistry.updateId(element,oldProperties.id),ids.claim(oldProperties.id,businessObject)),context.changed};var referencePropertyNames=["default"]},{"../../../util/ModelUtil":91,"min-dash":219}],72:[function(require,module,exports){"use strict";function UpdateSemanticParentHandler(bpmnUpdater){this._bpmnUpdater=bpmnUpdater}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=UpdateSemanticParentHandler,UpdateSemanticParentHandler.$inject=["bpmnUpdater"],UpdateSemanticParentHandler.prototype.execute=function(context){var dataStoreBo=context.dataStoreBo,newSemanticParent=context.newSemanticParent,newDiParent=context.newDiParent;context.oldSemanticParent=dataStoreBo.$parent,context.oldDiParent=dataStoreBo.di.$parent,this._bpmnUpdater.updateSemanticParent(dataStoreBo,newSemanticParent),this._bpmnUpdater.updateDiParent(dataStoreBo.di,newDiParent)},UpdateSemanticParentHandler.prototype.revert=function(context){var dataStoreBo=context.dataStoreBo,oldSemanticParent=context.oldSemanticParent,oldDiParent=context.oldDiParent;this._bpmnUpdater.updateSemanticParent(dataStoreBo,oldSemanticParent),this._bpmnUpdater.updateDiParent(dataStoreBo.di,oldDiParent)}},{}],73:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _behavior=_interopRequireDefault(require("./behavior")),_rules=_interopRequireDefault(require("../rules")),_diOrdering=_interopRequireDefault(require("../di-ordering")),_ordering=_interopRequireDefault(require("../ordering")),_replace=_interopRequireDefault(require("../replace")),_command=_interopRequireDefault(require("diagram-js/lib/command")),_tooltips=_interopRequireDefault(require("diagram-js/lib/features/tooltips")),_labelSupport=_interopRequireDefault(require("diagram-js/lib/features/label-support")),_attachSupport=_interopRequireDefault(require("diagram-js/lib/features/attach-support")),_selection=_interopRequireDefault(require("diagram-js/lib/features/selection")),_changeSupport=_interopRequireDefault(require("diagram-js/lib/features/change-support")),_spaceTool=_interopRequireDefault(require("diagram-js/lib/features/space-tool")),_BpmnFactory=_interopRequireDefault(require("./BpmnFactory")),_BpmnUpdater=_interopRequireDefault(require("./BpmnUpdater")),_ElementFactory=_interopRequireDefault(require("./ElementFactory")),_Modeling=_interopRequireDefault(require("./Modeling")),_BpmnLayouter=_interopRequireDefault(require("./BpmnLayouter")),_CroppingConnectionDocking=_interopRequireDefault(require("diagram-js/lib/layout/CroppingConnectionDocking"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _default={__init__:["modeling","bpmnUpdater"],__depends__:[_behavior.default,_rules.default,_diOrdering.default,_ordering.default,_replace.default,_command.default,_tooltips.default,_labelSupport.default,_attachSupport.default,_selection.default,_changeSupport.default,_spaceTool.default],bpmnFactory:["type",_BpmnFactory.default],bpmnUpdater:["type",_BpmnUpdater.default],elementFactory:["type",_ElementFactory.default],modeling:["type",_Modeling.default],layouter:["type",_BpmnLayouter.default],connectionDocking:["type",_CroppingConnectionDocking.default]};exports.default=_default},{"../di-ordering":15,"../ordering":77,"../replace":79,"../rules":81,"./BpmnFactory":18,"./BpmnLayouter":19,"./BpmnUpdater":20,"./ElementFactory":21,"./Modeling":22,"./behavior":57,"diagram-js/lib/command":98,"diagram-js/lib/features/attach-support":110,"diagram-js/lib/features/change-support":112,"diagram-js/lib/features/label-support":131,"diagram-js/lib/features/selection":175,"diagram-js/lib/features/space-tool":179,"diagram-js/lib/features/tooltips":183,"diagram-js/lib/layout/CroppingConnectionDocking":187}],74:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.collectLanes=collectLanes,exports.getChildLanes=function(shape){return shape.children.filter((function(c){return(0,_ModelUtil.is)(c,"bpmn:Lane")}))},exports.getLanesRoot=getLanesRoot,exports.computeLanesResize=function(shape,newBounds){var rootElement=getLanesRoot(shape),initialShapes=(0,_ModelUtil.is)(rootElement,"bpmn:Process")?[]:[rootElement],allLanes=collectLanes(rootElement,initialShapes),shapeTrbl=(0,_LayoutUtil.asTRBL)(shape),shapeNewTrbl=(0,_LayoutUtil.asTRBL)(newBounds),trblResize=function(oldBounds,newBounds){return(0,_ResizeUtil.substractTRBL)((0,_LayoutUtil.asTRBL)(newBounds),(0,_LayoutUtil.asTRBL)(oldBounds))}(shape,newBounds),resizeNeeded=[];return allLanes.forEach((function(other){if(other!==shape){var topResize=0,rightResize=trblResize.right,bottomResize=0,leftResize=trblResize.left,otherTrbl=(0,_LayoutUtil.asTRBL)(other);trblResize.top&&(abs(otherTrbl.bottom-shapeTrbl.top)<10&&(bottomResize=shapeNewTrbl.top-otherTrbl.bottom),abs(otherTrbl.top-shapeTrbl.top)<5&&(topResize=shapeNewTrbl.top-otherTrbl.top)),trblResize.bottom&&(abs(otherTrbl.top-shapeTrbl.bottom)<10&&(topResize=shapeNewTrbl.bottom-otherTrbl.top),abs(otherTrbl.bottom-shapeTrbl.bottom)<5&&(bottomResize=shapeNewTrbl.bottom-otherTrbl.bottom)),(topResize||rightResize||bottomResize||leftResize)&&resizeNeeded.push({shape:other,newBounds:(0,_ResizeUtil.resizeTRBL)(other,{top:topResize,right:rightResize,bottom:bottomResize,left:leftResize})})}})),resizeNeeded},exports.LANE_INDENTATION=void 0;var _ModelUtil=require("../../../util/ModelUtil"),_ModelingUtil=require("./ModelingUtil"),_LayoutUtil=require("diagram-js/lib/layout/LayoutUtil"),_ResizeUtil=require("diagram-js/lib/features/resize/ResizeUtil"),abs=Math.abs;var LANE_PARENTS=["bpmn:Participant","bpmn:Process","bpmn:SubProcess"];function collectLanes(shape,collectedShapes){return collectedShapes=collectedShapes||[],shape.children.filter((function(s){(0,_ModelUtil.is)(s,"bpmn:Lane")&&(collectLanes(s,collectedShapes),collectedShapes.push(s))})),collectedShapes}function getLanesRoot(shape){return(0,_ModelingUtil.getParent)(shape,LANE_PARENTS)||shape}exports.LANE_INDENTATION=30},{"../../../util/ModelUtil":91,"./ModelingUtil":75,"diagram-js/lib/features/resize/ResizeUtil":168,"diagram-js/lib/layout/LayoutUtil":188}],75:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getParent=function(element,anyType){"string"==typeof anyType&&(anyType=[anyType]);for(;element=element.parent;)if((0,_ModelUtil.isAny)(element,anyType))return element;return null},Object.defineProperty(exports,"is",{enumerable:!0,get:function(){return _ModelUtil.is}}),Object.defineProperty(exports,"isAny",{enumerable:!0,get:function(){return _ModelUtil.isAny}});var _ModelUtil=require("../../../util/ModelUtil")},{"../../../util/ModelUtil":91}],76:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BpmnOrderingProvider;var _inherits=_interopRequireDefault(require("inherits")),_OrderingProvider=_interopRequireDefault(require("diagram-js/lib/features/ordering/OrderingProvider")),_ModelingUtil=require("../modeling/util/ModelingUtil"),_minDash=require("min-dash");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function BpmnOrderingProvider(eventBus,canvas,translate){_OrderingProvider.default.call(this,eventBus);var orders=[{type:"bpmn:SubProcess",order:{level:6}},{type:"bpmn:SequenceFlow",order:{level:3,containers:["bpmn:Participant","bpmn:FlowElementsContainer"]}},{type:"bpmn:DataAssociation",order:{level:9,containers:["bpmn:Collaboration","bpmn:Process"]}},{type:"bpmn:MessageFlow",order:{level:9,containers:["bpmn:Collaboration"]}},{type:"bpmn:Association",order:{level:6,containers:["bpmn:Participant","bpmn:FlowElementsContainer","bpmn:Collaboration"]}},{type:"bpmn:BoundaryEvent",order:{level:8}},{type:"bpmn:Group",order:{level:10,containers:["bpmn:Collaboration","bpmn:Process"]}},{type:"bpmn:FlowElement",order:{level:5}},{type:"bpmn:Participant",order:{level:-2}},{type:"bpmn:Lane",order:{level:-1}}];function getOrder(element){var order=element.order;if(order||(element.order=order=function(element){if(element.labelTarget)return{level:10};var entry=(0,_minDash.find)(orders,(function(o){return(0,_ModelingUtil.isAny)(element,[o.type])}));return entry&&entry.order||{level:1}}(element)),!order)throw new Error("no order for <"+element.id+">");return order}this.getOrdering=function(element,newParent){if(element.labelTarget)return{parent:canvas.getRootElement(),index:-1};var elementOrder=getOrder(element);elementOrder.containers&&(newParent=function(element,newParent,containers){for(var actualParent=newParent;actualParent&&!(0,_ModelingUtil.isAny)(actualParent,containers);)actualParent=actualParent.parent;if(!actualParent)throw new Error("no parent for <"+element.id+"> in <"+(newParent&&newParent.id)+">");return actualParent}(element,newParent,elementOrder.containers));var currentIndex=newParent.children.indexOf(element),insertIndex=(0,_minDash.findIndex)(newParent.children,(function(child){return!(!element.labelTarget&&child.labelTarget)&&elementOrder.level<getOrder(child).level}));return-1!==insertIndex&&-1!==currentIndex&&currentIndex<insertIndex&&(insertIndex-=1),{index:insertIndex,parent:newParent}}}BpmnOrderingProvider.$inject=["eventBus","canvas","translate"],(0,_inherits.default)(BpmnOrderingProvider,_OrderingProvider.default)},{"../modeling/util/ModelingUtil":75,"diagram-js/lib/features/ordering/OrderingProvider":159,inherits:218,"min-dash":219}],77:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _translate=_interopRequireDefault(require("diagram-js/lib/i18n/translate")),_BpmnOrderingProvider=_interopRequireDefault(require("./BpmnOrderingProvider"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _default={__depends__:[_translate.default],__init__:["bpmnOrderingProvider"],bpmnOrderingProvider:["type",_BpmnOrderingProvider.default]};exports.default=_default},{"./BpmnOrderingProvider":76,"diagram-js/lib/i18n/translate":184}],78:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BpmnReplace;var _minDash=require("min-dash"),_ModelUtil=require("../../util/ModelUtil"),_ModelingUtil=require("../modeling/util/ModelingUtil"),_DiUtil=require("../../util/DiUtil"),_ModdleCopy=require("../copy-paste/ModdleCopy");var CUSTOM_PROPERTIES=["cancelActivity","instantiate","eventGatewayType","triggeredByEvent","isInterrupting"];function BpmnReplace(bpmnFactory,elementFactory,moddleCopy,modeling,replace,rules,selection){this.replaceElement=function(element,target,hints){hints=hints||{};var type=target.type,oldBusinessObject=element.businessObject;if(isSubProcess(oldBusinessObject)&&"bpmn:SubProcess"===type&&function(element,target){var oldCollapsed=element&&(0,_minDash.has)(element,"collapsed")?element.collapsed:!(0,_DiUtil.isExpanded)(element);return oldCollapsed!==(target&&((0,_minDash.has)(target,"collapsed")||(0,_minDash.has)(target,"isExpanded"))?(0,_minDash.has)(target,"collapsed")?target.collapsed:!target.isExpanded:oldCollapsed)&&(element.collapsed=oldCollapsed,!0)}(element,target))return modeling.toggleCollapse(element),element;var a2,newBusinessObject=bpmnFactory.create(type),newElement={type,businessObject:newBusinessObject},elementProps=(0,_ModdleCopy.getPropertyNames)(oldBusinessObject.$descriptor),newElementProps=(0,_ModdleCopy.getPropertyNames)(newBusinessObject.$descriptor,!0),copyProps=(a2=newElementProps,elementProps.filter((function(el){return-1!==a2.indexOf(el)})));(0,_minDash.assign)(newBusinessObject,(0,_minDash.pick)(target,CUSTOM_PROPERTIES));var properties=(0,_minDash.filter)(copyProps,(function(propertyName){return"eventDefinitions"===propertyName?hasEventDefinition(element,target.eventDefinitionType):"loopCharacteristics"===propertyName?!(0,_DiUtil.isEventSubProcess)(newBusinessObject):!(0,_minDash.has)(newBusinessObject,propertyName)&&(("processRef"!==propertyName||!1!==target.isExpanded)&&"triggeredByEvent"!==propertyName)}));return newBusinessObject=moddleCopy.copyElement(oldBusinessObject,newBusinessObject,properties),target.eventDefinitionType&&(hasEventDefinition(newBusinessObject,target.eventDefinitionType)||(newElement.eventDefinitionType=target.eventDefinitionType,newElement.eventDefinitionAttrs=target.eventDefinitionAttrs)),(0,_ModelUtil.is)(oldBusinessObject,"bpmn:Activity")&&(isSubProcess(oldBusinessObject)?newElement.isExpanded=(0,_DiUtil.isExpanded)(oldBusinessObject):target&&(0,_minDash.has)(target,"isExpanded")&&(newElement.isExpanded=target.isExpanded),(0,_DiUtil.isExpanded)(oldBusinessObject)&&!(0,_ModelUtil.is)(oldBusinessObject,"bpmn:Task")&&newElement.isExpanded&&(newElement.width=element.width,newElement.height=element.height)),isSubProcess(oldBusinessObject)&&!isSubProcess(newBusinessObject)&&(hints.moveChildren=!1),(0,_ModelUtil.is)(oldBusinessObject,"bpmn:Participant")&&(!0===target.isExpanded?newBusinessObject.processRef=bpmnFactory.create("bpmn:Process"):hints.moveChildren=!1,newElement.width=element.width,newElement.height=elementFactory._getDefaultSize(newBusinessObject).height),rules.allowed("shape.resize",{shape:newBusinessObject})||(newElement.height=elementFactory._getDefaultSize(newBusinessObject).height,newElement.width=elementFactory._getDefaultSize(newBusinessObject).width),newBusinessObject.name=oldBusinessObject.name,(0,_ModelingUtil.isAny)(oldBusinessObject,["bpmn:ExclusiveGateway","bpmn:InclusiveGateway","bpmn:Activity"])&&(0,_ModelingUtil.isAny)(newBusinessObject,["bpmn:ExclusiveGateway","bpmn:InclusiveGateway","bpmn:Activity"])&&(newBusinessObject.default=oldBusinessObject.default),target.host&&!(0,_ModelUtil.is)(oldBusinessObject,"bpmn:BoundaryEvent")&&(0,_ModelUtil.is)(newBusinessObject,"bpmn:BoundaryEvent")&&(newElement.host=target.host),"bpmn:DataStoreReference"!==newElement.type&&"bpmn:DataObjectReference"!==newElement.type||(newElement.x=element.x+(element.width-newElement.width)/2),newElement.di={},function(source,target,properties){(0,_minDash.isArray)(properties)||(properties=[properties]),(0,_minDash.forEach)(properties,(function(property){(0,_minDash.isUndefined)(source[property])||(target[property]=source[property])}))}(oldBusinessObject.di,newElement.di,["fill","stroke","background-color","border-color","color"]),newElement=replace.replaceElement(element,newElement,hints),!1!==hints.select&&selection.select(newElement),newElement}}function isSubProcess(bo){return(0,_ModelUtil.is)(bo,"bpmn:SubProcess")}function hasEventDefinition(element,type){var bo=(0,_ModelUtil.getBusinessObject)(element);return type&&bo.get("eventDefinitions").some((function(definition){return(0,_ModelUtil.is)(definition,type)}))}BpmnReplace.$inject=["bpmnFactory","elementFactory","moddleCopy","modeling","replace","rules","selection"]},{"../../util/DiUtil":89,"../../util/ModelUtil":91,"../copy-paste/ModdleCopy":12,"../modeling/util/ModelingUtil":75,"min-dash":219}],79:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _copyPaste=_interopRequireDefault(require("../copy-paste")),_replace=_interopRequireDefault(require("diagram-js/lib/features/replace")),_selection=_interopRequireDefault(require("diagram-js/lib/features/selection")),_BpmnReplace=_interopRequireDefault(require("./BpmnReplace"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _default={__depends__:[_copyPaste.default,_replace.default,_selection.default],bpmnReplace:["type",_BpmnReplace.default]};exports.default=_default},{"../copy-paste":13,"./BpmnReplace":78,"diagram-js/lib/features/replace":167,"diagram-js/lib/features/selection":175}],80:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BpmnRules;var _minDash=require("min-dash"),_inherits=_interopRequireDefault(require("inherits")),_ModelUtil=require("../../util/ModelUtil"),_ModelingUtil=require("../modeling/util/ModelingUtil"),_LabelUtil=require("../../util/LabelUtil"),_DiUtil=require("../../util/DiUtil"),_RuleProvider=_interopRequireDefault(require("diagram-js/lib/features/rules/RuleProvider")),_BpmnSnappingUtil=require("../snapping/BpmnSnappingUtil");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function BpmnRules(eventBus){_RuleProvider.default.call(this,eventBus)}function nonExistingOrLabel(element){return!element||(0,_LabelUtil.isLabel)(element)}function getOrganizationalParent(element){do{if((0,_ModelUtil.is)(element,"bpmn:Process"))return(0,_ModelUtil.getBusinessObject)(element);if((0,_ModelUtil.is)(element,"bpmn:Participant"))return(0,_ModelUtil.getBusinessObject)(element).processRef||(0,_ModelUtil.getBusinessObject)(element)}while(element=element.parent)}function isTextAnnotation(element){return(0,_ModelUtil.is)(element,"bpmn:TextAnnotation")}function isGroup(element){return(0,_ModelUtil.is)(element,"bpmn:Group")&&!element.labelTarget}function isCompensationBoundary(element){return(0,_ModelUtil.is)(element,"bpmn:BoundaryEvent")&&hasEventDefinition(element,"bpmn:CompensateEventDefinition")}function isForCompensation(e){return(0,_ModelUtil.getBusinessObject)(e).isForCompensation}function getScopeParent(element){for(var parent=element;parent=parent.parent;){if((0,_ModelUtil.is)(parent,"bpmn:FlowElementsContainer"))return(0,_ModelUtil.getBusinessObject)(parent);if((0,_ModelUtil.is)(parent,"bpmn:Participant"))return(0,_ModelUtil.getBusinessObject)(parent).processRef}return null}function hasEventDefinition(element,eventDefinition){var bo=(0,_ModelUtil.getBusinessObject)(element);return!!(0,_minDash.find)(bo.eventDefinitions||[],(function(definition){return(0,_ModelUtil.is)(definition,eventDefinition)}))}function hasEventDefinitionOrNone(element,eventDefinition){return((0,_ModelUtil.getBusinessObject)(element).eventDefinitions||[]).every((function(definition){return(0,_ModelUtil.is)(definition,eventDefinition)}))}function isEventBasedTarget(element){return(0,_ModelUtil.is)(element,"bpmn:ReceiveTask")||(0,_ModelUtil.is)(element,"bpmn:IntermediateCatchEvent")&&(hasEventDefinition(element,"bpmn:MessageEventDefinition")||hasEventDefinition(element,"bpmn:TimerEventDefinition")||hasEventDefinition(element,"bpmn:ConditionalEventDefinition")||hasEventDefinition(element,"bpmn:SignalEventDefinition"))}function isConnection(element){return element.waypoints}function isParent(possibleParent,element){return-1!==function(element){for(var parents=[];element;)(element=element.parent)&&parents.push(element);return parents}(element).indexOf(possibleParent)}function canConnect(source,target,connection){if(nonExistingOrLabel(source)||nonExistingOrLabel(target))return null;if(!(0,_ModelUtil.is)(connection,"bpmn:DataAssociation")){if(canConnectMessageFlow(source,target))return{type:"bpmn:MessageFlow"};if(canConnectSequenceFlow(source,target))return{type:"bpmn:SequenceFlow"}}var connectDataAssociation=canConnectDataAssociation(source,target);return connectDataAssociation||(isCompensationBoundary(source)&&isForCompensation(target)?{type:"bpmn:Association",associationDirection:"One"}:!!canConnectAssociation(source,target)&&{type:"bpmn:Association"})}function canDrop(element,target,position){return!(!(0,_LabelUtil.isLabel)(element)&&!isGroup(element))||!((0,_ModelUtil.is)(target,"bpmn:Participant")&&!(0,_DiUtil.isExpanded)(target))&&((0,_ModelUtil.is)(element,"bpmn:Participant")?(0,_ModelUtil.is)(target,"bpmn:Process")||(0,_ModelUtil.is)(target,"bpmn:Collaboration"):(0,_ModelingUtil.isAny)(element,["bpmn:DataInput","bpmn:DataOutput"])&&element.parent?target===element.parent:(0,_ModelUtil.is)(element,"bpmn:Lane")?(0,_ModelUtil.is)(target,"bpmn:Participant")||(0,_ModelUtil.is)(target,"bpmn:Lane"):!((0,_ModelUtil.is)(element,"bpmn:BoundaryEvent")&&(event=element,!(0,_ModelUtil.getBusinessObject)(event).cancelActivity||!hasNoEventDefinition(event)&&!hasCommonBoundaryIntermediateEventDefinition(event)))&&((0,_ModelUtil.is)(element,"bpmn:FlowElement")&&!(0,_ModelUtil.is)(element,"bpmn:DataStoreReference")?(0,_ModelUtil.is)(target,"bpmn:FlowElementsContainer")?(0,_DiUtil.isExpanded)(target):(0,_ModelingUtil.isAny)(target,["bpmn:Participant","bpmn:Lane"]):(0,_ModelUtil.is)(element,"bpmn:DataStoreReference")&&(0,_ModelUtil.is)(target,"bpmn:Collaboration")?(0,_minDash.some)((0,_ModelUtil.getBusinessObject)(target).get("participants"),(function(participant){return!!participant.get("processRef")})):(0,_ModelingUtil.isAny)(element,["bpmn:Artifact","bpmn:DataAssociation","bpmn:DataStoreReference"])?(0,_ModelingUtil.isAny)(target,["bpmn:Collaboration","bpmn:Lane","bpmn:Participant","bpmn:Process","bpmn:SubProcess"]):!!(0,_ModelUtil.is)(element,"bpmn:MessageFlow")&&((0,_ModelUtil.is)(target,"bpmn:Collaboration")||element.source.parent==target||element.target.parent==target)));var event}function isLane(element){return(0,_ModelUtil.is)(element,"bpmn:Lane")}function isBoundaryCandidate(element){return!!function(element){return!(0,_LabelUtil.isLabel)(element)&&(0,_ModelUtil.is)(element,"bpmn:BoundaryEvent")}(element)||(!(!(0,_ModelUtil.is)(element,"bpmn:IntermediateThrowEvent")||!hasNoEventDefinition(element))||(0,_ModelUtil.is)(element,"bpmn:IntermediateCatchEvent")&&hasCommonBoundaryIntermediateEventDefinition(element))}function hasNoEventDefinition(element){var bo=(0,_ModelUtil.getBusinessObject)(element);return bo&&!(bo.eventDefinitions&&bo.eventDefinitions.length)}function hasCommonBoundaryIntermediateEventDefinition(element){return hasOneOfEventDefinitions(element,["bpmn:MessageEventDefinition","bpmn:TimerEventDefinition","bpmn:SignalEventDefinition","bpmn:ConditionalEventDefinition"])}function hasOneOfEventDefinitions(element,eventDefinitions){return eventDefinitions.some((function(definition){return hasEventDefinition(element,definition)}))}function canAttach(elements,target,source,position){if(Array.isArray(elements)||(elements=[elements]),1!==elements.length)return!1;var element=elements[0];return!(0,_LabelUtil.isLabel)(element)&&(!!isBoundaryCandidate(element)&&(!(0,_DiUtil.isEventSubProcess)(target)&&(!(!(0,_ModelUtil.is)(target,"bpmn:Activity")||isForCompensation(target))&&(!(position&&!(0,_BpmnSnappingUtil.getBoundaryAttachment)(position,target))&&(!function(element){return(0,_ModelUtil.is)(element,"bpmn:ReceiveTask")&&(0,_minDash.find)(element.incoming,(function(incoming){return(0,_ModelUtil.is)(incoming.source,"bpmn:EventBasedGateway")}))}(target)&&"attach")))))}function canReplace(elements,target,position){if(!target)return!1;var canExecute={replacements:[]};return(0,_minDash.forEach)(elements,(function(element){(0,_DiUtil.isEventSubProcess)(target)||(0,_ModelUtil.is)(element,"bpmn:StartEvent")&&"label"!==element.type&&canDrop(element,target)&&((0,_DiUtil.isInterrupting)(element)||canExecute.replacements.push({oldElementId:element.id,newElementType:"bpmn:StartEvent"}),((0,_DiUtil.hasErrorEventDefinition)(element)||(0,_DiUtil.hasEscalationEventDefinition)(element)||(0,_DiUtil.hasCompensateEventDefinition)(element))&&canExecute.replacements.push({oldElementId:element.id,newElementType:"bpmn:StartEvent"}),hasOneOfEventDefinitions(element,["bpmn:MessageEventDefinition","bpmn:TimerEventDefinition","bpmn:SignalEventDefinition","bpmn:ConditionalEventDefinition"])&&(0,_ModelUtil.is)(target,"bpmn:SubProcess")&&canExecute.replacements.push({oldElementId:element.id,newElementType:"bpmn:StartEvent"})),(0,_ModelUtil.is)(target,"bpmn:Transaction")||hasEventDefinition(element,"bpmn:CancelEventDefinition")&&"label"!==element.type&&((0,_ModelUtil.is)(element,"bpmn:EndEvent")&&canDrop(element,target)&&canExecute.replacements.push({oldElementId:element.id,newElementType:"bpmn:EndEvent"}),(0,_ModelUtil.is)(element,"bpmn:BoundaryEvent")&&canAttach(element,target,0,position)&&canExecute.replacements.push({oldElementId:element.id,newElementType:"bpmn:BoundaryEvent"}))})),!!canExecute.replacements.length&&canExecute}function canMove(elements,target){return!(0,_minDash.some)(elements,isLane)&&(!target||elements.every((function(element){return canDrop(element,target)})))}function canCreate(shape,target,source,position){return!!target&&(!(!(0,_LabelUtil.isLabel)(shape)&&!isGroup(shape))||source!==target&&((!source||!isParent(source,target))&&(canDrop(shape,target)||canInsert(shape,target,position))))}function canResize(shape,newBounds){return(0,_ModelUtil.is)(shape,"bpmn:SubProcess")?(0,_DiUtil.isExpanded)(shape)&&(!newBounds||newBounds.width>=100&&newBounds.height>=80):(0,_ModelUtil.is)(shape,"bpmn:Lane")?!newBounds||newBounds.width>=130&&newBounds.height>=60:(0,_ModelUtil.is)(shape,"bpmn:Participant")?!newBounds||newBounds.width>=250&&newBounds.height>=50:!!isTextAnnotation(shape)||!!isGroup(shape)}function canConnectAssociation(source,target){return!isConnection(source)&&!isConnection(target)&&(!(!isCompensationBoundary(source)||!isForCompensation(target))||!isParent(target,source)&&!isParent(source,target)&&(!!function(source,target){var sourceTextAnnotation=isTextAnnotation(source),targetTextAnnotation=isTextAnnotation(target);return(sourceTextAnnotation||targetTextAnnotation)&&sourceTextAnnotation!==targetTextAnnotation}(source,target)||!!canConnectDataAssociation(source,target)))}function canConnectMessageFlow(source,target){return!(getRootElement(source)&&!getRootElement(target))&&(element=source,(0,_ModelUtil.is)(element,"bpmn:InteractionNode")&&!(0,_ModelUtil.is)(element,"bpmn:BoundaryEvent")&&(!(0,_ModelUtil.is)(element,"bpmn:Event")||(0,_ModelUtil.is)(element,"bpmn:ThrowEvent")&&hasEventDefinitionOrNone(element,"bpmn:MessageEventDefinition"))&&function(element){return(0,_ModelUtil.is)(element,"bpmn:InteractionNode")&&!isForCompensation(element)&&(!(0,_ModelUtil.is)(element,"bpmn:Event")||(0,_ModelUtil.is)(element,"bpmn:CatchEvent")&&hasEventDefinitionOrNone(element,"bpmn:MessageEventDefinition"))&&!((0,_ModelUtil.is)(element,"bpmn:BoundaryEvent")&&!hasEventDefinition(element,"bpmn:MessageEventDefinition"))}(target)&&(b=target,!(getOrganizationalParent(source)===getOrganizationalParent(b))));var b,element}function canConnectSequenceFlow(source,target){return!(isEventBasedTarget(target)&&target.incoming.length>0&&(connections=target.incoming,(connections=connections||[]).some(isOutgoingEventBasedGatewayConnection))&&!(0,_ModelUtil.is)(source,"bpmn:EventBasedGateway"))&&(element=source,(0,_ModelUtil.is)(element,"bpmn:FlowNode")&&!(0,_ModelUtil.is)(element,"bpmn:EndEvent")&&!(0,_DiUtil.isEventSubProcess)(element)&&!((0,_ModelUtil.is)(element,"bpmn:IntermediateThrowEvent")&&hasEventDefinition(element,"bpmn:LinkEventDefinition"))&&!isCompensationBoundary(element)&&!isForCompensation(element)&&function(element){return(0,_ModelUtil.is)(element,"bpmn:FlowNode")&&!(0,_ModelUtil.is)(element,"bpmn:StartEvent")&&!(0,_ModelUtil.is)(element,"bpmn:BoundaryEvent")&&!(0,_DiUtil.isEventSubProcess)(element)&&!((0,_ModelUtil.is)(element,"bpmn:IntermediateCatchEvent")&&hasEventDefinition(element,"bpmn:LinkEventDefinition"))&&!isForCompensation(element)}(target)&&(b=target,getScopeParent(source)===getScopeParent(b))&&!((0,_ModelUtil.is)(source,"bpmn:EventBasedGateway")&&!isEventBasedTarget(target)));var connections,b,element}function canConnectDataAssociation(source,target){return(0,_ModelingUtil.isAny)(source,["bpmn:DataObjectReference","bpmn:DataStoreReference"])&&(0,_ModelingUtil.isAny)(target,["bpmn:Activity","bpmn:ThrowEvent"])?{type:"bpmn:DataInputAssociation"}:!(!(0,_ModelingUtil.isAny)(target,["bpmn:DataObjectReference","bpmn:DataStoreReference"])||!(0,_ModelingUtil.isAny)(source,["bpmn:Activity","bpmn:CatchEvent"]))&&{type:"bpmn:DataOutputAssociation"}}function canInsert(shape,flow,position){if(!flow)return!1;if(Array.isArray(shape)){if(1!==shape.length)return!1;shape=shape[0]}return flow.source!==shape&&flow.target!==shape&&((0,_ModelingUtil.isAny)(flow,["bpmn:SequenceFlow","bpmn:MessageFlow"])&&!(0,_LabelUtil.isLabel)(flow)&&(0,_ModelUtil.is)(shape,"bpmn:FlowNode")&&!(0,_ModelUtil.is)(shape,"bpmn:BoundaryEvent")&&canDrop(shape,flow.parent))}function canCopy(elements,element){return!!(0,_LabelUtil.isLabel)(element)||!((0,_ModelUtil.is)(element,"bpmn:Lane")&&!function(elements,element){return elements&&element&&-1!==elements.indexOf(element)}(elements,element.parent))}function isOutgoingEventBasedGatewayConnection(connection){if(connection&&connection.source)return(0,_ModelUtil.is)(connection.source,"bpmn:EventBasedGateway")}function getRootElement(element){return(0,_ModelingUtil.getParent)(element,"bpmn:Process")||(0,_ModelingUtil.getParent)(element,"bpmn:Collaboration")}(0,_inherits.default)(BpmnRules,_RuleProvider.default),BpmnRules.$inject=["eventBus"],BpmnRules.prototype.init=function(){this.addRule("connection.start",(function(context){return function(element){if(nonExistingOrLabel(element))return null;return(0,_ModelingUtil.isAny)(element,["bpmn:FlowNode","bpmn:InteractionNode","bpmn:DataObjectReference","bpmn:DataStoreReference","bpmn:Group","bpmn:TextAnnotation"])}(context.source)})),this.addRule("connection.create",(function(context){var source=context.source,target=context.target,hints=context.hints||{},targetParent=hints.targetParent;if(hints.targetAttach)return!1;targetParent&&(target.parent=targetParent);try{return canConnect(source,target)}finally{targetParent&&(target.parent=null)}})),this.addRule("connection.reconnect",(function(context){var connection=context.connection;return canConnect(context.source,context.target,connection)})),this.addRule("connection.updateWaypoints",(function(context){return{type:context.connection.type}})),this.addRule("shape.resize",(function(context){return canResize(context.shape,context.newBounds)})),this.addRule("elements.create",(function(context){var elements=context.elements,position=context.position,target=context.target;return!(isConnection(target)&&!canInsert(elements,target,position))&&(0,_minDash.every)(elements,(function(element){return isConnection(element)?canConnect(element.source,element.target,element):element.host?canAttach(element,element.host,null,position):canCreate(element,target,null,position)}))})),this.addRule("elements.move",(function(context){var target=context.target,shapes=context.shapes,position=context.position;return canAttach(shapes,target,null,position)||canReplace(shapes,target,position)||canMove(shapes,target)||canInsert(shapes,target,position)})),this.addRule("shape.create",(function(context){return canCreate(context.shape,context.target,context.source,context.position)})),this.addRule("shape.attach",(function(context){return canAttach(context.shape,context.target,null,context.position)})),this.addRule("element.copy",(function(context){var element=context.element;return canCopy(context.elements,element)}))},BpmnRules.prototype.canConnectMessageFlow=canConnectMessageFlow,BpmnRules.prototype.canConnectSequenceFlow=canConnectSequenceFlow,BpmnRules.prototype.canConnectDataAssociation=canConnectDataAssociation,BpmnRules.prototype.canConnectAssociation=canConnectAssociation,BpmnRules.prototype.canMove=canMove,BpmnRules.prototype.canAttach=canAttach,BpmnRules.prototype.canReplace=canReplace,BpmnRules.prototype.canDrop=canDrop,BpmnRules.prototype.canInsert=canInsert,BpmnRules.prototype.canCreate=canCreate,BpmnRules.prototype.canConnect=canConnect,BpmnRules.prototype.canResize=canResize,BpmnRules.prototype.canCopy=canCopy},{"../../util/DiUtil":89,"../../util/LabelUtil":90,"../../util/ModelUtil":91,"../modeling/util/ModelingUtil":75,"../snapping/BpmnSnappingUtil":82,"diagram-js/lib/features/rules/RuleProvider":169,inherits:218,"min-dash":219}],81:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _rules=_interopRequireDefault(require("diagram-js/lib/features/rules")),_BpmnRules=_interopRequireDefault(require("./BpmnRules"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _default={__depends__:[_rules.default],__init__:["bpmnRules"],bpmnRules:["type",_BpmnRules.default]};exports.default=_default},{"./BpmnRules":80,"diagram-js/lib/features/rules":171}],82:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getBoundaryAttachment=function(position,targetBounds){var orientation=(0,_LayoutUtil.getOrientation)(position,targetBounds,-15);return"intersect"!==orientation?orientation:null};var _LayoutUtil=require("diagram-js/lib/layout/LayoutUtil")},{"diagram-js/lib/layout/LayoutUtil":188}],83:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BpmnImporter;var _minDash=require("min-dash"),_ModelUtil=require("../util/ModelUtil"),_LabelUtil=require("../util/LabelUtil"),_LayoutUtil=require("diagram-js/lib/layout/LayoutUtil"),_DiUtil=require("../util/DiUtil"),_LabelUtil2=require("../features/label-editing/LabelUtil"),_Util=require("./Util");function elementData(semantic,attrs){return(0,_minDash.assign)({id:semantic.id,type:semantic.$type,businessObject:semantic},attrs)}function getWaypoints(bo,source,target){var waypoints=bo.di.waypoint;return!waypoints||waypoints.length<2?[(0,_LayoutUtil.getMid)(source),(0,_LayoutUtil.getMid)(target)]:waypoints.map((function(p){return{x:p.x,y:p.y}}))}function notYetDrawn(translate,semantic,refSemantic,property){return new Error(translate("element {element} referenced by {referenced}#{property} not yet drawn",{element:(0,_Util.elementToString)(refSemantic),referenced:(0,_Util.elementToString)(semantic),property}))}function BpmnImporter(eventBus,canvas,elementFactory,elementRegistry,translate,textRenderer){this._eventBus=eventBus,this._canvas=canvas,this._elementFactory=elementFactory,this._elementRegistry=elementRegistry,this._translate=translate,this._textRenderer=textRenderer}BpmnImporter.$inject=["eventBus","canvas","elementFactory","elementRegistry","translate","textRenderer"],BpmnImporter.prototype.add=function(semantic,parentElement){var element,hidden,parentIndex,bbox,point,x,y,di=semantic.di,translate=this._translate;if((0,_ModelUtil.is)(di,"bpmndi:BPMNPlane"))element=this._elementFactory.createRoot(elementData(semantic)),this._canvas.setRootElement(element);else if((0,_ModelUtil.is)(di,"bpmndi:BPMNShape")){var collapsed=!(0,_DiUtil.isExpanded)(semantic),isFrame=function(semantic){return(0,_ModelUtil.is)(semantic,"bpmn:Group")}(semantic);hidden=parentElement&&(parentElement.hidden||parentElement.collapsed);var bounds=semantic.di.bounds;element=this._elementFactory.createShape(elementData(semantic,{collapsed,hidden,x:Math.round(bounds.x),y:Math.round(bounds.y),width:Math.round(bounds.width),height:Math.round(bounds.height),isFrame})),(0,_ModelUtil.is)(semantic,"bpmn:BoundaryEvent")&&this._attachBoundary(semantic,element),(0,_ModelUtil.is)(semantic,"bpmn:Lane")&&(parentIndex=0),(0,_ModelUtil.is)(semantic,"bpmn:DataStoreReference")&&(bbox=parentElement,point=(0,_LayoutUtil.getMid)(bounds),x=point.x,y=point.y,x>=bbox.x&&x<=bbox.x+bbox.width&&y>=bbox.y&&y<=bbox.y+bbox.height||(parentElement=this._canvas.getRootElement())),this._canvas.addShape(element,parentElement,parentIndex)}else{if(!(0,_ModelUtil.is)(di,"bpmndi:BPMNEdge"))throw new Error(translate("unknown di {di} for element {semantic}",{di:(0,_Util.elementToString)(di),semantic:(0,_Util.elementToString)(semantic)}));var source=this._getSource(semantic),target=this._getTarget(semantic);hidden=parentElement&&(parentElement.hidden||parentElement.collapsed),element=this._elementFactory.createConnection(elementData(semantic,{hidden,source,target,waypoints:getWaypoints(semantic,source,target)})),(0,_ModelUtil.is)(semantic,"bpmn:DataAssociation")&&(parentElement=null),(0,_ModelUtil.is)(semantic,"bpmn:SequenceFlow")&&(parentIndex=0),this._canvas.addConnection(element,parentElement,parentIndex)}return(0,_LabelUtil.isLabelExternal)(semantic)&&(0,_LabelUtil2.getLabel)(element)&&this.addLabel(semantic,element),this._eventBus.fire("bpmnElement.added",{element}),element},BpmnImporter.prototype._attachBoundary=function(boundarySemantic,boundaryElement){var translate=this._translate,hostSemantic=boundarySemantic.attachedToRef;if(!hostSemantic)throw new Error(translate("missing {semantic}#attachedToRef",{semantic:(0,_Util.elementToString)(boundarySemantic)}));var host=this._elementRegistry.get(hostSemantic.id),attachers=host&&host.attachers;if(!host)throw notYetDrawn(translate,boundarySemantic,hostSemantic,"attachedToRef");boundaryElement.host=host,attachers||(host.attachers=attachers=[]),-1===attachers.indexOf(boundaryElement)&&attachers.push(boundaryElement)},BpmnImporter.prototype.addLabel=function(semantic,element){var bounds,text,label;return bounds=(0,_LabelUtil.getExternalLabelBounds)(semantic,element),(text=(0,_LabelUtil2.getLabel)(element))&&(bounds=this._textRenderer.getExternalLabelBounds(bounds,text)),label=this._elementFactory.createLabel(elementData(semantic,{id:semantic.id+"_label",labelTarget:element,type:"label",hidden:element.hidden||!(0,_LabelUtil2.getLabel)(element),x:Math.round(bounds.x),y:Math.round(bounds.y),width:Math.round(bounds.width),height:Math.round(bounds.height)})),this._canvas.addShape(label,element.parent)},BpmnImporter.prototype._getEnd=function(semantic,side){var element,refSemantic,type=semantic.$type,translate=this._translate;if(refSemantic=semantic[side+"Ref"],"source"===side&&"bpmn:DataInputAssociation"===type&&(refSemantic=refSemantic&&refSemantic[0]),("source"===side&&"bpmn:DataOutputAssociation"===type||"target"===side&&"bpmn:DataInputAssociation"===type)&&(refSemantic=semantic.$parent),element=refSemantic&&this._getElement(refSemantic))return element;throw refSemantic?notYetDrawn(translate,semantic,refSemantic,side+"Ref"):new Error(translate("{semantic}#{side} Ref not specified",{semantic:(0,_Util.elementToString)(semantic),side}))},BpmnImporter.prototype._getSource=function(semantic){return this._getEnd(semantic,"source")},BpmnImporter.prototype._getTarget=function(semantic){return this._getEnd(semantic,"target")},BpmnImporter.prototype._getElement=function(semantic){return this._elementRegistry.get(semantic.id)}},{"../features/label-editing/LabelUtil":16,"../util/DiUtil":89,"../util/LabelUtil":90,"../util/ModelUtil":91,"./Util":86,"diagram-js/lib/layout/LayoutUtil":188,"min-dash":219}],84:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(handler,translate){var handledElements={},deferred=[];function contextual(fn,ctx){return function(e){fn(e,ctx)}}function handled(element){handledElements[element.id]=element}function visitIfDi(element,ctx){try{var gfx=element.di&&function(element,ctx){if(element.gfx)throw new Error(translate("already rendered {element}",{element:(0,_Util.elementToString)(element)}));return handler.element(element,ctx)}(element,ctx);return handled(element),gfx}catch(e){logError(e.message,{element,error:e}),console.error(translate("failed to import {element}",{element:(0,_Util.elementToString)(element)})),console.error(e)}}function logError(message,context){handler.error(message,context)}function registerDi(di){var bpmnElement=di.bpmnElement;bpmnElement?bpmnElement.di?logError(translate("multiple DI elements defined for {element}",{element:(0,_Util.elementToString)(bpmnElement)}),{element:bpmnElement}):(diRefs.bind(bpmnElement,"di"),bpmnElement.di=di):logError(translate("no bpmnElement referenced in {element}",{element:(0,_Util.elementToString)(di)}),{element:di})}function handleDiagram(diagram){var plane;registerDi(plane=diagram.plane),(0,_minDash.forEach)(plane.planeElement,handlePlaneElement)}function handlePlaneElement(planeElement){registerDi(planeElement)}function handleDeferred(){for(;deferred.length;)deferred.shift()()}function handleProcess(process,context){handleFlowElementsContainer(process,context),handleIoSpecification(process.ioSpecification,context),handleArtifacts(process.artifacts,context),handled(process)}function handleMessageFlow(messageFlow,context){visitIfDi(messageFlow,context)}function handleDataAssociation(association,context){visitIfDi(association,context)}function handleDataInput(dataInput,context){visitIfDi(dataInput,context)}function handleDataOutput(dataOutput,context){visitIfDi(dataOutput,context)}function handleArtifact(artifact,context){visitIfDi(artifact,context)}function handleArtifacts(artifacts,context){(0,_minDash.forEach)(artifacts,(function(e){is(e,"bpmn:Association")?deferred.push((function(){handleArtifact(e,context)})):handleArtifact(e,context)}))}function handleIoSpecification(ioSpecification,context){ioSpecification&&((0,_minDash.forEach)(ioSpecification.dataInputs,contextual(handleDataInput,context)),(0,_minDash.forEach)(ioSpecification.dataOutputs,contextual(handleDataOutput,context)))}function handleSubProcess(subProcess,context){handleFlowElementsContainer(subProcess,context),handleArtifacts(subProcess.artifacts,context)}function handleFlowNode(flowNode,context){var childCtx=visitIfDi(flowNode,context);is(flowNode,"bpmn:SubProcess")&&handleSubProcess(flowNode,childCtx||context),is(flowNode,"bpmn:Activity")&&handleIoSpecification(flowNode.ioSpecification,context),deferred.push((function(){(0,_minDash.forEach)(flowNode.dataInputAssociations,contextual(handleDataAssociation,context)),(0,_minDash.forEach)(flowNode.dataOutputAssociations,contextual(handleDataAssociation,context))}))}function handleDataElement(dataObject,context){visitIfDi(dataObject,context)}function handleLane(lane,context){deferred.push((function(){var newContext=visitIfDi(lane,context);lane.childLaneSet&&handleLaneSet(lane.childLaneSet,newContext||context),function(lane){(0,_minDash.forEach)(lane.flowNodeRef,(function(flowNode){var lanes=flowNode.get("lanes");lanes&&lanes.push(lane)}))}(lane)}))}function handleLaneSet(laneSet,context){(0,_minDash.forEach)(laneSet.lanes,contextual(handleLane,context))}function handleFlowElementsContainer(container,context){!function(flowElements,context){(0,_minDash.forEach)(flowElements,(function(e){is(e,"bpmn:SequenceFlow")?deferred.push((function(){!function(sequenceFlow,context){visitIfDi(sequenceFlow,context)}(e,context)})):is(e,"bpmn:BoundaryEvent")?deferred.unshift((function(){handleFlowNode(e,context)})):is(e,"bpmn:FlowNode")?handleFlowNode(e,context):is(e,"bpmn:DataObject")||(is(e,"bpmn:DataStoreReference")||is(e,"bpmn:DataObjectReference")?handleDataElement(e,context):logError(translate("unrecognized flowElement {element} in context {context}",{element:(0,_Util.elementToString)(e),context:context?(0,_Util.elementToString)(context.businessObject):"null"}),{element:e,context}))}))}(container.flowElements,context),container.laneSets&&function(laneSets,context){(0,_minDash.forEach)(laneSets,contextual(handleLaneSet,context))}(container.laneSets,context)}function handleParticipant(participant,context){var newCtx=visitIfDi(participant,context),process=participant.processRef;process&&handleProcess(process,newCtx||context)}return{handleDeferred,handleDefinitions:function(definitions,diagram){var diagrams=definitions.diagrams;if(diagram&&-1===diagrams.indexOf(diagram))throw new Error(translate("diagram not part of bpmn:Definitions"));if(!diagram&&diagrams&&diagrams.length&&(diagram=diagrams[0]),!diagram)throw new Error(translate("no diagram to display"));handleDiagram(diagram);var plane=diagram.plane;if(!plane)throw new Error(translate("no plane for {element}",{element:(0,_Util.elementToString)(diagram)}));var rootElement=plane.bpmnElement;if(!rootElement){if(!(rootElement=function(definitions){return(0,_minDash.find)(definitions.rootElements,(function(e){return is(e,"bpmn:Process")||is(e,"bpmn:Collaboration")}))}(definitions)))throw new Error(translate("no process or collaboration to display"));logError(translate("correcting missing bpmnElement on {plane} to {rootElement}",{plane:(0,_Util.elementToString)(plane),rootElement:(0,_Util.elementToString)(rootElement)})),plane.bpmnElement=rootElement,registerDi(plane)}var collaboration,ctx=function(element,diagram){return handler.root(element,diagram)}(rootElement,plane);if(is(rootElement,"bpmn:Process"))handleProcess(rootElement,ctx);else{if(!is(rootElement,"bpmn:Collaboration"))throw new Error(translate("unsupported bpmnElement for {plane}: {rootElement}",{plane:(0,_Util.elementToString)(plane),rootElement:(0,_Util.elementToString)(rootElement)}));collaboration=rootElement,(0,_minDash.forEach)(collaboration.participants,contextual(handleParticipant)),handleArtifacts(collaboration.artifacts),deferred.push((function(){var messageFlows,context;messageFlows=collaboration.messageFlows,(0,_minDash.forEach)(messageFlows,contextual(handleMessageFlow,context))})),function(rootElements,ctx){(0,_minDash.filter)(rootElements,(function(e){return!handledElements[e.id]&&is(e,"bpmn:Process")&&e.laneSets})).forEach(contextual(handleProcess,ctx))}(definitions.rootElements,ctx)}handleDeferred()},handleSubProcess,registerDi}};var obj,_minDash=require("min-dash"),_objectRefs=(obj=require("object-refs"))&&obj.__esModule?obj:{default:obj},_Util=require("./Util");var diRefs=new _objectRefs.default({name:"bpmnElement",enumerable:!0},{name:"di",configurable:!0});function is(element,type){return element.$instanceOf(type)}},{"./Util":86,"min-dash":219,"object-refs":223}],85:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.importBpmnDiagram=function(diagram,definitions,bpmnDiagram){var importer,eventBus,translate,warnings=[];return new Promise((function(resolve,reject){try{return importer=diagram.get("bpmnImporter"),eventBus=diagram.get("eventBus"),translate=diagram.get("translate"),eventBus.fire("import.render.start",{definitions}),function(definitions,bpmnDiagram){var visitor={root:function(element){return importer.add(element)},element:function(element,parentShape){return importer.add(element,parentShape)},error:function(message,context){warnings.push({message,context})}};new _BpmnTreeWalker.default(visitor,translate).handleDefinitions(definitions,bpmnDiagram)}(definitions,bpmnDiagram),eventBus.fire("import.render.complete",{error:void 0,warnings}),resolve({warnings})}catch(e){return e.warnings=warnings,reject(e)}}))};var obj,_BpmnTreeWalker=(obj=require("./BpmnTreeWalker"))&&obj.__esModule?obj:{default:obj}},{"./BpmnTreeWalker":84}],86:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.elementToString=function(e){if(!e)return"<null>";return"<"+e.$type+(e.id?' id="'+e.id:"")+'" />'}},{}],87:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _translate=_interopRequireDefault(require("diagram-js/lib/i18n/translate")),_BpmnImporter=_interopRequireDefault(require("./BpmnImporter"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _default={__depends__:[_translate.default],bpmnImporter:["type",_BpmnImporter.default]};exports.default=_default},{"./BpmnImporter":83,"diagram-js/lib/i18n/translate":184}],88:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.wrapForCompatibility=function(api){return function(){if(!window.Promise)throw new Error("Promises is not supported in this environment. Please polyfill Promise.");var argLen=arguments.length;if(!(argLen>=1&&(0,_minDash.isFunction)(arguments[argLen-1])))return api.apply(this,arguments);var callback=arguments[argLen-1];console.warn(new Error("Passing callbacks to "+api.name+" is deprecated and will be removed in a future major release. Please switch to promises: https://bpmn.io/l/moving-to-promises.html"));var argsWithoutCallback=Array.prototype.slice.call(arguments,0,-1);api.apply(this,argsWithoutCallback).then((function(result){var firstKey=Object.keys(result)[0];return callback(null,result[firstKey])}),(function(err){return callback(err,err.warnings)}))}};var _minDash=require("min-dash")},{"min-dash":219}],89:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isExpanded=function(element){if((0,_ModelUtil.is)(element,"bpmn:CallActivity"))return!1;if((0,_ModelUtil.is)(element,"bpmn:SubProcess"))return(0,_ModelUtil.getBusinessObject)(element).di&&!!(0,_ModelUtil.getBusinessObject)(element).di.isExpanded;if((0,_ModelUtil.is)(element,"bpmn:Participant"))return!!(0,_ModelUtil.getBusinessObject)(element).processRef;return!0},exports.isInterrupting=function(element){return element&&!1!==(0,_ModelUtil.getBusinessObject)(element).isInterrupting},exports.isEventSubProcess=function(element){return element&&!!(0,_ModelUtil.getBusinessObject)(element).triggeredByEvent},exports.hasEventDefinition=hasEventDefinition,exports.hasErrorEventDefinition=function(element){return hasEventDefinition(element,"bpmn:ErrorEventDefinition")},exports.hasEscalationEventDefinition=function(element){return hasEventDefinition(element,"bpmn:EscalationEventDefinition")},exports.hasCompensateEventDefinition=function(element){return hasEventDefinition(element,"bpmn:CompensateEventDefinition")};var _ModelUtil=require("./ModelUtil"),_minDash=require("min-dash");function hasEventDefinition(element,eventType){var bo=(0,_ModelUtil.getBusinessObject)(element),hasEventDefinition=!1;return bo.eventDefinitions&&(0,_minDash.forEach)(bo.eventDefinitions,(function(event){(0,_ModelUtil.is)(event,eventType)&&(hasEventDefinition=!0)})),hasEventDefinition}},{"./ModelUtil":91,"min-dash":219}],90:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isLabelExternal=function(semantic){return(0,_ModelUtil.is)(semantic,"bpmn:Event")||(0,_ModelUtil.is)(semantic,"bpmn:Gateway")||(0,_ModelUtil.is)(semantic,"bpmn:DataStoreReference")||(0,_ModelUtil.is)(semantic,"bpmn:DataObjectReference")||(0,_ModelUtil.is)(semantic,"bpmn:DataInput")||(0,_ModelUtil.is)(semantic,"bpmn:DataOutput")||(0,_ModelUtil.is)(semantic,"bpmn:SequenceFlow")||(0,_ModelUtil.is)(semantic,"bpmn:MessageFlow")||(0,_ModelUtil.is)(semantic,"bpmn:Group")},exports.hasExternalLabel=function(element){return isLabel(element.label)},exports.getFlowLabelPosition=getFlowLabelPosition,exports.getWaypointsMid=getWaypointsMid,exports.getExternalLabelMid=getExternalLabelMid,exports.getExternalLabelBounds=function(semantic,element){var mid,size,bounds,label=semantic.di.label;label&&label.bounds?(bounds=label.bounds,size={width:Math.max(DEFAULT_LABEL_SIZE.width,bounds.width),height:bounds.height},mid={x:bounds.x+bounds.width/2,y:bounds.y+bounds.height/2}):(mid=getExternalLabelMid(element),size=DEFAULT_LABEL_SIZE);return(0,_minDash.assign)({x:mid.x-size.width/2,y:mid.y-size.height/2},size)},exports.isLabel=isLabel,exports.FLOW_LABEL_INDENT=exports.DEFAULT_LABEL_SIZE=void 0;var _minDash=require("min-dash"),_ModelUtil=require("./ModelUtil"),DEFAULT_LABEL_SIZE={width:90,height:20};exports.DEFAULT_LABEL_SIZE=DEFAULT_LABEL_SIZE;function getFlowLabelPosition(waypoints){var mid=waypoints.length/2-1,first=waypoints[Math.floor(mid)],second=waypoints[Math.ceil(mid+.01)],position=getWaypointsMid(waypoints),angle=Math.atan((second.y-first.y)/(second.x-first.x)),x=position.x,y=position.y;return Math.abs(angle)<Math.PI/2?y-=15:x+=15,{x,y}}function getWaypointsMid(waypoints){var mid=waypoints.length/2-1,first=waypoints[Math.floor(mid)],second=waypoints[Math.ceil(mid+.01)];return{x:first.x+(second.x-first.x)/2,y:first.y+(second.y-first.y)/2}}function getExternalLabelMid(element){return element.waypoints?getFlowLabelPosition(element.waypoints):(0,_ModelUtil.is)(element,"bpmn:Group")?{x:element.x+element.width/2,y:element.y+DEFAULT_LABEL_SIZE.height/2}:{x:element.x+element.width/2,y:element.y+element.height+DEFAULT_LABEL_SIZE.height/2}}function isLabel(element){return element&&!!element.labelTarget}exports.FLOW_LABEL_INDENT=15},{"./ModelUtil":91,"min-dash":219}],91:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.is=is,exports.isAny=function(element,types){return(0,_minDash.some)(types,(function(t){return is(element,t)}))},exports.getBusinessObject=getBusinessObject,exports.getDi=function(element){var bo=getBusinessObject(element);return bo&&bo.di};var _minDash=require("min-dash");function is(element,type){var bo=getBusinessObject(element);return bo&&"function"==typeof bo.$instanceOf&&bo.$instanceOf(type)}function getBusinessObject(element){return element&&element.businessObject||element}},{"min-dash":219}],92:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.open=function(){lightbox||(lightbox=(0,_minDom.domify)(LIGHTBOX_MARKUP),_minDom.delegate.bind(lightbox,".backdrop","click",(function(event){document.body.removeChild(lightbox)})));document.body.appendChild(lightbox)},exports.LINK_STYLES=exports.BPMNIO_IMG=void 0;var _minDom=require("min-dom"),BPMNIO_IMG='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14.02 5.57" width="53" height="21" style="vertical-align:middle"><path fill="currentColor" d="M1.88.92v.14c0 .41-.13.68-.4.8.33.14.46.44.46.86v.33c0 .61-.33.95-.95.95H0V0h.95c.65 0 .93.3.93.92zM.63.57v1.06h.24c.24 0 .38-.1.38-.43V.98c0-.28-.1-.4-.32-.4zm0 1.63v1.22h.36c.2 0 .32-.1.32-.39v-.35c0-.37-.12-.48-.4-.48H.63zM4.18.99v.52c0 .64-.31.98-.94.98h-.3V4h-.62V0h.92c.63 0 .94.35.94.99zM2.94.57v1.35h.3c.2 0 .3-.09.3-.37v-.6c0-.29-.1-.38-.3-.38h-.3zm2.89 2.27L6.25 0h.88v4h-.6V1.12L6.1 3.99h-.6l-.46-2.82v2.82h-.55V0h.87zM8.14 1.1V4h-.56V0h.79L9 2.4V0h.56v4h-.64zm2.49 2.29v.6h-.6v-.6zM12.12 1c0-.63.33-1 .95-1 .61 0 .95.37.95 1v2.04c0 .64-.34 1-.95 1-.62 0-.95-.37-.95-1zm.62 2.08c0 .28.13.39.33.39s.32-.1.32-.4V.98c0-.29-.12-.4-.32-.4s-.33.11-.33.4z"/><path fill="currentColor" d="M0 4.53h14.02v1.04H0zM11.08 0h.63v.62h-.63zm.63 4V1h-.63v2.98z"/></svg>';function css(attrs){return attrs.join(";")}exports.BPMNIO_IMG=BPMNIO_IMG;var LINK_STYLES=css(["color: #404040"]);exports.LINK_STYLES=LINK_STYLES;var lightbox,LIGHTBOX_MARKUP='<div class="bjs-powered-by-lightbox" style="'+css(["z-index: 1001","position: fixed","top: 0","left: 0","right: 0","bottom: 0"])+'"><div class="backdrop" style="'+css(["width: 100%","height: 100%","background: rgba(40,40,40,0.2)"])+'"></div><div class="notice" style="'+css(["position: absolute","left: 50%","top: 40%","transform: translate(-50%)","width: 260px","padding: 10px","background: white","box-shadow: 0 1px 4px rgba(0,0,0,0.3)","font-family: Helvetica, Arial, sans-serif","font-size: 14px","display: flex","line-height: 1.3"])+'"><a href="https://bpmn.io" target="_blank" rel="noopener" style="margin: 15px 20px 15px 10px; align-self: center;'+LINK_STYLES+'">'+BPMNIO_IMG+'</a><span>Web-based tooling for BPMN, DMN and CMMN diagrams powered by <a href="https://bpmn.io" target="_blank" rel="noopener">bpmn.io</a>.</span></div></div>'},{"min-dom":220}],93:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _minDash=require("min-dash"),_moddle=require("moddle"),_moddleXml=require("moddle-xml");function BpmnModdle(packages,options){_moddle.Moddle.call(this,packages,options)}BpmnModdle.prototype=Object.create(_moddle.Moddle.prototype),BpmnModdle.prototype.fromXML=function(xmlStr,typeName,options){(0,_minDash.isString)(typeName)||(options=typeName,typeName="bpmn:Definitions");var reader=new _moddleXml.Reader((0,_minDash.assign)({model:this,lax:!0},options)),rootHandler=reader.handler(typeName);return reader.fromXML(xmlStr,rootHandler)},BpmnModdle.prototype.toXML=function(element,options){var writer=new _moddleXml.Writer(options);return new Promise((function(resolve,reject){try{return resolve({xml:writer.toXML(element)})}catch(err){return reject(err)}}))};var packages={bpmn:{name:"BPMN20",uri:"http://www.omg.org/spec/BPMN/20100524/MODEL",prefix:"bpmn",associations:[],types:[{name:"Interface",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"operations",type:"Operation",isMany:!0},{name:"implementationRef",isAttr:!0,type:"String"}]},{name:"Operation",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"inMessageRef",type:"Message",isReference:!0},{name:"outMessageRef",type:"Message",isReference:!0},{name:"errorRef",type:"Error",isMany:!0,isReference:!0},{name:"implementationRef",isAttr:!0,type:"String"}]},{name:"EndPoint",superClass:["RootElement"]},{name:"Auditing",superClass:["BaseElement"]},{name:"GlobalTask",superClass:["CallableElement"],properties:[{name:"resources",type:"ResourceRole",isMany:!0}]},{name:"Monitoring",superClass:["BaseElement"]},{name:"Performer",superClass:["ResourceRole"]},{name:"Process",superClass:["FlowElementsContainer","CallableElement"],properties:[{name:"processType",type:"ProcessType",isAttr:!0},{name:"isClosed",isAttr:!0,type:"Boolean"},{name:"auditing",type:"Auditing"},{name:"monitoring",type:"Monitoring"},{name:"properties",type:"Property",isMany:!0},{name:"laneSets",isMany:!0,replaces:"FlowElementsContainer#laneSets",type:"LaneSet"},{name:"flowElements",isMany:!0,replaces:"FlowElementsContainer#flowElements",type:"FlowElement"},{name:"artifacts",type:"Artifact",isMany:!0},{name:"resources",type:"ResourceRole",isMany:!0},{name:"correlationSubscriptions",type:"CorrelationSubscription",isMany:!0},{name:"supports",type:"Process",isMany:!0,isReference:!0},{name:"definitionalCollaborationRef",type:"Collaboration",isAttr:!0,isReference:!0},{name:"isExecutable",isAttr:!0,type:"Boolean"}]},{name:"LaneSet",superClass:["BaseElement"],properties:[{name:"lanes",type:"Lane",isMany:!0},{name:"name",isAttr:!0,type:"String"}]},{name:"Lane",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"partitionElementRef",type:"BaseElement",isAttr:!0,isReference:!0},{name:"partitionElement",type:"BaseElement"},{name:"flowNodeRef",type:"FlowNode",isMany:!0,isReference:!0},{name:"childLaneSet",type:"LaneSet",xml:{serialize:"xsi:type"}}]},{name:"GlobalManualTask",superClass:["GlobalTask"]},{name:"ManualTask",superClass:["Task"]},{name:"UserTask",superClass:["Task"],properties:[{name:"renderings",type:"Rendering",isMany:!0},{name:"implementation",isAttr:!0,type:"String"}]},{name:"Rendering",superClass:["BaseElement"]},{name:"HumanPerformer",superClass:["Performer"]},{name:"PotentialOwner",superClass:["HumanPerformer"]},{name:"GlobalUserTask",superClass:["GlobalTask"],properties:[{name:"implementation",isAttr:!0,type:"String"},{name:"renderings",type:"Rendering",isMany:!0}]},{name:"Gateway",isAbstract:!0,superClass:["FlowNode"],properties:[{name:"gatewayDirection",type:"GatewayDirection",default:"Unspecified",isAttr:!0}]},{name:"EventBasedGateway",superClass:["Gateway"],properties:[{name:"instantiate",default:!1,isAttr:!0,type:"Boolean"},{name:"eventGatewayType",type:"EventBasedGatewayType",isAttr:!0,default:"Exclusive"}]},{name:"ComplexGateway",superClass:["Gateway"],properties:[{name:"activationCondition",type:"Expression",xml:{serialize:"xsi:type"}},{name:"default",type:"SequenceFlow",isAttr:!0,isReference:!0}]},{name:"ExclusiveGateway",superClass:["Gateway"],properties:[{name:"default",type:"SequenceFlow",isAttr:!0,isReference:!0}]},{name:"InclusiveGateway",superClass:["Gateway"],properties:[{name:"default",type:"SequenceFlow",isAttr:!0,isReference:!0}]},{name:"ParallelGateway",superClass:["Gateway"]},{name:"RootElement",isAbstract:!0,superClass:["BaseElement"]},{name:"Relationship",superClass:["BaseElement"],properties:[{name:"type",isAttr:!0,type:"String"},{name:"direction",type:"RelationshipDirection",isAttr:!0},{name:"source",isMany:!0,isReference:!0,type:"Element"},{name:"target",isMany:!0,isReference:!0,type:"Element"}]},{name:"BaseElement",isAbstract:!0,properties:[{name:"id",isAttr:!0,type:"String",isId:!0},{name:"documentation",type:"Documentation",isMany:!0},{name:"extensionDefinitions",type:"ExtensionDefinition",isMany:!0,isReference:!0},{name:"extensionElements",type:"ExtensionElements"}]},{name:"Extension",properties:[{name:"mustUnderstand",default:!1,isAttr:!0,type:"Boolean"},{name:"definition",type:"ExtensionDefinition",isAttr:!0,isReference:!0}]},{name:"ExtensionDefinition",properties:[{name:"name",isAttr:!0,type:"String"},{name:"extensionAttributeDefinitions",type:"ExtensionAttributeDefinition",isMany:!0}]},{name:"ExtensionAttributeDefinition",properties:[{name:"name",isAttr:!0,type:"String"},{name:"type",isAttr:!0,type:"String"},{name:"isReference",default:!1,isAttr:!0,type:"Boolean"},{name:"extensionDefinition",type:"ExtensionDefinition",isAttr:!0,isReference:!0}]},{name:"ExtensionElements",properties:[{name:"valueRef",isAttr:!0,isReference:!0,type:"Element"},{name:"values",type:"Element",isMany:!0},{name:"extensionAttributeDefinition",type:"ExtensionAttributeDefinition",isAttr:!0,isReference:!0}]},{name:"Documentation",superClass:["BaseElement"],properties:[{name:"text",type:"String",isBody:!0},{name:"textFormat",default:"text/plain",isAttr:!0,type:"String"}]},{name:"Event",isAbstract:!0,superClass:["FlowNode","InteractionNode"],properties:[{name:"properties",type:"Property",isMany:!0}]},{name:"IntermediateCatchEvent",superClass:["CatchEvent"]},{name:"IntermediateThrowEvent",superClass:["ThrowEvent"]},{name:"EndEvent",superClass:["ThrowEvent"]},{name:"StartEvent",superClass:["CatchEvent"],properties:[{name:"isInterrupting",default:!0,isAttr:!0,type:"Boolean"}]},{name:"ThrowEvent",isAbstract:!0,superClass:["Event"],properties:[{name:"dataInputs",type:"DataInput",isMany:!0},{name:"dataInputAssociations",type:"DataInputAssociation",isMany:!0},{name:"inputSet",type:"InputSet"},{name:"eventDefinitions",type:"EventDefinition",isMany:!0},{name:"eventDefinitionRef",type:"EventDefinition",isMany:!0,isReference:!0}]},{name:"CatchEvent",isAbstract:!0,superClass:["Event"],properties:[{name:"parallelMultiple",isAttr:!0,type:"Boolean",default:!1},{name:"dataOutputs",type:"DataOutput",isMany:!0},{name:"dataOutputAssociations",type:"DataOutputAssociation",isMany:!0},{name:"outputSet",type:"OutputSet"},{name:"eventDefinitions",type:"EventDefinition",isMany:!0},{name:"eventDefinitionRef",type:"EventDefinition",isMany:!0,isReference:!0}]},{name:"BoundaryEvent",superClass:["CatchEvent"],properties:[{name:"cancelActivity",default:!0,isAttr:!0,type:"Boolean"},{name:"attachedToRef",type:"Activity",isAttr:!0,isReference:!0}]},{name:"EventDefinition",isAbstract:!0,superClass:["RootElement"]},{name:"CancelEventDefinition",superClass:["EventDefinition"]},{name:"ErrorEventDefinition",superClass:["EventDefinition"],properties:[{name:"errorRef",type:"Error",isAttr:!0,isReference:!0}]},{name:"TerminateEventDefinition",superClass:["EventDefinition"]},{name:"EscalationEventDefinition",superClass:["EventDefinition"],properties:[{name:"escalationRef",type:"Escalation",isAttr:!0,isReference:!0}]},{name:"Escalation",properties:[{name:"structureRef",type:"ItemDefinition",isAttr:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"},{name:"escalationCode",isAttr:!0,type:"String"}],superClass:["RootElement"]},{name:"CompensateEventDefinition",superClass:["EventDefinition"],properties:[{name:"waitForCompletion",isAttr:!0,type:"Boolean",default:!0},{name:"activityRef",type:"Activity",isAttr:!0,isReference:!0}]},{name:"TimerEventDefinition",superClass:["EventDefinition"],properties:[{name:"timeDate",type:"Expression",xml:{serialize:"xsi:type"}},{name:"timeCycle",type:"Expression",xml:{serialize:"xsi:type"}},{name:"timeDuration",type:"Expression",xml:{serialize:"xsi:type"}}]},{name:"LinkEventDefinition",superClass:["EventDefinition"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"target",type:"LinkEventDefinition",isAttr:!0,isReference:!0},{name:"source",type:"LinkEventDefinition",isMany:!0,isReference:!0}]},{name:"MessageEventDefinition",superClass:["EventDefinition"],properties:[{name:"messageRef",type:"Message",isAttr:!0,isReference:!0},{name:"operationRef",type:"Operation",isAttr:!0,isReference:!0}]},{name:"ConditionalEventDefinition",superClass:["EventDefinition"],properties:[{name:"condition",type:"Expression",xml:{serialize:"xsi:type"}}]},{name:"SignalEventDefinition",superClass:["EventDefinition"],properties:[{name:"signalRef",type:"Signal",isAttr:!0,isReference:!0}]},{name:"Signal",superClass:["RootElement"],properties:[{name:"structureRef",type:"ItemDefinition",isAttr:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"}]},{name:"ImplicitThrowEvent",superClass:["ThrowEvent"]},{name:"DataState",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"}]},{name:"ItemAwareElement",superClass:["BaseElement"],properties:[{name:"itemSubjectRef",type:"ItemDefinition",isAttr:!0,isReference:!0},{name:"dataState",type:"DataState"}]},{name:"DataAssociation",superClass:["BaseElement"],properties:[{name:"sourceRef",type:"ItemAwareElement",isMany:!0,isReference:!0},{name:"targetRef",type:"ItemAwareElement",isReference:!0},{name:"transformation",type:"FormalExpression",xml:{serialize:"property"}},{name:"assignment",type:"Assignment",isMany:!0}]},{name:"DataInput",superClass:["ItemAwareElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"isCollection",default:!1,isAttr:!0,type:"Boolean"},{name:"inputSetRef",type:"InputSet",isMany:!0,isVirtual:!0,isReference:!0},{name:"inputSetWithOptional",type:"InputSet",isMany:!0,isVirtual:!0,isReference:!0},{name:"inputSetWithWhileExecuting",type:"InputSet",isMany:!0,isVirtual:!0,isReference:!0}]},{name:"DataOutput",superClass:["ItemAwareElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"isCollection",default:!1,isAttr:!0,type:"Boolean"},{name:"outputSetRef",type:"OutputSet",isMany:!0,isVirtual:!0,isReference:!0},{name:"outputSetWithOptional",type:"OutputSet",isMany:!0,isVirtual:!0,isReference:!0},{name:"outputSetWithWhileExecuting",type:"OutputSet",isMany:!0,isVirtual:!0,isReference:!0}]},{name:"InputSet",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"dataInputRefs",type:"DataInput",isMany:!0,isReference:!0},{name:"optionalInputRefs",type:"DataInput",isMany:!0,isReference:!0},{name:"whileExecutingInputRefs",type:"DataInput",isMany:!0,isReference:!0},{name:"outputSetRefs",type:"OutputSet",isMany:!0,isReference:!0}]},{name:"OutputSet",superClass:["BaseElement"],properties:[{name:"dataOutputRefs",type:"DataOutput",isMany:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"},{name:"inputSetRefs",type:"InputSet",isMany:!0,isReference:!0},{name:"optionalOutputRefs",type:"DataOutput",isMany:!0,isReference:!0},{name:"whileExecutingOutputRefs",type:"DataOutput",isMany:!0,isReference:!0}]},{name:"Property",superClass:["ItemAwareElement"],properties:[{name:"name",isAttr:!0,type:"String"}]},{name:"DataInputAssociation",superClass:["DataAssociation"]},{name:"DataOutputAssociation",superClass:["DataAssociation"]},{name:"InputOutputSpecification",superClass:["BaseElement"],properties:[{name:"dataInputs",type:"DataInput",isMany:!0},{name:"dataOutputs",type:"DataOutput",isMany:!0},{name:"inputSets",type:"InputSet",isMany:!0},{name:"outputSets",type:"OutputSet",isMany:!0}]},{name:"DataObject",superClass:["FlowElement","ItemAwareElement"],properties:[{name:"isCollection",default:!1,isAttr:!0,type:"Boolean"}]},{name:"InputOutputBinding",properties:[{name:"inputDataRef",type:"InputSet",isAttr:!0,isReference:!0},{name:"outputDataRef",type:"OutputSet",isAttr:!0,isReference:!0},{name:"operationRef",type:"Operation",isAttr:!0,isReference:!0}]},{name:"Assignment",superClass:["BaseElement"],properties:[{name:"from",type:"Expression",xml:{serialize:"xsi:type"}},{name:"to",type:"Expression",xml:{serialize:"xsi:type"}}]},{name:"DataStore",superClass:["RootElement","ItemAwareElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"capacity",isAttr:!0,type:"Integer"},{name:"isUnlimited",default:!0,isAttr:!0,type:"Boolean"}]},{name:"DataStoreReference",superClass:["ItemAwareElement","FlowElement"],properties:[{name:"dataStoreRef",type:"DataStore",isAttr:!0,isReference:!0}]},{name:"DataObjectReference",superClass:["ItemAwareElement","FlowElement"],properties:[{name:"dataObjectRef",type:"DataObject",isAttr:!0,isReference:!0}]},{name:"ConversationLink",superClass:["BaseElement"],properties:[{name:"sourceRef",type:"InteractionNode",isAttr:!0,isReference:!0},{name:"targetRef",type:"InteractionNode",isAttr:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"}]},{name:"ConversationAssociation",superClass:["BaseElement"],properties:[{name:"innerConversationNodeRef",type:"ConversationNode",isAttr:!0,isReference:!0},{name:"outerConversationNodeRef",type:"ConversationNode",isAttr:!0,isReference:!0}]},{name:"CallConversation",superClass:["ConversationNode"],properties:[{name:"calledCollaborationRef",type:"Collaboration",isAttr:!0,isReference:!0},{name:"participantAssociations",type:"ParticipantAssociation",isMany:!0}]},{name:"Conversation",superClass:["ConversationNode"]},{name:"SubConversation",superClass:["ConversationNode"],properties:[{name:"conversationNodes",type:"ConversationNode",isMany:!0}]},{name:"ConversationNode",isAbstract:!0,superClass:["InteractionNode","BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"participantRef",type:"Participant",isMany:!0,isReference:!0},{name:"messageFlowRefs",type:"MessageFlow",isMany:!0,isReference:!0},{name:"correlationKeys",type:"CorrelationKey",isMany:!0}]},{name:"GlobalConversation",superClass:["Collaboration"]},{name:"PartnerEntity",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"participantRef",type:"Participant",isMany:!0,isReference:!0}]},{name:"PartnerRole",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"participantRef",type:"Participant",isMany:!0,isReference:!0}]},{name:"CorrelationProperty",superClass:["RootElement"],properties:[{name:"correlationPropertyRetrievalExpression",type:"CorrelationPropertyRetrievalExpression",isMany:!0},{name:"name",isAttr:!0,type:"String"},{name:"type",type:"ItemDefinition",isAttr:!0,isReference:!0}]},{name:"Error",superClass:["RootElement"],properties:[{name:"structureRef",type:"ItemDefinition",isAttr:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"},{name:"errorCode",isAttr:!0,type:"String"}]},{name:"CorrelationKey",superClass:["BaseElement"],properties:[{name:"correlationPropertyRef",type:"CorrelationProperty",isMany:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"}]},{name:"Expression",superClass:["BaseElement"],isAbstract:!1,properties:[{name:"body",isBody:!0,type:"String"}]},{name:"FormalExpression",superClass:["Expression"],properties:[{name:"language",isAttr:!0,type:"String"},{name:"evaluatesToTypeRef",type:"ItemDefinition",isAttr:!0,isReference:!0}]},{name:"Message",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"itemRef",type:"ItemDefinition",isAttr:!0,isReference:!0}]},{name:"ItemDefinition",superClass:["RootElement"],properties:[{name:"itemKind",type:"ItemKind",isAttr:!0},{name:"structureRef",isAttr:!0,type:"String"},{name:"isCollection",default:!1,isAttr:!0,type:"Boolean"},{name:"import",type:"Import",isAttr:!0,isReference:!0}]},{name:"FlowElement",isAbstract:!0,superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"auditing",type:"Auditing"},{name:"monitoring",type:"Monitoring"},{name:"categoryValueRef",type:"CategoryValue",isMany:!0,isReference:!0}]},{name:"SequenceFlow",superClass:["FlowElement"],properties:[{name:"isImmediate",isAttr:!0,type:"Boolean"},{name:"conditionExpression",type:"Expression",xml:{serialize:"xsi:type"}},{name:"sourceRef",type:"FlowNode",isAttr:!0,isReference:!0},{name:"targetRef",type:"FlowNode",isAttr:!0,isReference:!0}]},{name:"FlowElementsContainer",isAbstract:!0,superClass:["BaseElement"],properties:[{name:"laneSets",type:"LaneSet",isMany:!0},{name:"flowElements",type:"FlowElement",isMany:!0}]},{name:"CallableElement",isAbstract:!0,superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"ioSpecification",type:"InputOutputSpecification",xml:{serialize:"property"}},{name:"supportedInterfaceRef",type:"Interface",isMany:!0,isReference:!0},{name:"ioBinding",type:"InputOutputBinding",isMany:!0,xml:{serialize:"property"}}]},{name:"FlowNode",isAbstract:!0,superClass:["FlowElement"],properties:[{name:"incoming",type:"SequenceFlow",isMany:!0,isReference:!0},{name:"outgoing",type:"SequenceFlow",isMany:!0,isReference:!0},{name:"lanes",type:"Lane",isMany:!0,isVirtual:!0,isReference:!0}]},{name:"CorrelationPropertyRetrievalExpression",superClass:["BaseElement"],properties:[{name:"messagePath",type:"FormalExpression"},{name:"messageRef",type:"Message",isAttr:!0,isReference:!0}]},{name:"CorrelationPropertyBinding",superClass:["BaseElement"],properties:[{name:"dataPath",type:"FormalExpression"},{name:"correlationPropertyRef",type:"CorrelationProperty",isAttr:!0,isReference:!0}]},{name:"Resource",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"resourceParameters",type:"ResourceParameter",isMany:!0}]},{name:"ResourceParameter",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"isRequired",isAttr:!0,type:"Boolean"},{name:"type",type:"ItemDefinition",isAttr:!0,isReference:!0}]},{name:"CorrelationSubscription",superClass:["BaseElement"],properties:[{name:"correlationKeyRef",type:"CorrelationKey",isAttr:!0,isReference:!0},{name:"correlationPropertyBinding",type:"CorrelationPropertyBinding",isMany:!0}]},{name:"MessageFlow",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"sourceRef",type:"InteractionNode",isAttr:!0,isReference:!0},{name:"targetRef",type:"InteractionNode",isAttr:!0,isReference:!0},{name:"messageRef",type:"Message",isAttr:!0,isReference:!0}]},{name:"MessageFlowAssociation",superClass:["BaseElement"],properties:[{name:"innerMessageFlowRef",type:"MessageFlow",isAttr:!0,isReference:!0},{name:"outerMessageFlowRef",type:"MessageFlow",isAttr:!0,isReference:!0}]},{name:"InteractionNode",isAbstract:!0,properties:[{name:"incomingConversationLinks",type:"ConversationLink",isMany:!0,isVirtual:!0,isReference:!0},{name:"outgoingConversationLinks",type:"ConversationLink",isMany:!0,isVirtual:!0,isReference:!0}]},{name:"Participant",superClass:["InteractionNode","BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"interfaceRef",type:"Interface",isMany:!0,isReference:!0},{name:"participantMultiplicity",type:"ParticipantMultiplicity"},{name:"endPointRefs",type:"EndPoint",isMany:!0,isReference:!0},{name:"processRef",type:"Process",isAttr:!0,isReference:!0}]},{name:"ParticipantAssociation",superClass:["BaseElement"],properties:[{name:"innerParticipantRef",type:"Participant",isAttr:!0,isReference:!0},{name:"outerParticipantRef",type:"Participant",isAttr:!0,isReference:!0}]},{name:"ParticipantMultiplicity",properties:[{name:"minimum",default:0,isAttr:!0,type:"Integer"},{name:"maximum",default:1,isAttr:!0,type:"Integer"}],superClass:["BaseElement"]},{name:"Collaboration",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"isClosed",isAttr:!0,type:"Boolean"},{name:"participants",type:"Participant",isMany:!0},{name:"messageFlows",type:"MessageFlow",isMany:!0},{name:"artifacts",type:"Artifact",isMany:!0},{name:"conversations",type:"ConversationNode",isMany:!0},{name:"conversationAssociations",type:"ConversationAssociation"},{name:"participantAssociations",type:"ParticipantAssociation",isMany:!0},{name:"messageFlowAssociations",type:"MessageFlowAssociation",isMany:!0},{name:"correlationKeys",type:"CorrelationKey",isMany:!0},{name:"choreographyRef",type:"Choreography",isMany:!0,isReference:!0},{name:"conversationLinks",type:"ConversationLink",isMany:!0}]},{name:"ChoreographyActivity",isAbstract:!0,superClass:["FlowNode"],properties:[{name:"participantRef",type:"Participant",isMany:!0,isReference:!0},{name:"initiatingParticipantRef",type:"Participant",isAttr:!0,isReference:!0},{name:"correlationKeys",type:"CorrelationKey",isMany:!0},{name:"loopType",type:"ChoreographyLoopType",default:"None",isAttr:!0}]},{name:"CallChoreography",superClass:["ChoreographyActivity"],properties:[{name:"calledChoreographyRef",type:"Choreography",isAttr:!0,isReference:!0},{name:"participantAssociations",type:"ParticipantAssociation",isMany:!0}]},{name:"SubChoreography",superClass:["ChoreographyActivity","FlowElementsContainer"],properties:[{name:"artifacts",type:"Artifact",isMany:!0}]},{name:"ChoreographyTask",superClass:["ChoreographyActivity"],properties:[{name:"messageFlowRef",type:"MessageFlow",isMany:!0,isReference:!0}]},{name:"Choreography",superClass:["Collaboration","FlowElementsContainer"]},{name:"GlobalChoreographyTask",superClass:["Choreography"],properties:[{name:"initiatingParticipantRef",type:"Participant",isAttr:!0,isReference:!0}]},{name:"TextAnnotation",superClass:["Artifact"],properties:[{name:"text",type:"String"},{name:"textFormat",default:"text/plain",isAttr:!0,type:"String"}]},{name:"Group",superClass:["Artifact"],properties:[{name:"categoryValueRef",type:"CategoryValue",isAttr:!0,isReference:!0}]},{name:"Association",superClass:["Artifact"],properties:[{name:"associationDirection",type:"AssociationDirection",isAttr:!0},{name:"sourceRef",type:"BaseElement",isAttr:!0,isReference:!0},{name:"targetRef",type:"BaseElement",isAttr:!0,isReference:!0}]},{name:"Category",superClass:["RootElement"],properties:[{name:"categoryValue",type:"CategoryValue",isMany:!0},{name:"name",isAttr:!0,type:"String"}]},{name:"Artifact",isAbstract:!0,superClass:["BaseElement"]},{name:"CategoryValue",superClass:["BaseElement"],properties:[{name:"categorizedFlowElements",type:"FlowElement",isMany:!0,isVirtual:!0,isReference:!0},{name:"value",isAttr:!0,type:"String"}]},{name:"Activity",isAbstract:!0,superClass:["FlowNode"],properties:[{name:"isForCompensation",default:!1,isAttr:!0,type:"Boolean"},{name:"default",type:"SequenceFlow",isAttr:!0,isReference:!0},{name:"ioSpecification",type:"InputOutputSpecification",xml:{serialize:"property"}},{name:"boundaryEventRefs",type:"BoundaryEvent",isMany:!0,isReference:!0},{name:"properties",type:"Property",isMany:!0},{name:"dataInputAssociations",type:"DataInputAssociation",isMany:!0},{name:"dataOutputAssociations",type:"DataOutputAssociation",isMany:!0},{name:"startQuantity",default:1,isAttr:!0,type:"Integer"},{name:"resources",type:"ResourceRole",isMany:!0},{name:"completionQuantity",default:1,isAttr:!0,type:"Integer"},{name:"loopCharacteristics",type:"LoopCharacteristics"}]},{name:"ServiceTask",superClass:["Task"],properties:[{name:"implementation",isAttr:!0,type:"String"},{name:"operationRef",type:"Operation",isAttr:!0,isReference:!0}]},{name:"SubProcess",superClass:["Activity","FlowElementsContainer","InteractionNode"],properties:[{name:"triggeredByEvent",default:!1,isAttr:!0,type:"Boolean"},{name:"artifacts",type:"Artifact",isMany:!0}]},{name:"LoopCharacteristics",isAbstract:!0,superClass:["BaseElement"]},{name:"MultiInstanceLoopCharacteristics",superClass:["LoopCharacteristics"],properties:[{name:"isSequential",default:!1,isAttr:!0,type:"Boolean"},{name:"behavior",type:"MultiInstanceBehavior",default:"All",isAttr:!0},{name:"loopCardinality",type:"Expression",xml:{serialize:"xsi:type"}},{name:"loopDataInputRef",type:"ItemAwareElement",isReference:!0},{name:"loopDataOutputRef",type:"ItemAwareElement",isReference:!0},{name:"inputDataItem",type:"DataInput",xml:{serialize:"property"}},{name:"outputDataItem",type:"DataOutput",xml:{serialize:"property"}},{name:"complexBehaviorDefinition",type:"ComplexBehaviorDefinition",isMany:!0},{name:"completionCondition",type:"Expression",xml:{serialize:"xsi:type"}},{name:"oneBehaviorEventRef",type:"EventDefinition",isAttr:!0,isReference:!0},{name:"noneBehaviorEventRef",type:"EventDefinition",isAttr:!0,isReference:!0}]},{name:"StandardLoopCharacteristics",superClass:["LoopCharacteristics"],properties:[{name:"testBefore",default:!1,isAttr:!0,type:"Boolean"},{name:"loopCondition",type:"Expression",xml:{serialize:"xsi:type"}},{name:"loopMaximum",type:"Integer",isAttr:!0}]},{name:"CallActivity",superClass:["Activity","InteractionNode"],properties:[{name:"calledElement",type:"String",isAttr:!0}]},{name:"Task",superClass:["Activity","InteractionNode"]},{name:"SendTask",superClass:["Task"],properties:[{name:"implementation",isAttr:!0,type:"String"},{name:"operationRef",type:"Operation",isAttr:!0,isReference:!0},{name:"messageRef",type:"Message",isAttr:!0,isReference:!0}]},{name:"ReceiveTask",superClass:["Task"],properties:[{name:"implementation",isAttr:!0,type:"String"},{name:"instantiate",default:!1,isAttr:!0,type:"Boolean"},{name:"operationRef",type:"Operation",isAttr:!0,isReference:!0},{name:"messageRef",type:"Message",isAttr:!0,isReference:!0}]},{name:"ScriptTask",superClass:["Task"],properties:[{name:"scriptFormat",isAttr:!0,type:"String"},{name:"script",type:"String"}]},{name:"BusinessRuleTask",superClass:["Task"],properties:[{name:"implementation",isAttr:!0,type:"String"}]},{name:"AdHocSubProcess",superClass:["SubProcess"],properties:[{name:"completionCondition",type:"Expression",xml:{serialize:"xsi:type"}},{name:"ordering",type:"AdHocOrdering",isAttr:!0},{name:"cancelRemainingInstances",default:!0,isAttr:!0,type:"Boolean"}]},{name:"Transaction",superClass:["SubProcess"],properties:[{name:"protocol",isAttr:!0,type:"String"},{name:"method",isAttr:!0,type:"String"}]},{name:"GlobalScriptTask",superClass:["GlobalTask"],properties:[{name:"scriptLanguage",isAttr:!0,type:"String"},{name:"script",isAttr:!0,type:"String"}]},{name:"GlobalBusinessRuleTask",superClass:["GlobalTask"],properties:[{name:"implementation",isAttr:!0,type:"String"}]},{name:"ComplexBehaviorDefinition",superClass:["BaseElement"],properties:[{name:"condition",type:"FormalExpression"},{name:"event",type:"ImplicitThrowEvent"}]},{name:"ResourceRole",superClass:["BaseElement"],properties:[{name:"resourceRef",type:"Resource",isReference:!0},{name:"resourceParameterBindings",type:"ResourceParameterBinding",isMany:!0},{name:"resourceAssignmentExpression",type:"ResourceAssignmentExpression"},{name:"name",isAttr:!0,type:"String"}]},{name:"ResourceParameterBinding",properties:[{name:"expression",type:"Expression",xml:{serialize:"xsi:type"}},{name:"parameterRef",type:"ResourceParameter",isAttr:!0,isReference:!0}],superClass:["BaseElement"]},{name:"ResourceAssignmentExpression",properties:[{name:"expression",type:"Expression",xml:{serialize:"xsi:type"}}],superClass:["BaseElement"]},{name:"Import",properties:[{name:"importType",isAttr:!0,type:"String"},{name:"location",isAttr:!0,type:"String"},{name:"namespace",isAttr:!0,type:"String"}]},{name:"Definitions",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"targetNamespace",isAttr:!0,type:"String"},{name:"expressionLanguage",default:"http://www.w3.org/1999/XPath",isAttr:!0,type:"String"},{name:"typeLanguage",default:"http://www.w3.org/2001/XMLSchema",isAttr:!0,type:"String"},{name:"imports",type:"Import",isMany:!0},{name:"extensions",type:"Extension",isMany:!0},{name:"rootElements",type:"RootElement",isMany:!0},{name:"diagrams",isMany:!0,type:"bpmndi:BPMNDiagram"},{name:"exporter",isAttr:!0,type:"String"},{name:"relationships",type:"Relationship",isMany:!0},{name:"exporterVersion",isAttr:!0,type:"String"}]}],enumerations:[{name:"ProcessType",literalValues:[{name:"None"},{name:"Public"},{name:"Private"}]},{name:"GatewayDirection",literalValues:[{name:"Unspecified"},{name:"Converging"},{name:"Diverging"},{name:"Mixed"}]},{name:"EventBasedGatewayType",literalValues:[{name:"Parallel"},{name:"Exclusive"}]},{name:"RelationshipDirection",literalValues:[{name:"None"},{name:"Forward"},{name:"Backward"},{name:"Both"}]},{name:"ItemKind",literalValues:[{name:"Physical"},{name:"Information"}]},{name:"ChoreographyLoopType",literalValues:[{name:"None"},{name:"Standard"},{name:"MultiInstanceSequential"},{name:"MultiInstanceParallel"}]},{name:"AssociationDirection",literalValues:[{name:"None"},{name:"One"},{name:"Both"}]},{name:"MultiInstanceBehavior",literalValues:[{name:"None"},{name:"One"},{name:"All"},{name:"Complex"}]},{name:"AdHocOrdering",literalValues:[{name:"Parallel"},{name:"Sequential"}]}],xml:{tagAlias:"lowerCase",typePrefix:"t"}},bpmndi:{name:"BPMNDI",uri:"http://www.omg.org/spec/BPMN/20100524/DI",prefix:"bpmndi",types:[{name:"BPMNDiagram",properties:[{name:"plane",type:"BPMNPlane",redefines:"di:Diagram#rootElement"},{name:"labelStyle",type:"BPMNLabelStyle",isMany:!0}],superClass:["di:Diagram"]},{name:"BPMNPlane",properties:[{name:"bpmnElement",isAttr:!0,isReference:!0,type:"bpmn:BaseElement",redefines:"di:DiagramElement#modelElement"}],superClass:["di:Plane"]},{name:"BPMNShape",properties:[{name:"bpmnElement",isAttr:!0,isReference:!0,type:"bpmn:BaseElement",redefines:"di:DiagramElement#modelElement"},{name:"isHorizontal",isAttr:!0,type:"Boolean"},{name:"isExpanded",isAttr:!0,type:"Boolean"},{name:"isMarkerVisible",isAttr:!0,type:"Boolean"},{name:"label",type:"BPMNLabel"},{name:"isMessageVisible",isAttr:!0,type:"Boolean"},{name:"participantBandKind",type:"ParticipantBandKind",isAttr:!0},{name:"choreographyActivityShape",type:"BPMNShape",isAttr:!0,isReference:!0}],superClass:["di:LabeledShape"]},{name:"BPMNEdge",properties:[{name:"label",type:"BPMNLabel"},{name:"bpmnElement",isAttr:!0,isReference:!0,type:"bpmn:BaseElement",redefines:"di:DiagramElement#modelElement"},{name:"sourceElement",isAttr:!0,isReference:!0,type:"di:DiagramElement",redefines:"di:Edge#source"},{name:"targetElement",isAttr:!0,isReference:!0,type:"di:DiagramElement",redefines:"di:Edge#target"},{name:"messageVisibleKind",type:"MessageVisibleKind",isAttr:!0,default:"initiating"}],superClass:["di:LabeledEdge"]},{name:"BPMNLabel",properties:[{name:"labelStyle",type:"BPMNLabelStyle",isAttr:!0,isReference:!0,redefines:"di:DiagramElement#style"}],superClass:["di:Label"]},{name:"BPMNLabelStyle",properties:[{name:"font",type:"dc:Font"}],superClass:["di:Style"]}],enumerations:[{name:"ParticipantBandKind",literalValues:[{name:"top_initiating"},{name:"middle_initiating"},{name:"bottom_initiating"},{name:"top_non_initiating"},{name:"middle_non_initiating"},{name:"bottom_non_initiating"}]},{name:"MessageVisibleKind",literalValues:[{name:"initiating"},{name:"non_initiating"}]}],associations:[]},dc:{name:"DC",uri:"http://www.omg.org/spec/DD/20100524/DC",prefix:"dc",types:[{name:"Boolean"},{name:"Integer"},{name:"Real"},{name:"String"},{name:"Font",properties:[{name:"name",type:"String",isAttr:!0},{name:"size",type:"Real",isAttr:!0},{name:"isBold",type:"Boolean",isAttr:!0},{name:"isItalic",type:"Boolean",isAttr:!0},{name:"isUnderline",type:"Boolean",isAttr:!0},{name:"isStrikeThrough",type:"Boolean",isAttr:!0}]},{name:"Point",properties:[{name:"x",type:"Real",default:"0",isAttr:!0},{name:"y",type:"Real",default:"0",isAttr:!0}]},{name:"Bounds",properties:[{name:"x",type:"Real",default:"0",isAttr:!0},{name:"y",type:"Real",default:"0",isAttr:!0},{name:"width",type:"Real",isAttr:!0},{name:"height",type:"Real",isAttr:!0}]}],associations:[]},di:{name:"DI",uri:"http://www.omg.org/spec/DD/20100524/DI",prefix:"di",types:[{name:"DiagramElement",isAbstract:!0,properties:[{name:"id",isAttr:!0,isId:!0,type:"String"},{name:"extension",type:"Extension"},{name:"owningDiagram",type:"Diagram",isReadOnly:!0,isVirtual:!0,isReference:!0},{name:"owningElement",type:"DiagramElement",isReadOnly:!0,isVirtual:!0,isReference:!0},{name:"modelElement",isReadOnly:!0,isVirtual:!0,isReference:!0,type:"Element"},{name:"style",type:"Style",isReadOnly:!0,isVirtual:!0,isReference:!0},{name:"ownedElement",type:"DiagramElement",isReadOnly:!0,isMany:!0,isVirtual:!0}]},{name:"Node",isAbstract:!0,superClass:["DiagramElement"]},{name:"Edge",isAbstract:!0,superClass:["DiagramElement"],properties:[{name:"source",type:"DiagramElement",isReadOnly:!0,isVirtual:!0,isReference:!0},{name:"target",type:"DiagramElement",isReadOnly:!0,isVirtual:!0,isReference:!0},{name:"waypoint",isUnique:!1,isMany:!0,type:"dc:Point",xml:{serialize:"xsi:type"}}]},{name:"Diagram",isAbstract:!0,properties:[{name:"id",isAttr:!0,isId:!0,type:"String"},{name:"rootElement",type:"DiagramElement",isReadOnly:!0,isVirtual:!0},{name:"name",isAttr:!0,type:"String"},{name:"documentation",isAttr:!0,type:"String"},{name:"resolution",isAttr:!0,type:"Real"},{name:"ownedStyle",type:"Style",isReadOnly:!0,isMany:!0,isVirtual:!0}]},{name:"Shape",isAbstract:!0,superClass:["Node"],properties:[{name:"bounds",type:"dc:Bounds"}]},{name:"Plane",isAbstract:!0,superClass:["Node"],properties:[{name:"planeElement",type:"DiagramElement",subsettedProperty:"DiagramElement-ownedElement",isMany:!0}]},{name:"LabeledEdge",isAbstract:!0,superClass:["Edge"],properties:[{name:"ownedLabel",type:"Label",isReadOnly:!0,subsettedProperty:"DiagramElement-ownedElement",isMany:!0,isVirtual:!0}]},{name:"LabeledShape",isAbstract:!0,superClass:["Shape"],properties:[{name:"ownedLabel",type:"Label",isReadOnly:!0,subsettedProperty:"DiagramElement-ownedElement",isMany:!0,isVirtual:!0}]},{name:"Label",isAbstract:!0,superClass:["Node"],properties:[{name:"bounds",type:"dc:Bounds"}]},{name:"Style",isAbstract:!0,properties:[{name:"id",isAttr:!0,isId:!0,type:"String"}]},{name:"Extension",properties:[{name:"values",isMany:!0,type:"Element"}]}],associations:[],xml:{tagAlias:"lowerCase"}},bioc:{name:"bpmn.io colors for BPMN",uri:"http://bpmn.io/schema/bpmn/biocolor/1.0",prefix:"bioc",types:[{name:"ColoredShape",extends:["bpmndi:BPMNShape"],properties:[{name:"stroke",isAttr:!0,type:"String"},{name:"fill",isAttr:!0,type:"String"}]},{name:"ColoredEdge",extends:["bpmndi:BPMNEdge"],properties:[{name:"stroke",isAttr:!0,type:"String"},{name:"fill",isAttr:!0,type:"String"}]}],enumerations:[],associations:[]},color:{name:"BPMN in Color",uri:"http://www.omg.org/spec/BPMN/non-normative/color/1.0",prefix:"color",types:[{name:"ColoredLabel",extends:["bpmndi:BPMNLabel"],properties:[{name:"color",isAttr:!0,type:"String"}]},{name:"ColoredShape",extends:["bpmndi:BPMNShape"],properties:[{name:"background-color",isAttr:!0,type:"String"},{name:"border-color",isAttr:!0,type:"String"}]},{name:"ColoredEdge",extends:["bpmndi:BPMNEdge"],properties:[{name:"border-color",isAttr:!0,type:"String"}]}],enumerations:[],associations:[]}};var _default=function(additionalPackages,options){return new BpmnModdle((0,_minDash.assign)({},packages,additionalPackages),options)};exports.default=_default},{"min-dash":219,moddle:222,"moddle-xml":221}],94:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"default",{enumerable:!0,get:function(){return _Diagram.default}});var obj,_Diagram=(obj=require("./lib/Diagram"))&&obj.__esModule?obj:{default:obj}},{"./lib/Diagram":95}],95:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Diagram;var obj,_didi=require("didi"),_core=(obj=require("./core"))&&obj.__esModule?obj:{default:obj};function bootstrap(bootstrapModules){var modules=[],components=[];function hasModule(m){return modules.indexOf(m)>=0}bootstrapModules.forEach((function visit(m){hasModule(m)||((m.__depends__||[]).forEach(visit),hasModule(m)||(!function(m){modules.push(m)}(m),(m.__init__||[]).forEach((function(c){components.push(c)}))))}));var injector=new _didi.Injector(modules);return components.forEach((function(c){try{injector["string"==typeof c?"get":"invoke"](c)}catch(e){throw console.error("Failed to instantiate component"),console.error(e.stack),e}})),injector}function Diagram(options,injector){this.injector=injector=injector||function(options){return bootstrap([{config:["value",options=options||{}]},_core.default].concat(options.modules||[]))}(options),this.get=injector.get,this.invoke=injector.invoke,this.get("eventBus").fire("diagram.init")}Diagram.prototype.destroy=function(){this.get("eventBus").fire("diagram.destroy")},Diagram.prototype.clear=function(){this.get("eventBus").fire("diagram.clear")}},{"./core":104,didi:216}],96:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=CommandInterceptor;var _minDash=require("min-dash");function CommandInterceptor(eventBus){this._eventBus=eventBus}CommandInterceptor.$inject=["eventBus"],CommandInterceptor.prototype.on=function(events,hook,priority,handlerFn,unwrap,that){if(((0,_minDash.isFunction)(hook)||(0,_minDash.isNumber)(hook))&&(that=unwrap,unwrap=handlerFn,handlerFn=priority,priority=hook,hook=null),(0,_minDash.isFunction)(priority)&&(that=unwrap,unwrap=handlerFn,handlerFn=priority,priority=1e3),(0,_minDash.isObject)(unwrap)&&(that=unwrap,unwrap=!1),!(0,_minDash.isFunction)(handlerFn))throw new Error("handlerFn must be a function");(0,_minDash.isArray)(events)||(events=[events]);var eventBus=this._eventBus;(0,_minDash.forEach)(events,(function(event){var fullEvent=["commandStack",event,hook].filter((function(e){return e})).join(".");eventBus.on(fullEvent,priority,unwrap?function(fn,that){return function(event){return fn.call(that||null,event.context,event.command,event)}}(handlerFn,that):handlerFn,that)}))};(0,_minDash.forEach)(["canExecute","preExecute","preExecuted","execute","executed","postExecute","postExecuted","revert","reverted"],(function(hook){CommandInterceptor.prototype[hook]=function(events,priority,handlerFn,unwrap,that){((0,_minDash.isFunction)(events)||(0,_minDash.isNumber)(events))&&(that=unwrap,unwrap=handlerFn,handlerFn=priority,priority=events,events=null),this.on(events,hook,priority,handlerFn,unwrap,that)}}))},{"min-dash":219}],97:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=CommandStack;var _minDash=require("min-dash");function CommandStack(eventBus,injector){this._handlerMap={},this._stack=[],this._stackIdx=-1,this._currentExecution={actions:[],dirty:[],trigger:null},this._injector=injector,this._eventBus=eventBus,this._uid=1,eventBus.on(["diagram.destroy","diagram.clear"],(function(){this.clear(!1)}),this)}CommandStack.$inject=["eventBus","injector"],CommandStack.prototype.execute=function(command,context){if(!command)throw new Error("command required");this._currentExecution.trigger="execute";var action={command,context};this._pushAction(action),this._internalExecute(action),this._popAction(action)},CommandStack.prototype.canExecute=function(command,context){var action={command,context},handler=this._getHandler(command),result=this._fire(command,"canExecute",action);if(void 0===result){if(!handler)return!1;handler.canExecute&&(result=handler.canExecute(context))}return result},CommandStack.prototype.clear=function(emit){this._stack.length=0,this._stackIdx=-1,!1!==emit&&this._fire("changed",{trigger:"clear"})},CommandStack.prototype.undo=function(){var next,action=this._getUndoAction();if(action){for(this._currentExecution.trigger="undo",this._pushAction(action);action&&(this._internalUndo(action),(next=this._getUndoAction())&&next.id===action.id);)action=next;this._popAction()}},CommandStack.prototype.redo=function(){var next,action=this._getRedoAction();if(action){for(this._currentExecution.trigger="redo",this._pushAction(action);action&&(this._internalExecute(action,!0),(next=this._getRedoAction())&&next.id===action.id);)action=next;this._popAction()}},CommandStack.prototype.register=function(command,handler){this._setHandler(command,handler)},CommandStack.prototype.registerHandler=function(command,handlerCls){if(!command||!handlerCls)throw new Error("command and handlerCls must be defined");var handler=this._injector.instantiate(handlerCls);this.register(command,handler)},CommandStack.prototype.canUndo=function(){return!!this._getUndoAction()},CommandStack.prototype.canRedo=function(){return!!this._getRedoAction()},CommandStack.prototype._getRedoAction=function(){return this._stack[this._stackIdx+1]},CommandStack.prototype._getUndoAction=function(){return this._stack[this._stackIdx]},CommandStack.prototype._internalUndo=function(action){var self=this,command=action.command,context=action.context,handler=this._getHandler(command);this._atomicDo((function(){self._fire(command,"revert",action),handler.revert&&self._markDirty(handler.revert(context)),self._revertedAction(action),self._fire(command,"reverted",action)}))},CommandStack.prototype._fire=function(command,qualifier,event){arguments.length<3&&(event=qualifier,qualifier=null);var i,name,result,names=qualifier?[command+"."+qualifier,qualifier]:[command];for(event=this._eventBus.createEvent(event),i=0;(name=names[i])&&(result=this._eventBus.fire("commandStack."+name,event),!event.cancelBubble);i++);return result},CommandStack.prototype._createId=function(){return this._uid++},CommandStack.prototype._atomicDo=function(fn){var execution=this._currentExecution;execution.atomic=!0;try{fn()}finally{execution.atomic=!1}},CommandStack.prototype._internalExecute=function(action,redo){var self=this,command=action.command,context=action.context,handler=this._getHandler(command);if(!handler)throw new Error("no command handler registered for <"+command+">");this._pushAction(action),redo||(this._fire(command,"preExecute",action),handler.preExecute&&handler.preExecute(context),this._fire(command,"preExecuted",action)),this._atomicDo((function(){self._fire(command,"execute",action),handler.execute&&self._markDirty(handler.execute(context)),self._executedAction(action,redo),self._fire(command,"executed",action)})),redo||(this._fire(command,"postExecute",action),handler.postExecute&&handler.postExecute(context),this._fire(command,"postExecuted",action)),this._popAction(action)},CommandStack.prototype._pushAction=function(action){var execution=this._currentExecution,actions=execution.actions,baseAction=actions[0];if(execution.atomic)throw new Error("illegal invocation in <execute> or <revert> phase (action: "+action.command+")");action.id||(action.id=baseAction&&baseAction.id||this._createId()),actions.push(action)},CommandStack.prototype._popAction=function(){var execution=this._currentExecution,trigger=execution.trigger,actions=execution.actions,dirty=execution.dirty;actions.pop(),actions.length||(this._eventBus.fire("elements.changed",{elements:(0,_minDash.uniqueBy)("id",dirty.reverse())}),dirty.length=0,this._fire("changed",{trigger}),execution.trigger=null)},CommandStack.prototype._markDirty=function(elements){var execution=this._currentExecution;elements&&(elements=(0,_minDash.isArray)(elements)?elements:[elements],execution.dirty=execution.dirty.concat(elements))},CommandStack.prototype._executedAction=function(action,redo){var stackIdx=++this._stackIdx;redo||this._stack.splice(stackIdx,this._stack.length,action)},CommandStack.prototype._revertedAction=function(action){this._stackIdx--},CommandStack.prototype._getHandler=function(command){return this._handlerMap[command]},CommandStack.prototype._setHandler=function(command,handler){if(!command||!handler)throw new Error("command and handler required");if(this._handlerMap[command])throw new Error("overriding handler for command <"+command+">");this._handlerMap[command]=handler}},{"min-dash":219}],98:[function(require,module,exports){"use strict";var obj;Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={commandStack:["type",((obj=require("./CommandStack"))&&obj.__esModule?obj:{default:obj}).default]};exports.default=_default},{"./CommandStack":97}],99:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Canvas;var _minDash=require("min-dash"),_Collections=require("../util/Collections"),_Elements=require("../util/Elements"),_LayoutUtil=require("../layout/LayoutUtil"),_tinySvg=require("tiny-svg");function round(number,resolution){return Math.round(number*resolution)/resolution}function ensurePx(number){return(0,_minDash.isNumber)(number)?number+"px":number}function createGroup(parent,cls,childIndex){var group=(0,_tinySvg.create)("g");(0,_tinySvg.classes)(group).add(cls);var index=void 0!==childIndex?childIndex:parent.childNodes.length-1;return parent.insertBefore(group,parent.childNodes[index]||null),group}var REQUIRED_MODEL_ATTRS={shape:["x","y","width","height"],connection:["waypoints"]};function Canvas(config,eventBus,graphicsFactory,elementRegistry){this._eventBus=eventBus,this._elementRegistry=elementRegistry,this._graphicsFactory=graphicsFactory,this._init(config||{})}function setCTM(node,m){var mstr="matrix("+m.a+","+m.b+","+m.c+","+m.d+","+m.e+","+m.f+")";node.setAttribute("transform",mstr)}Canvas.$inject=["config.canvas","eventBus","graphicsFactory","elementRegistry"],Canvas.prototype._init=function(config){var eventBus=this._eventBus,container=this._container=function(options){var container=(options=(0,_minDash.assign)({},{width:"100%",height:"100%"},options)).container||document.body,parent=document.createElement("div");return parent.setAttribute("class","djs-container"),(0,_minDash.assign)(parent.style,{position:"relative",overflow:"hidden",width:ensurePx(options.width),height:ensurePx(options.height)}),container.appendChild(parent),parent}(config),svg=this._svg=(0,_tinySvg.create)("svg");(0,_tinySvg.attr)(svg,{width:"100%",height:"100%"}),(0,_tinySvg.append)(container,svg);var viewport=this._viewport=createGroup(svg,"viewport");this._layers={},this._planes={},!1!==config.deferUpdate&&(this._viewboxChanged=(0,_minDash.debounce)((0,_minDash.bind)(this._viewboxChanged,this),300)),eventBus.on("diagram.init",(function(){eventBus.fire("canvas.init",{svg,viewport})}),this),eventBus.on(["shape.added","connection.added","shape.removed","connection.removed","elements.changed","plane.set"],(function(){delete this._cachedViewbox}),this),eventBus.on("diagram.destroy",500,this._destroy,this),eventBus.on("diagram.clear",500,this._clear,this)},Canvas.prototype._destroy=function(emit){this._eventBus.fire("canvas.destroy",{svg:this._svg,viewport:this._viewport});var parent=this._container.parentNode;parent&&parent.removeChild(this._container),delete this._svg,delete this._container,delete this._layers,delete this._planes,delete this._activePlane,delete this._viewport},Canvas.prototype._clear=function(){var self=this;this._elementRegistry.getAll().forEach((function(element){var type=(0,_Elements.getType)(element);"root"===type?self.setRootElementForPlane(null,self.findPlane(element),!0):self._removeElement(element,type)})),this._activePlane=null,this._planes={},delete this._cachedViewbox},Canvas.prototype.getDefaultLayer=function(){return this.getLayer("base",0)},Canvas.prototype.getLayer=function(name,index){if(!name)throw new Error("must specify a name");var layer=this._layers[name];if(layer||(layer=this._layers[name]=this._createLayer(name,index)),void 0!==index&&layer.index!==index)throw new Error("layer <"+name+"> already created at index <"+index+">");return layer.group},Canvas.prototype._createLayer=function(name,index){void 0===index&&(index=1);var childIndex=(0,_minDash.reduce)(this._layers,(function(childIndex,layer){return index>=layer.index&&childIndex++,childIndex}),0);return{group:createGroup(this._viewport,"layer-"+name,childIndex),index}},Canvas.prototype.getPlane=function(name){if(!name)throw new Error("must specify a name");return this._planes[name]},Canvas.prototype.createPlane=function(name,rootElement){if(!name)throw new Error("must specify a name");if(this._planes[name])throw new Error("plane "+name+" already exists");rootElement||(rootElement={id:"__implicitroot"+name,children:[],isImplicit:!0});var svgLayer=this.getLayer(name,0);(0,_tinySvg.classes)(svgLayer).add("djs-element-hidden");var plane=this._planes[name]={layer:svgLayer,name,rootElement:null};return this.setRootElementForPlane(rootElement,plane),plane},Canvas.prototype.setActivePlane=function(plane){if(!plane)throw new Error("must specify a plane");return"string"==typeof plane&&(plane=this.getPlane(plane)),this._activePlane&&(0,_tinySvg.classes)(this._activePlane.layer).add("djs-element-hidden"),this._activePlane=plane,(0,_tinySvg.classes)(plane.layer).remove("djs-element-hidden"),plane.rootElement&&this._elementRegistry.updateGraphics(plane.rootElement,this._svg,!0),this._eventBus.fire("plane.set",{plane}),plane},Canvas.prototype.getActiveLayer=function(){return this.getActivePlane().layer},Canvas.prototype.getActivePlane=function(){var plane=this._activePlane;return plane||(plane=this.createPlane("base"),this.setActivePlane("base")),plane},Canvas.prototype.findPlane=function(element){"string"==typeof element&&(element=this._elementRegistry.get(element));var root=function(element){for(;element.parent;)element=element.parent;return element}(element);return(0,_minDash.find)(this._planes,(function(plane){return plane.rootElement===root}))},Canvas.prototype.getContainer=function(){return this._container},Canvas.prototype._updateMarker=function(element,marker,add){var container;element.id||(element=this._elementRegistry.get(element)),(container=this._elementRegistry._elements[element.id])&&((0,_minDash.forEach)([container.gfx,container.secondaryGfx],(function(gfx){gfx&&(add?(0,_tinySvg.classes)(gfx).add(marker):(0,_tinySvg.classes)(gfx).remove(marker))})),this._eventBus.fire("element.marker.update",{element,gfx:container.gfx,marker,add:!!add}))},Canvas.prototype.addMarker=function(element,marker){this._updateMarker(element,marker,!0)},Canvas.prototype.removeMarker=function(element,marker){this._updateMarker(element,marker,!1)},Canvas.prototype.hasMarker=function(element,marker){element.id||(element=this._elementRegistry.get(element));var gfx=this.getGraphics(element);return(0,_tinySvg.classes)(gfx).has(marker)},Canvas.prototype.toggleMarker=function(element,marker){this.hasMarker(element,marker)?this.removeMarker(element,marker):this.addMarker(element,marker)},Canvas.prototype.getRootElement=function(){return this.getActivePlane().rootElement},Canvas.prototype.setRootElement=function(element,override){var activePlane=this._activePlane;if(activePlane)return this.setRootElementForPlane(element,activePlane,override);var basePlane=this.createPlane("base",element);return this.setActivePlane(basePlane),basePlane.rootElement},Canvas.prototype.setRootElementForPlane=function(element,plane,override){"string"==typeof plane&&(plane=this.getPlane(plane)),element&&this._ensureValid("root",element);var currentRoot=plane.rootElement,elementRegistry=this._elementRegistry,eventBus=this._eventBus;if(currentRoot){if(!override)throw new Error("rootElement already set, need to specify override");eventBus.fire("root.remove",{element:currentRoot}),eventBus.fire("root.removed",{element:currentRoot}),elementRegistry.remove(currentRoot)}if(element){var gfx=plane.layer;eventBus.fire("root.add",{element}),elementRegistry.add(element,gfx),eventBus.fire("root.added",{element,gfx}),plane===this._activePlane&&this._elementRegistry.updateGraphics(element,this._svg,!0)}return plane.rootElement=element,element},Canvas.prototype._ensureValid=function(type,element){if(!element.id)throw new Error("element must have an id");if(this._elementRegistry.get(element.id))throw new Error("element with id "+element.id+" already exists");var requiredAttrs=REQUIRED_MODEL_ATTRS[type];if(!(0,_minDash.every)(requiredAttrs,(function(attr){return void 0!==element[attr]})))throw new Error("must supply { "+requiredAttrs.join(", ")+" } with "+type)},Canvas.prototype._setParent=function(element,parent,parentIndex){(0,_Collections.add)(parent.children,element,parentIndex),element.parent=parent},Canvas.prototype._addElement=function(type,element,parent,parentIndex){parent=parent||this.getRootElement();var eventBus=this._eventBus,graphicsFactory=this._graphicsFactory;this._ensureValid(type,element),eventBus.fire(type+".add",{element,parent}),this._setParent(element,parent,parentIndex);var gfx=graphicsFactory.create(type,element,parentIndex);return this._elementRegistry.add(element,gfx),graphicsFactory.update(type,element,gfx),eventBus.fire(type+".added",{element,gfx}),element},Canvas.prototype.addShape=function(shape,parent,parentIndex){return this._addElement("shape",shape,parent,parentIndex)},Canvas.prototype.addConnection=function(connection,parent,parentIndex){return this._addElement("connection",connection,parent,parentIndex)},Canvas.prototype._removeElement=function(element,type){var elementRegistry=this._elementRegistry,graphicsFactory=this._graphicsFactory,eventBus=this._eventBus;if(element=elementRegistry.get(element.id||element))return eventBus.fire(type+".remove",{element}),graphicsFactory.remove(element),(0,_Collections.remove)(element.parent&&element.parent.children,element),element.parent=null,eventBus.fire(type+".removed",{element}),elementRegistry.remove(element),element},Canvas.prototype.removeShape=function(shape){return this._removeElement(shape,"shape")},Canvas.prototype.removeConnection=function(connection){return this._removeElement(connection,"connection")},Canvas.prototype.getGraphics=function(element,secondary){return this._elementRegistry.getGraphics(element,secondary)},Canvas.prototype._changeViewbox=function(changeFn){this._eventBus.fire("canvas.viewbox.changing"),changeFn.apply(this),this._cachedViewbox=null,this._viewboxChanged()},Canvas.prototype._viewboxChanged=function(){this._eventBus.fire("canvas.viewbox.changed",{viewbox:this.viewbox()})},Canvas.prototype.viewbox=function(box){if(void 0===box&&this._cachedViewbox)return this._cachedViewbox;var innerBox,matrix,transform,scale,x,y,viewport=this._viewport,outerBox=this.getSize();return box?(this._changeViewbox((function(){scale=Math.min(outerBox.width/box.width,outerBox.height/box.height);var matrix=this._svg.createSVGMatrix().scale(scale).translate(-box.x,-box.y);(0,_tinySvg.transform)(viewport,matrix)})),box):(innerBox=this._activePlane&&this._activePlane.layer.getBBox()||{},matrix=(transform=(0,_tinySvg.transform)(viewport))?transform.matrix:(0,_tinySvg.createMatrix)(),scale=round(matrix.a,1e3),x=round(-matrix.e||0,1e3),y=round(-matrix.f||0,1e3),box=this._cachedViewbox={x:x?x/scale:0,y:y?y/scale:0,width:outerBox.width/scale,height:outerBox.height/scale,scale,inner:{width:innerBox.width||0,height:innerBox.height||0,x:innerBox.x||0,y:innerBox.y||0},outer:outerBox})},Canvas.prototype.scroll=function(delta){var node=this._viewport,matrix=node.getCTM();return delta&&this._changeViewbox((function(){delta=(0,_minDash.assign)({dx:0,dy:0},delta||{}),matrix=this._svg.createSVGMatrix().translate(delta.dx,delta.dy).multiply(matrix),setCTM(node,matrix)})),{x:matrix.e,y:matrix.f}},Canvas.prototype.scrollToElement=function(element,padding){var defaultPadding=100;"string"==typeof element&&(element=this._elementRegistry.get(element));var targetPlane=this.findPlane(element);targetPlane!==this._activePlane&&this.setActivePlane(targetPlane),padding||(padding={}),"number"==typeof padding&&(defaultPadding=padding),padding={top:padding.top||defaultPadding,right:padding.right||defaultPadding,bottom:padding.bottom||defaultPadding,left:padding.left||defaultPadding};var dx,dy,elementBounds=(0,_Elements.getBBox)(element),elementTrbl=(0,_LayoutUtil.asTRBL)(elementBounds),viewboxBounds=this.viewbox(),zoom=this.zoom();viewboxBounds.y+=padding.top/zoom,viewboxBounds.x+=padding.left/zoom,viewboxBounds.width-=(padding.right+padding.left)/zoom,viewboxBounds.height-=(padding.bottom+padding.top)/zoom;var viewboxTrbl=(0,_LayoutUtil.asTRBL)(viewboxBounds);if(elementBounds.width<viewboxBounds.width&&elementBounds.height<viewboxBounds.height){var dRight=Math.max(0,elementTrbl.right-viewboxTrbl.right),dLeft=Math.min(0,elementTrbl.left-viewboxTrbl.left),dBottom=Math.max(0,elementTrbl.bottom-viewboxTrbl.bottom),dTop=Math.min(0,elementTrbl.top-viewboxTrbl.top);dx=dRight||dLeft,dy=dBottom||dTop}else dx=elementBounds.x-viewboxBounds.x,dy=elementBounds.y-viewboxBounds.y;this.scroll({dx:-dx*zoom,dy:-dy*zoom})},Canvas.prototype.zoom=function(newScale,center){return newScale?"fit-viewport"===newScale?this._fitViewport(center):(this._changeViewbox((function(){"object"!=typeof center&&(outer=this.viewbox().outer,center={x:outer.width/2,y:outer.height/2}),matrix=this._setZoom(newScale,center)})),round(matrix.a,1e3)):this.viewbox(newScale).scale;var outer,matrix},Canvas.prototype._fitViewport=function(center){var newScale,newViewbox,vbox=this.viewbox(),outer=vbox.outer,inner=vbox.inner;return inner.x>=0&&inner.y>=0&&inner.x+inner.width<=outer.width&&inner.y+inner.height<=outer.height&&!center?newViewbox={x:0,y:0,width:Math.max(inner.width+inner.x,outer.width),height:Math.max(inner.height+inner.y,outer.height)}:(newScale=Math.min(1,outer.width/inner.width,outer.height/inner.height),newViewbox={x:inner.x+(center?inner.width/2-outer.width/newScale/2:0),y:inner.y+(center?inner.height/2-outer.height/newScale/2:0),width:outer.width/newScale,height:outer.height/newScale}),this.viewbox(newViewbox),this.viewbox(!1).scale},Canvas.prototype._setZoom=function(scale,center){var originalPoint,currentMatrix,scaleMatrix,newMatrix,svg=this._svg,viewport=this._viewport,matrix=svg.createSVGMatrix(),point=svg.createSVGPoint(),currentScale=(currentMatrix=viewport.getCTM()).a;return center?(originalPoint=(0,_minDash.assign)(point,center).matrixTransform(currentMatrix.inverse()),scaleMatrix=matrix.translate(originalPoint.x,originalPoint.y).scale(1/currentScale*scale).translate(-originalPoint.x,-originalPoint.y),newMatrix=currentMatrix.multiply(scaleMatrix)):newMatrix=matrix.scale(scale),setCTM(this._viewport,newMatrix),newMatrix},Canvas.prototype.getSize=function(){return{width:this._container.clientWidth,height:this._container.clientHeight}},Canvas.prototype.getAbsoluteBBox=function(element){var bbox,vbox=this.viewbox();element.waypoints?bbox=this.getGraphics(element).getBBox():bbox=element;return{x:bbox.x*vbox.scale-vbox.x*vbox.scale,y:bbox.y*vbox.scale-vbox.y*vbox.scale,width:bbox.width*vbox.scale,height:bbox.height*vbox.scale}},Canvas.prototype.resized=function(){delete this._cachedViewbox,this._eventBus.fire("canvas.resized")}},{"../layout/LayoutUtil":188,"../util/Collections":200,"../util/Elements":202,"min-dash":219,"tiny-svg":228}],100:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ElementFactory;var _model=require("../model"),_minDash=require("min-dash");function ElementFactory(){this._uid=12}ElementFactory.prototype.createRoot=function(attrs){return this.create("root",attrs)},ElementFactory.prototype.createLabel=function(attrs){return this.create("label",attrs)},ElementFactory.prototype.createShape=function(attrs){return this.create("shape",attrs)},ElementFactory.prototype.createConnection=function(attrs){return this.create("connection",attrs)},ElementFactory.prototype.create=function(type,attrs){return(attrs=(0,_minDash.assign)({},attrs||{})).id||(attrs.id=type+"_"+this._uid++),(0,_model.create)(type,attrs)}},{"../model":190,"min-dash":219}],101:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ElementRegistry;var _tinySvg=require("tiny-svg"),ELEMENT_ID="data-element-id";function ElementRegistry(eventBus){this._elements={},this._eventBus=eventBus}ElementRegistry.$inject=["eventBus"],ElementRegistry.prototype.add=function(element,gfx,secondaryGfx){var id=element.id;this._validateId(id),(0,_tinySvg.attr)(gfx,ELEMENT_ID,id),secondaryGfx&&(0,_tinySvg.attr)(secondaryGfx,ELEMENT_ID,id),this._elements[id]={element,gfx,secondaryGfx}},ElementRegistry.prototype.remove=function(element){var elements=this._elements,id=element.id||element,container=id&&elements[id];container&&((0,_tinySvg.attr)(container.gfx,ELEMENT_ID,""),container.secondaryGfx&&(0,_tinySvg.attr)(container.secondaryGfx,ELEMENT_ID,""),delete elements[id])},ElementRegistry.prototype.updateId=function(element,newId){this._validateId(newId),"string"==typeof element&&(element=this.get(element)),this._eventBus.fire("element.updateId",{element,newId});var gfx=this.getGraphics(element),secondaryGfx=this.getGraphics(element,!0);this.remove(element),element.id=newId,this.add(element,gfx,secondaryGfx)},ElementRegistry.prototype.updateGraphics=function(filter,gfx,secondary){var id=filter.id||filter,container=this._elements[id];return secondary?container.secondaryGfx=gfx:container.gfx=gfx,(0,_tinySvg.attr)(gfx,ELEMENT_ID,id),gfx},ElementRegistry.prototype.get=function(filter){var id;id="string"==typeof filter?filter:filter&&(0,_tinySvg.attr)(filter,ELEMENT_ID);var container=this._elements[id];return container&&container.element},ElementRegistry.prototype.filter=function(fn){var filtered=[];return this.forEach((function(element,gfx){fn(element,gfx)&&filtered.push(element)})),filtered},ElementRegistry.prototype.find=function(fn){for(var map=this._elements,keys=Object.keys(map),i=0;i<keys.length;i++){var container=map[keys[i]],element=container.element;if(fn(element,container.gfx))return element}},ElementRegistry.prototype.getAll=function(){return this.filter((function(e){return e}))},ElementRegistry.prototype.forEach=function(fn){var map=this._elements;Object.keys(map).forEach((function(id){var container=map[id],element=container.element,gfx=container.gfx;return fn(element,gfx)}))},ElementRegistry.prototype.getGraphics=function(filter,secondary){var id=filter.id||filter,container=this._elements[id];return container&&(secondary?container.secondaryGfx:container.gfx)},ElementRegistry.prototype._validateId=function(id){if(!id)throw new Error("element must have an id");if(this._elements[id])throw new Error("element with id "+id+" already added")}},{"tiny-svg":228}],102:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=EventBus;var _minDash=require("min-dash"),slice=Array.prototype.slice;function EventBus(){this._listeners={},this.on("diagram.destroy",1,this._destroy,this)}function InternalEvent(){}EventBus.prototype.on=function(events,priority,callback,that){if(events=(0,_minDash.isArray)(events)?events:[events],(0,_minDash.isFunction)(priority)&&(that=callback,callback=priority,priority=1e3),!(0,_minDash.isNumber)(priority))throw new Error("priority must be a number");var actualCallback=callback;that&&((actualCallback=(0,_minDash.bind)(callback,that)).__fn=callback.__fn||callback);var self=this;events.forEach((function(e){self._addListener(e,{priority,callback:actualCallback,next:null})}))},EventBus.prototype.once=function(event,priority,callback,that){var self=this;if((0,_minDash.isFunction)(priority)&&(that=callback,callback=priority,priority=1e3),!(0,_minDash.isNumber)(priority))throw new Error("priority must be a number");function wrappedCallback(){wrappedCallback.__isTomb=!0;var result=callback.apply(that,arguments);return self.off(event,wrappedCallback),result}wrappedCallback.__fn=callback,this.on(event,priority,wrappedCallback)},EventBus.prototype.off=function(events,callback){events=(0,_minDash.isArray)(events)?events:[events];var self=this;events.forEach((function(event){self._removeListener(event,callback)}))},EventBus.prototype.createEvent=function(data){var event=new InternalEvent;return event.init(data),event},EventBus.prototype.fire=function(type,data){var event,firstListener,returnValue,args;if(args=slice.call(arguments),"object"==typeof type&&(type=(data=type).type),!type)throw new Error("no event type specified");if(firstListener=this._listeners[type]){event=data instanceof InternalEvent?data:this.createEvent(data),args[0]=event;var originalType=event.type;type!==originalType&&(event.type=type);try{returnValue=this._invokeListeners(event,args,firstListener)}finally{type!==originalType&&(event.type=originalType)}return void 0===returnValue&&event.defaultPrevented&&(returnValue=!1),returnValue}},EventBus.prototype.handleError=function(error){return!1===this.fire("error",{error})},EventBus.prototype._destroy=function(){this._listeners={}},EventBus.prototype._invokeListeners=function(event,args,listener){for(var returnValue;listener&&!event.cancelBubble;)returnValue=this._invokeListener(event,args,listener),listener=listener.next;return returnValue},EventBus.prototype._invokeListener=function(event,args,listener){var returnValue;if(listener.callback.__isTomb)return returnValue;try{void 0!==(returnValue=function(fn,args){return fn.apply(null,args)}(listener.callback,args))&&(event.returnValue=returnValue,event.stopPropagation()),!1===returnValue&&event.preventDefault()}catch(error){if(!this.handleError(error))throw console.error("unhandled error in event listener",error),error}return returnValue},EventBus.prototype._addListener=function(event,newListener){var previousListener,listener=this._getListeners(event);if(listener){for(;listener;){if(listener.priority<newListener.priority)return newListener.next=listener,void(previousListener?previousListener.next=newListener:this._setListeners(event,newListener));previousListener=listener,listener=listener.next}previousListener.next=newListener}else this._setListeners(event,newListener)},EventBus.prototype._getListeners=function(name){return this._listeners[name]},EventBus.prototype._setListeners=function(name,listener){this._listeners[name]=listener},EventBus.prototype._removeListener=function(event,callback){var nextListener,previousListener,listenerCallback,listener=this._getListeners(event);if(callback)for(;listener;)nextListener=listener.next,(listenerCallback=listener.callback)!==callback&&listenerCallback.__fn!==callback||(previousListener?previousListener.next=nextListener:this._setListeners(event,nextListener)),previousListener=listener,listener=nextListener;else this._setListeners(event,null)},InternalEvent.prototype.stopPropagation=function(){this.cancelBubble=!0},InternalEvent.prototype.preventDefault=function(){this.defaultPrevented=!0},InternalEvent.prototype.init=function(data){(0,_minDash.assign)(this,data||{})}},{"min-dash":219}],103:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=GraphicsFactory;var _minDash=require("min-dash"),_GraphicsUtil=require("../util/GraphicsUtil"),_SvgTransformUtil=require("../util/SvgTransformUtil"),_minDom=require("min-dom"),_tinySvg=require("tiny-svg"),_Elements=require("../util/Elements");function GraphicsFactory(eventBus,elementRegistry){this._eventBus=eventBus,this._elementRegistry=elementRegistry}function prependTo(newNode,parentNode,siblingNode){var node=siblingNode||parentNode.firstChild;newNode!==node&&parentNode.insertBefore(newNode,node)}GraphicsFactory.$inject=["eventBus","elementRegistry"],GraphicsFactory.prototype._getChildrenContainer=function(element){var childrenGfx,gfx=this._elementRegistry.getGraphics(element);return element.parent?(childrenGfx=(0,_GraphicsUtil.getChildren)(gfx))||(childrenGfx=(0,_tinySvg.create)("g"),(0,_tinySvg.classes)(childrenGfx).add("djs-children"),(0,_tinySvg.append)(gfx.parentNode,childrenGfx)):childrenGfx=gfx,childrenGfx},GraphicsFactory.prototype._clear=function(gfx){var visual=(0,_GraphicsUtil.getVisual)(gfx);return(0,_minDom.clear)(visual),visual},GraphicsFactory.prototype._createContainer=function(type,childrenGfx,parentIndex,isFrame){var outerGfx=(0,_tinySvg.create)("g");(0,_tinySvg.classes)(outerGfx).add("djs-group"),void 0!==parentIndex?prependTo(outerGfx,childrenGfx,childrenGfx.childNodes[parentIndex]):(0,_tinySvg.append)(childrenGfx,outerGfx);var gfx=(0,_tinySvg.create)("g");(0,_tinySvg.classes)(gfx).add("djs-element"),(0,_tinySvg.classes)(gfx).add("djs-"+type),isFrame&&(0,_tinySvg.classes)(gfx).add("djs-frame"),(0,_tinySvg.append)(outerGfx,gfx);var visual=(0,_tinySvg.create)("g");return(0,_tinySvg.classes)(visual).add("djs-visual"),(0,_tinySvg.append)(gfx,visual),gfx},GraphicsFactory.prototype.create=function(type,element,parentIndex){var childrenGfx=this._getChildrenContainer(element.parent);return this._createContainer(type,childrenGfx,parentIndex,(0,_Elements.isFrameElement)(element))},GraphicsFactory.prototype.updateContainments=function(elements){var parents,self=this,elementRegistry=this._elementRegistry;parents=(0,_minDash.reduce)(elements,(function(map,e){return e.parent&&(map[e.parent.id]=e.parent),map}),{}),(0,_minDash.forEach)(parents,(function(parent){var children=parent.children;if(children){var childrenGfx=self._getChildrenContainer(parent);(0,_minDash.forEach)(children.slice().reverse(),(function(child){prependTo(elementRegistry.getGraphics(child).parentNode,childrenGfx)}))}}))},GraphicsFactory.prototype.drawShape=function(visual,element){return this._eventBus.fire("render.shape",{gfx:visual,element})},GraphicsFactory.prototype.getShapePath=function(element){return this._eventBus.fire("render.getShapePath",element)},GraphicsFactory.prototype.drawConnection=function(visual,element){return this._eventBus.fire("render.connection",{gfx:visual,element})},GraphicsFactory.prototype.getConnectionPath=function(waypoints){return this._eventBus.fire("render.getConnectionPath",waypoints)},GraphicsFactory.prototype.update=function(type,element,gfx){if(element.parent){var visual=this._clear(gfx);if("shape"===type)this.drawShape(visual,element),(0,_SvgTransformUtil.translate)(gfx,element.x,element.y);else{if("connection"!==type)throw new Error("unknown type: "+type);this.drawConnection(visual,element)}element.hidden?(0,_tinySvg.attr)(gfx,"display","none"):(0,_tinySvg.attr)(gfx,"display","block")}},GraphicsFactory.prototype.remove=function(element){var gfx=this._elementRegistry.getGraphics(element);(0,_tinySvg.remove)(gfx.parentNode)}},{"../util/Elements":202,"../util/GraphicsUtil":205,"../util/SvgTransformUtil":214,"min-dash":219,"min-dom":220,"tiny-svg":228}],104:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _draw=_interopRequireDefault(require("../draw")),_Canvas=_interopRequireDefault(require("./Canvas")),_ElementRegistry=_interopRequireDefault(require("./ElementRegistry")),_ElementFactory=_interopRequireDefault(require("./ElementFactory")),_EventBus=_interopRequireDefault(require("./EventBus")),_GraphicsFactory=_interopRequireDefault(require("./GraphicsFactory"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _default={__depends__:[_draw.default],__init__:["canvas"],canvas:["type",_Canvas.default],elementRegistry:["type",_ElementRegistry.default],elementFactory:["type",_ElementFactory.default],eventBus:["type",_EventBus.default],graphicsFactory:["type",_GraphicsFactory.default]};exports.default=_default},{"../draw":108,"./Canvas":99,"./ElementFactory":100,"./ElementRegistry":101,"./EventBus":102,"./GraphicsFactory":103}],105:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BaseRenderer;function BaseRenderer(eventBus,renderPriority){var self=this;renderPriority=renderPriority||1e3,eventBus.on(["render.shape","render.connection"],renderPriority,(function(evt,context){var type=evt.type,element=context.element,visuals=context.gfx,attrs=context.attrs;if(self.canRender(element))return"render.shape"===type?self.drawShape(visuals,element,attrs):self.drawConnection(visuals,element,attrs)})),eventBus.on(["render.getShapePath","render.getConnectionPath"],renderPriority,(function(evt,element){if(self.canRender(element))return"render.getShapePath"===evt.type?self.getShapePath(element):self.getConnectionPath(element)}))}BaseRenderer.prototype.canRender=function(){},BaseRenderer.prototype.drawShape=function(){},BaseRenderer.prototype.drawConnection=function(){},BaseRenderer.prototype.getShapePath=function(){},BaseRenderer.prototype.getConnectionPath=function(){}},{}],106:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=DefaultRenderer;var _inherits=_interopRequireDefault(require("inherits")),_BaseRenderer=_interopRequireDefault(require("./BaseRenderer")),_RenderUtil=require("../util/RenderUtil"),_tinySvg=require("tiny-svg"),_minDash=require("min-dash"),_Elements=require("../util/Elements");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function DefaultRenderer(eventBus,styles){_BaseRenderer.default.call(this,eventBus,1),this.CONNECTION_STYLE=styles.style(["no-fill"],{strokeWidth:5,stroke:"fuchsia"}),this.SHAPE_STYLE=styles.style({fill:"white",stroke:"fuchsia",strokeWidth:2}),this.FRAME_STYLE=styles.style(["no-fill"],{stroke:"fuchsia",strokeDasharray:4,strokeWidth:2})}(0,_inherits.default)(DefaultRenderer,_BaseRenderer.default),DefaultRenderer.prototype.canRender=function(){return!0},DefaultRenderer.prototype.drawShape=function(visuals,element,attrs){var rect=(0,_tinySvg.create)("rect");return(0,_tinySvg.attr)(rect,{x:0,y:0,width:element.width||0,height:element.height||0}),(0,_Elements.isFrameElement)(element)?(0,_tinySvg.attr)(rect,(0,_minDash.assign)({},this.FRAME_STYLE,attrs||{})):(0,_tinySvg.attr)(rect,(0,_minDash.assign)({},this.SHAPE_STYLE,attrs||{})),(0,_tinySvg.append)(visuals,rect),rect},DefaultRenderer.prototype.drawConnection=function(visuals,connection,attrs){var line=(0,_RenderUtil.createLine)(connection.waypoints,(0,_minDash.assign)({},this.CONNECTION_STYLE,attrs||{}));return(0,_tinySvg.append)(visuals,line),line},DefaultRenderer.prototype.getShapePath=function(shape){var x=shape.x,y=shape.y,width=shape.width,shapePath=[["M",x,y],["l",width,0],["l",0,shape.height],["l",-width,0],["z"]];return(0,_RenderUtil.componentsToPath)(shapePath)},DefaultRenderer.prototype.getConnectionPath=function(connection){var idx,point,waypoints=connection.waypoints,connectionPath=[];for(idx=0;point=waypoints[idx];idx++)point=point.original||point,connectionPath.push([0===idx?"M":"L",point.x,point.y]);return(0,_RenderUtil.componentsToPath)(connectionPath)},DefaultRenderer.$inject=["eventBus","styles"]},{"../util/Elements":202,"../util/RenderUtil":213,"./BaseRenderer":105,inherits:218,"min-dash":219,"tiny-svg":228}],107:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(){var defaultTraits={"no-fill":{fill:"none"},"no-border":{strokeOpacity:0},"no-events":{pointerEvents:"none"}},self=this;this.cls=function(className,traits,additionalAttrs){var attrs=this.style(traits,additionalAttrs);return(0,_minDash.assign)(attrs,{class:className})},this.style=function(traits,additionalAttrs){(0,_minDash.isArray)(traits)||additionalAttrs||(additionalAttrs=traits,traits=[]);var attrs=(0,_minDash.reduce)(traits,(function(attrs,t){return(0,_minDash.assign)(attrs,defaultTraits[t]||{})}),{});return additionalAttrs?(0,_minDash.assign)(attrs,additionalAttrs):attrs},this.computeStyle=function(custom,traits,defaultStyles){return(0,_minDash.isArray)(traits)||(defaultStyles=traits,traits=[]),self.style(traits||[],(0,_minDash.assign)({},defaultStyles,custom||{}))}};var _minDash=require("min-dash")},{"min-dash":219}],108:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _DefaultRenderer=_interopRequireDefault(require("./DefaultRenderer")),_Styles=_interopRequireDefault(require("./Styles"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _default={__init__:["defaultRenderer"],defaultRenderer:["type",_DefaultRenderer.default],styles:["type",_Styles.default]};exports.default=_default},{"./DefaultRenderer":106,"./Styles":107}],109:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=AttachSupport;var _minDash=require("min-dash"),_Removal=require("../../util/Removal"),_AttachUtil=require("../../util/AttachUtil"),_inherits=_interopRequireDefault(require("inherits")),_CommandInterceptor=_interopRequireDefault(require("../../command/CommandInterceptor"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function AttachSupport(injector,eventBus,canvas,rules,modeling){_CommandInterceptor.default.call(this,eventBus);var movePreview=injector.get("movePreview",!1);eventBus.on("shape.move.start",1401,(function(e){var elements,attachers,context=e.context,shapes=context.shapes,validatedShapes=context.validatedShapes;context.shapes=(attachers=getAttachers(elements=shapes),(0,_minDash.unionBy)("id",elements,attachers)),context.validatedShapes=function(elements){var ids=(0,_minDash.groupBy)(elements,"id");return(0,_minDash.filter)(elements,(function(element){for(;element;){if(element.host&&ids[element.host.id])return!1;element=element.parent}return!0}))}(validatedShapes)})),movePreview&&eventBus.on("shape.move.start",251,(function(e){var context=e.context,attachers=getAttachers(context.shapes);(0,_minDash.forEach)(attachers,(function(attacher){movePreview.makeDraggable(context,attacher,!0),(0,_minDash.forEach)(attacher.labels,(function(label){movePreview.makeDraggable(context,label,!0)}))}))})),movePreview&&eventBus.on("shape.move.start",(function(event){var shapes=event.context.shapes;if(1===shapes.length){var host=shapes[0].host;host&&(canvas.addMarker(host,"attach-ok"),eventBus.once(["shape.move.out","shape.move.cleanup"],(function(){canvas.removeMarker(host,"attach-ok")})))}})),this.preExecuted("elements.move",1401,(function(e){var context=e.context,closure=context.closure,attachers=getAttachers(context.shapes);(0,_minDash.forEach)(attachers,(function(attacher){closure.add(attacher,closure.topLevel[attacher.host.id])}))})),this.postExecuted("elements.move",(function(e){var attachers,context=e.context,shapes=context.shapes,newHost=context.newHost;newHost&&1!==shapes.length||(attachers=newHost?shapes:(0,_minDash.filter)(shapes,(function(shape){var item,host=shape.host;return function(shape){return!!shape.host}(shape)&&(item=host,!(-1!==shapes.indexOf(item)))})),(0,_minDash.forEach)(attachers,(function(attacher){modeling.updateAttachment(attacher,newHost)})))})),this.postExecuted("elements.move",(function(e){var shapes=e.context.shapes;(0,_minDash.forEach)(shapes,(function(shape){(0,_minDash.forEach)(shape.attachers,(function(attacher){(0,_minDash.forEach)(attacher.outgoing.slice(),(function(connection){rules.allowed("connection.reconnect",{connection,source:connection.source,target:connection.target})||modeling.removeConnection(connection)})),(0,_minDash.forEach)(attacher.incoming.slice(),(function(connection){rules.allowed("connection.reconnect",{connection,source:connection.source,target:connection.target})||modeling.removeConnection(connection)}))}))}))})),this.postExecute("shape.create",(function(e){var context=e.context,shape=context.shape,host=context.host;host&&modeling.updateAttachment(shape,host)})),this.postExecute("shape.replace",(function(e){var context=e.context,oldShape=context.oldShape,newShape=context.newShape;(0,_Removal.saveClear)(oldShape.attachers,(function(attacher){"attach"===rules.allowed("elements.move",{target:newShape,shapes:[attacher]})?modeling.updateAttachment(attacher,newShape):modeling.removeShape(attacher)})),newShape.attachers.length&&(0,_minDash.forEach)(newShape.attachers,(function(attacher){var delta=(0,_AttachUtil.getNewAttachShapeDelta)(attacher,oldShape,newShape);modeling.moveShape(attacher,delta,attacher.parent)}))})),this.postExecute("shape.resize",(function(event){var context=event.context,shape=context.shape,oldBounds=context.oldBounds,newBounds=context.newBounds,attachers=shape.attachers;!1!==(context.hints||{}).attachSupport&&(0,_minDash.forEach)(attachers,(function(attacher){var delta=(0,_AttachUtil.getNewAttachShapeDelta)(attacher,oldBounds,newBounds);modeling.moveShape(attacher,delta,attacher.parent),(0,_minDash.forEach)(attacher.labels,(function(label){modeling.moveShape(label,delta,label.parent)}))}))})),this.preExecute("shape.delete",(function(event){var shape=event.context.shape;(0,_Removal.saveClear)(shape.attachers,(function(attacher){modeling.removeShape(attacher)})),shape.host&&modeling.updateAttachment(shape,null)}))}function getAttachers(shapes){return(0,_minDash.flatten)((0,_minDash.map)(shapes,(function(s){return s.attachers||[]})))}(0,_inherits.default)(AttachSupport,_CommandInterceptor.default),AttachSupport.$inject=["injector","eventBus","canvas","rules","modeling"]},{"../../command/CommandInterceptor":96,"../../util/AttachUtil":198,"../../util/Removal":212,inherits:218,"min-dash":219}],110:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _rules=_interopRequireDefault(require("../rules")),_AttachSupport=_interopRequireDefault(require("./AttachSupport"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _default={__depends__:[_rules.default],__init__:["attachSupport"],attachSupport:["type",_AttachSupport.default]};exports.default=_default},{"../rules":171,"./AttachSupport":109}],111:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ChangeSupport;var _Elements=require("../../util/Elements");function ChangeSupport(eventBus,canvas,elementRegistry,graphicsFactory){eventBus.on("element.changed",(function(event){var element=event.element;(element.parent||element===canvas.getRootElement())&&(event.gfx=elementRegistry.getGraphics(element)),event.gfx&&eventBus.fire((0,_Elements.getType)(element)+".changed",event)})),eventBus.on("elements.changed",(function(event){var elements=event.elements;elements.forEach((function(e){eventBus.fire("element.changed",{element:e})})),graphicsFactory.updateContainments(elements)})),eventBus.on("shape.changed",(function(event){graphicsFactory.update("shape",event.element,event.gfx)})),eventBus.on("connection.changed",(function(event){graphicsFactory.update("connection",event.element,event.gfx)}))}ChangeSupport.$inject=["eventBus","canvas","elementRegistry","graphicsFactory"]},{"../../util/Elements":202}],112:[function(require,module,exports){"use strict";var obj;Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={__init__:["changeSupport"],changeSupport:["type",((obj=require("./ChangeSupport"))&&obj.__esModule?obj:{default:obj}).default]};exports.default=_default},{"./ChangeSupport":111}],113:[function(require,module,exports){"use strict";function Clipboard(){}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Clipboard,Clipboard.prototype.get=function(){return this._data},Clipboard.prototype.set=function(data){this._data=data},Clipboard.prototype.clear=function(){var data=this._data;return delete this._data,data},Clipboard.prototype.isEmpty=function(){return!this._data}},{}],114:[function(require,module,exports){"use strict";var obj;Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={clipboard:["type",((obj=require("./Clipboard"))&&obj.__esModule?obj:{default:obj}).default]};exports.default=_default},{"./Clipboard":113}],115:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=CopyPaste;var _minDash=require("min-dash"),_Elements=require("../../util/Elements");function CopyPaste(canvas,create,clipboard,elementFactory,eventBus,modeling,mouse,rules){this._canvas=canvas,this._create=create,this._clipboard=clipboard,this._elementFactory=elementFactory,this._eventBus=eventBus,this._modeling=modeling,this._mouse=mouse,this._rules=rules,eventBus.on("copyPaste.copyElement",(function(context){var descriptor=context.descriptor,element=context.element,elements=context.elements;descriptor.priority=1,descriptor.id=element.id,(0,_minDash.find)(elements,(function(e){return e===element.parent}))&&(descriptor.parent=element.parent.id),function(element){return!!element.host}(element)&&(descriptor.priority=2,descriptor.host=element.host.id),isConnection(element)&&(descriptor.priority=3,descriptor.source=element.source.id,descriptor.target=element.target.id,descriptor.waypoints=function(element){return(0,_minDash.map)(element.waypoints,(function(waypoint){return(waypoint=copyWaypoint(waypoint)).original&&(waypoint.original=copyWaypoint(waypoint.original)),waypoint}))}(element)),isLabel(element)&&(descriptor.priority=4,descriptor.labelTarget=element.labelTarget.id),(0,_minDash.forEach)(["x","y","width","height"],(function(property){(0,_minDash.isNumber)(element[property])&&(descriptor[property]=element[property])})),descriptor.hidden=element.hidden,descriptor.collapsed=element.collapsed})),eventBus.on("copyPaste.pasteElements",(function(context){var hints=context.hints;(0,_minDash.assign)(hints,{createElementsBehavior:!1})}))}function isConnection(element){return!!element.waypoints}function isLabel(element){return!!element.labelTarget}function copyWaypoint(waypoint){return(0,_minDash.assign)({},waypoint)}function removeElement(element,elements){var index=elements.indexOf(element);return-1===index?elements:elements.splice(index,1)}CopyPaste.$inject=["canvas","create","clipboard","elementFactory","eventBus","modeling","mouse","rules"],CopyPaste.prototype.copy=function(elements){var allowed,tree;return(0,_minDash.isArray)(elements)||(elements=elements?[elements]:[]),tree=!1===(allowed=this._eventBus.fire("copyPaste.canCopyElements",{elements}))?{}:this.createTree((0,_minDash.isArray)(allowed)?allowed:elements),this._clipboard.set(tree),this._eventBus.fire("copyPaste.elementsCopied",{elements,tree}),tree},CopyPaste.prototype.paste=function(context){var tree=this._clipboard.get();if(!this._clipboard.isEmpty()){var hints=context&&context.hints||{};this._eventBus.fire("copyPaste.pasteElements",{hints});var elements=this._createElements(tree);if(context&&context.element&&context.point)return this._paste(elements,context.element,context.point,hints);this._create.start(this._mouse.getLastMoveEvent(),elements,{hints:hints||{}})}},CopyPaste.prototype._paste=function(elements,target,position,hints){(0,_minDash.forEach)(elements,(function(element){(0,_minDash.isNumber)(element.x)||(element.x=0),(0,_minDash.isNumber)(element.y)||(element.y=0)}));var bbox=(0,_Elements.getBBox)(elements);return(0,_minDash.forEach)(elements,(function(element){isConnection(element)&&(element.waypoints=(0,_minDash.map)(element.waypoints,(function(waypoint){return{x:waypoint.x-bbox.x-bbox.width/2,y:waypoint.y-bbox.y-bbox.height/2}}))),(0,_minDash.assign)(element,{x:element.x-bbox.x-bbox.width/2,y:element.y-bbox.y-bbox.height/2})})),this._modeling.createElements(elements,position,target,(0,_minDash.assign)({},hints))},CopyPaste.prototype._createElements=function(tree){var self=this,eventBus=this._eventBus,cache={},elements=[];return(0,_minDash.forEach)(tree,(function(branch,depth){depth=parseInt(depth,10),branch=(0,_minDash.sortBy)(branch,"priority"),(0,_minDash.forEach)(branch,(function(descriptor){var element,attrs=(0,_minDash.assign)({},(0,_minDash.omit)(descriptor,["priority"]));return cache[descriptor.parent]?attrs.parent=cache[descriptor.parent]:delete attrs.parent,eventBus.fire("copyPaste.pasteElement",{cache,descriptor:attrs}),isConnection(attrs)?(attrs.source=cache[descriptor.source],attrs.target=cache[descriptor.target],element=cache[descriptor.id]=self.createConnection(attrs),void elements.push(element)):isLabel(attrs)?(attrs.labelTarget=cache[attrs.labelTarget],element=cache[descriptor.id]=self.createLabel(attrs),void elements.push(element)):(attrs.host&&(attrs.host=cache[attrs.host]),element=cache[descriptor.id]=self.createShape(attrs),void elements.push(element))}))})),elements},CopyPaste.prototype.createConnection=function(attrs){return this._elementFactory.createConnection((0,_minDash.omit)(attrs,["id"]))},CopyPaste.prototype.createLabel=function(attrs){return this._elementFactory.createLabel((0,_minDash.omit)(attrs,["id"]))},CopyPaste.prototype.createShape=function(attrs){return this._elementFactory.createShape((0,_minDash.omit)(attrs,["id"]))},CopyPaste.prototype.hasRelations=function(element,elements){var source,target;return!(isConnection(element)&&(source=(0,_minDash.find)(elements,(0,_minDash.matchPattern)({id:element.source.id})),target=(0,_minDash.find)(elements,(0,_minDash.matchPattern)({id:element.target.id})),!source||!target))&&!(isLabel(element)&&!(0,_minDash.find)(elements,(0,_minDash.matchPattern)({id:element.labelTarget.id})))},CopyPaste.prototype.createTree=function(elements){var rules=this._rules,self=this,tree={},elementsData=[],parents=(0,_Elements.getParents)(elements);function addElementData(element,depth){var foundElementData=(0,_minDash.find)(elementsData,(function(elementsData){return element===elementsData.element}));foundElementData?foundElementData.depth<depth&&(elementsData=function(elementData,elementsData){var index=elementsData.indexOf(elementData);-1!==index&&elementsData.splice(index,1);return elementsData}(foundElementData,elementsData)).push({element:foundElementData.element,depth}):elementsData.push({element,depth})}return(0,_Elements.eachElement)(parents,(function(element,_index,depth){if(!isLabel(element))return(0,_minDash.forEach)(element.labels,(function(label){addElementData(label,depth)})),(0,_minDash.forEach)([element.attachers,element.incoming,element.outgoing],(function(elements){elements&&elements.length&&(0,_minDash.forEach)(elements,(function(element){(0,_minDash.forEach)(element.labels,(function(label){addElementData(label,depth)})),addElementData(element,depth)}))})),addElementData(element,depth),element.children})),elements=(0,_minDash.map)(elementsData,(function(elementData){return elementData.element})),elementsData=(0,_minDash.map)(elementsData,(function(elementData){return elementData.descriptor={},self._eventBus.fire("copyPaste.copyElement",{descriptor:elementData.descriptor,element:elementData.element,elements}),elementData})),elementsData=(0,_minDash.sortBy)(elementsData,(function(elementData){return elementData.descriptor.priority})),elements=(0,_minDash.map)(elementsData,(function(elementData){return elementData.element})),(0,_minDash.forEach)(elementsData,(function(elementData){var depth=elementData.depth;self.hasRelations(elementData.element,elements)?!function(element,elements){return rules.allowed("element.copy",{element,elements})}(elementData.element,elements)?removeElement(elementData.element,elements):(tree[depth]||(tree[depth]=[]),tree[depth].push(elementData.descriptor)):removeElement(elementData.element,elements)})),tree}},{"../../util/Elements":202,"min-dash":219}],116:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _clipboard=_interopRequireDefault(require("../clipboard")),_create=_interopRequireDefault(require("../create")),_mouse=_interopRequireDefault(require("../mouse")),_rules=_interopRequireDefault(require("../rules")),_CopyPaste=_interopRequireDefault(require("./CopyPaste"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _default={__depends__:[_clipboard.default,_create.default,_mouse.default,_rules.default],__init__:["copyPaste"],copyPaste:["type",_CopyPaste.default]};exports.default=_default},{"../clipboard":114,"../create":119,"../mouse":158,"../rules":171,"./CopyPaste":115}],117:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Create;var _minDash=require("min-dash"),_Elements=require("../../util/Elements"),MARKER_OK="drop-ok",MARKER_NOT_OK="drop-not-ok",MARKER_ATTACH="attach-ok",MARKER_NEW_PARENT="new-parent";function Create(canvas,dragging,eventBus,modeling,rules){function setMarker(element,marker){[MARKER_ATTACH,MARKER_OK,MARKER_NOT_OK,MARKER_NEW_PARENT].forEach((function(m){m===marker?canvas.addMarker(element,m):canvas.removeMarker(element,m)}))}function cancel(){var context=dragging.context();context&&"create"===context.prefix&&dragging.cancel()}eventBus.on(["create.move","create.hover"],(function(event){var context=event.context,elements=context.elements,hover=event.hover,source=context.source,hints=context.hints||{};if(!hover)return context.canExecute=!1,void(context.target=null);ensureConstraints(event);var position={x:event.x,y:event.y},canExecute=context.canExecute=hover&&function(elements,target,position,source,hints){if(!target)return!1;elements=(0,_minDash.filter)(elements,(function(element){var labelTarget=element.labelTarget;return!(element.parent||function(element){return!!element.labelTarget}(element)&&-1!==elements.indexOf(labelTarget))}));var shape=(0,_minDash.find)(elements,(function(element){return!isConnection(element)})),attach=!1,connect=!1,create=!1;isSingleShape(elements)&&(attach=rules.allowed("shape.attach",{position,shape,target})),attach||(create=isSingleShape(elements)?rules.allowed("shape.create",{position,shape,source,target}):rules.allowed("elements.create",{elements,position,target}));var connectionTarget=hints.connectionTarget;return create||attach?(shape&&source&&(connect=rules.allowed("connection.create",{source:connectionTarget===source?shape:source,target:connectionTarget===source?source:shape,hints:{targetParent:target,targetAttach:attach}})),{attach,connect}):(null===create||null===attach)&&null}(elements,hover,position,source,hints);hover&&null!==canExecute&&(context.target=hover,canExecute&&canExecute.attach?setMarker(hover,MARKER_ATTACH):setMarker(hover,canExecute?MARKER_NEW_PARENT:MARKER_NOT_OK))})),eventBus.on(["create.end","create.out","create.cleanup"],(function(event){var hover=event.hover;hover&&setMarker(hover,null)})),eventBus.on("create.end",(function(event){var context=event.context,source=context.source,shape=context.shape,elements=context.elements,target=context.target,canExecute=context.canExecute,attach=canExecute&&canExecute.attach,connect=canExecute&&canExecute.connect,hints=context.hints||{};if(!1===canExecute||!target)return!1;ensureConstraints(event);var position={x:event.x,y:event.y};connect?shape=modeling.appendShape(source,shape,position,target,{attach,connection:!0===connect?{}:connect,connectionTarget:hints.connectionTarget}):(elements=modeling.createElements(elements,position,target,(0,_minDash.assign)({},hints,{attach})),shape=(0,_minDash.find)(elements,(function(element){return!isConnection(element)}))),(0,_minDash.assign)(context,{elements,shape}),(0,_minDash.assign)(event,{elements,shape})})),eventBus.on("create.init",(function(){eventBus.on("elements.changed",cancel),eventBus.once(["create.cancel","create.end"],2e3,(function(){eventBus.off("elements.changed",cancel)}))})),this.start=function(event,elements,context){(0,_minDash.isArray)(elements)||(elements=[elements]);var shape=(0,_minDash.find)(elements,(function(element){return!isConnection(element)}));if(shape){context=(0,_minDash.assign)({elements,hints:{},shape},context||{}),(0,_minDash.forEach)(elements,(function(element){(0,_minDash.isNumber)(element.x)||(element.x=0),(0,_minDash.isNumber)(element.y)||(element.y=0)}));var bbox=(0,_Elements.getBBox)(elements);(0,_minDash.forEach)(elements,(function(element){isConnection(element)&&(element.waypoints=(0,_minDash.map)(element.waypoints,(function(waypoint){return{x:waypoint.x-bbox.x-bbox.width/2,y:waypoint.y-bbox.y-bbox.height/2}}))),(0,_minDash.assign)(element,{x:element.x-bbox.x-bbox.width/2,y:element.y-bbox.y-bbox.height/2})})),dragging.init(event,"create",{cursor:"grabbing",autoActivate:!0,data:{shape,elements,context}})}}}function ensureConstraints(event){var createConstraints=event.context.createConstraints;createConstraints&&(createConstraints.left&&(event.x=Math.max(event.x,createConstraints.left)),createConstraints.right&&(event.x=Math.min(event.x,createConstraints.right)),createConstraints.top&&(event.y=Math.max(event.y,createConstraints.top)),createConstraints.bottom&&(event.y=Math.min(event.y,createConstraints.bottom)))}function isConnection(element){return!!element.waypoints}function isSingleShape(elements){return elements&&1===elements.length&&!isConnection(elements[0])}Create.$inject=["canvas","dragging","eventBus","modeling","rules"]},{"../../util/Elements":202,"min-dash":219}],118:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=CreatePreview;var _SvgTransformUtil=require("../../util/SvgTransformUtil"),_GraphicsUtil=require("../../util/GraphicsUtil"),_tinySvg=require("tiny-svg");function CreatePreview(canvas,eventBus,graphicsFactory,previewSupport,styles){eventBus.on("create.move",750,(function(event){var activeLayer,hover=event.hover,context=event.context,elements=context.elements,dragGroup=context.dragGroup;dragGroup||(dragGroup=context.dragGroup=function(elements){var dragGroup=(0,_tinySvg.create)("g");(0,_tinySvg.attr)(dragGroup,styles.cls("djs-drag-group",["no-events"]));var childrenGfx=(0,_tinySvg.create)("g");return elements.forEach((function(element){var gfx;element.hidden||(element.waypoints?(gfx=graphicsFactory._createContainer("connection",childrenGfx),graphicsFactory.drawConnection((0,_GraphicsUtil.getVisual)(gfx),element)):(gfx=graphicsFactory._createContainer("shape",childrenGfx),graphicsFactory.drawShape((0,_GraphicsUtil.getVisual)(gfx),element),(0,_SvgTransformUtil.translate)(gfx,element.x,element.y)),previewSupport.addDragger(element,dragGroup,gfx))})),dragGroup}(elements)),hover?(dragGroup.parentNode||(activeLayer=canvas.getActiveLayer(),(0,_tinySvg.append)(activeLayer,dragGroup)),(0,_SvgTransformUtil.translate)(dragGroup,event.x,event.y)):(0,_tinySvg.remove)(dragGroup)})),eventBus.on("create.cleanup",(function(event){var dragGroup=event.context.dragGroup;dragGroup&&(0,_tinySvg.remove)(dragGroup)}))}CreatePreview.$inject=["canvas","eventBus","graphicsFactory","previewSupport","styles"]},{"../../util/GraphicsUtil":205,"../../util/SvgTransformUtil":214,"tiny-svg":228}],119:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _dragging=_interopRequireDefault(require("../dragging")),_previewSupport=_interopRequireDefault(require("../preview-support")),_rules=_interopRequireDefault(require("../rules")),_selection=_interopRequireDefault(require("../selection")),_Create=_interopRequireDefault(require("./Create")),_CreatePreview=_interopRequireDefault(require("./CreatePreview"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _default={__depends__:[_dragging.default,_previewSupport.default,_rules.default,_selection.default],__init__:["create","createPreview"],create:["type",_Create.default],createPreview:["type",_CreatePreview.default]};exports.default=_default},{"../dragging":121,"../preview-support":165,"../rules":171,"../selection":175,"./Create":117,"./CreatePreview":118}],120:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Dragging;var _minDash=require("min-dash"),_minDom=require("min-dom"),_Event=require("../../util/Event"),_Cursor=require("../../util/Cursor"),_ClickTrap=require("../../util/ClickTrap"),_PositionUtil=require("../../util/PositionUtil"),round=Math.round;function preventDefault(event){event.preventDefault()}function Dragging(eventBus,canvas,selection,elementRegistry){var context,defaultOptions={threshold:5,trapClick:!0};function toLocalPoint(globalPosition){var viewbox=canvas.viewbox(),clientRect=canvas._container.getBoundingClientRect();return{x:viewbox.x+(globalPosition.x-clientRect.left)/viewbox.scale,y:viewbox.y+(globalPosition.y-clientRect.top)/viewbox.scale}}function fire(type,dragContext){dragContext=dragContext||context;var event=eventBus.createEvent((0,_minDash.assign)({},dragContext.payload,dragContext.data,{isTouch:dragContext.isTouch}));return!1!==eventBus.fire("drag."+type,event)&&eventBus.fire(dragContext.prefix+"."+type,event)}function move(event,activate){var point,payload=context.payload,displacement=context.displacement,globalStart=context.globalStart,globalCurrent=(0,_Event.toPoint)(event),globalDelta=(0,_PositionUtil.delta)(globalCurrent,globalStart),localStart=context.localStart,localCurrent=toLocalPoint(globalCurrent),localDelta=(0,_PositionUtil.delta)(localCurrent,localStart);if(!context.active&&(activate||(point=globalDelta,Math.sqrt(Math.pow(point.x,2)+Math.pow(point.y,2))>context.threshold))){if((0,_minDash.assign)(payload,{x:round(localStart.x+displacement.x),y:round(localStart.y+displacement.y),dx:0,dy:0},{originalEvent:event}),!1===fire("start"))return cancel();context.active=!0,context.keepSelection||(payload.previousSelection=selection.get(),selection.select(null)),context.cursor&&(0,_Cursor.set)(context.cursor),canvas.addMarker(canvas.getRootElement(),"djs-drag-active")}(0,_Event.stopPropagation)(event),context.active&&((0,_minDash.assign)(payload,{x:round(localCurrent.x+displacement.x),y:round(localCurrent.y+displacement.y),dx:round(localDelta.x),dy:round(localDelta.y)},{originalEvent:event}),fire("move"))}function end(event){var returnValue=!0;context.active&&(event&&(context.payload.originalEvent=event,(0,_Event.stopPropagation)(event)),returnValue=fire("end")),!1===returnValue&&fire("rejected"),fire("ended",cleanup(!0!==returnValue))}function checkCancel(event){27===event.which&&(preventDefault(event),cancel())}function trapClickAndEnd(event){var untrap;context.active&&(untrap=(0,_ClickTrap.install)(eventBus),setTimeout(untrap,400),preventDefault(event)),end(event)}function trapTouch(event){move(event)}function hover(event){var payload=context.payload;payload.hoverGfx=event.gfx,payload.hover=event.element,fire("hover")}function out(event){fire("out");var payload=context.payload;payload.hoverGfx=null,payload.hover=null}function cancel(restore){var previousContext;if(context){var wasActive=context.active;wasActive&&fire("cancel"),previousContext=cleanup(restore),wasActive&&fire("canceled",previousContext)}}function cleanup(restore){var previousContext,endDrag;fire("cleanup"),(0,_Cursor.unset)(),endDrag=context.trapClick?trapClickAndEnd:end,_minDom.event.unbind(document,"mousemove",move),_minDom.event.unbind(document,"dragstart",preventDefault),_minDom.event.unbind(document,"selectstart",preventDefault),_minDom.event.unbind(document,"mousedown",endDrag,!0),_minDom.event.unbind(document,"mouseup",endDrag,!0),_minDom.event.unbind(document,"keyup",checkCancel),_minDom.event.unbind(document,"touchstart",trapTouch,!0),_minDom.event.unbind(document,"touchcancel",cancel,!0),_minDom.event.unbind(document,"touchmove",move,!0),_minDom.event.unbind(document,"touchend",end,!0),eventBus.off("element.hover",hover),eventBus.off("element.out",out),canvas.removeMarker(canvas.getRootElement(),"djs-drag-active");var previousSelection=context.payload.previousSelection;return!1!==restore&&previousSelection&&!selection.get().length&&function(previousSelection){var existingSelection=previousSelection.filter((function(element){return elementRegistry.get(element.id)}));existingSelection.length&&selection.select(existingSelection)}(previousSelection),previousContext=context,context=null,previousContext}eventBus.on("diagram.destroy",cancel),this.init=function(event,relativeTo,prefix,options){context&&cancel(!1),"string"==typeof relativeTo&&(options=prefix,prefix=relativeTo,relativeTo=null);var originalEvent,globalStart,localStart,endDrag,isTouch,data=(options=(0,_minDash.assign)({},defaultOptions,options||{})).data||{};endDrag=options.trapClick?trapClickAndEnd:end,event?(originalEvent=(0,_Event.getOriginal)(event)||event,globalStart=(0,_Event.toPoint)(event),(0,_Event.stopPropagation)(event),"dragstart"===originalEvent.type&&preventDefault(originalEvent)):(originalEvent=null,globalStart={x:0,y:0}),localStart=toLocalPoint(globalStart),relativeTo||(relativeTo=localStart),isTouch=function(event){return"undefined"!=typeof TouchEvent&&event instanceof TouchEvent}(originalEvent),context=(0,_minDash.assign)({prefix,data,payload:{},globalStart,displacement:(0,_PositionUtil.delta)(relativeTo,localStart),localStart,isTouch},options),options.manual||(isTouch?(_minDom.event.bind(document,"touchstart",trapTouch,!0),_minDom.event.bind(document,"touchcancel",cancel,!0),_minDom.event.bind(document,"touchmove",move,!0),_minDom.event.bind(document,"touchend",end,!0)):(_minDom.event.bind(document,"mousemove",move),_minDom.event.bind(document,"dragstart",preventDefault),_minDom.event.bind(document,"selectstart",preventDefault),_minDom.event.bind(document,"mousedown",endDrag,!0),_minDom.event.bind(document,"mouseup",endDrag,!0)),_minDom.event.bind(document,"keyup",checkCancel),eventBus.on("element.hover",hover),eventBus.on("element.out",out)),fire("init"),options.autoActivate&&move(event,!0)},this.move=move,this.hover=hover,this.out=out,this.end=end,this.cancel=cancel,this.context=function(){return context},this.setOptions=function(options){(0,_minDash.assign)(defaultOptions,options)}}Dragging.$inject=["eventBus","canvas","selection","elementRegistry"]},{"../../util/ClickTrap":199,"../../util/Cursor":201,"../../util/Event":203,"../../util/PositionUtil":211,"min-dash":219,"min-dom":220}],121:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _hoverFix=_interopRequireDefault(require("../hover-fix")),_selection=_interopRequireDefault(require("../selection")),_Dragging=_interopRequireDefault(require("./Dragging"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _default={__depends__:[_hoverFix.default,_selection.default],dragging:["type",_Dragging.default]};exports.default=_default},{"../hover-fix":123,"../selection":175,"./Dragging":120}],122:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=HoverFix;var _minDom=require("min-dom"),_Event=require("../../util/Event");function HoverFix(elementRegistry,eventBus,injector){var hoverGfx,hover,self=this,dragging=injector.get("dragging",!1);dragging&&eventBus.on("drag.start",(function(event){eventBus.once("drag.move",1500,(function(event){!function(event){if(!event.hover){var originalEvent=event.originalEvent,gfx=self._findTargetGfx(originalEvent),element=gfx&&elementRegistry.get(gfx);gfx&&element&&(event.stopPropagation(),dragging.hover({element,gfx}),dragging.move(originalEvent))}}(event)}))})),eventBus.on("element.hover",(function(event){hoverGfx=event.gfx,hover=event.element})),eventBus.on("element.hover",1500,(function(event){hover&&eventBus.fire("element.out",{element:hover,gfx:hoverGfx})})),eventBus.on("element.out",(function(){hoverGfx=null,hover=null})),this._findTargetGfx=function(event){var position;if(event instanceof MouseEvent)return position=(0,_Event.toPoint)(event),function(target){return(0,_minDom.closest)(target,"svg, .djs-element",!0)}(document.elementFromPoint(position.x,position.y))}}HoverFix.$inject=["elementRegistry","eventBus","injector"]},{"../../util/Event":203,"min-dom":220}],123:[function(require,module,exports){"use strict";var obj;Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={__init__:["hoverFix"],hoverFix:["type",((obj=require("./HoverFix"))&&obj.__esModule?obj:{default:obj}).default]};exports.default=_default},{"./HoverFix":122}],124:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=InteractionEvents;var _minDash=require("min-dash"),_minDom=require("min-dom"),_Mouse=require("../../util/Mouse"),_tinySvg=require("tiny-svg"),_RenderUtil=require("../../util/RenderUtil");function allowAll(event){return!0}function allowPrimaryAndAuxiliary(event){return(0,_Mouse.isPrimaryButton)(event)||(0,_Mouse.isAuxiliaryButton)(event)}function InteractionEvents(eventBus,elementRegistry,styles){var self=this;function fire(type,event,element){var target,gfx;(function(localEventName,event){return!(ignoredFilters[localEventName]||_Mouse.isPrimaryButton)(event)})(type,event)||(element?gfx=elementRegistry.getGraphics(element):(target=event.delegateTarget||event.target)&&(gfx=target,element=elementRegistry.get(gfx)),gfx&&element&&!1===eventBus.fire(type,{element,gfx,originalEvent:event})&&(event.stopPropagation(),event.preventDefault()))}var handlers={};function mouseHandler(localEventName){return handlers[localEventName]}var bindings={click:"element.click",contextmenu:"element.contextmenu",dblclick:"element.dblclick",mousedown:"element.mousedown",mousemove:"element.mousemove",mouseover:"element.hover",mouseout:"element.out",mouseup:"element.mouseup"},ignoredFilters={"element.contextmenu":allowAll,"element.mousedown":allowPrimaryAndAuxiliary,"element.mouseup":allowPrimaryAndAuxiliary,"element.click":allowPrimaryAndAuxiliary,"element.dblclick":allowPrimaryAndAuxiliary};function registerEvent(node,event,localEvent,ignoredFilter){var handler=handlers[localEvent]=function(event){fire(localEvent,event)};ignoredFilter&&(ignoredFilters[localEvent]=ignoredFilter),handler.$delegate=_minDom.delegate.bind(node,"svg, .djs-element",event,handler)}function unregisterEvent(node,event,localEvent){var handler=mouseHandler(localEvent);handler&&_minDom.delegate.unbind(node,event,handler.$delegate)}eventBus.on("canvas.destroy",(function(event){var svg;svg=event.svg,(0,_minDash.forEach)(bindings,(function(val,key){unregisterEvent(svg,key,val)}))})),eventBus.on("canvas.init",(function(event){var svg;svg=event.svg,(0,_minDash.forEach)(bindings,(function(val,key){registerEvent(svg,key,val)}))})),eventBus.on(["shape.added","connection.added"],(function(event){var element=event.element,gfx=event.gfx;eventBus.fire("interactionEvents.createHit",{element,gfx})})),eventBus.on(["shape.changed","connection.changed"],500,(function(event){var element=event.element,gfx=event.gfx;eventBus.fire("interactionEvents.updateHit",{element,gfx})})),eventBus.on("interactionEvents.createHit",500,(function(event){var element=event.element,gfx=event.gfx;self.createDefaultHit(element,gfx)})),eventBus.on("interactionEvents.updateHit",(function(event){var element=event.element,gfx=event.gfx;self.updateDefaultHit(element,gfx)}));var STROKE_HIT_STYLE=createHitStyle("djs-hit djs-hit-stroke"),CLICK_STROKE_HIT_STYLE=createHitStyle("djs-hit djs-hit-click-stroke"),HIT_TYPES={all:createHitStyle("djs-hit djs-hit-all"),"click-stroke":CLICK_STROKE_HIT_STYLE,stroke:STROKE_HIT_STYLE};function createHitStyle(classNames,attrs){return attrs=(0,_minDash.assign)({stroke:"white",strokeWidth:15},attrs||{}),styles.cls(classNames,["no-fill","no-border"],attrs)}function applyStyle(hit,type){var attrs=HIT_TYPES[type];if(!attrs)throw new Error("invalid hit type <"+type+">");return(0,_tinySvg.attr)(hit,attrs),hit}function appendHit(gfx,hit){(0,_tinySvg.append)(gfx,hit)}this.removeHits=function(gfx){var hits=(0,_minDom.queryAll)(".djs-hit",gfx);(0,_minDash.forEach)(hits,_tinySvg.remove)},this.createDefaultHit=function(element,gfx){var boxType,waypoints=element.waypoints,isFrame=element.isFrame;return waypoints?this.createWaypointsHit(gfx,waypoints):(boxType=isFrame?"stroke":"all",this.createBoxHit(gfx,boxType,{width:element.width,height:element.height}))},this.createWaypointsHit=function(gfx,waypoints){var hit=(0,_RenderUtil.createLine)(waypoints);return applyStyle(hit,"stroke"),appendHit(gfx,hit),hit},this.createBoxHit=function(gfx,type,attrs){attrs=(0,_minDash.assign)({x:0,y:0},attrs);var hit=(0,_tinySvg.create)("rect");return applyStyle(hit,type),(0,_tinySvg.attr)(hit,attrs),appendHit(gfx,hit),hit},this.updateDefaultHit=function(element,gfx){var hit=(0,_minDom.query)(".djs-hit",gfx);if(hit)return element.waypoints?(0,_RenderUtil.updateLine)(hit,element.waypoints):(0,_tinySvg.attr)(hit,{width:element.width,height:element.height}),hit},this.fire=fire,this.triggerMouseEvent=function(eventName,event,targetElement){var localEventName=bindings[eventName];if(!localEventName)throw new Error("unmapped DOM event name <"+eventName+">");return fire(localEventName,event,targetElement)},this.mouseHandler=mouseHandler,this.registerEvent=registerEvent,this.unregisterEvent=unregisterEvent}InteractionEvents.$inject=["eventBus","elementRegistry","styles"]},{"../../util/Mouse":209,"../../util/RenderUtil":213,"min-dash":219,"min-dom":220,"tiny-svg":228}],125:[function(require,module,exports){"use strict";var obj;Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={__init__:["interactionEvents"],interactionEvents:["type",((obj=require("./InteractionEvents"))&&obj.__esModule?obj:{default:obj}).default]};exports.default=_default},{"./InteractionEvents":124}],126:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Keyboard;var _minDash=require("min-dash"),_minDom=require("min-dom"),_KeyboardUtil=require("./KeyboardUtil");function Keyboard(config,eventBus){var self=this;this._config=config||{},this._eventBus=eventBus,this._keydownHandler=this._keydownHandler.bind(this),this._keyupHandler=this._keyupHandler.bind(this),eventBus.on("diagram.destroy",(function(){self._fire("destroy"),self.unbind()})),eventBus.on("diagram.init",(function(){self._fire("init")})),eventBus.on("attach",(function(){config&&config.bindTo&&self.bind(config.bindTo)})),eventBus.on("detach",(function(){self.unbind()}))}Keyboard.$inject=["config.keyboard","eventBus"],Keyboard.prototype._keydownHandler=function(event){this._keyHandler(event,"keyboard.keydown")},Keyboard.prototype._keyupHandler=function(event){this._keyHandler(event,"keyboard.keyup")},Keyboard.prototype._keyHandler=function(event,type){if(!this._isEventIgnored(event)){var context={keyEvent:event};this._eventBus.fire(type||"keyboard.keydown",context)&&event.preventDefault()}},Keyboard.prototype._isEventIgnored=function(event){return(target=event.target)&&((0,_minDom.matches)(target,"input, textarea")||"true"===target.contentEditable)&&this._isModifiedKeyIgnored(event);var target},Keyboard.prototype._isModifiedKeyIgnored=function(event){return!(0,_KeyboardUtil.isCmd)(event)||!this._getAllowedModifiers(event.target).includes(event.key)},Keyboard.prototype._getAllowedModifiers=function(element){var modifierContainer=(0,_minDom.closest)(element,"[input-handle-modified-keys]",!0);return!modifierContainer||this._node&&!this._node.contains(modifierContainer)?[]:modifierContainer.getAttribute("input-handle-modified-keys").split(",")},Keyboard.prototype.bind=function(node){this.unbind(),this._node=node,_minDom.event.bind(node,"keydown",this._keydownHandler,!0),_minDom.event.bind(node,"keyup",this._keyupHandler,!0),this._fire("bind")},Keyboard.prototype.getBinding=function(){return this._node},Keyboard.prototype.unbind=function(){var node=this._node;node&&(this._fire("unbind"),_minDom.event.unbind(node,"keydown",this._keydownHandler,!0),_minDom.event.unbind(node,"keyup",this._keyupHandler,!0)),this._node=null},Keyboard.prototype._fire=function(event){this._eventBus.fire("keyboard."+event,{node:this._node})},Keyboard.prototype.addListener=function(priority,listener,type){(0,_minDash.isFunction)(priority)&&(type=listener,listener=priority,priority=1e3),this._eventBus.on(type||"keyboard.keydown",priority,listener)},Keyboard.prototype.removeListener=function(listener,type){this._eventBus.off(type||"keyboard.keydown",listener)},Keyboard.prototype.hasModifier=_KeyboardUtil.hasModifier,Keyboard.prototype.isCmd=_KeyboardUtil.isCmd,Keyboard.prototype.isShift=_KeyboardUtil.isShift,Keyboard.prototype.isKey=_KeyboardUtil.isKey},{"./KeyboardUtil":128,"min-dash":219,"min-dom":220}],127:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=KeyboardBindings,exports.KEYS_UNDO=exports.KEYS_REDO=exports.KEYS_PASTE=exports.KEYS_COPY=exports.KEYCODE_Z=exports.KEYCODE_Y=exports.KEYCODE_V=exports.KEYCODE_C=void 0;var _KeyboardUtil=require("./KeyboardUtil");exports.KEYCODE_C=67;exports.KEYCODE_V=86;exports.KEYCODE_Y=89;exports.KEYCODE_Z=90;var KEYS_COPY=["c","C",67];exports.KEYS_COPY=KEYS_COPY;var KEYS_PASTE=["v","V",86];exports.KEYS_PASTE=KEYS_PASTE;var KEYS_REDO=["y","Y",89];exports.KEYS_REDO=KEYS_REDO;var KEYS_UNDO=["z","Z",90];function KeyboardBindings(eventBus,keyboard){var self=this;eventBus.on("editorActions.init",500,(function(event){var editorActions=event.editorActions;self.registerBindings(keyboard,editorActions)}))}exports.KEYS_UNDO=KEYS_UNDO,KeyboardBindings.$inject=["eventBus","keyboard"],KeyboardBindings.prototype.registerBindings=function(keyboard,editorActions){function addListener(action,fn){editorActions.isRegistered(action)&&keyboard.addListener(fn)}addListener("undo",(function(context){var event=context.keyEvent;if((0,_KeyboardUtil.isCmd)(event)&&!(0,_KeyboardUtil.isShift)(event)&&(0,_KeyboardUtil.isKey)(KEYS_UNDO,event))return editorActions.trigger("undo"),!0})),addListener("redo",(function(context){var event=context.keyEvent;if((0,_KeyboardUtil.isCmd)(event)&&((0,_KeyboardUtil.isKey)(KEYS_REDO,event)||(0,_KeyboardUtil.isKey)(KEYS_UNDO,event)&&(0,_KeyboardUtil.isShift)(event)))return editorActions.trigger("redo"),!0})),addListener("copy",(function(context){var event=context.keyEvent;if((0,_KeyboardUtil.isCmd)(event)&&(0,_KeyboardUtil.isKey)(KEYS_COPY,event))return editorActions.trigger("copy"),!0})),addListener("paste",(function(context){var event=context.keyEvent;if((0,_KeyboardUtil.isCmd)(event)&&(0,_KeyboardUtil.isKey)(KEYS_PASTE,event))return editorActions.trigger("paste"),!0})),addListener("stepZoom",(function(context){var event=context.keyEvent;if((0,_KeyboardUtil.isKey)(["+","Add","="],event)&&(0,_KeyboardUtil.isCmd)(event))return editorActions.trigger("stepZoom",{value:1}),!0})),addListener("stepZoom",(function(context){var event=context.keyEvent;if((0,_KeyboardUtil.isKey)(["-","Subtract"],event)&&(0,_KeyboardUtil.isCmd)(event))return editorActions.trigger("stepZoom",{value:-1}),!0})),addListener("zoom",(function(context){var event=context.keyEvent;if((0,_KeyboardUtil.isKey)("0",event)&&(0,_KeyboardUtil.isCmd)(event))return editorActions.trigger("zoom",{value:1}),!0})),addListener("removeSelection",(function(context){var event=context.keyEvent;if((0,_KeyboardUtil.isKey)(["Backspace","Delete","Del"],event))return editorActions.trigger("removeSelection"),!0}))}},{"./KeyboardUtil":128}],128:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.hasModifier=function(event){return event.ctrlKey||event.metaKey||event.shiftKey||event.altKey},exports.isCmd=function(event){if(event.altKey)return!1;return event.ctrlKey||event.metaKey},exports.isKey=function(keys,event){return-1!==(keys=(0,_minDash.isArray)(keys)?keys:[keys]).indexOf(event.key)||-1!==keys.indexOf(event.keyCode)},exports.isShift=function(event){return event.shiftKey};var _minDash=require("min-dash")},{"min-dash":219}],129:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Keyboard=_interopRequireDefault(require("./Keyboard")),_KeyboardBindings=_interopRequireDefault(require("./KeyboardBindings"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _default={__init__:["keyboard","keyboardBindings"],keyboard:["type",_Keyboard.default],keyboardBindings:["type",_KeyboardBindings.default]};exports.default=_default},{"./Keyboard":126,"./KeyboardBindings":127}],130:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=LabelSupport;var _minDash=require("min-dash"),_inherits=_interopRequireDefault(require("inherits")),_Collections=require("../../util/Collections"),_Removal=require("../../util/Removal"),_CommandInterceptor=_interopRequireDefault(require("../../command/CommandInterceptor"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function LabelSupport(injector,eventBus,modeling){_CommandInterceptor.default.call(this,eventBus);var movePreview=injector.get("movePreview",!1);eventBus.on("shape.move.start",1400,(function(e){var context=e.context,shapes=context.shapes,validatedShapes=context.validatedShapes;context.shapes=removeLabels(shapes),context.validatedShapes=removeLabels(validatedShapes)})),movePreview&&eventBus.on("shape.move.start",250,(function(e){var context=e.context,shapes=context.shapes,labels=[];(0,_minDash.forEach)(shapes,(function(element){(0,_minDash.forEach)(element.labels,(function(label){label.hidden||-1!==context.shapes.indexOf(label)||labels.push(label),element.labelTarget&&labels.push(element)}))})),(0,_minDash.forEach)(labels,(function(label){movePreview.makeDraggable(context,label,!0)}))})),this.preExecuted("elements.move",1400,(function(e){var closure=e.context.closure,enclosedElements=closure.enclosedElements,enclosedLabels=[];(0,_minDash.forEach)(enclosedElements,(function(element){(0,_minDash.forEach)(element.labels,(function(label){enclosedElements[label.id]||enclosedLabels.push(label)}))})),closure.addAll(enclosedLabels)})),this.preExecute(["connection.delete","shape.delete"],(function(e){var context=e.context,element=context.connection||context.shape;(0,_Removal.saveClear)(element.labels,(function(label){modeling.removeShape(label,{nested:!0})}))})),this.execute("shape.delete",(function(e){var context=e.context,shape=context.shape,labelTarget=shape.labelTarget;labelTarget&&(context.labelTargetIndex=(0,_Collections.indexOf)(labelTarget.labels,shape),context.labelTarget=labelTarget,shape.labelTarget=null)})),this.revert("shape.delete",(function(e){var context=e.context,shape=context.shape,labelTarget=context.labelTarget,labelTargetIndex=context.labelTargetIndex;labelTarget&&((0,_Collections.add)(labelTarget.labels,shape,labelTargetIndex),shape.labelTarget=labelTarget)}))}function removeLabels(elements){return(0,_minDash.filter)(elements,(function(element){return-1===elements.indexOf(element.labelTarget)}))}(0,_inherits.default)(LabelSupport,_CommandInterceptor.default),LabelSupport.$inject=["injector","eventBus","modeling"]},{"../../command/CommandInterceptor":96,"../../util/Collections":200,"../../util/Removal":212,inherits:218,"min-dash":219}],131:[function(require,module,exports){"use strict";var obj;Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={__init__:["labelSupport"],labelSupport:["type",((obj=require("./LabelSupport"))&&obj.__esModule?obj:{default:obj}).default]};exports.default=_default},{"./LabelSupport":130}],132:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Modeling;var _minDash=require("min-dash"),_model=require("../../model"),_AlignElementsHandler=_interopRequireDefault(require("./cmd/AlignElementsHandler")),_AppendShapeHandler=_interopRequireDefault(require("./cmd/AppendShapeHandler")),_CreateConnectionHandler=_interopRequireDefault(require("./cmd/CreateConnectionHandler")),_CreateElementsHandler=_interopRequireDefault(require("./cmd/CreateElementsHandler")),_CreateLabelHandler=_interopRequireDefault(require("./cmd/CreateLabelHandler")),_CreateShapeHandler=_interopRequireDefault(require("./cmd/CreateShapeHandler")),_DeleteConnectionHandler=_interopRequireDefault(require("./cmd/DeleteConnectionHandler")),_DeleteElementsHandler=_interopRequireDefault(require("./cmd/DeleteElementsHandler")),_DeleteShapeHandler=_interopRequireDefault(require("./cmd/DeleteShapeHandler")),_DistributeElementsHandler=_interopRequireDefault(require("./cmd/DistributeElementsHandler")),_LayoutConnectionHandler=_interopRequireDefault(require("./cmd/LayoutConnectionHandler")),_MoveConnectionHandler=_interopRequireDefault(require("./cmd/MoveConnectionHandler")),_MoveElementsHandler=_interopRequireDefault(require("./cmd/MoveElementsHandler")),_MoveShapeHandler=_interopRequireDefault(require("./cmd/MoveShapeHandler")),_ReconnectConnectionHandler=_interopRequireDefault(require("./cmd/ReconnectConnectionHandler")),_ReplaceShapeHandler=_interopRequireDefault(require("./cmd/ReplaceShapeHandler")),_ResizeShapeHandler=_interopRequireDefault(require("./cmd/ResizeShapeHandler")),_SpaceToolHandler=_interopRequireDefault(require("./cmd/SpaceToolHandler")),_ToggleShapeCollapseHandler=_interopRequireDefault(require("./cmd/ToggleShapeCollapseHandler")),_UpdateAttachmentHandler=_interopRequireDefault(require("./cmd/UpdateAttachmentHandler")),_UpdateWaypointsHandler=_interopRequireDefault(require("./cmd/UpdateWaypointsHandler"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function Modeling(eventBus,elementFactory,commandStack){this._eventBus=eventBus,this._elementFactory=elementFactory,this._commandStack=commandStack;var self=this;eventBus.on("diagram.init",(function(){self.registerHandlers(commandStack)}))}Modeling.$inject=["eventBus","elementFactory","commandStack"],Modeling.prototype.getHandlers=function(){return{"shape.append":_AppendShapeHandler.default,"shape.create":_CreateShapeHandler.default,"shape.delete":_DeleteShapeHandler.default,"shape.move":_MoveShapeHandler.default,"shape.resize":_ResizeShapeHandler.default,"shape.replace":_ReplaceShapeHandler.default,"shape.toggleCollapse":_ToggleShapeCollapseHandler.default,spaceTool:_SpaceToolHandler.default,"label.create":_CreateLabelHandler.default,"connection.create":_CreateConnectionHandler.default,"connection.delete":_DeleteConnectionHandler.default,"connection.move":_MoveConnectionHandler.default,"connection.layout":_LayoutConnectionHandler.default,"connection.updateWaypoints":_UpdateWaypointsHandler.default,"connection.reconnect":_ReconnectConnectionHandler.default,"elements.create":_CreateElementsHandler.default,"elements.move":_MoveElementsHandler.default,"elements.delete":_DeleteElementsHandler.default,"elements.distribute":_DistributeElementsHandler.default,"elements.align":_AlignElementsHandler.default,"element.updateAttachment":_UpdateAttachmentHandler.default}},Modeling.prototype.registerHandlers=function(commandStack){(0,_minDash.forEach)(this.getHandlers(),(function(handler,id){commandStack.registerHandler(id,handler)}))},Modeling.prototype.moveShape=function(shape,delta,newParent,newParentIndex,hints){"object"==typeof newParentIndex&&(hints=newParentIndex,newParentIndex=null);var context={shape,delta,newParent,newParentIndex,hints:hints||{}};this._commandStack.execute("shape.move",context)},Modeling.prototype.updateAttachment=function(shape,newHost){var context={shape,newHost};this._commandStack.execute("element.updateAttachment",context)},Modeling.prototype.moveElements=function(shapes,delta,target,hints){var newHost,attach=(hints=hints||{}).attach,newParent=target;!0===attach?(newHost=target,newParent=target.parent):!1===attach&&(newHost=null);var context={shapes,delta,newParent,newHost,hints};this._commandStack.execute("elements.move",context)},Modeling.prototype.moveConnection=function(connection,delta,newParent,newParentIndex,hints){"object"==typeof newParentIndex&&(hints=newParentIndex,newParentIndex=void 0);var context={connection,delta,newParent,newParentIndex,hints:hints||{}};this._commandStack.execute("connection.move",context)},Modeling.prototype.layoutConnection=function(connection,hints){var context={connection,hints:hints||{}};this._commandStack.execute("connection.layout",context)},Modeling.prototype.createConnection=function(source,target,parentIndex,connection,parent,hints){"object"==typeof parentIndex&&(hints=parent,parent=connection,connection=parentIndex,parentIndex=void 0);var context={source,target,parent,parentIndex,connection:connection=this._create("connection",connection),hints};return this._commandStack.execute("connection.create",context),context.connection},Modeling.prototype.createShape=function(shape,position,target,parentIndex,hints){"number"!=typeof parentIndex&&(hints=parentIndex,parentIndex=void 0);var parent,host,attach=(hints=hints||{}).attach;shape=this._create("shape",shape),attach?(parent=target.parent,host=target):parent=target;var context={position,shape,parent,parentIndex,host,hints};return this._commandStack.execute("shape.create",context),context.shape},Modeling.prototype.createElements=function(elements,position,parent,parentIndex,hints){(0,_minDash.isArray)(elements)||(elements=[elements]),"number"!=typeof parentIndex&&(hints=parentIndex,parentIndex=void 0);var context={position,elements,parent,parentIndex,hints:hints=hints||{}};return this._commandStack.execute("elements.create",context),context.elements},Modeling.prototype.createLabel=function(labelTarget,position,label,parent){label=this._create("label",label);var context={labelTarget,position,parent:parent||labelTarget.parent,shape:label};return this._commandStack.execute("label.create",context),context.shape},Modeling.prototype.appendShape=function(source,shape,position,target,hints){hints=hints||{};var context={source,position,target,shape:shape=this._create("shape",shape),connection:hints.connection,connectionParent:hints.connectionParent,hints};return this._commandStack.execute("shape.append",context),context.shape},Modeling.prototype.removeElements=function(elements){var context={elements};this._commandStack.execute("elements.delete",context)},Modeling.prototype.distributeElements=function(groups,axis,dimension){var context={groups,axis,dimension};this._commandStack.execute("elements.distribute",context)},Modeling.prototype.removeShape=function(shape,hints){var context={shape,hints:hints||{}};this._commandStack.execute("shape.delete",context)},Modeling.prototype.removeConnection=function(connection,hints){var context={connection,hints:hints||{}};this._commandStack.execute("connection.delete",context)},Modeling.prototype.replaceShape=function(oldShape,newShape,hints){var context={oldShape,newData:newShape,hints:hints||{}};return this._commandStack.execute("shape.replace",context),context.newShape},Modeling.prototype.alignElements=function(elements,alignment){var context={elements,alignment};this._commandStack.execute("elements.align",context)},Modeling.prototype.resizeShape=function(shape,newBounds,minBounds,hints){var context={shape,newBounds,minBounds,hints};this._commandStack.execute("shape.resize",context)},Modeling.prototype.createSpace=function(movingShapes,resizingShapes,delta,direction,start){var context={delta,direction,movingShapes,resizingShapes,start};this._commandStack.execute("spaceTool",context)},Modeling.prototype.updateWaypoints=function(connection,newWaypoints,hints){var context={connection,newWaypoints,hints:hints||{}};this._commandStack.execute("connection.updateWaypoints",context)},Modeling.prototype.reconnect=function(connection,source,target,dockingOrPoints,hints){var context={connection,newSource:source,newTarget:target,dockingOrPoints,hints:hints||{}};this._commandStack.execute("connection.reconnect",context)},Modeling.prototype.reconnectStart=function(connection,newSource,dockingOrPoints,hints){hints||(hints={}),this.reconnect(connection,newSource,connection.target,dockingOrPoints,(0,_minDash.assign)(hints,{docking:"source"}))},Modeling.prototype.reconnectEnd=function(connection,newTarget,dockingOrPoints,hints){hints||(hints={}),this.reconnect(connection,connection.source,newTarget,dockingOrPoints,(0,_minDash.assign)(hints,{docking:"target"}))},Modeling.prototype.connect=function(source,target,attrs,hints){return this.createConnection(source,target,attrs||{},source.parent,hints)},Modeling.prototype._create=function(type,attrs){return attrs instanceof _model.Base?attrs:this._elementFactory.create(type,attrs)},Modeling.prototype.toggleCollapse=function(shape,hints){var context={shape,hints:hints||{}};this._commandStack.execute("shape.toggleCollapse",context)}},{"../../model":190,"./cmd/AlignElementsHandler":133,"./cmd/AppendShapeHandler":134,"./cmd/CreateConnectionHandler":135,"./cmd/CreateElementsHandler":136,"./cmd/CreateLabelHandler":137,"./cmd/CreateShapeHandler":138,"./cmd/DeleteConnectionHandler":139,"./cmd/DeleteElementsHandler":140,"./cmd/DeleteShapeHandler":141,"./cmd/DistributeElementsHandler":142,"./cmd/LayoutConnectionHandler":143,"./cmd/MoveConnectionHandler":144,"./cmd/MoveElementsHandler":145,"./cmd/MoveShapeHandler":146,"./cmd/ReconnectConnectionHandler":147,"./cmd/ReplaceShapeHandler":148,"./cmd/ResizeShapeHandler":149,"./cmd/SpaceToolHandler":150,"./cmd/ToggleShapeCollapseHandler":151,"./cmd/UpdateAttachmentHandler":152,"./cmd/UpdateWaypointsHandler":153,"min-dash":219}],133:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=AlignElements;var _minDash=require("min-dash");function AlignElements(modeling,canvas){this._modeling=modeling,this._canvas=canvas}AlignElements.$inject=["modeling","canvas"],AlignElements.prototype.preExecute=function(context){var modeling=this._modeling,elements=context.elements,alignment=context.alignment;(0,_minDash.forEach)(elements,(function(element){var delta={x:0,y:0};alignment.left?delta.x=alignment.left-element.x:alignment.right?delta.x=alignment.right-element.width-element.x:alignment.center?delta.x=alignment.center-Math.round(element.width/2)-element.x:alignment.top?delta.y=alignment.top-element.y:alignment.bottom?delta.y=alignment.bottom-element.height-element.y:alignment.middle&&(delta.y=alignment.middle-Math.round(element.height/2)-element.y),modeling.moveElements([element],delta,element.parent)}))},AlignElements.prototype.postExecute=function(context){}},{"min-dash":219}],134:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=AppendShapeHandler;var _minDash=require("min-dash");function AppendShapeHandler(modeling){this._modeling=modeling}AppendShapeHandler.$inject=["modeling"],AppendShapeHandler.prototype.preExecute=function(context){var source=context.source;if(!source)throw new Error("source required");var target=context.target||source.parent,shape=context.shape,hints=context.hints||{};shape=context.shape=this._modeling.createShape(shape,context.position,target,{attach:hints.attach}),context.shape=shape},AppendShapeHandler.prototype.postExecute=function(context){var source,target,hints=context.hints||{};source=context.source,target=context.shape,(0,_minDash.some)(source.outgoing,(function(c){return c.target===target}))||(hints.connectionTarget===context.source?this._modeling.connect(context.shape,context.source,context.connection):this._modeling.connect(context.source,context.shape,context.connection))}},{"min-dash":219}],135:[function(require,module,exports){"use strict";function CreateConnectionHandler(canvas,layouter){this._canvas=canvas,this._layouter=layouter}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=CreateConnectionHandler,CreateConnectionHandler.$inject=["canvas","layouter"],CreateConnectionHandler.prototype.execute=function(context){var connection=context.connection,source=context.source,target=context.target,parent=context.parent,parentIndex=context.parentIndex,hints=context.hints;if(!source||!target)throw new Error("source and target required");if(!parent)throw new Error("parent required");return connection.source=source,connection.target=target,connection.waypoints||(connection.waypoints=this._layouter.layoutConnection(connection,hints)),this._canvas.addConnection(connection,parent,parentIndex),connection},CreateConnectionHandler.prototype.revert=function(context){var connection=context.connection;return this._canvas.removeConnection(connection),connection.source=null,connection.target=null,connection}},{}],136:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=CreateElementsHandler;var _minDash=require("min-dash"),_Elements=require("../../../util/Elements"),round=Math.round;function CreateElementsHandler(modeling){this._modeling=modeling}function isConnection(element){return!!element.waypoints}CreateElementsHandler.$inject=["modeling"],CreateElementsHandler.prototype.preExecute=function(context){var elements=context.elements,parent=context.parent,parentIndex=context.parentIndex,position=context.position,hints=context.hints,modeling=this._modeling;(0,_minDash.forEach)(elements,(function(element){(0,_minDash.isNumber)(element.x)||(element.x=0),(0,_minDash.isNumber)(element.y)||(element.y=0)}));var bbox=(0,_Elements.getBBox)(elements);(0,_minDash.forEach)(elements,(function(element){isConnection(element)&&(element.waypoints=(0,_minDash.map)(element.waypoints,(function(waypoint){return{x:round(waypoint.x-bbox.x-bbox.width/2+position.x),y:round(waypoint.y-bbox.y-bbox.height/2+position.y)}}))),(0,_minDash.assign)(element,{x:round(element.x-bbox.x-bbox.width/2+position.x),y:round(element.y-bbox.y-bbox.height/2+position.y)})}));var parents=(0,_Elements.getParents)(elements),cache={};(0,_minDash.forEach)(elements,(function(element){if(isConnection(element))cache[element.id]=(0,_minDash.isNumber)(parentIndex)?modeling.createConnection(cache[element.source.id],cache[element.target.id],parentIndex,element,element.parent||parent,hints):modeling.createConnection(cache[element.source.id],cache[element.target.id],element,element.parent||parent,hints);else{var createShapeHints=(0,_minDash.assign)({},hints);-1===parents.indexOf(element)&&(createShapeHints.autoResize=!1),cache[element.id]=(0,_minDash.isNumber)(parentIndex)?modeling.createShape(element,(0,_minDash.pick)(element,["x","y","width","height"]),element.parent||parent,parentIndex,createShapeHints):modeling.createShape(element,(0,_minDash.pick)(element,["x","y","width","height"]),element.parent||parent,createShapeHints)}})),context.elements=(0,_minDash.values)(cache)}},{"../../../util/Elements":202,"min-dash":219}],137:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=CreateLabelHandler;var _inherits=_interopRequireDefault(require("inherits")),_CreateShapeHandler=_interopRequireDefault(require("./CreateShapeHandler"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function CreateLabelHandler(canvas){_CreateShapeHandler.default.call(this,canvas)}(0,_inherits.default)(CreateLabelHandler,_CreateShapeHandler.default),CreateLabelHandler.$inject=["canvas"];var originalExecute=_CreateShapeHandler.default.prototype.execute;CreateLabelHandler.prototype.execute=function(context){var label=context.shape;return function(label){["width","height"].forEach((function(prop){void 0===label[prop]&&(label[prop]=0)}))}(label),label.labelTarget=context.labelTarget,originalExecute.call(this,context)};var originalRevert=_CreateShapeHandler.default.prototype.revert;CreateLabelHandler.prototype.revert=function(context){return context.shape.labelTarget=null,originalRevert.call(this,context)}},{"./CreateShapeHandler":138,inherits:218}],138:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=CreateShapeHandler;var _minDash=require("min-dash"),round=Math.round;function CreateShapeHandler(canvas){this._canvas=canvas}CreateShapeHandler.$inject=["canvas"],CreateShapeHandler.prototype.execute=function(context){var shape=context.shape,positionOrBounds=context.position,parent=context.parent,parentIndex=context.parentIndex;if(!parent)throw new Error("parent required");if(!positionOrBounds)throw new Error("position required");return void 0!==positionOrBounds.width?(0,_minDash.assign)(shape,positionOrBounds):(0,_minDash.assign)(shape,{x:positionOrBounds.x-round(shape.width/2),y:positionOrBounds.y-round(shape.height/2)}),this._canvas.addShape(shape,parent,parentIndex),shape},CreateShapeHandler.prototype.revert=function(context){var shape=context.shape;return this._canvas.removeShape(shape),shape}},{"min-dash":219}],139:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=DeleteConnectionHandler;var _Collections=require("../../../util/Collections");function DeleteConnectionHandler(canvas,modeling){this._canvas=canvas,this._modeling=modeling}DeleteConnectionHandler.$inject=["canvas","modeling"],DeleteConnectionHandler.prototype.execute=function(context){var connection=context.connection,parent=connection.parent;return context.parent=parent,context.parentIndex=(0,_Collections.indexOf)(parent.children,connection),context.source=connection.source,context.target=connection.target,this._canvas.removeConnection(connection),connection.source=null,connection.target=null,connection},DeleteConnectionHandler.prototype.revert=function(context){var connection=context.connection,parent=context.parent,parentIndex=context.parentIndex;return connection.source=context.source,connection.target=context.target,(0,_Collections.add)(parent.children,connection,parentIndex),this._canvas.addConnection(connection,parent),connection}},{"../../../util/Collections":200}],140:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=DeleteElementsHandler;var _minDash=require("min-dash");function DeleteElementsHandler(modeling,elementRegistry){this._modeling=modeling,this._elementRegistry=elementRegistry}DeleteElementsHandler.$inject=["modeling","elementRegistry"],DeleteElementsHandler.prototype.postExecute=function(context){var modeling=this._modeling,elementRegistry=this._elementRegistry,elements=context.elements;(0,_minDash.forEach)(elements,(function(element){elementRegistry.get(element.id)&&(element.waypoints?modeling.removeConnection(element):modeling.removeShape(element))}))}},{"min-dash":219}],141:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=DeleteShapeHandler;var _Collections=require("../../../util/Collections"),_Removal=require("../../../util/Removal");function DeleteShapeHandler(canvas,modeling){this._canvas=canvas,this._modeling=modeling}DeleteShapeHandler.$inject=["canvas","modeling"],DeleteShapeHandler.prototype.preExecute=function(context){var modeling=this._modeling,shape=context.shape;(0,_Removal.saveClear)(shape.incoming,(function(connection){modeling.removeConnection(connection,{nested:!0})})),(0,_Removal.saveClear)(shape.outgoing,(function(connection){modeling.removeConnection(connection,{nested:!0})})),(0,_Removal.saveClear)(shape.children,(function(child){child.waypoints?modeling.removeConnection(child,{nested:!0}):modeling.removeShape(child,{nested:!0})}))},DeleteShapeHandler.prototype.execute=function(context){var canvas=this._canvas,shape=context.shape,oldParent=shape.parent;return context.oldParent=oldParent,context.oldParentIndex=(0,_Collections.indexOf)(oldParent.children,shape),canvas.removeShape(shape),shape},DeleteShapeHandler.prototype.revert=function(context){var canvas=this._canvas,shape=context.shape,oldParent=context.oldParent,oldParentIndex=context.oldParentIndex;return(0,_Collections.add)(oldParent.children,shape,oldParentIndex),canvas.addShape(shape,oldParent),shape}},{"../../../util/Collections":200,"../../../util/Removal":212}],142:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=DistributeElements;var _minDash=require("min-dash");function DistributeElements(modeling){this._modeling=modeling}DistributeElements.$inject=["modeling"];var OFF_AXIS={x:"y",y:"x"};DistributeElements.prototype.preExecute=function(context){var modeling=this._modeling,groups=context.groups,axis=context.axis,dimension=context.dimension;function updateRange(group,element){group.range.min=Math.min(element[axis],group.range.min),group.range.max=Math.max(element[axis]+element[dimension],group.range.max)}function center(element){return element[axis]+element[dimension]/2}function lastIdx(arr){return arr.length-1}function rangeDiff(range){return range.max-range.min}var margin,spaceInBetween,firstGroup=groups[0],lastGroupIdx=lastIdx(groups),lastGroup=groups[lastGroupIdx],groupsSize=0;(0,_minDash.forEach)(groups,(function(group,idx){var sortedElements,refElem,refCenter;group.elements.length<2?idx&&idx!==groups.length-1&&(updateRange(group,group.elements[0]),groupsSize+=rangeDiff(group.range)):(refElem=(sortedElements=(0,_minDash.sortBy)(group.elements,axis))[0],idx===lastGroupIdx&&(refElem=sortedElements[lastIdx(sortedElements)]),refCenter=center(refElem),group.range=null,(0,_minDash.forEach)(sortedElements,(function(element){!function(refCenter,element){var delta={y:0};delta[axis]=refCenter-center(element),delta[axis]&&(delta[OFF_AXIS[axis]]=0,modeling.moveElements([element],delta,element.parent))}(refCenter,element),null!==group.range?updateRange(group,element):group.range={min:element[axis],max:element[axis]+element[dimension]}})),idx&&idx!==groups.length-1&&(groupsSize+=rangeDiff(group.range)))})),spaceInBetween=Math.abs(lastGroup.range.min-firstGroup.range.max),(margin=Math.round((spaceInBetween-groupsSize)/(groups.length-1)))<groups.length-1||(0,_minDash.forEach)(groups,(function(group,groupIdx){var prevGroup,delta={};group!==firstGroup&&group!==lastGroup&&(prevGroup=groups[groupIdx-1],group.range.max=0,(0,_minDash.forEach)(group.elements,(function(element,idx){delta[OFF_AXIS[axis]]=0,delta[axis]=prevGroup.range.max-element[axis]+margin,group.range.min!==element[axis]&&(delta[axis]+=element[axis]-group.range.min),delta[axis]&&modeling.moveElements([element],delta,element.parent),group.range.max=Math.max(element[axis]+element[dimension],idx?group.range.max:0)})))}))},DistributeElements.prototype.postExecute=function(context){}},{"min-dash":219}],143:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=LayoutConnectionHandler;var _minDash=require("min-dash");function LayoutConnectionHandler(layouter,canvas){this._layouter=layouter,this._canvas=canvas}LayoutConnectionHandler.$inject=["layouter","canvas"],LayoutConnectionHandler.prototype.execute=function(context){var connection=context.connection,oldWaypoints=connection.waypoints;return(0,_minDash.assign)(context,{oldWaypoints}),connection.waypoints=this._layouter.layoutConnection(connection,context.hints),connection},LayoutConnectionHandler.prototype.revert=function(context){var connection=context.connection;return connection.waypoints=context.oldWaypoints,connection}},{"min-dash":219}],144:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=MoveConnectionHandler;var _minDash=require("min-dash"),_Collections=require("../../../util/Collections");function MoveConnectionHandler(){}MoveConnectionHandler.prototype.execute=function(context){var connection=context.connection,delta=context.delta,newParent=context.newParent||connection.parent,newParentIndex=context.newParentIndex,oldParent=connection.parent;return context.oldParent=oldParent,context.oldParentIndex=(0,_Collections.remove)(oldParent.children,connection),(0,_Collections.add)(newParent.children,connection,newParentIndex),connection.parent=newParent,(0,_minDash.forEach)(connection.waypoints,(function(p){p.x+=delta.x,p.y+=delta.y,p.original&&(p.original.x+=delta.x,p.original.y+=delta.y)})),connection},MoveConnectionHandler.prototype.revert=function(context){var connection=context.connection,newParent=connection.parent,oldParent=context.oldParent,oldParentIndex=context.oldParentIndex,delta=context.delta;return(0,_Collections.remove)(newParent.children,connection),(0,_Collections.add)(oldParent.children,connection,oldParentIndex),connection.parent=oldParent,(0,_minDash.forEach)(connection.waypoints,(function(p){p.x-=delta.x,p.y-=delta.y,p.original&&(p.original.x-=delta.x,p.original.y-=delta.y)})),connection}},{"../../../util/Collections":200,"min-dash":219}],145:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=MoveElementsHandler;var obj,_MoveHelper=(obj=require("./helper/MoveHelper"))&&obj.__esModule?obj:{default:obj};function MoveElementsHandler(modeling){this._helper=new _MoveHelper.default(modeling)}MoveElementsHandler.$inject=["modeling"],MoveElementsHandler.prototype.preExecute=function(context){context.closure=this._helper.getClosure(context.shapes)},MoveElementsHandler.prototype.postExecute=function(context){var primaryShape,hints=context.hints;hints&&hints.primaryShape&&(primaryShape=hints.primaryShape,hints.oldParent=primaryShape.parent),this._helper.moveClosure(context.closure,context.delta,context.newParent,context.newHost,primaryShape)}},{"./helper/MoveHelper":156}],146:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=MoveShapeHandler;var obj,_minDash=require("min-dash"),_MoveHelper=(obj=require("./helper/MoveHelper"))&&obj.__esModule?obj:{default:obj},_Collections=require("../../../util/Collections"),_AnchorsHelper=require("./helper/AnchorsHelper");function MoveShapeHandler(modeling){this._modeling=modeling,this._helper=new _MoveHelper.default(modeling)}MoveShapeHandler.$inject=["modeling"],MoveShapeHandler.prototype.execute=function(context){var shape=context.shape,delta=context.delta,newParent=context.newParent||shape.parent,newParentIndex=context.newParentIndex,oldParent=shape.parent;return context.oldBounds=(0,_minDash.pick)(shape,["x","y","width","height"]),context.oldParent=oldParent,context.oldParentIndex=(0,_Collections.remove)(oldParent.children,shape),(0,_Collections.add)(newParent.children,shape,newParentIndex),(0,_minDash.assign)(shape,{parent:newParent,x:shape.x+delta.x,y:shape.y+delta.y}),shape},MoveShapeHandler.prototype.postExecute=function(context){var shape=context.shape,delta=context.delta,hints=context.hints,modeling=this._modeling;!1!==hints.layout&&((0,_minDash.forEach)(shape.incoming,(function(c){modeling.layoutConnection(c,{connectionEnd:(0,_AnchorsHelper.getMovedTargetAnchor)(c,shape,delta)})})),(0,_minDash.forEach)(shape.outgoing,(function(c){modeling.layoutConnection(c,{connectionStart:(0,_AnchorsHelper.getMovedSourceAnchor)(c,shape,delta)})}))),!1!==hints.recurse&&this.moveChildren(context)},MoveShapeHandler.prototype.revert=function(context){var shape=context.shape,oldParent=context.oldParent,oldParentIndex=context.oldParentIndex,delta=context.delta;return(0,_Collections.add)(oldParent.children,shape,oldParentIndex),(0,_minDash.assign)(shape,{parent:oldParent,x:shape.x-delta.x,y:shape.y-delta.y}),shape},MoveShapeHandler.prototype.moveChildren=function(context){var delta=context.delta,shape=context.shape;this._helper.moveRecursive(shape.children,delta,null)},MoveShapeHandler.prototype.getNewParent=function(context){return context.newParent||context.shape.parent}},{"../../../util/Collections":200,"./helper/AnchorsHelper":154,"./helper/MoveHelper":156,"min-dash":219}],147:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ReconnectConnectionHandler;var _minDash=require("min-dash");function ReconnectConnectionHandler(modeling){this._modeling=modeling}function getDocking(point){return point.original||point}ReconnectConnectionHandler.$inject=["modeling"],ReconnectConnectionHandler.prototype.execute=function(context){var newSource=context.newSource,newTarget=context.newTarget,connection=context.connection,dockingOrPoints=context.dockingOrPoints;if(!newSource&&!newTarget)throw new Error("newSource or newTarget required");return(0,_minDash.isArray)(dockingOrPoints)&&(context.oldWaypoints=connection.waypoints,connection.waypoints=dockingOrPoints),newSource&&(context.oldSource=connection.source,connection.source=newSource),newTarget&&(context.oldTarget=connection.target,connection.target=newTarget),connection},ReconnectConnectionHandler.prototype.postExecute=function(context){var connection=context.connection,newSource=context.newSource,newTarget=context.newTarget,dockingOrPoints=context.dockingOrPoints,hints=context.hints||{},layoutConnectionHints={};hints.connectionStart&&(layoutConnectionHints.connectionStart=hints.connectionStart),hints.connectionEnd&&(layoutConnectionHints.connectionEnd=hints.connectionEnd),!1!==hints.layoutConnection&&(!newSource||newTarget&&"source"!==hints.docking||(layoutConnectionHints.connectionStart=layoutConnectionHints.connectionStart||getDocking((0,_minDash.isArray)(dockingOrPoints)?dockingOrPoints[0]:dockingOrPoints)),!newTarget||newSource&&"target"!==hints.docking||(layoutConnectionHints.connectionEnd=layoutConnectionHints.connectionEnd||getDocking((0,_minDash.isArray)(dockingOrPoints)?dockingOrPoints[dockingOrPoints.length-1]:dockingOrPoints)),hints.newWaypoints&&(layoutConnectionHints.waypoints=hints.newWaypoints),this._modeling.layoutConnection(connection,layoutConnectionHints))},ReconnectConnectionHandler.prototype.revert=function(context){var oldSource=context.oldSource,oldTarget=context.oldTarget,oldWaypoints=context.oldWaypoints,connection=context.connection;return oldSource&&(connection.source=oldSource),oldTarget&&(connection.target=oldTarget),oldWaypoints&&(connection.waypoints=oldWaypoints),connection}},{"min-dash":219}],148:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ReplaceShapeHandler;var _minDash=require("min-dash"),_AnchorsHelper=require("./helper/AnchorsHelper");function ReplaceShapeHandler(modeling,rules){this._modeling=modeling,this._rules=rules}ReplaceShapeHandler.$inject=["modeling","rules"],ReplaceShapeHandler.prototype.preExecute=function(context){var newShape,self=this,modeling=this._modeling,rules=this._rules,oldShape=context.oldShape,newData=context.newData,hints=context.hints||{};function canReconnect(source,target,connection){return rules.allowed("connection.reconnect",{connection,source,target})}var children,position={x:newData.x,y:newData.y},oldBounds={x:oldShape.x,y:oldShape.y,width:oldShape.width,height:oldShape.height};newShape=context.newShape=context.newShape||self.createShape(newData,position,oldShape.parent,hints),oldShape.host&&modeling.updateAttachment(newShape,oldShape.host),!1!==hints.moveChildren&&(children=oldShape.children.slice(),modeling.moveElements(children,{x:0,y:0},newShape,hints));var incoming=oldShape.incoming.slice(),outgoing=oldShape.outgoing.slice();(0,_minDash.forEach)(incoming,(function(connection){canReconnect(connection.source,newShape,connection)&&self.reconnectEnd(connection,newShape,(0,_AnchorsHelper.getResizedTargetAnchor)(connection,newShape,oldBounds),hints)})),(0,_minDash.forEach)(outgoing,(function(connection){var target=connection.target;canReconnect(newShape,target,connection)&&self.reconnectStart(connection,newShape,(0,_AnchorsHelper.getResizedSourceAnchor)(connection,newShape,oldBounds),hints)}))},ReplaceShapeHandler.prototype.postExecute=function(context){var oldShape=context.oldShape;this._modeling.removeShape(oldShape)},ReplaceShapeHandler.prototype.execute=function(context){},ReplaceShapeHandler.prototype.revert=function(context){},ReplaceShapeHandler.prototype.createShape=function(shape,position,target,hints){return this._modeling.createShape(shape,position,target,hints)},ReplaceShapeHandler.prototype.reconnectStart=function(connection,newSource,dockingPoint,hints){this._modeling.reconnectStart(connection,newSource,dockingPoint,hints)},ReplaceShapeHandler.prototype.reconnectEnd=function(connection,newTarget,dockingPoint,hints){this._modeling.reconnectEnd(connection,newTarget,dockingPoint,hints)}},{"./helper/AnchorsHelper":154,"min-dash":219}],149:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ResizeShapeHandler;var _minDash=require("min-dash"),_AnchorsHelper=require("./helper/AnchorsHelper");function ResizeShapeHandler(modeling){this._modeling=modeling}ResizeShapeHandler.$inject=["modeling"],ResizeShapeHandler.prototype.execute=function(context){var shape=context.shape,newBounds=context.newBounds,minBounds=context.minBounds;if(void 0===newBounds.x||void 0===newBounds.y||void 0===newBounds.width||void 0===newBounds.height)throw new Error("newBounds must have {x, y, width, height} properties");if(minBounds&&(newBounds.width<minBounds.width||newBounds.height<minBounds.height))throw new Error("width and height cannot be less than minimum height and width");if(!minBounds&&newBounds.width<10||newBounds.height<10)throw new Error("width and height cannot be less than 10px");return context.oldBounds={width:shape.width,height:shape.height,x:shape.x,y:shape.y},(0,_minDash.assign)(shape,{width:newBounds.width,height:newBounds.height,x:newBounds.x,y:newBounds.y}),shape},ResizeShapeHandler.prototype.postExecute=function(context){var modeling=this._modeling,shape=context.shape,oldBounds=context.oldBounds;!1!==(context.hints||{}).layout&&((0,_minDash.forEach)(shape.incoming,(function(c){modeling.layoutConnection(c,{connectionEnd:(0,_AnchorsHelper.getResizedTargetAnchor)(c,shape,oldBounds)})})),(0,_minDash.forEach)(shape.outgoing,(function(c){modeling.layoutConnection(c,{connectionStart:(0,_AnchorsHelper.getResizedSourceAnchor)(c,shape,oldBounds)})})))},ResizeShapeHandler.prototype.revert=function(context){var shape=context.shape,oldBounds=context.oldBounds;return(0,_minDash.assign)(shape,{width:oldBounds.width,height:oldBounds.height,x:oldBounds.x,y:oldBounds.y}),shape}},{"./helper/AnchorsHelper":154,"min-dash":219}],150:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=SpaceToolHandler;var _minDash=require("min-dash"),_SpaceUtil=require("../../space-tool/SpaceUtil"),_AnchorsHelper=require("./helper/AnchorsHelper");function SpaceToolHandler(modeling){this._modeling=modeling}function copyWaypoint(waypoint){return(0,_minDash.assign)({},waypoint)}function getAxisFromDirection(direction){switch(direction){case"n":return"y";case"w":return"x";case"s":return"y";case"e":return"x"}}function shouldMoveWaypoint(waypoint,start,direction){var relevantAxis=getAxisFromDirection(direction);return/e|s/.test(direction)?waypoint[relevantAxis]>start:/n|w/.test(direction)?waypoint[relevantAxis]<start:void 0}function includes(array,item){return-1!==array.indexOf(item)}SpaceToolHandler.$inject=["modeling"],SpaceToolHandler.prototype.preExecute=function(context){var delta=context.delta,direction=context.direction,movingShapes=context.movingShapes,resizingShapes=context.resizingShapes,start=context.start,oldBounds={};this.moveShapes(movingShapes,delta),(0,_minDash.forEach)(resizingShapes,(function(shape){oldBounds[shape.id]=function(shape){return{x:shape.x,y:shape.y,height:shape.height,width:shape.width}}(shape)})),this.resizeShapes(resizingShapes,delta,direction),this.updateConnectionWaypoints((0,_SpaceUtil.getWaypointsUpdatingConnections)(movingShapes,resizingShapes),delta,direction,start,movingShapes,resizingShapes,oldBounds)},SpaceToolHandler.prototype.execute=function(){},SpaceToolHandler.prototype.revert=function(){},SpaceToolHandler.prototype.moveShapes=function(shapes,delta){var self=this;(0,_minDash.forEach)(shapes,(function(element){self._modeling.moveShape(element,delta,null,{autoResize:!1,layout:!1,recurse:!1})}))},SpaceToolHandler.prototype.resizeShapes=function(shapes,delta,direction){var self=this;(0,_minDash.forEach)(shapes,(function(shape){var newBounds=(0,_SpaceUtil.resizeBounds)(shape,direction,delta);self._modeling.resizeShape(shape,newBounds,null,{attachSupport:!1,autoResize:!1,layout:!1})}))},SpaceToolHandler.prototype.updateConnectionWaypoints=function(connections,delta,direction,start,movingShapes,resizingShapes,oldBounds){var self=this,affectedShapes=movingShapes.concat(resizingShapes);(0,_minDash.forEach)(connections,(function(connection){var source=connection.source,target=connection.target,waypoints=function(connection){return(0,_minDash.map)(connection.waypoints,(function(waypoint){return(waypoint=copyWaypoint(waypoint)).original&&(waypoint.original=copyWaypoint(waypoint.original)),waypoint}))}(connection),axis=getAxisFromDirection(direction),layoutHints={labelBehavior:!1};includes(affectedShapes,source)&&includes(affectedShapes,target)?(waypoints=(0,_minDash.map)(waypoints,(function(waypoint){return shouldMoveWaypoint(waypoint,start,direction)&&(waypoint[axis]=waypoint[axis]+delta[axis]),waypoint.original&&shouldMoveWaypoint(waypoint.original,start,direction)&&(waypoint.original[axis]=waypoint.original[axis]+delta[axis]),waypoint})),self._modeling.updateWaypoints(connection,waypoints,{labelBehavior:!1})):(includes(affectedShapes,source)||includes(affectedShapes,target))&&(includes(movingShapes,source)?layoutHints.connectionStart=(0,_AnchorsHelper.getMovedSourceAnchor)(connection,source,delta):includes(movingShapes,target)?layoutHints.connectionEnd=(0,_AnchorsHelper.getMovedTargetAnchor)(connection,target,delta):includes(resizingShapes,source)?layoutHints.connectionStart=(0,_AnchorsHelper.getResizedSourceAnchor)(connection,source,oldBounds[source.id]):includes(resizingShapes,target)&&(layoutHints.connectionEnd=(0,_AnchorsHelper.getResizedTargetAnchor)(connection,target,oldBounds[target.id])),self._modeling.layoutConnection(connection,layoutHints))}))}},{"../../space-tool/SpaceUtil":178,"./helper/AnchorsHelper":154,"min-dash":219}],151:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ToggleShapeCollapseHandler;var _minDash=require("min-dash");function ToggleShapeCollapseHandler(modeling){this._modeling=modeling}ToggleShapeCollapseHandler.$inject=["modeling"],ToggleShapeCollapseHandler.prototype.execute=function(context){var shape=context.shape,children=shape.children;context.oldChildrenVisibility=function getElementsVisibilityRecursive(elements){var result={};return(0,_minDash.forEach)(elements,(function(element){result[element.id]=element.hidden,element.children&&(result=(0,_minDash.assign)({},result,getElementsVisibilityRecursive(element.children)))})),result}(children),shape.collapsed=!shape.collapsed;var result=function setHiddenRecursive(elements,newHidden){var result=[];return(0,_minDash.forEach)(elements,(function(element){element.hidden=newHidden,result=result.concat(element),element.children&&(result=result.concat(setHiddenRecursive(element.children,element.collapsed||newHidden)))})),result}(children,shape.collapsed);return[shape].concat(result)},ToggleShapeCollapseHandler.prototype.revert=function(context){var shape=context.shape,oldChildrenVisibility=context.oldChildrenVisibility,result=function restoreVisibilityRecursive(elements,lastState){var result=[];return(0,_minDash.forEach)(elements,(function(element){element.hidden=lastState[element.id],result=result.concat(element),element.children&&(result=result.concat(restoreVisibilityRecursive(element.children,lastState)))})),result}(shape.children,oldChildrenVisibility);return shape.collapsed=!shape.collapsed,[shape].concat(result)}},{"min-dash":219}],152:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=UpdateAttachmentHandler;var _Collections=require("../../../util/Collections");function UpdateAttachmentHandler(modeling){this._modeling=modeling}function removeAttacher(host,attacher){return(0,_Collections.remove)(host&&host.attachers,attacher)}function addAttacher(host,attacher,idx){if(host){var attachers=host.attachers;attachers||(host.attachers=attachers=[]),(0,_Collections.add)(attachers,attacher,idx)}}UpdateAttachmentHandler.$inject=["modeling"],UpdateAttachmentHandler.prototype.execute=function(context){var shape=context.shape,newHost=context.newHost,oldHost=shape.host;return context.oldHost=oldHost,context.attacherIdx=removeAttacher(oldHost,shape),addAttacher(newHost,shape),shape.host=newHost,shape},UpdateAttachmentHandler.prototype.revert=function(context){var shape=context.shape,newHost=context.newHost,oldHost=context.oldHost,attacherIdx=context.attacherIdx;return shape.host=oldHost,removeAttacher(newHost,shape),addAttacher(oldHost,shape,attacherIdx),shape}},{"../../../util/Collections":200}],153:[function(require,module,exports){"use strict";function UpdateWaypointsHandler(){}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=UpdateWaypointsHandler,UpdateWaypointsHandler.prototype.execute=function(context){var connection=context.connection,newWaypoints=context.newWaypoints;return context.oldWaypoints=connection.waypoints,connection.waypoints=newWaypoints,connection},UpdateWaypointsHandler.prototype.revert=function(context){var connection=context.connection,oldWaypoints=context.oldWaypoints;return connection.waypoints=oldWaypoints,connection}},{}],154:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getResizedSourceAnchor=function(connection,shape,oldBounds){var waypoints=safeGetWaypoints(connection),waypointsInsideNewBounds=getWaypointsInsideBounds(waypoints,shape),oldAnchor=waypoints[0];if(waypointsInsideNewBounds.length)return waypointsInsideNewBounds[waypointsInsideNewBounds.length-1];return(0,_AttachUtil.getNewAttachPoint)(oldAnchor.original||oldAnchor,oldBounds,shape)},exports.getResizedTargetAnchor=function(connection,shape,oldBounds){var waypoints=safeGetWaypoints(connection),waypointsInsideNewBounds=getWaypointsInsideBounds(waypoints,shape),oldAnchor=waypoints[waypoints.length-1];if(waypointsInsideNewBounds.length)return waypointsInsideNewBounds[0];return(0,_AttachUtil.getNewAttachPoint)(oldAnchor.original||oldAnchor,oldBounds,shape)},exports.getMovedSourceAnchor=function(connection,source,moveDelta){var waypoints=safeGetWaypoints(connection),oldBounds=subtract(source,moveDelta),oldAnchor=waypoints[0];return(0,_AttachUtil.getNewAttachPoint)(oldAnchor.original||oldAnchor,oldBounds,source)},exports.getMovedTargetAnchor=function(connection,target,moveDelta){var waypoints=safeGetWaypoints(connection),oldBounds=subtract(target,moveDelta),oldAnchor=waypoints[waypoints.length-1];return(0,_AttachUtil.getNewAttachPoint)(oldAnchor.original||oldAnchor,oldBounds,target)};var _AttachUtil=require("../../../../util/AttachUtil"),_LayoutUtil=require("../../../../layout/LayoutUtil"),_minDash=require("min-dash");function subtract(bounds,delta){return{x:bounds.x-delta.x,y:bounds.y-delta.y,width:bounds.width,height:bounds.height}}function safeGetWaypoints(connection){var waypoints=connection.waypoints;if(!waypoints.length)throw new Error("connection#"+connection.id+": no waypoints");return waypoints}function getWaypointsInsideBounds(waypoints,bounds){var originalWaypoints=(0,_minDash.map)(waypoints,getOriginal);return(0,_minDash.filter)(originalWaypoints,(function(waypoint){return function(point,bounds){return"intersect"===(0,_LayoutUtil.getOrientation)(bounds,point,1)}(waypoint,bounds)}))}function getOriginal(point){return point.original||point}},{"../../../../layout/LayoutUtil":188,"../../../../util/AttachUtil":198,"min-dash":219}],155:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=MoveClosure;var _minDash=require("min-dash"),_Elements=require("../../../../util/Elements");function MoveClosure(){this.allShapes={},this.allConnections={},this.enclosedElements={},this.enclosedConnections={},this.topLevel={}}MoveClosure.prototype.add=function(element,isTopLevel){return this.addAll([element],isTopLevel)},MoveClosure.prototype.addAll=function(elements,isTopLevel){var newClosure=(0,_Elements.getClosure)(elements,!!isTopLevel,this);return(0,_minDash.assign)(this,newClosure),this}},{"../../../../util/Elements":202,"min-dash":219}],156:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=MoveHelper;var obj,_minDash=require("min-dash"),_AnchorsHelper=require("./AnchorsHelper"),_MoveClosure=(obj=require("./MoveClosure"))&&obj.__esModule?obj:{default:obj};function MoveHelper(modeling){this._modeling=modeling}MoveHelper.prototype.moveRecursive=function(elements,delta,newParent){return elements?this.moveClosure(this.getClosure(elements),delta,newParent):[]},MoveHelper.prototype.moveClosure=function(closure,delta,newParent,newHost,primaryShape){var modeling=this._modeling,allShapes=closure.allShapes,allConnections=closure.allConnections,enclosedConnections=closure.enclosedConnections,topLevel=closure.topLevel,keepParent=!1;primaryShape&&primaryShape.parent===newParent&&(keepParent=!0),(0,_minDash.forEach)(allShapes,(function(shape){modeling.moveShape(shape,delta,topLevel[shape.id]&&!keepParent&&newParent,{recurse:!1,layout:!1})})),(0,_minDash.forEach)(allConnections,(function(c){var sourceMoved=!!allShapes[c.source.id],targetMoved=!!allShapes[c.target.id];enclosedConnections[c.id]&&sourceMoved&&targetMoved?modeling.moveConnection(c,delta,topLevel[c.id]&&!keepParent&&newParent):modeling.layoutConnection(c,{connectionStart:sourceMoved&&(0,_AnchorsHelper.getMovedSourceAnchor)(c,c.source,delta),connectionEnd:targetMoved&&(0,_AnchorsHelper.getMovedTargetAnchor)(c,c.target,delta)})}))},MoveHelper.prototype.getClosure=function(elements){return(new _MoveClosure.default).addAll(elements,!0)}},{"./AnchorsHelper":154,"./MoveClosure":155,"min-dash":219}],157:[function(require,module,exports){"use strict";function Mouse(eventBus){var self=this;function setLastMoveEvent(mousemoveEvent){self._lastMoveEvent=mousemoveEvent}this._lastMoveEvent=null,eventBus.on("canvas.init",(function(context){(self._svg=context.svg).addEventListener("mousemove",setLastMoveEvent)})),eventBus.on("canvas.destroy",(function(){self._lastMouseEvent=null,self._svg.removeEventListener("mousemove",setLastMoveEvent)}))}function createMoveEvent(x,y){var event=document.createEvent("MouseEvent"),screenX=x,screenY=y,clientX=x,clientY=y;return event.initMouseEvent&&event.initMouseEvent("mousemove",!0,!0,window,0,screenX,screenY,clientX,clientY,!1,!1,!1,!1,0,null),event}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Mouse,exports.createMoveEvent=createMoveEvent,Mouse.$inject=["eventBus"],Mouse.prototype.getLastMoveEvent=function(){return this._lastMoveEvent||createMoveEvent(0,0)}},{}],158:[function(require,module,exports){"use strict";var obj;Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={__init__:["mouse"],mouse:["type",((obj=require("./Mouse"))&&obj.__esModule?obj:{default:obj}).default]};exports.default=_default},{"./Mouse":157}],159:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=OrderingProvider;var _inherits=_interopRequireDefault(require("inherits")),_CommandInterceptor=_interopRequireDefault(require("../../command/CommandInterceptor"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function OrderingProvider(eventBus){_CommandInterceptor.default.call(this,eventBus);var self=this;this.preExecute(["shape.create","connection.create"],(function(event){var context=event.context,element=context.shape||context.connection,parent=context.parent,ordering=self.getOrdering(element,parent);ordering&&(void 0!==ordering.parent&&(context.parent=ordering.parent),context.parentIndex=ordering.index)})),this.preExecute(["shape.move","connection.move"],(function(event){var context=event.context,element=context.shape||context.connection,parent=context.newParent||element.parent,ordering=self.getOrdering(element,parent);ordering&&(void 0!==ordering.parent&&(context.newParent=ordering.parent),context.newParentIndex=ordering.index)}))}OrderingProvider.prototype.getOrdering=function(element,newParent){return null},(0,_inherits.default)(OrderingProvider,_CommandInterceptor.default)},{"../../command/CommandInterceptor":96,inherits:218}],160:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Outline;var _Elements=require("../../util/Elements"),_tinySvg=require("tiny-svg"),_minDom=require("min-dom"),_minDash=require("min-dash");function Outline(eventBus,styles,elementRegistry){this.offset=6;var OUTLINE_STYLE=styles.cls("djs-outline",["no-fill"]),self=this;function createOutline(gfx,bounds){var outline=(0,_tinySvg.create)("rect");return(0,_tinySvg.attr)(outline,(0,_minDash.assign)({x:10,y:10,width:100,height:100},OUTLINE_STYLE)),(0,_tinySvg.append)(gfx,outline),outline}eventBus.on(["shape.added","shape.changed"],500,(function(event){var element=event.element,gfx=event.gfx,outline=(0,_minDom.query)(".djs-outline",gfx);outline||(outline=createOutline(gfx)),self.updateShapeOutline(outline,element)})),eventBus.on(["connection.added","connection.changed"],(function(event){var element=event.element,gfx=event.gfx,outline=(0,_minDom.query)(".djs-outline",gfx);outline||(outline=createOutline(gfx)),self.updateConnectionOutline(outline,element)}))}Outline.prototype.updateShapeOutline=function(outline,element){(0,_tinySvg.attr)(outline,{x:-this.offset,y:-this.offset,width:element.width+2*this.offset,height:element.height+2*this.offset})},Outline.prototype.updateConnectionOutline=function(outline,connection){var bbox=(0,_Elements.getBBox)(connection);(0,_tinySvg.attr)(outline,{x:bbox.x-this.offset,y:bbox.y-this.offset,width:bbox.width+2*this.offset,height:bbox.height+2*this.offset})},Outline.$inject=["eventBus","styles","elementRegistry"]},{"../../util/Elements":202,"min-dash":219,"min-dom":220,"tiny-svg":228}],161:[function(require,module,exports){"use strict";var obj;Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={__init__:["outline"],outline:["type",((obj=require("./Outline"))&&obj.__esModule?obj:{default:obj}).default]};exports.default=_default},{"./Outline":160}],162:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Overlays;var obj,_minDash=require("min-dash"),_minDom=require("min-dom"),_Elements=require("../../util/Elements");var ids=new(((obj=require("../../util/IdGenerator"))&&obj.__esModule?obj:{default:obj}).default)("ov");function Overlays(config,eventBus,canvas,elementRegistry){var parentNode,root;this._eventBus=eventBus,this._canvas=canvas,this._elementRegistry=elementRegistry,this._ids=ids,this._overlayDefaults=(0,_minDash.assign)({show:null,scale:!0},config&&config.defaults),this._overlays={},this._overlayContainers=[],this._overlayRoot=(parentNode=canvas.getContainer(),root=(0,_minDom.domify)('<div class="djs-overlay-container" style="position: absolute; width: 0; height: 0;" />'),parentNode.insertBefore(root,parentNode.firstChild),root),this._init()}function setPosition(el,x,y){(0,_minDash.assign)(el.style,{left:x+"px",top:y+"px"})}function setVisible(el,visible){el.style.display=!1===visible?"none":""}function setTransform(el,transform){el.style["transform-origin"]="top left",["","-ms-","-webkit-"].forEach((function(prefix){el.style[prefix+"transform"]=transform}))}Overlays.$inject=["config.overlays","eventBus","canvas","elementRegistry"],Overlays.prototype.get=function(search){if((0,_minDash.isString)(search)&&(search={id:search}),(0,_minDash.isString)(search.element)&&(search.element=this._elementRegistry.get(search.element)),search.element){var container=this._getOverlayContainer(search.element,!0);return container?search.type?(0,_minDash.filter)(container.overlays,(0,_minDash.matchPattern)({type:search.type})):container.overlays.slice():[]}return search.type?(0,_minDash.filter)(this._overlays,(0,_minDash.matchPattern)({type:search.type})):search.id?this._overlays[search.id]:null},Overlays.prototype.add=function(element,type,overlay){if((0,_minDash.isObject)(type)&&(overlay=type,type=null),element.id||(element=this._elementRegistry.get(element)),!overlay.position)throw new Error("must specifiy overlay position");if(!overlay.html)throw new Error("must specifiy overlay html");if(!element)throw new Error("invalid element specified");var id=this._ids.next();return overlay=(0,_minDash.assign)({},this._overlayDefaults,overlay,{id,type,element,html:overlay.html}),this._addOverlay(overlay),id},Overlays.prototype.remove=function(filter){var overlays=this.get(filter)||[];(0,_minDash.isArray)(overlays)||(overlays=[overlays]);var self=this;(0,_minDash.forEach)(overlays,(function(overlay){var container=self._getOverlayContainer(overlay.element,!0);if(overlay&&((0,_minDom.remove)(overlay.html),(0,_minDom.remove)(overlay.htmlContainer),delete overlay.htmlContainer,delete overlay.element,delete self._overlays[overlay.id]),container){var idx=container.overlays.indexOf(overlay);-1!==idx&&container.overlays.splice(idx,1)}}))},Overlays.prototype.show=function(){setVisible(this._overlayRoot)},Overlays.prototype.hide=function(){setVisible(this._overlayRoot,!1)},Overlays.prototype.clear=function(){this._overlays={},this._overlayContainers=[],(0,_minDom.clear)(this._overlayRoot)},Overlays.prototype._updateOverlayContainer=function(container){var element=container.element,html=container.html,x=element.x,y=element.y;if(element.waypoints){var bbox=(0,_Elements.getBBox)(element);x=bbox.x,y=bbox.y}setPosition(html,x,y),(0,_minDom.attr)(container.html,"data-container-id",element.id)},Overlays.prototype._updateOverlay=function(overlay){var width,height,position=overlay.position,htmlContainer=overlay.htmlContainer,element=overlay.element,left=position.left,top=position.top;void 0!==position.right&&(width=element.waypoints?(0,_Elements.getBBox)(element).width:element.width,left=-1*position.right+width);void 0!==position.bottom&&(height=element.waypoints?(0,_Elements.getBBox)(element).height:element.height,top=-1*position.bottom+height);setPosition(htmlContainer,left||0,top||0)},Overlays.prototype._createOverlayContainer=function(element){var html=(0,_minDom.domify)('<div class="djs-overlays" style="position: absolute" />');this._overlayRoot.appendChild(html);var container={html,element,overlays:[]};return this._updateOverlayContainer(container),this._overlayContainers.push(container),container},Overlays.prototype._updateRoot=function(viewbox){var scale=viewbox.scale||1,matrix="matrix("+[scale,0,0,scale,-1*viewbox.x*scale,-1*viewbox.y*scale].join(",")+")";setTransform(this._overlayRoot,matrix)},Overlays.prototype._getOverlayContainer=function(element,raw){var container=(0,_minDash.find)(this._overlayContainers,(function(c){return c.element===element}));return container||raw?container:this._createOverlayContainer(element)},Overlays.prototype._addOverlay=function(overlay){var htmlContainer,overlayContainer,id=overlay.id,element=overlay.element,html=overlay.html;html.get&&html.constructor.prototype.jquery&&(html=html.get(0)),(0,_minDash.isString)(html)&&(html=(0,_minDom.domify)(html)),overlayContainer=this._getOverlayContainer(element),(htmlContainer=(0,_minDom.domify)('<div class="djs-overlay" data-overlay-id="'+id+'" style="position: absolute">')).appendChild(html),overlay.type&&(0,_minDom.classes)(htmlContainer).add("djs-overlay-"+overlay.type);var plane=this._canvas.findPlane(element),activePlane=this._canvas.getActivePlane();overlay.plane=plane,plane!==activePlane&&setVisible(htmlContainer,!1),overlay.htmlContainer=htmlContainer,overlayContainer.overlays.push(overlay),overlayContainer.html.appendChild(htmlContainer),this._overlays[id]=overlay,this._updateOverlay(overlay),this._updateOverlayVisibilty(overlay,this._canvas.viewbox())},Overlays.prototype._updateOverlayVisibilty=function(overlay,viewbox){var show=overlay.show,plane=overlay.plane,minZoom=show&&show.minZoom,maxZoom=show&&show.maxZoom,htmlContainer=overlay.htmlContainer,visible=!0;(plane!==this._canvas.getActivePlane()||show&&((0,_minDash.isDefined)(minZoom)&&minZoom>viewbox.scale||(0,_minDash.isDefined)(maxZoom)&&maxZoom<viewbox.scale))&&(visible=!1),setVisible(htmlContainer,visible),this._updateOverlayScale(overlay,viewbox)},Overlays.prototype._updateOverlayScale=function(overlay,viewbox){var minScale,maxScale,scale,shouldScale=overlay.scale,htmlContainer=overlay.htmlContainer,transform="";!0!==shouldScale&&(!1===shouldScale?(minScale=1,maxScale=1):(minScale=shouldScale.min,maxScale=shouldScale.max),(0,_minDash.isDefined)(minScale)&&viewbox.scale<minScale&&(scale=(1/viewbox.scale||1)*minScale),(0,_minDash.isDefined)(maxScale)&&viewbox.scale>maxScale&&(scale=(1/viewbox.scale||1)*maxScale)),(0,_minDash.isDefined)(scale)&&(transform="scale("+scale+","+scale+")"),setTransform(htmlContainer,transform)},Overlays.prototype._updateOverlaysVisibilty=function(viewbox){var self=this;(0,_minDash.forEach)(this._overlays,(function(overlay){self._updateOverlayVisibilty(overlay,viewbox)}))},Overlays.prototype._init=function(){var eventBus=this._eventBus,self=this;eventBus.on("canvas.viewbox.changing",(function(event){self.hide()})),eventBus.on("canvas.viewbox.changed",(function(event){var viewbox;viewbox=event.viewbox,self._updateRoot(viewbox),self._updateOverlaysVisibilty(viewbox),self.show()})),eventBus.on(["shape.remove","connection.remove"],(function(e){var element=e.element,overlays=self.get({element});(0,_minDash.forEach)(overlays,(function(o){self.remove(o.id)}));var container=self._getOverlayContainer(element);if(container){(0,_minDom.remove)(container.html);var i=self._overlayContainers.indexOf(container);-1!==i&&self._overlayContainers.splice(i,1)}})),eventBus.on("element.changed",500,(function(e){var element=e.element,container=self._getOverlayContainer(element,!0);container&&((0,_minDash.forEach)(container.overlays,(function(overlay){self._updateOverlay(overlay)})),self._updateOverlayContainer(container))})),eventBus.on("element.marker.update",(function(e){var container=self._getOverlayContainer(e.element,!0);container&&(0,_minDom.classes)(container.html)[e.add?"add":"remove"](e.marker)})),eventBus.on("plane.set",(function(e){(0,_minDash.forEach)(self._overlays,(function(el){setVisible(el.htmlContainer,el.plane===e.plane)}))})),eventBus.on("diagram.clear",this.clear,this)}},{"../../util/Elements":202,"../../util/IdGenerator":206,"min-dash":219,"min-dom":220}],163:[function(require,module,exports){"use strict";var obj;Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={__init__:["overlays"],overlays:["type",((obj=require("./Overlays"))&&obj.__esModule?obj:{default:obj}).default]};exports.default=_default},{"./Overlays":162}],164:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=PreviewSupport;var _minDash=require("min-dash"),_tinySvg=require("tiny-svg"),_minDom=require("min-dom"),_GraphicsUtil=require("../../util/GraphicsUtil"),MARKER_TYPES=["marker-start","marker-mid","marker-end"],NODES_CAN_HAVE_MARKER=["circle","ellipse","line","path","polygon","polyline","rect"];function PreviewSupport(elementRegistry,eventBus,canvas,styles){this._elementRegistry=elementRegistry,this._canvas=canvas,this._styles=styles,this._clonedMarkers={};var self=this;eventBus.on("drag.cleanup",(function(){(0,_minDash.forEach)(self._clonedMarkers,(function(clonedMarker){(0,_tinySvg.remove)(clonedMarker)})),self._clonedMarkers={}}))}PreviewSupport.$inject=["elementRegistry","eventBus","canvas","styles"],PreviewSupport.prototype.getGfx=function(element){return this._elementRegistry.getGraphics(element)},PreviewSupport.prototype.addDragger=function(element,group,gfx){gfx=gfx||this.getGfx(element);var dragger=(0,_tinySvg.clone)(gfx),bbox=gfx.getBoundingClientRect();return this._cloneMarkers((0,_GraphicsUtil.getVisual)(dragger)),(0,_tinySvg.attr)(dragger,this._styles.cls("djs-dragger",[],{x:bbox.top,y:bbox.left})),(0,_tinySvg.append)(group,dragger),dragger},PreviewSupport.prototype.addFrame=function(shape,group){var frame=(0,_tinySvg.create)("rect",{class:"djs-resize-overlay",width:shape.width,height:shape.height,x:shape.x,y:shape.y});return(0,_tinySvg.append)(group,frame),frame},PreviewSupport.prototype._cloneMarkers=function(gfx){var node,self=this;if(gfx.childNodes)for(var i=0;i<gfx.childNodes.length;i++)self._cloneMarkers(gfx.childNodes[i]);(node=gfx,-1!==NODES_CAN_HAVE_MARKER.indexOf(node.nodeName))&&MARKER_TYPES.forEach((function(markerType){if((0,_tinySvg.attr)(gfx,markerType)){var marker=function(node,markerType,parentNode){var id=(reference=(0,_tinySvg.attr)(node,markerType),reference.match(/url\(['"]?#([^'"]*)['"]?\)/)[1]);var reference;return(0,_minDom.query)("marker#"+id,parentNode||document)}(gfx,markerType,self._canvas.getContainer());self._cloneMarker(gfx,marker,markerType)}}))},PreviewSupport.prototype._cloneMarker=function(gfx,marker,markerType){var markerId=marker.id,clonedMarker=this._clonedMarkers[markerId];if(!clonedMarker){var clonedMarkerId=markerId+"-clone";(clonedMarker=(0,_tinySvg.clone)(marker)).id=clonedMarkerId,(0,_tinySvg.classes)(clonedMarker).add("djs-dragger").add("djs-dragger-marker"),this._clonedMarkers[markerId]=clonedMarker;var defs=(0,_minDom.query)("defs",this._canvas._svg);defs||(defs=(0,_tinySvg.create)("defs"),(0,_tinySvg.append)(this._canvas._svg,defs)),(0,_tinySvg.append)(defs,clonedMarker)}var reference="url(#"+this._clonedMarkers[markerId].id+")";(0,_tinySvg.attr)(gfx,markerType,reference)}},{"../../util/GraphicsUtil":205,"min-dash":219,"min-dom":220,"tiny-svg":228}],165:[function(require,module,exports){"use strict";var obj;Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={__init__:["previewSupport"],previewSupport:["type",((obj=require("./PreviewSupport"))&&obj.__esModule?obj:{default:obj}).default]};exports.default=_default},{"./PreviewSupport":164}],166:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Replace;var _minDash=require("min-dash"),round=Math.round;function Replace(modeling){this._modeling=modeling}Replace.$inject=["modeling"],Replace.prototype.replaceElement=function(oldElement,newElementData,options){if(oldElement.waypoints)return null;var modeling=this._modeling,width=newElementData.width||oldElement.width,height=newElementData.height||oldElement.height,x=newElementData.x||oldElement.x,y=newElementData.y||oldElement.y,centerX=round(x+width/2),centerY=round(y+height/2);return modeling.replaceShape(oldElement,(0,_minDash.assign)({},newElementData,{x:centerX,y:centerY,width,height}),options)}},{"min-dash":219}],167:[function(require,module,exports){"use strict";var obj;Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={__init__:["replace"],replace:["type",((obj=require("./Replace"))&&obj.__esModule?obj:{default:obj}).default]};exports.default=_default},{"./Replace":166}],168:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.substractTRBL=function(trblA,trblB){return{top:trblA.top-trblB.top,right:trblA.right-trblB.right,bottom:trblA.bottom-trblB.bottom,left:trblA.left-trblB.left}},exports.resizeBounds=function(bounds,direction,delta){var dx=delta.x,dy=delta.y,newBounds={x:bounds.x,y:bounds.y,width:bounds.width,height:bounds.height};-1!==direction.indexOf("n")?(newBounds.y=bounds.y+dy,newBounds.height=bounds.height-dy):-1!==direction.indexOf("s")&&(newBounds.height=bounds.height+dy);-1!==direction.indexOf("e")?newBounds.width=bounds.width+dx:-1!==direction.indexOf("w")&&(newBounds.x=bounds.x+dx,newBounds.width=bounds.width-dx);return newBounds},exports.resizeTRBL=function(bounds,resize){return{x:bounds.x+(resize.left||0),y:bounds.y+(resize.top||0),width:bounds.width-(resize.left||0)+(resize.right||0),height:bounds.height-(resize.top||0)+(resize.bottom||0)}},exports.reattachPoint=function(bounds,newBounds,point){var sx=bounds.width/newBounds.width,sy=bounds.height/newBounds.height;return{x:Math.round(newBounds.x+newBounds.width/2)-Math.floor((bounds.x+bounds.width/2-point.x)/sx),y:Math.round(newBounds.y+newBounds.height/2)-Math.floor((bounds.y+bounds.height/2-point.y)/sy)}},exports.ensureConstraints=function(currentBounds,resizeConstraints){if(!resizeConstraints)return currentBounds;var currentTrbl=(0,_LayoutUtil.asTRBL)(currentBounds);return(0,_LayoutUtil.asBounds)({top:applyConstraints("top",currentTrbl,resizeConstraints),right:applyConstraints("right",currentTrbl,resizeConstraints),bottom:applyConstraints("bottom",currentTrbl,resizeConstraints),left:applyConstraints("left",currentTrbl,resizeConstraints)})},exports.getMinResizeBounds=function(direction,currentBounds,minDimensions,childrenBounds){var currentBox=(0,_LayoutUtil.asTRBL)(currentBounds),minBox={top:/n/.test(direction)?currentBox.bottom-minDimensions.height:currentBox.top,left:/w/.test(direction)?currentBox.right-minDimensions.width:currentBox.left,bottom:/s/.test(direction)?currentBox.top+minDimensions.height:currentBox.bottom,right:/e/.test(direction)?currentBox.left+minDimensions.width:currentBox.right},childrenBox=childrenBounds?(0,_LayoutUtil.asTRBL)(childrenBounds):minBox,combinedBox={top:min(minBox.top,childrenBox.top),left:min(minBox.left,childrenBox.left),bottom:max(minBox.bottom,childrenBox.bottom),right:max(minBox.right,childrenBox.right)};return(0,_LayoutUtil.asBounds)(combinedBox)},exports.addPadding=addPadding,exports.computeChildrenBBox=function(shapeOrChildren,padding){var elements;elements=void 0===shapeOrChildren.length?(0,_minDash.filter)(shapeOrChildren.children,isBBoxChild):shapeOrChildren;if(elements.length)return addPadding((0,_Elements.getBBox)(elements),padding)};var _minDash=require("min-dash"),_Elements=require("../../util/Elements"),_LayoutUtil=require("../../layout/LayoutUtil"),max=Math.max,min=Math.min;function applyConstraints(attr,trbl,resizeConstraints){var value=trbl[attr],minValue=resizeConstraints.min&&resizeConstraints.min[attr],maxValue=resizeConstraints.max&&resizeConstraints.max[attr];return(0,_minDash.isNumber)(minValue)&&(value=(/top|left/.test(attr)?min:max)(value,minValue)),(0,_minDash.isNumber)(maxValue)&&(value=(/top|left/.test(attr)?max:min)(value,maxValue)),value}function asPadding(mayBePadding,defaultValue){return void 0!==mayBePadding?mayBePadding:20}function addPadding(bbox,padding){var left,right,top,bottom;return"object"==typeof padding?(left=asPadding(padding.left),right=asPadding(padding.right),top=asPadding(padding.top),bottom=asPadding(padding.bottom)):left=right=top=bottom=asPadding(padding),{x:bbox.x-left,y:bbox.y-top,width:bbox.width+left+right,height:bbox.height+top+bottom}}function isBBoxChild(element){return!element.waypoints&&"label"!==element.type}},{"../../layout/LayoutUtil":188,"../../util/Elements":202,"min-dash":219}],169:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=RuleProvider;var _inherits=_interopRequireDefault(require("inherits")),_CommandInterceptor=_interopRequireDefault(require("../../command/CommandInterceptor"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function RuleProvider(eventBus){_CommandInterceptor.default.call(this,eventBus),this.init()}RuleProvider.$inject=["eventBus"],(0,_inherits.default)(RuleProvider,_CommandInterceptor.default),RuleProvider.prototype.addRule=function(actions,priority,fn){var self=this;"string"==typeof actions&&(actions=[actions]),actions.forEach((function(action){self.canExecute(action,priority,(function(context,action,event){return fn(context)}),!0)}))},RuleProvider.prototype.init=function(){}},{"../../command/CommandInterceptor":96,inherits:218}],170:[function(require,module,exports){"use strict";function Rules(injector){this._commandStack=injector.get("commandStack",!1)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Rules,Rules.$inject=["injector"],Rules.prototype.allowed=function(action,context){var allowed=!0,commandStack=this._commandStack;return commandStack&&(allowed=commandStack.canExecute(action,context)),void 0===allowed||allowed}},{}],171:[function(require,module,exports){"use strict";var obj;Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={__init__:["rules"],rules:["type",((obj=require("./Rules"))&&obj.__esModule?obj:{default:obj}).default]};exports.default=_default},{"./Rules":170}],172:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Selection;var _minDash=require("min-dash");function Selection(eventBus,canvas){this._eventBus=eventBus,this._canvas=canvas,this._selectedElements=[];var self=this;eventBus.on(["shape.remove","connection.remove"],(function(e){var element=e.element;self.deselect(element)})),eventBus.on(["diagram.clear","plane.set"],(function(e){self.select(null)}))}Selection.$inject=["eventBus","canvas"],Selection.prototype.deselect=function(element){var selectedElements=this._selectedElements,idx=selectedElements.indexOf(element);if(-1!==idx){var oldSelection=selectedElements.slice();selectedElements.splice(idx,1),this._eventBus.fire("selection.changed",{oldSelection,newSelection:selectedElements})}},Selection.prototype.get=function(){return this._selectedElements},Selection.prototype.isSelected=function(element){return-1!==this._selectedElements.indexOf(element)},Selection.prototype.select=function(elements,add){var selectedElements=this._selectedElements,oldSelection=selectedElements.slice();(0,_minDash.isArray)(elements)||(elements=elements?[elements]:[]);var canvas=this._canvas;elements=elements.filter((function(element){return canvas.findPlane(element)===canvas.getActivePlane()})),add?(0,_minDash.forEach)(elements,(function(element){-1===selectedElements.indexOf(element)&&selectedElements.push(element)})):this._selectedElements=selectedElements=elements.slice(),this._eventBus.fire("selection.changed",{oldSelection,newSelection:selectedElements})}},{"min-dash":219}],173:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=SelectionBehavior;var _Mouse=require("../../util/Mouse"),_minDash=require("min-dash");function SelectionBehavior(eventBus,selection,canvas,elementRegistry){eventBus.on("create.end",500,(function(event){var context=event.context,canExecute=context.canExecute,elements=context.elements,autoSelect=(context.hints||{}).autoSelect;if(canExecute){if(!1===autoSelect)return;(0,_minDash.isArray)(autoSelect)?selection.select(autoSelect):selection.select(elements.filter(isShown))}})),eventBus.on("connect.end",500,(function(event){var context=event.context,canExecute=context.canExecute,hover=context.hover;canExecute&&hover&&selection.select(hover)})),eventBus.on("shape.move.end",500,(function(event){var previousSelection=event.previousSelection||[],shape=elementRegistry.get(event.context.shape.id);(0,_minDash.find)(previousSelection,(function(selectedShape){return shape.id===selectedShape.id}))||selection.select(shape)})),eventBus.on("element.click",(function(event){if((0,_Mouse.isPrimaryButton)(event)){var element=event.element;element===canvas.getRootElement()&&(element=null);var isSelected=selection.isSelected(element),isMultiSelect=selection.get().length>1,add=(0,_Mouse.hasPrimaryModifier)(event)||(0,_Mouse.hasSecondaryModifier)(event);if(isSelected&&isMultiSelect)return add?selection.deselect(element):selection.select(element);isSelected?selection.deselect(element):selection.select(element,add)}}))}function isShown(element){return!element.hidden}SelectionBehavior.$inject=["eventBus","selection","canvas","elementRegistry"]},{"../../util/Mouse":209,"min-dash":219}],174:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=SelectionVisuals;var _minDash=require("min-dash");function SelectionVisuals(events,canvas,selection,styles){function addMarker(e,cls){canvas.addMarker(e,cls)}function removeMarker(e,cls){canvas.removeMarker(e,cls)}this._multiSelectionBox=null,events.on("element.hover",(function(event){addMarker(event.element,"hover")})),events.on("element.out",(function(event){removeMarker(event.element,"hover")})),events.on("selection.changed",(function(event){var oldSelection=event.oldSelection,newSelection=event.newSelection;(0,_minDash.forEach)(oldSelection,(function(e){-1===newSelection.indexOf(e)&&removeMarker(e,"selected")})),(0,_minDash.forEach)(newSelection,(function(e){-1===oldSelection.indexOf(e)&&addMarker(e,"selected")}))}))}SelectionVisuals.$inject=["eventBus","canvas","selection","styles"]},{"min-dash":219}],175:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _interactionEvents=_interopRequireDefault(require("../interaction-events")),_outline=_interopRequireDefault(require("../outline")),_Selection=_interopRequireDefault(require("./Selection")),_SelectionVisuals=_interopRequireDefault(require("./SelectionVisuals")),_SelectionBehavior=_interopRequireDefault(require("./SelectionBehavior"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _default={__init__:["selectionVisuals","selectionBehavior"],__depends__:[_interactionEvents.default,_outline.default],selection:["type",_Selection.default],selectionVisuals:["type",_SelectionVisuals.default],selectionBehavior:["type",_SelectionBehavior.default]};exports.default=_default},{"../interaction-events":125,"../outline":161,"./Selection":172,"./SelectionBehavior":173,"./SelectionVisuals":174}],176:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=SpaceTool;var _minDash=require("min-dash"),_LayoutUtil=require("../../layout/LayoutUtil"),_Elements=require("../../util/Elements"),_SpaceUtil=require("./SpaceUtil"),_Mouse=require("../../util/Mouse"),_Cursor=require("../../util/Cursor"),abs=Math.abs,round=Math.round,AXIS_TO_DIMENSION={x:"width",y:"height"},DIRECTION_TO_TRBL={n:"top",w:"left",s:"bottom",e:"right"},DIRECTION_TO_OPPOSITE={n:"s",w:"e",s:"n",e:"w"};function SpaceTool(canvas,dragging,eventBus,modeling,rules,toolManager,mouse){this._canvas=canvas,this._dragging=dragging,this._eventBus=eventBus,this._modeling=modeling,this._rules=rules,this._toolManager=toolManager,this._mouse=mouse;var self=this;toolManager.registerTool("space",{tool:"spaceTool.selection",dragging:"spaceTool"}),eventBus.on("spaceTool.selection.end",(function(event){eventBus.once("spaceTool.selection.ended",(function(){self.activateMakeSpace(event.originalEvent)}))})),eventBus.on("spaceTool.move",1500,(function(event){var context=event.context,initialized=context.initialized;initialized||(initialized=context.initialized=self.init(event,context)),initialized&&ensureConstraints(event)})),eventBus.on("spaceTool.end",(function(event){var context=event.context,axis=context.axis,direction=context.direction,movingShapes=context.movingShapes,resizingShapes=context.resizingShapes,start=context.start;if(context.initialized){ensureConstraints(event);var delta={x:0,y:0};delta[axis]=round(event["d"+axis]),self.makeSpace(movingShapes,resizingShapes,delta,direction,start),eventBus.once("spaceTool.ended",(function(event){self.activateSelection(event.originalEvent,!0,!0)}))}}))}function addPadding(trbl){return{top:trbl.top-20,right:trbl.right+20,bottom:trbl.bottom+20,left:trbl.left-20}}function ensureConstraints(event){var x,y,spaceToolConstraints=event.context.spaceToolConstraints;spaceToolConstraints&&((0,_minDash.isNumber)(spaceToolConstraints.left)&&(x=Math.max(event.x,spaceToolConstraints.left),event.dx=event.dx+x-event.x,event.x=x),(0,_minDash.isNumber)(spaceToolConstraints.right)&&(x=Math.min(event.x,spaceToolConstraints.right),event.dx=event.dx+x-event.x,event.x=x),(0,_minDash.isNumber)(spaceToolConstraints.top)&&(y=Math.max(event.y,spaceToolConstraints.top),event.dy=event.dy+y-event.y,event.y=y),(0,_minDash.isNumber)(spaceToolConstraints.bottom)&&(y=Math.min(event.y,spaceToolConstraints.bottom),event.dy=event.dy+y-event.y,event.y=y))}function includes(array,item){return-1!==array.indexOf(item)}function isConnection(element){return!!element.waypoints}function isLabel(element){return!!element.labelTarget}SpaceTool.$inject=["canvas","dragging","eventBus","modeling","rules","toolManager","mouse"],SpaceTool.prototype.activateSelection=function(event,autoActivate,reactivate){this._dragging.init(event,"spaceTool.selection",{autoActivate,cursor:"crosshair",data:{context:{reactivate}},trapClick:!1})},SpaceTool.prototype.activateMakeSpace=function(event){this._dragging.init(event,"spaceTool",{autoActivate:!0,cursor:"crosshair",data:{context:{}}})},SpaceTool.prototype.makeSpace=function(movingShapes,resizingShapes,delta,direction,start){return this._modeling.createSpace(movingShapes,resizingShapes,delta,direction,start)},SpaceTool.prototype.init=function(event,context){var axis=abs(event.dx)>abs(event.dy)?"x":"y",delta=event["d"+axis],start=event[axis]-delta;if(abs(delta)<5)return!1;delta<0&&(delta*=-1),(0,_Mouse.hasPrimaryModifier)(event)&&(delta*=-1);var direction=(0,_SpaceUtil.getDirection)(axis,delta),root=this._canvas.getRootElement(),children=(0,_Elements.selfAndAllChildren)(root,!0),elements=this.calculateAdjustments(children,axis,delta,start),spaceToolConstraints=function(elements,axis,direction,start,minDimensions){var movingShapes=elements.movingShapes,resizingShapes=elements.resizingShapes;if(!resizingShapes.length)return;var min,max,spaceToolConstraints={};return(0,_minDash.forEach)(resizingShapes,(function(resizingShape){var minOrMax,nonMovingResizingChildrenBBox,movingChildrenBBox,resizingShapeBBox=(0,_LayoutUtil.asTRBL)(resizingShape),nonMovingResizingChildren=(0,_minDash.filter)(resizingShape.children,(function(child){return!(isConnection(child)||isLabel(child)||includes(movingShapes,child)||includes(resizingShapes,child))})),movingChildren=(0,_minDash.filter)(resizingShape.children,(function(child){return!isConnection(child)&&!isLabel(child)&&includes(movingShapes,child)}));nonMovingResizingChildren.length&&(nonMovingResizingChildrenBBox=addPadding((0,_LayoutUtil.asTRBL)((0,_Elements.getBBox)(nonMovingResizingChildren))),minOrMax=start-resizingShapeBBox[DIRECTION_TO_TRBL[direction]]+nonMovingResizingChildrenBBox[DIRECTION_TO_TRBL[direction]],"n"===direction?spaceToolConstraints.bottom=max=(0,_minDash.isNumber)(max)?Math.min(max,minOrMax):minOrMax:"w"===direction?spaceToolConstraints.right=max=(0,_minDash.isNumber)(max)?Math.min(max,minOrMax):minOrMax:"s"===direction?spaceToolConstraints.top=min=(0,_minDash.isNumber)(min)?Math.max(min,minOrMax):minOrMax:"e"===direction&&(spaceToolConstraints.left=min=(0,_minDash.isNumber)(min)?Math.max(min,minOrMax):minOrMax)),movingChildren.length&&(movingChildrenBBox=addPadding((0,_LayoutUtil.asTRBL)((0,_Elements.getBBox)(movingChildren))),minOrMax=start-movingChildrenBBox[DIRECTION_TO_TRBL[DIRECTION_TO_OPPOSITE[direction]]]+resizingShapeBBox[DIRECTION_TO_TRBL[DIRECTION_TO_OPPOSITE[direction]]],"n"===direction?spaceToolConstraints.bottom=max=(0,_minDash.isNumber)(max)?Math.min(max,minOrMax):minOrMax:"w"===direction?spaceToolConstraints.right=max=(0,_minDash.isNumber)(max)?Math.min(max,minOrMax):minOrMax:"s"===direction?spaceToolConstraints.top=min=(0,_minDash.isNumber)(min)?Math.max(min,minOrMax):minOrMax:"e"===direction&&(spaceToolConstraints.left=min=(0,_minDash.isNumber)(min)?Math.max(min,minOrMax):minOrMax));var resizingShapeMinDimensions=minDimensions&&minDimensions[resizingShape.id];resizingShapeMinDimensions&&("n"===direction?(minOrMax=start+resizingShape[AXIS_TO_DIMENSION[axis]]-resizingShapeMinDimensions[AXIS_TO_DIMENSION[axis]],spaceToolConstraints.bottom=max=(0,_minDash.isNumber)(max)?Math.min(max,minOrMax):minOrMax):"w"===direction?(minOrMax=start+resizingShape[AXIS_TO_DIMENSION[axis]]-resizingShapeMinDimensions[AXIS_TO_DIMENSION[axis]],spaceToolConstraints.right=max=(0,_minDash.isNumber)(max)?Math.min(max,minOrMax):minOrMax):"s"===direction?(minOrMax=start-resizingShape[AXIS_TO_DIMENSION[axis]]+resizingShapeMinDimensions[AXIS_TO_DIMENSION[axis]],spaceToolConstraints.top=min=(0,_minDash.isNumber)(min)?Math.max(min,minOrMax):minOrMax):"e"===direction&&(minOrMax=start-resizingShape[AXIS_TO_DIMENSION[axis]]+resizingShapeMinDimensions[AXIS_TO_DIMENSION[axis]],spaceToolConstraints.left=min=(0,_minDash.isNumber)(min)?Math.max(min,minOrMax):minOrMax))})),spaceToolConstraints}(elements,axis,direction,start,this._eventBus.fire("spaceTool.getMinDimensions",{axis,direction,shapes:elements.resizingShapes,start}));return(0,_minDash.assign)(context,elements,{axis,direction,spaceToolConstraints,start}),(0,_Cursor.set)("resize-"+("x"===axis?"ew":"ns")),!0},SpaceTool.prototype.calculateAdjustments=function(elements,axis,delta,start){var rules=this._rules,movingShapes=[],resizingShapes=[];return(0,_minDash.forEach)(elements,(function(element){if(element.parent&&!isConnection(element)){var shapeStart=element[axis],shapeEnd=shapeStart+element[AXIS_TO_DIMENSION[axis]];return delta>0&&shapeStart>start||delta<0&&shapeEnd<start?movingShapes.push(element):shapeStart<start&&shapeEnd>start&&rules.allowed("shape.resize",{shape:element})?resizingShapes.push(element):void 0}})),{movingShapes,resizingShapes}},SpaceTool.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var mouseEvent=this._mouse.getLastMoveEvent();this.activateSelection(mouseEvent,!!mouseEvent)},SpaceTool.prototype.isActive=function(){var context=this._dragging.context();return context&&/^spaceTool/.test(context.prefix)}},{"../../layout/LayoutUtil":188,"../../util/Cursor":201,"../../util/Elements":202,"../../util/Mouse":209,"./SpaceUtil":178,"min-dash":219}],177:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=SpaceToolPreview;var _minDash=require("min-dash"),_tinySvg=require("tiny-svg"),_SvgTransformUtil=require("../../util/SvgTransformUtil"),max=Math.max;function SpaceToolPreview(eventBus,elementRegistry,canvas,styles,previewSupport){function addPreviewGfx(collection,dragGroup){(0,_minDash.forEach)(collection,(function(element){previewSupport.addDragger(element,dragGroup),canvas.addMarker(element,"djs-dragging")}))}eventBus.on("spaceTool.selection.start",(function(event){var space=canvas.getLayer("space"),context=event.context,orientation_x="M 0,-10000 L 0,10000",orientation_y="M -10000,0 L 10000,0",crosshairGroup=(0,_tinySvg.create)("g");(0,_tinySvg.attr)(crosshairGroup,styles.cls("djs-crosshair-group",["no-events"])),(0,_tinySvg.append)(space,crosshairGroup);var pathX=(0,_tinySvg.create)("path");(0,_tinySvg.attr)(pathX,"d",orientation_x),(0,_tinySvg.classes)(pathX).add("djs-crosshair"),(0,_tinySvg.append)(crosshairGroup,pathX);var pathY=(0,_tinySvg.create)("path");(0,_tinySvg.attr)(pathY,"d",orientation_y),(0,_tinySvg.classes)(pathY).add("djs-crosshair"),(0,_tinySvg.append)(crosshairGroup,pathY),context.crosshairGroup=crosshairGroup})),eventBus.on("spaceTool.selection.move",(function(event){var crosshairGroup=event.context.crosshairGroup;(0,_SvgTransformUtil.translate)(crosshairGroup,event.x,event.y)})),eventBus.on("spaceTool.selection.cleanup",(function(event){var crosshairGroup=event.context.crosshairGroup;crosshairGroup&&(0,_tinySvg.remove)(crosshairGroup)})),eventBus.on("spaceTool.move",250,(function(event){var context=event.context,line=context.line,axis=context.axis,movingShapes=context.movingShapes,resizingShapes=context.resizingShapes;if(context.initialized){if(!context.dragGroup){var spaceLayer=canvas.getLayer("space");line=(0,_tinySvg.create)("path"),(0,_tinySvg.attr)(line,"d","M0,0 L0,0"),(0,_tinySvg.classes)(line).add("djs-crosshair"),(0,_tinySvg.append)(spaceLayer,line),context.line=line;var dragGroup=(0,_tinySvg.create)("g");(0,_tinySvg.attr)(dragGroup,styles.cls("djs-drag-group",["no-events"])),(0,_tinySvg.append)(canvas.getActiveLayer(),dragGroup),addPreviewGfx(movingShapes,dragGroup),addPreviewGfx(context.movingConnections=elementRegistry.filter((function(element){var sourceIsMoving=!1;(0,_minDash.forEach)(movingShapes,(function(shape){(0,_minDash.forEach)(shape.outgoing,(function(connection){element===connection&&(sourceIsMoving=!0)}))}));var targetIsMoving=!1;(0,_minDash.forEach)(movingShapes,(function(shape){(0,_minDash.forEach)(shape.incoming,(function(connection){element===connection&&(targetIsMoving=!0)}))}));var sourceIsResizing=!1;(0,_minDash.forEach)(resizingShapes,(function(shape){(0,_minDash.forEach)(shape.outgoing,(function(connection){element===connection&&(sourceIsResizing=!0)}))}));var targetIsResizing=!1;return(0,_minDash.forEach)(resizingShapes,(function(shape){(0,_minDash.forEach)(shape.incoming,(function(connection){element===connection&&(targetIsResizing=!0)}))})),function(element){return element.waypoints}(element)&&(sourceIsMoving||sourceIsResizing)&&(targetIsMoving||targetIsResizing)})),dragGroup),context.dragGroup=dragGroup}if(!context.frameGroup){var frameGroup=(0,_tinySvg.create)("g");(0,_tinySvg.attr)(frameGroup,styles.cls("djs-frame-group",["no-events"])),(0,_tinySvg.append)(canvas.getActiveLayer(),frameGroup);var frames=[];(0,_minDash.forEach)(resizingShapes,(function(shape){var frame=previewSupport.addFrame(shape,frameGroup),initialBounds=frame.getBBox();frames.push({element:frame,initialBounds}),canvas.addMarker(shape,"djs-resizing")})),context.frameGroup=frameGroup,context.frames=frames}var orientation={x:"M"+event.x+", -10000 L"+event.x+", 10000",y:"M -10000, "+event.y+" L 10000, "+event.y};(0,_tinySvg.attr)(line,{d:orientation[axis]});var delta={x:event.dx,y:event.dy};delta[{x:"y",y:"x"}[context.axis]]=0,(0,_SvgTransformUtil.translate)(context.dragGroup,delta.x,delta.y),(0,_minDash.forEach)(context.frames,(function(frame){var width,height,element=frame.element,initialBounds=frame.initialBounds;"e"===context.direction?(0,_tinySvg.attr)(element,{width:max(initialBounds.width+delta.x,5)}):(width=max(initialBounds.width-delta.x,5),(0,_tinySvg.attr)(element,{width,x:initialBounds.x+initialBounds.width-width})),"s"===context.direction?(0,_tinySvg.attr)(element,{height:max(initialBounds.height+delta.y,5)}):(height=max(initialBounds.height-delta.y,5),(0,_tinySvg.attr)(element,{height,y:initialBounds.y+initialBounds.height-height}))}))}})),eventBus.on("spaceTool.cleanup",(function(event){var context=event.context,movingShapes=context.movingShapes,movingConnections=context.movingConnections,resizingShapes=context.resizingShapes,line=context.line,dragGroup=context.dragGroup,frameGroup=context.frameGroup;(0,_minDash.forEach)(movingShapes,(function(shape){canvas.removeMarker(shape,"djs-dragging")})),(0,_minDash.forEach)(movingConnections,(function(connection){canvas.removeMarker(connection,"djs-dragging")})),dragGroup&&((0,_tinySvg.remove)(line),(0,_tinySvg.remove)(dragGroup)),(0,_minDash.forEach)(resizingShapes,(function(shape){canvas.removeMarker(shape,"djs-resizing")})),frameGroup&&(0,_tinySvg.remove)(frameGroup)}))}SpaceToolPreview.$inject=["eventBus","elementRegistry","canvas","styles","previewSupport"]},{"../../util/SvgTransformUtil":214,"min-dash":219,"tiny-svg":228}],178:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getDirection=function(axis,delta){if("x"===axis){if(delta>0)return"e";if(delta<0)return"w"}if("y"===axis){if(delta>0)return"s";if(delta<0)return"n"}return null},exports.getWaypointsUpdatingConnections=function(movingShapes,resizingShapes){var waypointsUpdatingConnections=[];return(0,_minDash.forEach)(movingShapes.concat(resizingShapes),(function(shape){var incoming=shape.incoming,outgoing=shape.outgoing;(0,_minDash.forEach)(incoming.concat(outgoing),(function(connection){var source=connection.source,target=connection.target;(includes(movingShapes,source)||includes(movingShapes,target)||includes(resizingShapes,source)||includes(resizingShapes,target))&&(includes(waypointsUpdatingConnections,connection)||waypointsUpdatingConnections.push(connection))}))})),waypointsUpdatingConnections},exports.resizeBounds=function(bounds,direction,delta){var x=bounds.x,y=bounds.y,width=bounds.width,height=bounds.height,dx=delta.x,dy=delta.y;switch(direction){case"n":return{x,y:y+dy,width,height:height-dy};case"s":return{x,y,width,height:height+dy};case"w":return{x:x+dx,y,width:width-dx,height};case"e":return{x,y,width:width+dx,height};default:throw new Error("unknown direction: "+direction)}};var _minDash=require("min-dash");function includes(array,item){return-1!==array.indexOf(item)}},{"min-dash":219}],179:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _dragging=_interopRequireDefault(require("../dragging")),_rules=_interopRequireDefault(require("../rules")),_toolManager=_interopRequireDefault(require("../tool-manager")),_previewSupport=_interopRequireDefault(require("../preview-support")),_mouse=_interopRequireDefault(require("../mouse")),_SpaceTool=_interopRequireDefault(require("./SpaceTool")),_SpaceToolPreview=_interopRequireDefault(require("./SpaceToolPreview"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _default={__init__:["spaceToolPreview"],__depends__:[_dragging.default,_rules.default,_toolManager.default,_previewSupport.default,_mouse.default],spaceTool:["type",_SpaceTool.default],spaceToolPreview:["type",_SpaceToolPreview.default]};exports.default=_default},{"../dragging":121,"../mouse":158,"../preview-support":165,"../rules":171,"../tool-manager":181,"./SpaceTool":176,"./SpaceToolPreview":177}],180:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ToolManager;var _minDash=require("min-dash"),_minDom=require("min-dom");function ToolManager(eventBus,dragging){this._eventBus=eventBus,this._dragging=dragging,this._tools=[],this._active=null}ToolManager.$inject=["eventBus","dragging"],ToolManager.prototype.registerTool=function(name,events){var tools=this._tools;if(!events)throw new Error('A tool has to be registered with it\'s "events"');tools.push(name),this.bindEvents(name,events)},ToolManager.prototype.isActive=function(tool){return tool&&this._active===tool},ToolManager.prototype.length=function(tool){return this._tools.length},ToolManager.prototype.setActive=function(tool){var eventBus=this._eventBus;this._active!==tool&&(this._active=tool,eventBus.fire("tool-manager.update",{tool}))},ToolManager.prototype.bindEvents=function(name,events){var eventBus=this._eventBus,dragging=this._dragging,eventsToRegister=[];eventBus.on(events.tool+".init",(function(event){if(!event.context.reactivate&&this.isActive(name))return this.setActive(null),void dragging.cancel();this.setActive(name)}),this),(0,_minDash.forEach)(events,(function(event){eventsToRegister.push(event+".ended"),eventsToRegister.push(event+".canceled")})),eventBus.on(eventsToRegister,250,(function(event){this._active&&(function(event){var target=event.originalEvent&&event.originalEvent.target;return target&&(0,_minDom.closest)(target,'.group[data-group="tools"]')}(event)||this.setActive(null))}),this)}},{"min-dash":219,"min-dom":220}],181:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _dragging=_interopRequireDefault(require("../dragging")),_ToolManager=_interopRequireDefault(require("./ToolManager"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _default={__depends__:[_dragging.default],__init__:["toolManager"],toolManager:["type",_ToolManager.default]};exports.default=_default},{"../dragging":121,"./ToolManager":180}],182:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Tooltips;var obj,_minDash=require("min-dash"),_minDom=require("min-dom");var ids=new(((obj=require("../../util/IdGenerator"))&&obj.__esModule?obj:{default:obj}).default)("tt");function setVisible(el,visible){el.style.display=!1===visible?"none":""}function Tooltips(eventBus,canvas){var parentNode,root;this._eventBus=eventBus,this._canvas=canvas,this._ids=ids,this._tooltipDefaults={show:{minZoom:.7,maxZoom:5}},this._tooltips={},this._tooltipRoot=(parentNode=canvas.getContainer(),root=(0,_minDom.domify)('<div class="djs-tooltip-container" style="position: absolute; width: 0; height: 0;" />'),parentNode.insertBefore(root,parentNode.firstChild),root);var self=this;_minDom.delegate.bind(this._tooltipRoot,".djs-tooltip","mousedown",(function(event){event.stopPropagation()})),_minDom.delegate.bind(this._tooltipRoot,".djs-tooltip","mouseover",(function(event){self.trigger("mouseover",event)})),_minDom.delegate.bind(this._tooltipRoot,".djs-tooltip","mouseout",(function(event){self.trigger("mouseout",event)})),this._init()}Tooltips.$inject=["eventBus","canvas"],Tooltips.prototype.add=function(tooltip){if(!tooltip.position)throw new Error("must specifiy tooltip position");if(!tooltip.html)throw new Error("must specifiy tooltip html");var id=this._ids.next();return tooltip=(0,_minDash.assign)({},this._tooltipDefaults,tooltip,{id}),this._addTooltip(tooltip),tooltip.timeout&&this.setTimeout(tooltip),id},Tooltips.prototype.trigger=function(action,event){var node=event.delegateTarget||event.target,tooltip=this.get((0,_minDom.attr)(node,"data-tooltip-id"));tooltip&&("mouseover"===action&&tooltip.timeout&&this.clearTimeout(tooltip),"mouseout"===action&&tooltip.timeout&&(tooltip.timeout=1e3,this.setTimeout(tooltip)))},Tooltips.prototype.get=function(id){return"string"!=typeof id&&(id=id.id),this._tooltips[id]},Tooltips.prototype.clearTimeout=function(tooltip){if(tooltip=this.get(tooltip)){var removeTimer=tooltip.removeTimer;removeTimer&&(clearTimeout(removeTimer),tooltip.removeTimer=null)}},Tooltips.prototype.setTimeout=function(tooltip){if(tooltip=this.get(tooltip)){this.clearTimeout(tooltip);var self=this;tooltip.removeTimer=setTimeout((function(){self.remove(tooltip)}),tooltip.timeout)}},Tooltips.prototype.remove=function(id){var tooltip=this.get(id);tooltip&&((0,_minDom.remove)(tooltip.html),(0,_minDom.remove)(tooltip.htmlContainer),delete tooltip.htmlContainer,delete this._tooltips[tooltip.id])},Tooltips.prototype.show=function(){setVisible(this._tooltipRoot)},Tooltips.prototype.hide=function(){setVisible(this._tooltipRoot,!1)},Tooltips.prototype._updateRoot=function(viewbox){var a=viewbox.scale||1,d=viewbox.scale||1,matrix="matrix("+a+",0,0,"+d+","+-1*viewbox.x*a+","+-1*viewbox.y*d+")";this._tooltipRoot.style.transform=matrix,this._tooltipRoot.style["-ms-transform"]=matrix},Tooltips.prototype._addTooltip=function(tooltip){var htmlContainer,id=tooltip.id,html=tooltip.html,tooltipRoot=this._tooltipRoot;html.get&&html.constructor.prototype.jquery&&(html=html.get(0)),(0,_minDash.isString)(html)&&(html=(0,_minDom.domify)(html)),(htmlContainer=(0,_minDom.domify)('<div data-tooltip-id="'+id+'" class="djs-tooltip" style="position: absolute">')).appendChild(html),tooltip.type&&(0,_minDom.classes)(htmlContainer).add("djs-tooltip-"+tooltip.type),tooltip.className&&(0,_minDom.classes)(htmlContainer).add(tooltip.className),tooltip.htmlContainer=htmlContainer,tooltipRoot.appendChild(htmlContainer),this._tooltips[id]=tooltip,this._updateTooltip(tooltip)},Tooltips.prototype._updateTooltip=function(tooltip){var el,x,y,position=tooltip.position,htmlContainer=tooltip.htmlContainer;el=htmlContainer,x=position.x,y=position.y,(0,_minDash.assign)(el.style,{left:x+"px",top:y+"px"})},Tooltips.prototype._updateTooltipVisibilty=function(viewbox){(0,_minDash.forEach)(this._tooltips,(function(tooltip){var show=tooltip.show,htmlContainer=tooltip.htmlContainer,visible=!0;show&&((show.minZoom>viewbox.scale||show.maxZoom<viewbox.scale)&&(visible=!1),setVisible(htmlContainer,visible))}))},Tooltips.prototype._init=function(){var self=this;this._eventBus.on("canvas.viewbox.changing",(function(event){self.hide()})),this._eventBus.on("canvas.viewbox.changed",(function(event){var viewbox;viewbox=event.viewbox,self._updateRoot(viewbox),self._updateTooltipVisibilty(viewbox),self.show()}))}},{"../../util/IdGenerator":206,"min-dash":219,"min-dom":220}],183:[function(require,module,exports){"use strict";var obj;Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={__init__:["tooltips"],tooltips:["type",((obj=require("./Tooltips"))&&obj.__esModule?obj:{default:obj}).default]};exports.default=_default},{"./Tooltips":182}],184:[function(require,module,exports){"use strict";var obj;Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={translate:["value",((obj=require("./translate"))&&obj.__esModule?obj:{default:obj}).default]};exports.default=_default},{"./translate":185}],185:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(template,replacements){return replacements=replacements||{},template.replace(/{([^}]+)}/g,(function(_,key){return replacements[key]||"{"+key+"}"}))}},{}],186:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BaseLayouter;var _LayoutUtil=require("./LayoutUtil");function BaseLayouter(){}BaseLayouter.prototype.layoutConnection=function(connection,hints){return[(hints=hints||{}).connectionStart||(0,_LayoutUtil.getMid)(hints.source||connection.source),hints.connectionEnd||(0,_LayoutUtil.getMid)(hints.target||connection.target)]}},{"./LayoutUtil":188}],187:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=CroppingConnectionDocking;var _minDash=require("min-dash"),_LayoutUtil=require("./LayoutUtil");function dockingToPoint(docking){return(0,_minDash.assign)({original:docking.point.original||docking.point},docking.actual)}function CroppingConnectionDocking(elementRegistry,graphicsFactory){this._elementRegistry=elementRegistry,this._graphicsFactory=graphicsFactory}CroppingConnectionDocking.$inject=["elementRegistry","graphicsFactory"],CroppingConnectionDocking.prototype.getCroppedWaypoints=function(connection,source,target){source=source||connection.source,target=target||connection.target;var sourceDocking=this.getDockingPoint(connection,source,!0),targetDocking=this.getDockingPoint(connection,target),croppedWaypoints=connection.waypoints.slice(sourceDocking.idx+1,targetDocking.idx);return croppedWaypoints.unshift(dockingToPoint(sourceDocking)),croppedWaypoints.push(dockingToPoint(targetDocking)),croppedWaypoints},CroppingConnectionDocking.prototype.getDockingPoint=function(connection,shape,dockStart){var dockingIdx,dockingPoint,waypoints=connection.waypoints;return{point:dockingPoint=waypoints[dockingIdx=dockStart?0:waypoints.length-1],actual:this._getIntersection(shape,connection,dockStart)||dockingPoint,idx:dockingIdx}},CroppingConnectionDocking.prototype._getIntersection=function(shape,connection,takeFirst){var shapePath=this._getShapePath(shape),connectionPath=this._getConnectionPath(connection);return(0,_LayoutUtil.getElementLineIntersection)(shapePath,connectionPath,takeFirst)},CroppingConnectionDocking.prototype._getConnectionPath=function(connection){return this._graphicsFactory.getConnectionPath(connection)},CroppingConnectionDocking.prototype._getShapePath=function(shape){return this._graphicsFactory.getShapePath(shape)},CroppingConnectionDocking.prototype._getGfx=function(element){return this._elementRegistry.getGraphics(element)}},{"./LayoutUtil":188,"min-dash":219}],188:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.roundBounds=function(bounds){return{x:Math.round(bounds.x),y:Math.round(bounds.y),width:Math.round(bounds.width),height:Math.round(bounds.height)}},exports.roundPoint=roundPoint,exports.asTRBL=asTRBL,exports.asBounds=function(trbl){return{x:trbl.left,y:trbl.top,width:trbl.right-trbl.left,height:trbl.bottom-trbl.top}},exports.getMid=function(bounds){return roundPoint({x:bounds.x+(bounds.width||0)/2,y:bounds.y+(bounds.height||0)/2})},exports.getOrientation=function(rect,reference,padding){padding=padding||0,(0,_minDash.isObject)(padding)||(padding={x:padding,y:padding});var rectOrientation=asTRBL(rect),referenceOrientation=asTRBL(reference),top=rectOrientation.bottom+padding.y<=referenceOrientation.top,right=rectOrientation.left-padding.x>=referenceOrientation.right,bottom=rectOrientation.top-padding.y>=referenceOrientation.bottom,left=rectOrientation.right+padding.x<=referenceOrientation.left,vertical=top?"top":bottom?"bottom":null,horizontal=left?"left":right?"right":null;return horizontal&&vertical?vertical+"-"+horizontal:horizontal||vertical||"intersect"},exports.getElementLineIntersection=function(elementPath,linePath,cropStart){var intersections=getIntersections(elementPath,linePath);if(1===intersections.length)return roundPoint(intersections[0]);if(2===intersections.length&&(0,_Geometry.pointDistance)(intersections[0],intersections[1])<1)return roundPoint(intersections[0]);if(intersections.length>1)return roundPoint((intersections=(0,_minDash.sortBy)(intersections,(function(i){var distance=Math.floor(100*i.t2)||1;return distance=((distance=100-distance)<10?"0":"")+distance,i.segment2+"#"+distance})))[cropStart?0:intersections.length-1]);return null},exports.getIntersections=getIntersections,exports.filterRedundantWaypoints=function(waypoints){waypoints=waypoints.slice();var point,previousPoint,nextPoint,idx=0;for(;waypoints[idx];)point=waypoints[idx],previousPoint=waypoints[idx-1],nextPoint=waypoints[idx+1],0===(0,_Geometry.pointDistance)(point,nextPoint)||(0,_Geometry.pointsOnLine)(previousPoint,nextPoint,point)?waypoints.splice(idx,1):idx++;return waypoints};var obj,_minDash=require("min-dash"),_Geometry=require("../util/Geometry"),_pathIntersection=(obj=require("path-intersection"))&&obj.__esModule?obj:{default:obj};function roundPoint(point){return{x:Math.round(point.x),y:Math.round(point.y)}}function asTRBL(bounds){return{top:bounds.y,right:bounds.x+(bounds.width||0),bottom:bounds.y+(bounds.height||0),left:bounds.x}}function getIntersections(a,b){return(0,_pathIntersection.default)(a,b)}},{"../util/Geometry":204,"min-dash":219,"path-intersection":226}],189:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.connectPoints=connectPoints,exports.connectRectangles=connectRectangles,exports.repairConnection=function(source,target,start,end,waypoints,hints){(0,_minDash.isArray)(start)&&(waypoints=start,hints=end,start=(0,_LayoutUtil.getMid)(source),end=(0,_LayoutUtil.getMid)(target));hints=(0,_minDash.assign)({preferredLayouts:[]},hints),waypoints=waypoints||[];var repairedWaypoints,preferStraight=-1!==hints.preferredLayouts.indexOf("straight");if(repairedWaypoints=preferStraight&&tryLayoutStraight(source,target,start,end,hints))return repairedWaypoints;if(repairedWaypoints=hints.connectionEnd&&function(moved,other,newDocking,points){var waypoints=points.slice().reverse();return(waypoints=_tryRepairConnectionSide(moved,other,newDocking,waypoints))?waypoints.reverse():null}(target,source,end,waypoints))return repairedWaypoints;if(repairedWaypoints=hints.connectionStart&&function(moved,other,newDocking,points){return _tryRepairConnectionSide(moved,other,newDocking,points)}(source,target,start,waypoints))return repairedWaypoints;if(!hints.connectionStart&&!hints.connectionEnd&&waypoints&&waypoints.length)return waypoints;return connectRectangles(source,target,start,end,hints)},exports.tryLayoutStraight=tryLayoutStraight,exports.withoutRedundantPoints=withoutRedundantPoints;var _minDash=require("min-dash"),_LayoutUtil=require("./LayoutUtil"),_Geometry=require("../util/Geometry"),round=Math.round,ORIENTATION_THRESHOLD={"h:h":20,"v:v":20,"h:v":-10,"v:h":-10};function getSegmentBendpoints(a,b,directions){var segmentEnd,segmentDirections,targetOrientation,orientation=(0,_LayoutUtil.getOrientation)(b,a,5),startDirection=directions.split(":")[0],xmid=round((b.x-a.x)/2+a.x),ymid=round((b.y-a.y)/2+a.y),layoutStraight=(targetOrientation=orientation,{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/left|right/,v:/top|bottom/}[startDirection].test(targetOrientation)),layoutHorizontal=/h|r|l/.test(startDirection),turnNextDirections=!1;return layoutStraight?(segmentEnd=layoutHorizontal?{x:xmid,y:a.y}:{x:a.x,y:ymid},segmentDirections=layoutHorizontal?"h:h":"v:v"):(segmentDirections=layoutHorizontal?"h:v":"v:h",function(orientation,startDirection){return!{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/./,v:/./}[startDirection].test(orientation)}(orientation,startDirection)?layoutHorizontal?(turnNextDirections=ymid===a.y,segmentEnd={x:a.x+20*(/l/.test(startDirection)?-1:1),y:turnNextDirections?ymid+20:ymid}):segmentEnd={x:(turnNextDirections=xmid===a.x)?xmid+20:xmid,y:a.y+20*(/t/.test(startDirection)?-1:1)}:segmentEnd={x:xmid,y:ymid}),{waypoints:getBendpoints(a,segmentEnd,segmentDirections).concat(segmentEnd),directions:segmentDirections,turnNextDirections}}function invertDirections(directions){return directions.split(":").reverse().join(":")}function getBendpoints(a,b,directions){if(!function(directions){return directions&&/^h|v|t|r|b|l:h|v|t|r|b|l$/.test(directions)}(directions=directions||"h:h"))throw new Error("unknown directions: <"+directions+">: must be specified as <start>:<end> with start/end in { h,v,t,r,b,l }");if(isExplicitDirections(directions)){var startSegment=function(a,b,directions){return getSegmentBendpoints(a,b,directions)}(a,b,directions),endSegment=function(a,b,directions){var invertedSegment=getSegmentBendpoints(b,a,invertDirections(directions));return{waypoints:invertedSegment.waypoints.slice().reverse(),directions:invertDirections(invertedSegment.directions),turnNextDirections:invertedSegment.turnNextDirections}}(a,b,directions),midSegment=function(startSegment,endSegment){var startDirection=startSegment.directions.split(":")[1],endDirection=endSegment.directions.split(":")[0];startSegment.turnNextDirections&&(startDirection="h"==startDirection?"v":"h"),endSegment.turnNextDirections&&(endDirection="h"==endDirection?"v":"h");var directions=startDirection+":"+endDirection;return{waypoints:getBendpoints(startSegment.waypoints[startSegment.waypoints.length-1],endSegment.waypoints[0],directions),directions}}(startSegment,endSegment);return[].concat(startSegment.waypoints,midSegment.waypoints,endSegment.waypoints)}return function(a,b,directions){var xmid=round((b.x-a.x)/2+a.x),ymid=round((b.y-a.y)/2+a.y);if("h:v"===directions)return[{x:b.x,y:a.y}];if("v:h"===directions)return[{x:a.x,y:b.y}];if("h:h"===directions)return[{x:xmid,y:a.y},{x:xmid,y:b.y}];if("v:v"===directions)return[{x:a.x,y:ymid},{x:b.x,y:ymid}];throw new Error("invalid directions: can only handle varians of [hv]:[hv]")}(a,b,directions)}function connectPoints(a,b,directions){var points=getBendpoints(a,b,directions);return points.unshift(a),points.push(b),withoutRedundantPoints(points)}function connectRectangles(source,target,start,end,hints){var preferredLayouts=hints&&hints.preferredLayouts||[],preferredLayout=(0,_minDash.without)(preferredLayouts,"straight")[0]||"h:h",threshold=ORIENTATION_THRESHOLD[preferredLayout]||0,orientation=(0,_LayoutUtil.getOrientation)(source,target,threshold),directions=function(orientation,defaultLayout){if(isExplicitDirections(defaultLayout))return defaultLayout;switch(orientation){case"intersect":return"t:t";case"top":case"bottom":return"v:v";case"left":case"right":return"h:h";default:return defaultLayout}}(orientation,preferredLayout);start=start||(0,_LayoutUtil.getMid)(source),end=end||(0,_LayoutUtil.getMid)(target);var directionSplit=directions.split(":");return connectPoints(getDockingPoint(start,source,directionSplit[0],function(orientation){return{top:"bottom",bottom:"top",left:"right",right:"left","top-left":"bottom-right","bottom-right":"top-left","top-right":"bottom-left","bottom-left":"top-right"}[orientation]}(orientation)),getDockingPoint(end,target,directionSplit[1],orientation),directions)}function isInRange(axis,a,b){return function(a,start,end){return a>=start&&a<=end}(a[axis],b[axis],b[axis]+b[{x:"width",y:"height"}[axis]])}function tryLayoutStraight(source,target,start,end,hints){var primaryAxis,orientation,axis={};return orientation=(0,_LayoutUtil.getOrientation)(source,target),/^(top|bottom|left|right)$/.test(orientation)?(/top|bottom/.test(orientation)&&(primaryAxis="x"),/left|right/.test(orientation)&&(primaryAxis="y"),"target"===hints.preserveDocking?isInRange(primaryAxis,end,source)?(axis[primaryAxis]=end[primaryAxis],[{x:void 0!==axis.x?axis.x:start.x,y:void 0!==axis.y?axis.y:start.y,original:{x:void 0!==axis.x?axis.x:start.x,y:void 0!==axis.y?axis.y:start.y}},{x:end.x,y:end.y}]):null:isInRange(primaryAxis,start,target)?(axis[primaryAxis]=start[primaryAxis],[{x:start.x,y:start.y},{x:void 0!==axis.x?axis.x:end.x,y:void 0!==axis.y?axis.y:end.y,original:{x:void 0!==axis.x?axis.x:end.x,y:void 0!==axis.y?axis.y:end.y}}]):null):null}function _tryRepairConnectionSide(moved,other,newDocking,points){if(function(points){return points.length<3||!(points.length>4)&&!!(0,_minDash.find)(points,(function(p,idx){var q=points[idx-1];return q&&(0,_Geometry.pointDistance)(p,q)<3}))}(points))return null;var slicedPoints,oldDocking=points[0],newPoints=points.slice();return newPoints[0]=newDocking,newPoints[1]=function(candidate,oldPeer,newPeer){switch((0,_Geometry.pointsAligned)(oldPeer,candidate)){case"v":return{x:newPeer.x,y:candidate.y};case"h":return{x:candidate.x,y:newPeer.y}}return{x:candidate.x,y:candidate.y}}(newPoints[1],oldDocking,newDocking),(slicedPoints=function(points,a,b){var i;for(i=points.length-2;0!==i;i--)if((0,_Geometry.pointInRect)(points[i],a,20)||(0,_Geometry.pointInRect)(points[i],b,20))return points.slice(i);return points}(newPoints,moved,other))!==newPoints&&(newPoints=_tryRepairConnectionSide(moved,other,newDocking,slicedPoints)),newPoints&&(0,_Geometry.pointsAligned)(newPoints)?null:newPoints}function isExplicitDirections(directions){return directions&&/t|r|b|l/.test(directions)}function getDockingPoint(point,rectangle,dockingDirection,targetOrientation){if("h"===dockingDirection&&(dockingDirection=/left/.test(targetOrientation)?"l":"r"),"v"===dockingDirection&&(dockingDirection=/top/.test(targetOrientation)?"t":"b"),"t"===dockingDirection)return{original:point,x:point.x,y:rectangle.y};if("r"===dockingDirection)return{original:point,x:rectangle.x+rectangle.width,y:point.y};if("b"===dockingDirection)return{original:point,x:point.x,y:rectangle.y+rectangle.height};if("l"===dockingDirection)return{original:point,x:rectangle.x,y:point.y};throw new Error("unexpected dockingDirection: <"+dockingDirection+">")}function withoutRedundantPoints(waypoints){return waypoints.reduce((function(points,p,idx){var previous=points[points.length-1],next=waypoints[idx+1];return(0,_Geometry.pointsOnLine)(previous,next,p,0)||points.push(p),points}),[])}},{"../util/Geometry":204,"./LayoutUtil":188,"min-dash":219}],190:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Base=Base,exports.Shape=Shape,exports.Root=Root,exports.Label=Label,exports.Connection=Connection,exports.create=function(type,attrs){var Type=types[type];if(!Type)throw new Error("unknown type: <"+type+">");return(0,_minDash.assign)(new Type,attrs)};var _minDash=require("min-dash"),_inherits=_interopRequireDefault(require("inherits")),_objectRefs=_interopRequireDefault(require("object-refs"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var parentRefs=new _objectRefs.default({name:"children",enumerable:!0,collection:!0},{name:"parent"}),labelRefs=new _objectRefs.default({name:"labels",enumerable:!0,collection:!0},{name:"labelTarget"}),attacherRefs=new _objectRefs.default({name:"attachers",collection:!0},{name:"host"}),outgoingRefs=new _objectRefs.default({name:"outgoing",collection:!0},{name:"source"}),incomingRefs=new _objectRefs.default({name:"incoming",collection:!0},{name:"target"});function Base(){Object.defineProperty(this,"businessObject",{writable:!0}),Object.defineProperty(this,"label",{get:function(){return this.labels[0]},set:function(newLabel){var label=this.label,labels=this.labels;!newLabel&&label?labels.remove(label):labels.add(newLabel,0)}}),parentRefs.bind(this,"parent"),labelRefs.bind(this,"labels"),outgoingRefs.bind(this,"outgoing"),incomingRefs.bind(this,"incoming")}function Shape(){Base.call(this),parentRefs.bind(this,"children"),attacherRefs.bind(this,"host"),attacherRefs.bind(this,"attachers")}function Root(){Shape.call(this)}function Label(){Shape.call(this),labelRefs.bind(this,"labelTarget")}function Connection(){Base.call(this),outgoingRefs.bind(this,"source"),incomingRefs.bind(this,"target")}(0,_inherits.default)(Shape,Base),(0,_inherits.default)(Root,Shape),(0,_inherits.default)(Label,Shape),(0,_inherits.default)(Connection,Base);var types={connection:Connection,shape:Shape,label:Label,root:Root}},{inherits:218,"min-dash":219,"object-refs":223}],191:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=KeyboardMove;var _minDash=require("min-dash"),DEFAULT_CONFIG={moveSpeed:50,moveSpeedAccelerated:200};function KeyboardMove(config,keyboard,canvas){var self=this;this._config=(0,_minDash.assign)({},DEFAULT_CONFIG,config||{}),keyboard.addListener((function(context){var event=context.keyEvent,config=self._config;if(!keyboard.isCmd(event))return;if(keyboard.isKey(["ArrowLeft","Left","ArrowUp","Up","ArrowDown","Down","ArrowRight","Right"],event)){var direction,speed=keyboard.isShift(event)?config.moveSpeedAccelerated:config.moveSpeed;switch(event.key){case"ArrowLeft":case"Left":direction="left";break;case"ArrowUp":case"Up":direction="up";break;case"ArrowRight":case"Right":direction="right";break;case"ArrowDown":case"Down":direction="down"}return self.moveCanvas({speed,direction}),!0}})),this.moveCanvas=function(opts){var dx=0,dy=0,actualSpeed=opts.speed/Math.min(Math.sqrt(canvas.viewbox().scale),1);switch(opts.direction){case"left":dx=actualSpeed;break;case"up":dy=actualSpeed;break;case"right":dx=-actualSpeed;break;case"down":dy=-actualSpeed}canvas.scroll({dx,dy})}}KeyboardMove.$inject=["config.keyboardMove","keyboard","canvas"]},{"min-dash":219}],192:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _keyboard=_interopRequireDefault(require("../../features/keyboard")),_KeyboardMove=_interopRequireDefault(require("./KeyboardMove"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _default={__depends__:[_keyboard.default],__init__:["keyboardMove"],keyboardMove:["type",_KeyboardMove.default]};exports.default=_default},{"../../features/keyboard":129,"./KeyboardMove":191}],193:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=MoveCanvas;var _Cursor=require("../../util/Cursor"),_ClickTrap=require("../../util/ClickTrap"),_PositionUtil=require("../../util/PositionUtil"),_minDom=require("min-dom"),_Event=require("../../util/Event");function MoveCanvas(eventBus,canvas){var context;function handleMove(event){var point,start=context.start,button=context.button,position=(0,_Event.toPoint)(event),delta=(0,_PositionUtil.delta)(position,start);if(!context.dragging&&(point=delta,Math.sqrt(Math.pow(point.x,2)+Math.pow(point.y,2))>15)&&(context.dragging=!0,0===button&&(0,_ClickTrap.install)(eventBus),(0,_Cursor.set)("grab")),context.dragging){var lastPosition=context.last||context.start;delta=(0,_PositionUtil.delta)(position,lastPosition),canvas.scroll({dx:delta.x,dy:delta.y}),context.last=position}event.preventDefault()}function handleEnd(event){_minDom.event.unbind(document,"mousemove",handleMove),_minDom.event.unbind(document,"mouseup",handleEnd),context=null,(0,_Cursor.unset)()}eventBus.on("element.mousedown",500,(function(e){return function(event){if((0,_minDom.closest)(event.target,".djs-draggable"))return;var button=event.button;if(button>=2||event.ctrlKey||event.shiftKey||event.altKey)return;return context={button,start:(0,_Event.toPoint)(event)},_minDom.event.bind(document,"mousemove",handleMove),_minDom.event.bind(document,"mouseup",handleEnd),!0}(e.originalEvent)})),this.isActive=function(){return!!context}}MoveCanvas.$inject=["eventBus","canvas"]},{"../../util/ClickTrap":199,"../../util/Cursor":201,"../../util/Event":203,"../../util/PositionUtil":211,"min-dom":220}],194:[function(require,module,exports){"use strict";var obj;Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={__init__:["moveCanvas"],moveCanvas:["type",((obj=require("./MoveCanvas"))&&obj.__esModule?obj:{default:obj}).default]};exports.default=_default},{"./MoveCanvas":193}],195:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ZoomScroll;var _minDom=require("min-dom"),_ZoomUtil=require("./ZoomUtil"),_Math=require("../../util/Math"),_minDash=require("min-dash"),sign=Math.sign||function(n){return n>=0?1:-1},RANGE={min:.2,max:4};function ZoomScroll(config,eventBus,canvas){config=config||{},this._enabled=!1,this._canvas=canvas,this._container=canvas._container,this._handleWheel=(0,_minDash.bind)(this._handleWheel,this),this._totalDelta=0,this._scale=config.scale||.75;var self=this;eventBus.on("canvas.init",(function(e){self._init(!1!==config.enabled)}))}ZoomScroll.$inject=["config.zoomScroll","eventBus","canvas"],ZoomScroll.prototype.scroll=function(delta){this._canvas.scroll(delta)},ZoomScroll.prototype.reset=function(){this._canvas.zoom("fit-viewport")},ZoomScroll.prototype.zoom=function(delta,position){var stepSize=(0,_ZoomUtil.getStepSize)(RANGE,20);this._totalDelta+=delta,Math.abs(this._totalDelta)>.1&&(this._zoom(delta,position,stepSize),this._totalDelta=0)},ZoomScroll.prototype._handleWheel=function(event){if(!(0,_minDom.closest)(event.target,".djs-scrollable",!0)){var element=this._container;event.preventDefault();var delta,isZoom=event.ctrlKey,isHorizontalScroll=event.shiftKey,factor=-1*this._scale;if(factor*=isZoom?0===event.deltaMode?.02:.32:0===event.deltaMode?1:16,isZoom){var elementRect=element.getBoundingClientRect(),offset={x:event.clientX-elementRect.left,y:event.clientY-elementRect.top};delta=Math.sqrt(Math.pow(event.deltaY,2)+Math.pow(event.deltaX,2))*sign(event.deltaY)*factor,this.zoom(delta,offset)}else delta=isHorizontalScroll?{dx:factor*event.deltaY,dy:0}:{dx:factor*event.deltaX,dy:factor*event.deltaY},this.scroll(delta)}},ZoomScroll.prototype.stepZoom=function(delta,position){var stepSize=(0,_ZoomUtil.getStepSize)(RANGE,10);this._zoom(delta,position,stepSize)},ZoomScroll.prototype._zoom=function(delta,position,stepSize){var canvas=this._canvas,direction=delta>0?1:-1,currentLinearZoomLevel=(0,_Math.log10)(canvas.zoom()),newLinearZoomLevel=Math.round(currentLinearZoomLevel/stepSize)*stepSize;newLinearZoomLevel+=stepSize*direction;var newLogZoomLevel=Math.pow(10,newLinearZoomLevel);canvas.zoom((0,_ZoomUtil.cap)(RANGE,newLogZoomLevel),position)},ZoomScroll.prototype.toggle=function(newEnabled){var element=this._container,handleWheel=this._handleWheel,oldEnabled=this._enabled;return void 0===newEnabled&&(newEnabled=!oldEnabled),oldEnabled!==newEnabled&&_minDom.event[newEnabled?"bind":"unbind"](element,"wheel",handleWheel,!1),this._enabled=newEnabled,newEnabled},ZoomScroll.prototype._init=function(newEnabled){this.toggle(newEnabled)}},{"../../util/Math":208,"./ZoomUtil":196,"min-dash":219,"min-dom":220}],196:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getStepSize=function(range,steps){var minLinearRange=(0,_Math.log10)(range.min),maxLinearRange=(0,_Math.log10)(range.max);return(Math.abs(minLinearRange)+Math.abs(maxLinearRange))/steps},exports.cap=function(range,scale){return Math.max(range.min,Math.min(range.max,scale))};var _Math=require("../../util/Math")},{"../../util/Math":208}],197:[function(require,module,exports){"use strict";var obj;Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={__init__:["zoomScroll"],zoomScroll:["type",((obj=require("./ZoomScroll"))&&obj.__esModule?obj:{default:obj}).default]};exports.default=_default},{"./ZoomScroll":195}],198:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getNewAttachPoint=function(point,oldBounds,newBounds){var oldCenter=(0,_PositionUtil.center)(oldBounds),newCenter=(0,_PositionUtil.center)(newBounds),oldDelta=(0,_PositionUtil.delta)(point,oldCenter),newDelta={x:oldDelta.x*(newBounds.width/oldBounds.width),y:oldDelta.y*(newBounds.height/oldBounds.height)};return(0,_LayoutUtil.roundPoint)({x:newCenter.x+newDelta.x,y:newCenter.y+newDelta.y})},exports.getNewAttachShapeDelta=function(shape,oldBounds,newBounds){var shapeCenter=(0,_PositionUtil.center)(shape),oldCenter=(0,_PositionUtil.center)(oldBounds),newCenter=(0,_PositionUtil.center)(newBounds),shapeDelta=(0,_PositionUtil.delta)(shape,shapeCenter),oldCenterDelta=(0,_PositionUtil.delta)(shapeCenter,oldCenter),stickyPositionDelta=function(oldShapeCenter,oldBounds,newBounds){var oldTRBL=(0,_LayoutUtil.asTRBL)(oldBounds),newTRBL=(0,_LayoutUtil.asTRBL)(newBounds);if(function(oldTRBL,newTRBL){return function(oldTRBL,newTRBL){return oldTRBL.right!==newTRBL.right&&oldTRBL.left!==newTRBL.left}(oldTRBL,newTRBL)||function(oldTRBL,newTRBL){return oldTRBL.top!==newTRBL.top&&oldTRBL.bottom!==newTRBL.bottom}(oldTRBL,newTRBL)}(oldTRBL,newTRBL))return null;var stickyPositionDelta,newShapeCenter,oldOrientation=(0,_LayoutUtil.getOrientation)(oldBounds,oldShapeCenter);if("top"===oldOrientation)stickyPositionDelta={x:0,y:newTRBL.bottom-oldTRBL.bottom};else if("bottom"===oldOrientation)stickyPositionDelta={x:0,y:newTRBL.top-oldTRBL.top};else if("right"===oldOrientation)stickyPositionDelta={x:newTRBL.left-oldTRBL.left,y:0};else{if("left"!==oldOrientation)return null;stickyPositionDelta={x:newTRBL.right-oldTRBL.right,y:0}}if(newShapeCenter={x:oldShapeCenter.x+stickyPositionDelta.x,y:oldShapeCenter.y+stickyPositionDelta.y},(0,_LayoutUtil.getOrientation)(newBounds,newShapeCenter)!==oldOrientation)return null;return stickyPositionDelta}(shapeCenter,oldBounds,newBounds);if(stickyPositionDelta)return stickyPositionDelta;var newCenterDelta={x:oldCenterDelta.x*(newBounds.width/oldBounds.width),y:oldCenterDelta.y*(newBounds.height/oldBounds.height)},newShapeCenter={x:newCenter.x+newCenterDelta.x,y:newCenter.y+newCenterDelta.y};return(0,_LayoutUtil.roundPoint)({x:newShapeCenter.x+shapeDelta.x-shape.x,y:newShapeCenter.y+shapeDelta.y-shape.y})};var _LayoutUtil=require("../layout/LayoutUtil"),_PositionUtil=require("./PositionUtil")},{"../layout/LayoutUtil":188,"./PositionUtil":211}],199:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.install=function(eventBus,eventName){function trap(){return!1}return eventName=eventName||"element.click",eventBus.once(eventName,5e3,trap),function(){eventBus.off(eventName,trap)}}},{}],200:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.remove=function(collection,element){if(!collection||!element)return-1;var idx=collection.indexOf(element);-1!==idx&&collection.splice(idx,1);return idx},exports.add=function(collection,element,idx){if(!collection||!element)return;"number"!=typeof idx&&(idx=-1);var currentIdx=collection.indexOf(element);if(-1!==currentIdx){if(currentIdx===idx)return;if(-1===idx)return;collection.splice(currentIdx,1)}-1!==idx?collection.splice(idx,0,element):collection.push(element)},exports.indexOf=function(collection,element){if(!collection||!element)return-1;return collection.indexOf(element)}},{}],201:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.set=set,exports.unset=function(){set(null)},exports.has=function(mode){return(0,_minDom.classes)(document.body).has("djs-cursor-"+mode)};var _minDom=require("min-dom"),CURSOR_CLS_PATTERN=/^djs-cursor-.*$/;function set(mode){var classes=(0,_minDom.classes)(document.body);classes.removeMatching(CURSOR_CLS_PATTERN),mode&&classes.add("djs-cursor-"+mode)}},{"min-dom":220}],202:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getParents=function(elements){return(0,_minDash.filter)(elements,(function(element){return!(0,_minDash.find)(elements,(function(e){return e!==element&&function getParent(element,parent){if(!parent)return;if(element===parent)return parent;if(!element.parent)return;return getParent(element.parent,parent)}(element,e)}))}))},exports.add=add,exports.eachElement=eachElement,exports.selfAndChildren=selfAndChildren,exports.selfAndDirectChildren=function(elements,allowDuplicates){return selfAndChildren(elements,!allowDuplicates,1)},exports.selfAndAllChildren=function(elements,allowDuplicates){return selfAndChildren(elements,!allowDuplicates,-1)},exports.getClosure=function(elements,isTopLevel,closure){(0,_minDash.isUndefined)(isTopLevel)&&(isTopLevel=!0);(0,_minDash.isObject)(isTopLevel)&&(closure=isTopLevel,isTopLevel=!0);var allShapes=copyObject((closure=closure||{}).allShapes),allConnections=copyObject(closure.allConnections),enclosedElements=copyObject(closure.enclosedElements),enclosedConnections=copyObject(closure.enclosedConnections),topLevel=copyObject(closure.topLevel,isTopLevel&&(0,_minDash.groupBy)(elements,(function(e){return e.id})));function handleConnection(c){topLevel[c.source.id]&&topLevel[c.target.id]&&(topLevel[c.id]=[c]),allShapes[c.source.id]&&allShapes[c.target.id]&&(enclosedConnections[c.id]=enclosedElements[c.id]=c),allConnections[c.id]=c}return eachElement(elements,(function(element){if(enclosedElements[element.id]=element,!element.waypoints)return allShapes[element.id]=element,(0,_minDash.forEach)(element.incoming,handleConnection),(0,_minDash.forEach)(element.outgoing,handleConnection),element.children;enclosedConnections[element.id]=allConnections[element.id]=element})),{allShapes,allConnections,topLevel,enclosedConnections,enclosedElements}},exports.getBBox=getBBox,exports.getEnclosedElements=function(elements,bbox){var filteredElements={};return(0,_minDash.forEach)(elements,(function(element){var e=element;e.waypoints&&(e=getBBox(e)),!(0,_minDash.isNumber)(bbox.y)&&e.x>bbox.x&&(filteredElements[element.id]=element),!(0,_minDash.isNumber)(bbox.x)&&e.y>bbox.y&&(filteredElements[element.id]=element),e.x>bbox.x&&e.y>bbox.y&&((0,_minDash.isNumber)(bbox.width)&&(0,_minDash.isNumber)(bbox.height)&&e.width+e.x<bbox.width+bbox.x&&e.height+e.y<bbox.height+bbox.y?filteredElements[element.id]=element:(0,_minDash.isNumber)(bbox.width)&&(0,_minDash.isNumber)(bbox.height)||(filteredElements[element.id]=element))})),filteredElements},exports.getType=function(element){if("waypoints"in element)return"connection";if("x"in element)return"shape";return"root"},exports.isFrameElement=function(element){return!(!element||!element.isFrame)};var _minDash=require("min-dash");function add(elements,e,unique){var canAdd=!unique||-1===elements.indexOf(e);return canAdd&&elements.push(e),canAdd}function eachElement(elements,fn,depth){depth=depth||0,(0,_minDash.isArray)(elements)||(elements=[elements]),(0,_minDash.forEach)(elements,(function(s,i){var filter=fn(s,i,depth);(0,_minDash.isArray)(filter)&&filter.length&&eachElement(filter,fn,depth+1)}))}function selfAndChildren(elements,unique,maxDepth){var result=[],processedChildren=[];return eachElement(elements,(function(element,i,depth){add(result,element,unique);var children=element.children;if((-1===maxDepth||depth<maxDepth)&&children&&add(processedChildren,children,unique))return children})),result}function getBBox(elements,stopRecursion){var minX,minY,maxX,maxY;return stopRecursion=!!stopRecursion,(0,_minDash.isArray)(elements)||(elements=[elements]),(0,_minDash.forEach)(elements,(function(element){var bbox=element;element.waypoints&&!stopRecursion&&(bbox=getBBox(element.waypoints,!0));var x=bbox.x,y=bbox.y,height=bbox.height||0,width=bbox.width||0;(x<minX||void 0===minX)&&(minX=x),(y<minY||void 0===minY)&&(minY=y),(x+width>maxX||void 0===maxX)&&(maxX=x+width),(y+height>maxY||void 0===maxY)&&(maxY=y+height)})),{x:minX,y:minY,height:maxY-minY,width:maxX-minX}}function copyObject(src1,src2){return(0,_minDash.assign)({},src1||{},src2||{})}},{"min-dash":219}],203:[function(require,module,exports){"use strict";function __stopPropagation(event){event&&"function"==typeof event.stopPropagation&&event.stopPropagation()}function getOriginal(event){return event.originalEvent||event.srcEvent}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getOriginal=getOriginal,exports.stopPropagation=function(event,immediate){__stopPropagation(event),__stopPropagation(getOriginal(event))},exports.toPoint=function(event){event.pointers&&event.pointers.length&&(event=event.pointers[0]);event.touches&&event.touches.length&&(event=event.touches[0]);return event?{x:event.clientX,y:event.clientY}:null}},{}],204:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.pointDistance=pointDistance,exports.pointsOnLine=function(p,q,r,accuracy){void 0===accuracy&&(accuracy=5);if(!p||!q||!r)return!1;var val=(q.x-p.x)*(r.y-p.y)-(q.y-p.y)*(r.x-p.x),dist=pointDistance(p,q);return Math.abs(val/dist)<=accuracy},exports.pointsAligned=function(a,b){var points;points=(0,_minDash.isArray)(a)?a:[a,b];if(pointsAlignedHorizontally(points))return"h";if(pointsAlignedVertically(points))return"v";return!1},exports.pointsAlignedHorizontally=pointsAlignedHorizontally,exports.pointsAlignedVertically=pointsAlignedVertically,exports.pointInRect=function(p,rect,tolerance){return tolerance=tolerance||0,p.x>rect.x-tolerance&&p.y>rect.y-tolerance&&p.x<rect.x+rect.width+tolerance&&p.y<rect.y+rect.height+tolerance},exports.getMidPoint=function(p,q){return{x:Math.round(p.x+(q.x-p.x)/2),y:Math.round(p.y+(q.y-p.y)/2)}};var _minDash=require("min-dash");function pointDistance(a,b){return a&&b?Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2)):-1}function pointsAlignedHorizontally(a,b){var points,firstPoint=(points=(0,_minDash.isArray)(a)?a:[a,b]).slice().shift();return(0,_minDash.every)(points,(function(point){return Math.abs(firstPoint.y-point.y)<=2}))}function pointsAlignedVertically(a,b){var points,firstPoint=(points=(0,_minDash.isArray)(a)?a:[a,b]).slice().shift();return(0,_minDash.every)(points,(function(point){return Math.abs(firstPoint.x-point.x)<=2}))}},{"min-dash":219}],205:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getVisual=function(gfx){return gfx.childNodes[0]},exports.getChildren=function(gfx){return gfx.parentNode.childNodes[1]}},{}],206:[function(require,module,exports){"use strict";function IdGenerator(prefix){this._counter=0,this._prefix=(prefix?prefix+"-":"")+Math.floor(1e9*Math.random())+"-"}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=IdGenerator,IdGenerator.prototype.next=function(){return this._prefix+ ++this._counter}},{}],207:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getApproxIntersection=function(waypoints,reference){return function(waypoints,reference){var i,w;for(i=0;w=waypoints[i];i++)if((0,_Geometry.pointDistance)(w,reference)<=10)return{point:waypoints[i],bendpoint:!0,index:i};return null}(waypoints,reference)||function(waypoints,reference){var idx,intersections=(0,_pathIntersection.default)((center=reference,r=10,x=center.x,y=center.y,[["M",x,y],["m",0,-r],["a",r,r,0,1,1,0,2*r],["a",r,r,0,1,1,0,-2*r],["z"]]),(points=waypoints,segments=[],points.forEach((function(p,idx){segments.push([0===idx?"M":"L",p.x,p.y])})),segments)),a=intersections[0],b=intersections[intersections.length-1];var points,segments;var center,r,x,y;if(!a)return null;if(a!==b)return a.segment2!==b.segment2?(idx=max(a.segment2,b.segment2)-1,{point:waypoints[idx],bendpoint:!0,index:idx}):{point:{x:round(a.x+b.x)/2,y:round(a.y+b.y)/2},index:a.segment2};return{point:{x:round(a.x),y:round(a.y)},index:a.segment2}}(waypoints,reference)};var obj,_Geometry=require("./Geometry"),_pathIntersection=(obj=require("path-intersection"))&&obj.__esModule?obj:{default:obj};var round=Math.round,max=Math.max},{"./Geometry":204,"path-intersection":226}],208:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.log10=function(x){return Math.log(x)/Math.log(10)},Object.defineProperty(exports,"substract",{enumerable:!0,get:function(){return _PositionUtil.delta}});var _PositionUtil=require("./PositionUtil")},{"./PositionUtil":211}],209:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isButton=isButton,exports.isPrimaryButton=isPrimaryButton,exports.isAuxiliaryButton=function(event){return isButton(event,1)},exports.isSecondaryButton=function(event){return isButton(event,2)},exports.hasPrimaryModifier=function(event){var originalEvent=(0,_Event.getOriginal)(event)||event;if(!isPrimaryButton(event))return!1;return(0,_Platform.isMac)()?originalEvent.metaKey:originalEvent.ctrlKey},exports.hasSecondaryModifier=function(event){var originalEvent=(0,_Event.getOriginal)(event)||event;return isPrimaryButton(event)&&originalEvent.shiftKey},Object.defineProperty(exports,"isMac",{enumerable:!0,get:function(){return _Platform.isMac}});var _Event=require("./Event"),_Platform=require("./Platform");function isButton(event,button){return((0,_Event.getOriginal)(event)||event).button===button}function isPrimaryButton(event){return isButton(event,0)}},{"./Event":203,"./Platform":210}],210:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isMac=function(){return/mac/i.test(navigator.platform)}},{}],211:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.center=function(bounds){return{x:bounds.x+bounds.width/2,y:bounds.y+bounds.height/2}},exports.delta=function(a,b){return{x:a.x-b.x,y:a.y-b.y}}},{}],212:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.saveClear=function(collection,removeFn){if("function"!=typeof removeFn)throw new Error("removeFn iterator must be a function");if(!collection)return;var e;for(;e=collection[0];)removeFn(e);return collection}},{}],213:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.componentsToPath=function(elements){return elements.join(",").replace(/,?([A-z]),?/g,"$1")},exports.toSVGPoints=toSVGPoints,exports.createLine=function(points,attrs){var line=(0,_tinySvg.create)("polyline");(0,_tinySvg.attr)(line,{points:toSVGPoints(points)}),attrs&&(0,_tinySvg.attr)(line,attrs);return line},exports.updateLine=function(gfx,points){return(0,_tinySvg.attr)(gfx,{points:toSVGPoints(points)}),gfx};var _tinySvg=require("tiny-svg");function toSVGPoints(points){for(var p,result="",i=0;p=points[i];i++)result+=p.x+","+p.y+" ";return result}},{"tiny-svg":228}],214:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.transform=function(gfx,x,y,angle,amount){var translate=(0,_tinySvg.createTransform)();translate.setTranslate(x,y);var rotate=(0,_tinySvg.createTransform)();rotate.setRotate(angle||0,0,0);var scale=(0,_tinySvg.createTransform)();scale.setScale(amount||1,amount||1),(0,_tinySvg.transform)(gfx,[translate,rotate,scale])},exports.translate=function(gfx,x,y){var translate=(0,_tinySvg.createTransform)();translate.setTranslate(x,y),(0,_tinySvg.transform)(gfx,translate)},exports.rotate=function(gfx,angle){var rotate=(0,_tinySvg.createTransform)();rotate.setRotate(angle,0,0),(0,_tinySvg.transform)(gfx,rotate)},exports.scale=function(gfx,amount){var scale=(0,_tinySvg.createTransform)();scale.setScale(amount,amount),(0,_tinySvg.transform)(gfx,scale)};var _tinySvg=require("tiny-svg")},{"tiny-svg":228}],215:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Text;var _minDash=require("min-dash"),_tinySvg=require("tiny-svg"),DEFAULT_LABEL_SIZE={width:150,height:50};function getTextBBox(text,fakeText){var textBBox;fakeText.textContent=text;try{var bbox,emptyLine=""===text;return fakeText.textContent=emptyLine?"dummy":text,bbox={width:(textBBox=fakeText.getBBox()).width+2*textBBox.x,height:textBBox.height},emptyLine&&(bbox.width=0),bbox}catch(e){return{width:0,height:0}}}function layoutNext(lines,maxWidth,fakeText){for(var textBBox,originalLine=lines.shift(),fitLine=originalLine;;){if((textBBox=getTextBBox(fitLine,fakeText)).width=fitLine?textBBox.width:0," "===fitLine||""===fitLine||textBBox.width<Math.round(maxWidth)||fitLine.length<2)return fit(lines,fitLine,originalLine,textBBox);fitLine=shortenLine(fitLine,textBBox.width,maxWidth)}}function fit(lines,fitLine,originalLine,textBBox){if(fitLine.length<originalLine.length){var remainder=originalLine.slice(fitLine.length).trim();lines.unshift(remainder)}return{width:textBBox.width,height:textBBox.height,text:fitLine}}function shortenLine(line,width,maxWidth){var length=Math.max(line.length*(maxWidth/width),1),shortenedLine=function(line,maxLength){var part,parts=line.split(/(\s|-|\u00AD)/g),shortenedParts=[],length=0;if(parts.length>1)for(;part=parts.shift();){if(!(part.length+length<maxLength)){"-"!==part&&""!==part||shortenedParts.pop();break}shortenedParts.push(part),length+=part.length}var last=shortenedParts[shortenedParts.length-1];return last&&""===last&&(shortenedParts[shortenedParts.length-1]="-"),shortenedParts.join("")}(line,length);return shortenedLine||(shortenedLine=line.slice(0,Math.max(Math.round(length-1),1))),shortenedLine}function Text(config){this._config=(0,_minDash.assign)({},{size:DEFAULT_LABEL_SIZE,padding:0,style:{},align:"center-top"},config||{})}Text.prototype.createText=function(text,options){return this.layoutText(text,options).element},Text.prototype.getDimensions=function(text,options){return this.layoutText(text,options).dimensions},Text.prototype.layoutText=function(text,options){var box=(0,_minDash.assign)({},this._config.size,options.box),style=(0,_minDash.assign)({},this._config.style,options.style),align=function(align){var parts=align.split("-");return{horizontal:parts[0]||"center",vertical:parts[1]||"top"}}(options.align||this._config.align),padding=function(padding){return(0,_minDash.isObject)(padding)?(0,_minDash.assign)({top:0,left:0,right:0,bottom:0},padding):{top:padding,left:padding,right:padding,bottom:padding}}(void 0!==options.padding?options.padding:this._config.padding),fitBox=options.fitBox||!1,lineHeight=function(style){if("fontSize"in style&&"lineHeight"in style)return style.lineHeight*parseInt(style.fontSize,10)}(style),lines=text.split(/\u00AD?\r?\n/),layouted=[],maxWidth=box.width-padding.left-padding.right,helperText=(0,_tinySvg.create)("text");(0,_tinySvg.attr)(helperText,{x:0,y:0}),(0,_tinySvg.attr)(helperText,style);var helperSvg=function(){var helperSvg=document.getElementById("helper-svg");return helperSvg||(helperSvg=(0,_tinySvg.create)("svg"),(0,_tinySvg.attr)(helperSvg,{id:"helper-svg",width:0,height:0,style:"visibility: hidden; position: fixed"}),document.body.appendChild(helperSvg)),helperSvg}();for((0,_tinySvg.append)(helperSvg,helperText);lines.length;)layouted.push(layoutNext(lines,maxWidth,helperText));"middle"===align.vertical&&(padding.top=padding.bottom=0);var totalHeight=(0,_minDash.reduce)(layouted,(function(sum,line,idx){return sum+(lineHeight||line.height)}),0)+padding.top+padding.bottom,maxLineWidth=(0,_minDash.reduce)(layouted,(function(sum,line,idx){return line.width>sum?line.width:sum}),0),y=padding.top;"middle"===align.vertical&&(y+=(box.height-totalHeight)/2),y-=(lineHeight||layouted[0].height)/4;var textElement=(0,_tinySvg.create)("text");return(0,_tinySvg.attr)(textElement,style),(0,_minDash.forEach)(layouted,(function(line){var x;switch(y+=lineHeight||line.height,align.horizontal){case"left":x=padding.left;break;case"right":x=(fitBox?maxLineWidth:maxWidth)-padding.right-line.width;break;default:x=Math.max(((fitBox?maxLineWidth:maxWidth)-line.width)/2+padding.left,0)}var tspan=(0,_tinySvg.create)("tspan");(0,_tinySvg.attr)(tspan,{x,y}),tspan.textContent=line.text,(0,_tinySvg.append)(textElement,tspan)})),(0,_tinySvg.remove)(helperText),{dimensions:{width:maxLineWidth,height:totalHeight},element:textElement}}},{"min-dash":219,"tiny-svg":228}],216:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.annotate=annotate,exports.parseAnnotations=parseAnnotations,exports.Module=Module,exports.Injector=function Injector(modules,parent){parent=parent||{get:function(name,strict){if(currentlyResolving.push(name),!1===strict)return null;throw error('No provider for "'+name+'"!')}};var currentlyResolving=[],providers=this._providers=Object.create(parent._providers||null),instances=this._instances=Object.create(null),self=instances.injector=this,error=function(msg){var stack=currentlyResolving.join(" -> ");return currentlyResolving.length=0,new Error(stack?msg+" (Resolving: "+stack+")":msg)},get=function(name,strict){if(!providers[name]&&-1!==name.indexOf(".")){for(var parts=name.split("."),pivot=get(parts.shift());parts.length;)pivot=pivot[parts.shift()];return pivot}if(hasOwnProp(instances,name))return instances[name];if(hasOwnProp(providers,name)){if(-1!==currentlyResolving.indexOf(name))throw currentlyResolving.push(name),error("Cannot resolve circular dependency!");return currentlyResolving.push(name),instances[name]=providers[name][0](providers[name][1]),currentlyResolving.pop(),instances[name]}return parent.get(name,strict)},fnDef=function(fn,locals){if(void 0===locals&&(locals={}),"function"!=typeof fn){if(!isArray(fn))throw new Error('Cannot invoke "'+fn+'". Expected a function!');fn=annotate(fn.slice())}return{fn,dependencies:(fn.$inject||parseAnnotations(fn)).map((function(dep){return hasOwnProp(locals,dep)?locals[dep]:get(dep)}))}},instantiate=function(Type){var def=fnDef(Type),fn=def.fn,dependencies=def.dependencies;return new(Function.prototype.bind.apply(fn,[null].concat(dependencies)))},invoke=function(func,context,locals){var def=fnDef(func,locals),fn=def.fn,dependencies=def.dependencies;return fn.apply(context,dependencies)},createPrivateInjectorFactory=function(privateChildInjector){return annotate((function(key){return privateChildInjector.get(key)}))},createChild=function(modules,forceNewInstances){if(forceNewInstances&&forceNewInstances.length){var provider,cacheIdx,privateChildInjector,privateChildInjectorFactory,fromParentModule=Object.create(null),matchedScopes=Object.create(null),privateInjectorsCache=[],privateChildInjectors=[],privateChildFactories=[];for(var name in providers)provider=providers[name],-1!==forceNewInstances.indexOf(name)&&("private"===provider[2]?-1===(cacheIdx=privateInjectorsCache.indexOf(provider[3]))?(privateChildInjector=provider[3].createChild([],forceNewInstances),privateChildInjectorFactory=createPrivateInjectorFactory(privateChildInjector),privateInjectorsCache.push(provider[3]),privateChildInjectors.push(privateChildInjector),privateChildFactories.push(privateChildInjectorFactory),fromParentModule[name]=[privateChildInjectorFactory,name,"private",privateChildInjector]):fromParentModule[name]=[privateChildFactories[cacheIdx],name,"private",privateChildInjectors[cacheIdx]]:fromParentModule[name]=[provider[2],provider[1]],matchedScopes[name]=!0),"factory"!==provider[2]&&"type"!==provider[2]||!provider[1].$scope||forceNewInstances.forEach((function(scope){-1!==provider[1].$scope.indexOf(scope)&&(fromParentModule[name]=[provider[2],provider[1]],matchedScopes[scope]=!0)}));forceNewInstances.forEach((function(scope){if(!matchedScopes[scope])throw new Error('No provider for "'+scope+'". Cannot use provider from the parent!')})),modules.unshift(fromParentModule)}return new Injector(modules,self)},factoryMap={factory:invoke,type:instantiate,value:function(value){return value}};modules.forEach((function(module){function arrayUnwrap(type,value){return"value"!==type&&isArray(value)&&(value=annotate(value.slice())),value}if(module instanceof Module)module.forEach((function(provider){var name=provider[0],type=provider[1],value=provider[2];providers[name]=[factoryMap[type],arrayUnwrap(type,value),type]}));else if("object"==typeof module)if(module.__exports__){var clonedModule=Object.keys(module).reduce((function(m,key){return"__"!==key.substring(0,2)&&(m[key]=module[key]),m}),Object.create(null)),privateInjector=new Injector((module.__modules__||[]).concat([clonedModule]),self),getFromPrivateInjector=annotate((function(key){return privateInjector.get(key)}));module.__exports__.forEach((function(key){providers[key]=[getFromPrivateInjector,key,"private",privateInjector]}))}else Object.keys(module).forEach((function(name){if("private"!==module[name][2]){var type=module[name][0],value=module[name][1];providers[name]=[factoryMap[type],arrayUnwrap(type,value),type]}else providers[name]=module[name]}))})),this.get=get,this.invoke=invoke,this.instantiate=instantiate,this.createChild=createChild};var CLASS_PATTERN=/^class /;function isArray(obj){return"[object Array]"===Object.prototype.toString.call(obj)}function hasOwnProp(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}function annotate(){var args=Array.prototype.slice.call(arguments);1===args.length&&isArray(args[0])&&(args=args[0]);var fn=args.pop();return fn.$inject=args,fn}var CONSTRUCTOR_ARGS=/constructor\s*[^(]*\(\s*([^)]*)\)/m,FN_ARGS=/^(?:async )?(?:function\s*)?[^(]*\(\s*([^)]*)\)/m,FN_ARG=/\/\*([^*]*)\*\//m;function parseAnnotations(fn){if("function"!=typeof fn)throw new Error('Cannot annotate "'+fn+'". Expected a function!');var match=fn.toString().match(function(fn){return CLASS_PATTERN.test(fn.toString())}(fn)?CONSTRUCTOR_ARGS:FN_ARGS);return match&&match[1]&&match[1].split(",").map((function(arg){return(match=arg.match(FN_ARG))?match[1].trim():arg.trim()}))||[]}function Module(){var providers=[];this.factory=function(name,factory){return providers.push([name,"factory",factory]),this},this.value=function(name,value){return providers.push([name,"value",value]),this},this.type=function(name,type){return providers.push([name,"type",type]),this},this.forEach=function(iterator){providers.forEach(iterator)}}},{}],217:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var hat_1=function(fn,module){return fn(module={exports:{}},module.exports),module.exports}((function(module){var hat=module.exports=function(bits,base){if(base||(base=16),void 0===bits&&(bits=128),bits<=0)return"0";for(var digits=Math.log(Math.pow(2,bits))/Math.log(base),i=2;digits===1/0;i*=2)digits=Math.log(Math.pow(2,bits/i))/Math.log(base)*i;var rem=digits-Math.floor(digits),res="";for(i=0;i<Math.floor(digits);i++){res=Math.floor(Math.random()*base).toString(base)+res}if(rem){var b=Math.pow(base,rem);res=Math.floor(Math.random()*b).toString(base)+res}var parsed=parseInt(res,base);return parsed!==1/0&&parsed>=Math.pow(2,bits)?hat(bits,base):res};hat.rack=function(bits,base,expandBy){var fn=function(data){var iters=0;do{if(iters++>10){if(!expandBy)throw new Error("too many ID collisions, use more bits");bits+=expandBy}var id=hat(bits,base)}while(Object.hasOwnProperty.call(hats,id));return hats[id]=data,id},hats=fn.hats={};return fn.get=function(id){return fn.hats[id]},fn.set=function(id,value){return fn.hats[id]=value,fn},fn.bits=bits||128,fn.base=base||16,fn}}));function Ids(seed){if(!(this instanceof Ids))return new Ids(seed);seed=seed||[128,36,1],this._seed=seed.length?hat_1.rack(seed[0],seed[1],seed[2]):seed}Ids.prototype.next=function(element){return this._seed(element||!0)},Ids.prototype.nextPrefixed=function(prefix,element){var id;do{id=prefix+this.next(!0)}while(this.assigned(id));return this.claim(id,element),id},Ids.prototype.claim=function(id,element){this._seed.set(id,element||!0)},Ids.prototype.assigned=function(id){return this._seed.get(id)||!1},Ids.prototype.unclaim=function(id){delete this._seed.hats[id]},Ids.prototype.clear=function(){var id,hats=this._seed.hats;for(id in hats)this.unclaim(id)};var _default=Ids;exports.default=_default},{}],218:[function(require,module,exports){"function"==typeof Object.create?module.exports=function(ctor,superCtor){superCtor&&(ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}}))}:module.exports=function(ctor,superCtor){if(superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}}},{}],219:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.assign=function(target){for(var _len=arguments.length,others=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)others[_key-1]=arguments[_key];return _extends.apply(void 0,[target].concat(others))},exports.bind=function(fn,target){return fn.bind(target)},exports.debounce=function(fn,timeout){var timer,lastArgs,lastThis,lastNow;function fire(force){var now=Date.now(),scheduledDiff=force?0:lastNow+timeout-now;if(scheduledDiff>0)return schedule(scheduledDiff);fn.apply(lastThis,lastArgs),clear()}function schedule(timeout){timer=setTimeout(fire,timeout)}function clear(){timer&&clearTimeout(timer),timer=lastNow=lastArgs=lastThis=void 0}function callback(){lastNow=Date.now();for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];lastArgs=args,lastThis=this,timer||schedule(timeout)}return callback.flush=function(){timer&&fire(!0);clear()},callback.cancel=clear,callback},exports.ensureArray=ensureArray,exports.every=every,exports.filter=function(collection,matcher){var result=[];return forEach(collection,(function(val,key){matcher(val,key)&&result.push(val)})),result},exports.find=find,exports.findIndex=function(collection,matcher){matcher=toMatcher(matcher);var idx=isArray(collection)?-1:void 0;return forEach(collection,(function(val,key){if(matcher(val,key))return idx=key,!1})),idx},exports.flatten=function(arr){return Array.prototype.concat.apply([],arr)},exports.forEach=forEach,exports.get=function(target,path,defaultValue){var currentTarget=target;return forEach(path,(function(key){if(isNil(currentTarget))return currentTarget=void 0,!1;currentTarget=currentTarget[key]})),isUndefined(currentTarget)?defaultValue:currentTarget},exports.groupBy=groupBy,exports.has=has,exports.isArray=isArray,exports.isDefined=isDefined,exports.isFunction=isFunction,exports.isNil=isNil,exports.isNumber=function(obj){return"[object Number]"===nativeToString.call(obj)},exports.isObject=isObject,exports.isString=function(obj){return"[object String]"===nativeToString.call(obj)},exports.isUndefined=isUndefined,exports.keys=keys,exports.map=map,exports.matchPattern=function(pattern){return function(el){return every(pattern,(function(val,key){return el[key]===val}))}},exports.merge=function merge(target){for(var _len2=arguments.length,sources=new Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++)sources[_key2-1]=arguments[_key2];if(!sources.length)return target;return forEach(sources,(function(source){source&&isObject(source)&&forEach(source,(function(sourceVal,key){if("__proto__"!==key){var targetVal=target[key];isObject(sourceVal)?(isObject(targetVal)||(targetVal={}),target[key]=merge(targetVal,sourceVal)):target[key]=sourceVal}}))})),target},exports.omit=function(target,properties){var result={};return forEach(Object(target),(function(prop,key){-1===properties.indexOf(key)&&(result[key]=prop)})),result},exports.pick=function(target,properties){var result={},obj=Object(target);return forEach(properties,(function(prop){prop in obj&&(result[prop]=target[prop])})),result},exports.reduce=reduce,exports.set=function(target,path,value){var currentTarget=target;return forEach(path,(function(key,idx){if("number"!=typeof key&&"string"!=typeof key)throw new Error("illegal key type: "+_typeof(key)+". Key should be of type number or string.");if("constructor"===key)throw new Error("illegal key: constructor");if("__proto__"===key)throw new Error("illegal key: __proto__");var nextKey=path[idx+1],nextTarget=currentTarget[key];isDefined(nextKey)&&isNil(nextTarget)&&(nextTarget=currentTarget[key]=isNaN(+nextKey)?{}:[]),isUndefined(nextKey)?isUndefined(value)?delete currentTarget[key]:currentTarget[key]=value:currentTarget=nextTarget})),target},exports.size=function(collection){return keys(collection).length},exports.some=function(collection,matcher){return!!find(collection,matcher)},exports.sortBy=function(collection,extractor){extractor=toExtractor(extractor);var sorted=[];return forEach(collection,(function(value,key){for(var disc=extractor(value,key),entry={d:disc,v:value},idx=0;idx<sorted.length;idx++){if(disc<sorted[idx].d)return void sorted.splice(idx,0,entry)}sorted.push(entry)})),map(sorted,(function(e){return e.v}))},exports.throttle=function(fn,interval){var throttling=!1;return function(){throttling||(fn.apply(void 0,arguments),throttling=!0,setTimeout((function(){throttling=!1}),interval))}},exports.uniqueBy=uniqueBy,exports.values=function(collection){return map(collection,(function(val){return val}))},exports.without=function(arr,matcher){if(isUndefined(arr))return[];return ensureArray(arr),matcher=toMatcher(matcher),arr.filter((function(el,idx){return!matcher(el,idx)}))},exports.unionBy=void 0;var nativeToString=Object.prototype.toString,nativeHasOwnProperty=Object.prototype.hasOwnProperty;function isUndefined(obj){return void 0===obj}function isDefined(obj){return void 0!==obj}function isNil(obj){return null==obj}function isArray(obj){return"[object Array]"===nativeToString.call(obj)}function isObject(obj){return"[object Object]"===nativeToString.call(obj)}function isFunction(obj){var tag=nativeToString.call(obj);return"[object Function]"===tag||"[object AsyncFunction]"===tag||"[object GeneratorFunction]"===tag||"[object AsyncGeneratorFunction]"===tag||"[object Proxy]"===tag}function ensureArray(obj){if(!isArray(obj))throw new Error("must supply array")}function has(target,key){return nativeHasOwnProperty.call(target,key)}function find(collection,matcher){var match;return matcher=toMatcher(matcher),forEach(collection,(function(val,key){if(matcher(val,key))return match=val,!1})),match}function forEach(collection,iterator){var val;if(!isUndefined(collection)){var convertKey=isArray(collection)?toNum:identity;for(var key in collection)if(has(collection,key)&&!1===iterator(val=collection[key],convertKey(key)))return val}}function reduce(collection,iterator,result){return forEach(collection,(function(value,idx){result=iterator(result,value,idx)})),result}function every(collection,matcher){return!!reduce(collection,(function(matches,val,key){return matches&&matcher(val,key)}),!0)}function map(collection,fn){var result=[];return forEach(collection,(function(val,key){result.push(fn(val,key))})),result}function keys(collection){return collection&&Object.keys(collection)||[]}function groupBy(collection,extractor){var grouped=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return extractor=toExtractor(extractor),forEach(collection,(function(val){var discriminator=extractor(val)||"_",group=grouped[discriminator];group||(group=grouped[discriminator]=[]),group.push(val)})),grouped}function uniqueBy(extractor){extractor=toExtractor(extractor);for(var grouped={},_len=arguments.length,collections=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)collections[_key-1]=arguments[_key];forEach(collections,(function(c){return groupBy(c,extractor,grouped)}));var result=map(grouped,(function(val,key){return val[0]}));return result}var unionBy=uniqueBy;function toExtractor(extractor){return isFunction(extractor)?extractor:function(e){return e[extractor]}}function toMatcher(matcher){return isFunction(matcher)?matcher:function(e){return e===matcher}}function identity(arg){return arg}function toNum(arg){return Number(arg)}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _extends(){return(_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}exports.unionBy=unionBy},{}],220:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.attr=function(el,name,val){if(2==arguments.length)return el.getAttribute(name);if(null===val)return el.removeAttribute(name);return el.setAttribute(name,val),el},exports.classes=function(el){return new ClassList(el)},exports.clear=function(el){var c;for(;el.childNodes.length;)c=el.childNodes[0],el.removeChild(c);return el},exports.closest=closest,exports.query=function(selector,el){return(el=el||document).querySelector(selector)},exports.queryAll=function(selector,el){return(el=el||document).querySelectorAll(selector)},exports.remove=function(el){el.parentNode&&el.parentNode.removeChild(el)},exports.matches=exports.event=exports.domify=exports.delegate=void 0;var indexOf=[].indexOf,indexof=function(arr,obj){if(indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i)if(arr[i]===obj)return i;return-1},re=/\s+/,toString=Object.prototype.toString;function ClassList(el){if(!el||!el.nodeType)throw new Error("A DOM element reference is required");this.el=el,this.list=el.classList}ClassList.prototype.add=function(name){if(this.list)return this.list.add(name),this;var arr=this.array();return~indexof(arr,name)||arr.push(name),this.el.className=arr.join(" "),this},ClassList.prototype.remove=function(name){if("[object RegExp]"==toString.call(name))return this.removeMatching(name);if(this.list)return this.list.remove(name),this;var arr=this.array(),i=indexof(arr,name);return~i&&arr.splice(i,1),this.el.className=arr.join(" "),this},ClassList.prototype.removeMatching=function(re){for(var arr=this.array(),i=0;i<arr.length;i++)re.test(arr[i])&&this.remove(arr[i]);return this},ClassList.prototype.toggle=function(name,force){return this.list?(void 0!==force?force!==this.list.toggle(name,force)&&this.list.toggle(name):this.list.toggle(name),this):(void 0!==force?force?this.add(name):this.remove(name):this.has(name)?this.remove(name):this.add(name),this)},ClassList.prototype.array=function(){var arr=(this.el.getAttribute("class")||"").replace(/^\s+|\s+$/g,"").split(re);return""===arr[0]&&arr.shift(),arr},ClassList.prototype.has=ClassList.prototype.contains=function(name){return this.list?this.list.contains(name):!!~indexof(this.array(),name)};var proto="undefined"!=typeof Element?Element.prototype:{},vendor=proto.matches||proto.matchesSelector||proto.webkitMatchesSelector||proto.mozMatchesSelector||proto.msMatchesSelector||proto.oMatchesSelector,matchesSelector=function(el,selector){if(!el||1!==el.nodeType)return!1;if(vendor)return vendor.call(el,selector);for(var nodes=el.parentNode.querySelectorAll(selector),i=0;i<nodes.length;i++)if(nodes[i]==el)return!0;return!1};function closest(element,selector,checkYourSelf){for(var currentElem=checkYourSelf?element:element.parentNode;currentElem&&currentElem.nodeType!==document.DOCUMENT_NODE&&currentElem.nodeType!==document.DOCUMENT_FRAGMENT_NODE;){if(matchesSelector(currentElem,selector))return currentElem;currentElem=currentElem.parentNode}return matchesSelector(currentElem,selector)?currentElem:null}exports.matches=matchesSelector;var bind=window.addEventListener?"addEventListener":"attachEvent",unbind=window.removeEventListener?"removeEventListener":"detachEvent",prefix="addEventListener"!==bind?"on":"",componentEvent={bind:function(el,type,fn,capture){return el[bind](prefix+type,fn,capture||!1),fn},unbind:function(el,type,fn,capture){return el[unbind](prefix+type,fn,capture||!1),fn}};exports.event=componentEvent;var forceCaptureEvents=["focus","blur"];var delegate={bind:function(el,selector,type,fn,capture){return-1!==forceCaptureEvents.indexOf(type)&&(capture=!0),componentEvent.bind(el,type,(function(e){var target=e.target||e.srcElement;e.delegateTarget=closest(target,selector,!0),e.delegateTarget&&fn.call(el,e)}),capture)},unbind:function(el,type,fn,capture){return-1!==forceCaptureEvents.indexOf(type)&&(capture=!0),componentEvent.unbind(el,type,fn,capture)}};exports.delegate=delegate;var domify=function(html,doc){if("string"!=typeof html)throw new TypeError("String expected");doc||(doc=document);var m=/<([\w:]+)/.exec(html);if(!m)return doc.createTextNode(html);html=html.replace(/^\s+|\s+$/g,"");var tag=m[1];if("body"==tag){return(el=doc.createElement("html")).innerHTML=html,el.removeChild(el.lastChild)}var el,wrap=map[tag]||map._default,depth=wrap[0],prefix=wrap[1],suffix=wrap[2];(el=doc.createElement("div")).innerHTML=prefix+html+suffix;for(;depth--;)el=el.lastChild;if(el.firstChild==el.lastChild)return el.removeChild(el.firstChild);var fragment=doc.createDocumentFragment();for(;el.firstChild;)fragment.appendChild(el.removeChild(el.firstChild));return fragment};exports.domify=domify;var bugTestDiv,innerHTMLBug=!1;"undefined"!=typeof document&&((bugTestDiv=document.createElement("div")).innerHTML='  <link/><table></table><a href="/a">a</a><input type="checkbox"/>',innerHTMLBug=!bugTestDiv.getElementsByTagName("link").length,bugTestDiv=void 0);var map={legend:[1,"<fieldset>","</fieldset>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],_default:innerHTMLBug?[1,"X<div>","</div>"]:[0,"",""]};map.td=map.th=[3,"<table><tbody><tr>","</tr></tbody></table>"],map.option=map.optgroup=[1,'<select multiple="multiple">',"</select>"],map.thead=map.tbody=map.colgroup=map.caption=map.tfoot=[1,"<table>","</table>"],map.polyline=map.ellipse=map.polygon=map.circle=map.text=map.line=map.path=map.rect=map.g=[1,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1">',"</svg>"]},{}],221:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Reader=Reader,exports.Writer=function(options){return options=(0,_minDash.assign)({format:!1,preamble:!0},options||{}),{toXML:function(tree,writer){var internalWriter=writer||new SavingWriter,formatingWriter=new FormatingWriter(internalWriter,options.format);options.preamble&&formatingWriter.append('<?xml version="1.0" encoding="UTF-8"?>\n');if((new ElementSerializer).build(tree).serializeTo(formatingWriter),!writer)return internalWriter.value}}};var _minDash=require("min-dash"),_saxen=require("saxen"),_moddle=require("moddle");function hasLowerCaseAlias(pkg){return pkg.xml&&"lowerCase"===pkg.xml.tagAlias}var DEFAULT_NS_MAP={xsi:"http://www.w3.org/2001/XMLSchema-instance",xml:"http://www.w3.org/XML/1998/namespace"};function serializeFormat(element){return element.xml&&element.xml.serialize}function serializeAsType(element){return"xsi:type"===serializeFormat(element)}function aliasToName(aliasNs,pkg){return hasLowerCaseAlias(pkg)?aliasNs.prefix+":"+((str=aliasNs.localName).charAt(0).toUpperCase()+str.slice(1)):aliasNs.name;var str}function error(message){return new Error(message)}function getModdleDescriptor(element){return element.$descriptor}function Context(options){(0,_minDash.assign)(this,options),this.elementsById={},this.references=[],this.warnings=[],this.addReference=function(reference){this.references.push(reference)},this.addElement=function(element){if(!element)throw error("expected element");var id,elementsById=this.elementsById,idProperty=getModdleDescriptor(element).idProperty;if(idProperty&&(id=element.get(idProperty.name))){if(!/^([a-z][\w-.]*:)?[a-z_][\w-.]*$/i.test(id))throw new Error("illegal ID <"+id+">");if(elementsById[id])throw error("duplicate ID <"+id+">");elementsById[id]=element}},this.addWarning=function(warning){this.warnings.push(warning)}}function BaseHandler(){}function NoopHandler(){}function BodyHandler(){}function ReferenceHandler(property,context){this.property=property,this.context=context}function ValueHandler(propertyDesc,element){this.element=element,this.propertyDesc=propertyDesc}function BaseElementHandler(){}function ElementHandler(model,typeName,context){this.model=model,this.type=model.getType(typeName),this.context=context}function RootElementHandler(model,typeName,context){ElementHandler.call(this,model,typeName,context)}function GenericElementHandler(model,typeName,context){this.model=model,this.context=context}function Reader(options){options instanceof _moddle.Moddle&&(options={model:options}),(0,_minDash.assign)(this,{lax:!1},options)}BaseHandler.prototype.handleEnd=function(){},BaseHandler.prototype.handleText=function(){},BaseHandler.prototype.handleNode=function(){},NoopHandler.prototype=Object.create(BaseHandler.prototype),NoopHandler.prototype.handleNode=function(){return this},BodyHandler.prototype=Object.create(BaseHandler.prototype),BodyHandler.prototype.handleText=function(text){this.body=(this.body||"")+text},ReferenceHandler.prototype=Object.create(BodyHandler.prototype),ReferenceHandler.prototype.handleNode=function(node){if(this.element)throw error("expected no sub nodes");return this.element=this.createReference(node),this},ReferenceHandler.prototype.handleEnd=function(){this.element.id=this.body},ReferenceHandler.prototype.createReference=function(node){return{property:this.property.ns.name,id:""}},ValueHandler.prototype=Object.create(BodyHandler.prototype),ValueHandler.prototype.handleEnd=function(){var value=this.body||"",element=this.element,propertyDesc=this.propertyDesc;value=(0,_moddle.coerceType)(propertyDesc.type,value),propertyDesc.isMany?element.get(propertyDesc.name).push(value):element.set(propertyDesc.name,value)},BaseElementHandler.prototype=Object.create(BodyHandler.prototype),BaseElementHandler.prototype.handleNode=function(node){var parser=this,element=this.element;return element?parser=this.handleChild(node):(element=this.element=this.createElement(node),this.context.addElement(element)),parser},ElementHandler.prototype=Object.create(BaseElementHandler.prototype),ElementHandler.prototype.addReference=function(reference){this.context.addReference(reference)},ElementHandler.prototype.handleText=function(text){if(!getModdleDescriptor(this.element).bodyProperty)throw error("unexpected body text <"+text+">");BodyHandler.prototype.handleText.call(this,text)},ElementHandler.prototype.handleEnd=function(){var value=this.body,element=this.element,bodyProperty=getModdleDescriptor(element).bodyProperty;bodyProperty&&void 0!==value&&(value=(0,_moddle.coerceType)(bodyProperty.type,value),element.set(bodyProperty.name,value))},ElementHandler.prototype.createElement=function(node){var propNameNs,attributes=node.attributes,Type=this.type,descriptor=getModdleDescriptor(Type),context=this.context,instance=new Type({}),model=this.model;return(0,_minDash.forEach)(attributes,(function(value,name){var values,prop=descriptor.propertiesByName[name];prop&&prop.isReference?prop.isMany?(values=value.split(" "),(0,_minDash.forEach)(values,(function(v){context.addReference({element:instance,property:prop.ns.name,id:v})}))):context.addReference({element:instance,property:prop.ns.name,id:value}):(prop?value=(0,_moddle.coerceType)(prop.type,value):"xmlns"!==name&&(propNameNs=(0,_moddle.parseNameNS)(name,descriptor.ns.prefix),model.getPackage(propNameNs.prefix)&&context.addWarning({message:"unknown attribute <"+name+">",element:instance,property:name,value})),instance.set(name,value))})),instance},ElementHandler.prototype.getPropertyForNode=function(node){var elementTypeName,elementType,name=node.name,nameNs=(0,_moddle.parseNameNS)(name),type=this.type,model=this.model,descriptor=getModdleDescriptor(type),propertyName=nameNs.name,property=descriptor.propertiesByName[propertyName];if(property&&!property.isAttr)return serializeAsType(property)&&(elementTypeName=node.attributes["xsi:type"])?(elementTypeName=function(name,model){var nameNs=(0,_moddle.parseNameNS)(name);return function(nameNs,pkg){var name=nameNs.name,localName=nameNs.localName,typePrefix=pkg.xml&&pkg.xml.typePrefix;return typePrefix&&0===localName.indexOf(typePrefix)?nameNs.prefix+":"+localName.slice(typePrefix.length):name}(nameNs,model.getPackage(nameNs.prefix))}(elementTypeName,model),elementType=model.getType(elementTypeName),(0,_minDash.assign)({},property,{effectiveType:getModdleDescriptor(elementType).name})):property;var pkg=model.getPackage(nameNs.prefix);if(pkg){if(elementTypeName=aliasToName(nameNs,pkg),elementType=model.getType(elementTypeName),property=(0,_minDash.find)(descriptor.properties,(function(p){return!p.isVirtual&&!p.isReference&&!p.isAttribute&&elementType.hasType(p.type)})))return(0,_minDash.assign)({},property,{effectiveType:getModdleDescriptor(elementType).name})}else if(property=(0,_minDash.find)(descriptor.properties,(function(p){return!p.isReference&&!p.isAttribute&&"Element"===p.type})))return property;throw error("unrecognized element <"+nameNs.name+">")},ElementHandler.prototype.toString=function(){return"ElementDescriptor["+getModdleDescriptor(this.type).name+"]"},ElementHandler.prototype.valueHandler=function(propertyDesc,element){return new ValueHandler(propertyDesc,element)},ElementHandler.prototype.referenceHandler=function(propertyDesc){return new ReferenceHandler(propertyDesc,this.context)},ElementHandler.prototype.handler=function(type){return"Element"===type?new GenericElementHandler(this.model,type,this.context):new ElementHandler(this.model,type,this.context)},ElementHandler.prototype.handleChild=function(node){var propertyDesc,type,element,childHandler;if(propertyDesc=this.getPropertyForNode(node),element=this.element,type=propertyDesc.effectiveType||propertyDesc.type,(0,_moddle.isSimpleType)(type))return this.valueHandler(propertyDesc,element);var newElement=(childHandler=propertyDesc.isReference?this.referenceHandler(propertyDesc).handleNode(node):this.handler(type).handleNode(node)).element;return void 0!==newElement&&(propertyDesc.isMany?element.get(propertyDesc.name).push(newElement):element.set(propertyDesc.name,newElement),propertyDesc.isReference?((0,_minDash.assign)(newElement,{element}),this.context.addReference(newElement)):newElement.$parent=element),childHandler},RootElementHandler.prototype=Object.create(ElementHandler.prototype),RootElementHandler.prototype.createElement=function(node){var name=node.name,nameNs=(0,_moddle.parseNameNS)(name),model=this.model,type=this.type,pkg=model.getPackage(nameNs.prefix),typeName=pkg&&aliasToName(nameNs,pkg)||name;if(!type.hasType(typeName))throw error("unexpected element <"+node.originalName+">");return ElementHandler.prototype.createElement.call(this,node)},GenericElementHandler.prototype=Object.create(BaseElementHandler.prototype),GenericElementHandler.prototype.createElement=function(node){var name=node.name,prefix=(0,_moddle.parseNameNS)(name).prefix,uri=node.ns[prefix+"$uri"],attributes=node.attributes;return this.model.createAny(name,uri,attributes)},GenericElementHandler.prototype.handleChild=function(node){var handler=new GenericElementHandler(this.model,"Element",this.context).handleNode(node),element=this.element,newElement=handler.element;return void 0!==newElement&&((element.$children=element.$children||[]).push(newElement),newElement.$parent=element),handler},GenericElementHandler.prototype.handleEnd=function(){this.body&&(this.element.$body=this.body)},Reader.prototype.fromXML=function(xml,options,done){var rootHandler=options.rootHandler;options instanceof ElementHandler?(rootHandler=options,options={}):"string"==typeof options?(rootHandler=this.handler(options),options={}):"string"==typeof rootHandler&&(rootHandler=this.handler(rootHandler));var model=this.model,lax=this.lax,context=new Context((0,_minDash.assign)({},options,{rootHandler})),parser=new _saxen.Parser({proxy:!0}),stack=function(){var stack=[];return Object.defineProperty(stack,"peek",{value:function(){return this[this.length-1]}}),stack}();function handleError(err,getContext,lax){var ctx=getContext(),line=ctx.line,column=ctx.column,data=ctx.data;"<"===data.charAt(0)&&-1!==data.indexOf(" ")&&(data=data.slice(0,data.indexOf(" "))+">");var message="unparsable content "+(data?data+" ":"")+"detected\n\tline: "+line+"\n\tcolumn: "+column+"\n\tnested error: "+err.message;if(lax)return context.addWarning({message,error:err}),!0;throw error(message)}function handleWarning(err,getContext){return handleError(err,getContext,!0)}rootHandler.context=context,stack.push(rootHandler);var PREAMBLE_START_PATTERN=/^<\?xml /i,ENCODING_PATTERN=/ encoding="([^"]+)"/i,UTF_8_PATTERN=/^utf-8$/i;function handleCData(text,getContext){try{stack.peek().handleText(text)}catch(err){handleWarning(err,getContext)}}var uriMap=model.getPackages().reduce((function(uriMap,p){return uriMap[p.uri]=p.prefix,uriMap}),{"http://www.w3.org/XML/1998/namespace":"xml"});return parser.ns(uriMap).on("openTag",(function(obj,decodeStr,selfClosing,getContext){var attrs=obj.attrs||{},decodedAttrs=Object.keys(attrs).reduce((function(d,key){var value=decodeStr(attrs[key]);return d[key]=value,d}),{});!function(node,getContext){var handler=stack.peek();try{stack.push(handler.handleNode(node))}catch(err){handleError(err,getContext,lax)&&stack.push(new NoopHandler)}}({name:obj.name,originalName:obj.originalName,attributes:decodedAttrs,ns:obj.ns},getContext)})).on("question",(function(question){if(PREAMBLE_START_PATTERN.test(question)){var match=ENCODING_PATTERN.exec(question),encoding=match&&match[1];encoding&&!UTF_8_PATTERN.test(encoding)&&context.addWarning({message:"unsupported document encoding <"+encoding+">, falling back to UTF-8"})}})).on("closeTag",(function(){stack.pop().handleEnd()})).on("cdata",handleCData).on("text",(function(text,decodeEntities,getContext){!function(text,getContext){text.trim()&&handleCData(text,getContext)}(decodeEntities(text),getContext)})).on("error",handleError).on("warn",handleWarning),new Promise((function(resolve,reject){var err;try{parser.parse(xml),function(){var i,r,elementsById=context.elementsById,references=context.references;for(i=0;r=references[i];i++){var element=r.element,reference=elementsById[r.id],property=getModdleDescriptor(element).propertiesByName[r.property];if(reference||context.addWarning({message:"unresolved reference <"+r.id+">",element:r.element,property:r.property,value:r.id}),property.isMany){var collection=element.get(property.name),idx=collection.indexOf(r);-1===idx&&(idx=collection.length),reference?collection[idx]=reference:collection.splice(idx,1)}else element.set(property.name,reference)}}()}catch(e){err=e}var rootElement=rootHandler.element;err||rootElement||(err=error("failed to parse document as <"+rootHandler.type.$descriptor.name+">"));var warnings=context.warnings,references=context.references,elementsById=context.elementsById;return err?(err.warnings=warnings,reject(err)):resolve({rootElement,elementsById,references,warnings})}))},Reader.prototype.handler=function(name){return new RootElementHandler(this.model,name)};var ESCAPE_ATTR_CHARS=/<|>|'|"|&|\n\r|\n/g,ESCAPE_CHARS=/<|>|&/g;function Namespaces(parent){var prefixMap={},uriMap={},used={},wellknown=[],custom=[];this.byUri=function(uri){return uriMap[uri]||parent&&parent.byUri(uri)},this.add=function(ns,isWellknown){uriMap[ns.uri]=ns,isWellknown?wellknown.push(ns):custom.push(ns),this.mapPrefix(ns.prefix,ns.uri)},this.uriByPrefix=function(prefix){return prefixMap[prefix||"xmlns"]},this.mapPrefix=function(prefix,uri){prefixMap[prefix||"xmlns"]=uri},this.getNSKey=function(ns){return void 0!==ns.prefix?ns.uri+"|"+ns.prefix:ns.uri},this.logUsed=function(ns){var uri=ns.uri,nsKey=this.getNSKey(ns);used[nsKey]=this.byUri(uri),parent&&parent.logUsed(ns)},this.getUsed=function(ns){var self=this;return[].concat(wellknown,custom).filter((function(ns){var nsKey=self.getNSKey(ns);return used[nsKey]}))}}function inherits(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}function nsName(ns){return(0,_minDash.isString)(ns)?ns:(ns.prefix?ns.prefix+":":"")+ns.localName}var ESCAPE_ATTR_MAP={"\n":"#10","\n\r":"#10",'"':"#34","'":"#39","<":"#60",">":"#62","&":"#38"},ESCAPE_MAP={"<":"lt",">":"gt","&":"amp"};function escape(str,charPattern,replaceMap){return(str=(0,_minDash.isString)(str)?str:""+str).replace(charPattern,(function(s){return"&"+replaceMap[s]+";"}))}function ReferenceSerializer(tagName){this.tagName=tagName}function BodySerializer(){}function ValueSerializer(tagName){this.tagName=tagName}function ElementSerializer(parent,propertyDescriptor){this.body=[],this.attrs=[],this.parent=parent,this.propertyDescriptor=propertyDescriptor}function TypeSerializer(parent,propertyDescriptor){ElementSerializer.call(this,parent,propertyDescriptor)}function SavingWriter(){this.value="",this.write=function(str){this.value+=str}}function FormatingWriter(out,format){var indent=[""];this.append=function(str){return out.write(str),this},this.appendNewLine=function(){return format&&out.write("\n"),this},this.appendIndent=function(){return format&&out.write(indent.join("  ")),this},this.indent=function(){return indent.push(""),this},this.unindent=function(){return indent.pop(),this}}ReferenceSerializer.prototype.build=function(element){return this.element=element,this},ReferenceSerializer.prototype.serializeTo=function(writer){writer.appendIndent().append("<"+this.tagName+">"+this.element.id+"</"+this.tagName+">").appendNewLine()},BodySerializer.prototype.serializeValue=BodySerializer.prototype.serializeTo=function(writer){writer.append(this.escape?escape(this.value,ESCAPE_CHARS,ESCAPE_MAP):this.value)},BodySerializer.prototype.build=function(prop,value){return this.value=value,"String"===prop.type&&-1!==value.search(ESCAPE_CHARS)&&(this.escape=!0),this},inherits(ValueSerializer,BodySerializer),ValueSerializer.prototype.serializeTo=function(writer){writer.appendIndent().append("<"+this.tagName+">"),this.serializeValue(writer),writer.append("</"+this.tagName+">").appendNewLine()},ElementSerializer.prototype.build=function(element){this.element=element;var otherAttrs,properties,props,elementDescriptor=element.$descriptor,propertyDescriptor=this.propertyDescriptor,isGeneric=elementDescriptor.isGeneric;return otherAttrs=isGeneric?this.parseGeneric(element):this.parseNsAttributes(element),this.ns=propertyDescriptor?this.nsPropertyTagName(propertyDescriptor):this.nsTagName(elementDescriptor),this.tagName=this.addTagName(this.ns),isGeneric||(properties=function(element){var descriptor=element.$descriptor;return(0,_minDash.filter)(descriptor.properties,(function(p){var name=p.name;if(p.isVirtual)return!1;if(!(0,_minDash.has)(element,name))return!1;var value=element[name];return value!==p.default&&(null!==value&&(!p.isMany||value.length))}))}(element),this.parseAttributes((props=properties,(0,_minDash.filter)(props,(function(p){return p.isAttr})))),this.parseContainments(function(props){return(0,_minDash.filter)(props,(function(p){return!p.isAttr}))}(properties))),this.parseGenericAttributes(element,otherAttrs),this},ElementSerializer.prototype.nsTagName=function(descriptor){return function(ns,descriptor){return descriptor.isGeneric?(0,_minDash.assign)({localName:descriptor.ns.localName},ns):(0,_minDash.assign)({localName:(name=descriptor.ns.localName,pkg=descriptor.$pkg,hasLowerCaseAlias(pkg)?(string=name).charAt(0).toLowerCase()+string.slice(1):name)},ns);var name,pkg,string}(this.logNamespaceUsed(descriptor.ns),descriptor)},ElementSerializer.prototype.nsPropertyTagName=function(descriptor){return function(ns,descriptor){return(0,_minDash.assign)({localName:descriptor.ns.localName},ns)}(this.logNamespaceUsed(descriptor.ns),descriptor)},ElementSerializer.prototype.isLocalNs=function(ns){return ns.uri===this.ns.uri},ElementSerializer.prototype.nsAttributeName=function(element){var ns;if(ns=(0,_minDash.isString)(element)?(0,_moddle.parseNameNS)(element):element.ns,element.inherited)return{localName:ns.localName};var effectiveNs=this.logNamespaceUsed(ns);return this.getNamespaces().logUsed(effectiveNs),this.isLocalNs(effectiveNs)?{localName:ns.localName}:(0,_minDash.assign)({localName:ns.localName},effectiveNs)},ElementSerializer.prototype.parseGeneric=function(element){var self=this,body=this.body,attributes=[];return(0,_minDash.forEach)(element,(function(val,key){"$body"===key?body.push((new BodySerializer).build({type:"String"},val)):"$children"===key?(0,_minDash.forEach)(val,(function(child){body.push(new ElementSerializer(self).build(child))})):0!==key.indexOf("$")&&self.parseNsAttribute(element,key,val)&&attributes.push({name:key,value:val})})),attributes},ElementSerializer.prototype.parseNsAttribute=function(element,name,value){var ns,model=element.$model,nameNs=(0,_moddle.parseNameNS)(name);if("xmlns"===nameNs.prefix&&(ns={prefix:nameNs.localName,uri:value}),nameNs.prefix||"xmlns"!==nameNs.localName||(ns={uri:value}),!ns)return{name,value};if(model&&model.getPackage(value))this.logNamespace(ns,!0,!0);else{var actualNs=this.logNamespaceUsed(ns,!0);this.getNamespaces().logUsed(actualNs)}},ElementSerializer.prototype.parseNsAttributes=function(element,attrs){var self=this,genericAttrs=element.$attrs,attributes=[];return(0,_minDash.forEach)(genericAttrs,(function(value,name){var nonNsAttr=self.parseNsAttribute(element,name,value);nonNsAttr&&attributes.push(nonNsAttr)})),attributes},ElementSerializer.prototype.parseGenericAttributes=function(element,attributes){var self=this;(0,_minDash.forEach)(attributes,(function(attr){if("xsi:type"!==attr.name)try{self.addAttribute(self.nsAttributeName(attr.name),attr.value)}catch(e){console.warn("missing namespace information for ",attr.name,"=",attr.value,"on",element,e)}}))},ElementSerializer.prototype.parseContainments=function(properties){var self=this,body=this.body,element=this.element;(0,_minDash.forEach)(properties,(function(p){var value=element.get(p.name),isReference=p.isReference;if(p.isMany||(value=[value]),p.isBody)body.push((new BodySerializer).build(p,value[0]));else if((0,_moddle.isSimpleType)(p.type))(0,_minDash.forEach)(value,(function(v){body.push(new ValueSerializer(self.addTagName(self.nsPropertyTagName(p))).build(p,v))}));else if(isReference)(0,_minDash.forEach)(value,(function(v){body.push(new ReferenceSerializer(self.addTagName(self.nsPropertyTagName(p))).build(v))}));else{var asType=serializeAsType(p),asProperty=function(element){return"property"===serializeFormat(element)}(p);(0,_minDash.forEach)(value,(function(v){var serializer;serializer=asType?new TypeSerializer(self,p):asProperty?new ElementSerializer(self,p):new ElementSerializer(self),body.push(serializer.build(v))}))}}))},ElementSerializer.prototype.getNamespaces=function(local){var parentNamespaces,namespaces=this.namespaces,parent=this.parent;return namespaces||(parentNamespaces=parent&&parent.getNamespaces(),local||!parentNamespaces?this.namespaces=namespaces=new Namespaces(parentNamespaces):namespaces=parentNamespaces),namespaces},ElementSerializer.prototype.logNamespace=function(ns,wellknown,local){var namespaces=this.getNamespaces(local),nsUri=ns.uri,nsPrefix=ns.prefix;return namespaces.byUri(nsUri)&&!local||namespaces.add(ns,wellknown),namespaces.mapPrefix(nsPrefix,nsUri),ns},ElementSerializer.prototype.logNamespaceUsed=function(ns,local){var newPrefix,idx,wellknownUri,model=this.element.$model,namespaces=this.getNamespaces(local),prefix=ns.prefix,uri=ns.uri;if(!prefix&&!uri)return{localName:ns.localName};if(wellknownUri=DEFAULT_NS_MAP[prefix]||model&&(model.getPackage(prefix)||{}).uri,!(uri=uri||wellknownUri||namespaces.uriByPrefix(prefix)))throw new Error("no namespace uri given for prefix <"+prefix+">");if(!(ns=namespaces.byUri(uri))){for(newPrefix=prefix,idx=1;namespaces.uriByPrefix(newPrefix);)newPrefix=prefix+"_"+idx++;ns=this.logNamespace({prefix:newPrefix,uri},wellknownUri===uri)}return prefix&&namespaces.mapPrefix(prefix,uri),ns},ElementSerializer.prototype.parseAttributes=function(properties){var self=this,element=this.element;(0,_minDash.forEach)(properties,(function(p){var value=element.get(p.name);if(p.isReference)if(p.isMany){var values=[];(0,_minDash.forEach)(value,(function(v){values.push(v.id)})),value=values.join(" ")}else value=value.id;self.addAttribute(self.nsAttributeName(p),value)}))},ElementSerializer.prototype.addTagName=function(nsTagName){var actualNs=this.logNamespaceUsed(nsTagName);return this.getNamespaces().logUsed(actualNs),nsName(nsTagName)},ElementSerializer.prototype.addAttribute=function(name,value){var attrs=this.attrs;(0,_minDash.isString)(value)&&(value=escape(value,ESCAPE_ATTR_CHARS,ESCAPE_ATTR_MAP)),attrs.push({name,value})},ElementSerializer.prototype.serializeAttributes=function(writer){var attrs=this.attrs,namespaces=this.namespaces;namespaces&&(attrs=function(namespaces){return namespaces.getUsed().filter((function(ns){return"xml"!==ns.prefix})).map((function(ns){return{name:"xmlns"+(ns.prefix?":"+ns.prefix:""),value:ns.uri}}))}(namespaces).concat(attrs)),(0,_minDash.forEach)(attrs,(function(a){writer.append(" ").append(nsName(a.name)).append('="').append(a.value).append('"')}))},ElementSerializer.prototype.serializeTo=function(writer){var firstBody=this.body[0],indent=firstBody&&firstBody.constructor!==BodySerializer;writer.appendIndent().append("<"+this.tagName),this.serializeAttributes(writer),writer.append(firstBody?">":" />"),firstBody&&(indent&&writer.appendNewLine().indent(),(0,_minDash.forEach)(this.body,(function(b){b.serializeTo(writer)})),indent&&writer.unindent().appendIndent(),writer.append("</"+this.tagName+">")),writer.appendNewLine()},inherits(TypeSerializer,ElementSerializer),TypeSerializer.prototype.parseNsAttributes=function(element){var attributes=ElementSerializer.prototype.parseNsAttributes.call(this,element),descriptor=element.$descriptor;if(descriptor.name===this.propertyDescriptor.type)return attributes;var typeNs=this.typeNs=this.nsTagName(descriptor);this.getNamespaces().logUsed(this.typeNs);var pkg=element.$model.getPackage(typeNs.uri),typePrefix=pkg.xml&&pkg.xml.typePrefix||"";return this.addAttribute(this.nsAttributeName("xsi:type"),(typeNs.prefix?typeNs.prefix+":":"")+typePrefix+descriptor.ns.localName),attributes},TypeSerializer.prototype.isLocalNs=function(ns){return ns.uri===(this.typeNs||this.ns).uri}},{"min-dash":219,moddle:222,saxen:227}],222:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Moddle=Moddle,exports.coerceType=function(type,value){var converter=TYPE_CONVERTERS[type];return converter?converter(value):value},exports.isBuiltInType=isBuiltIn,exports.isSimpleType=function(type){return!!TYPE_CONVERTERS[type]},exports.parseNameNS=parseName;var _minDash=require("min-dash");function Base(){}function Factory(model,properties){this.model=model,this.properties=properties}Base.prototype.get=function(name){return this.$model.properties.get(this,name)},Base.prototype.set=function(name,value){this.$model.properties.set(this,name,value)},Factory.prototype.createType=function(descriptor){var model=this.model,props=this.properties,prototype=Object.create(Base.prototype);(0,_minDash.forEach)(descriptor.properties,(function(p){p.isMany||void 0===p.default||(prototype[p.name]=p.default)})),props.defineModel(prototype,model),props.defineDescriptor(prototype,descriptor);var name=descriptor.ns.name;function ModdleElement(attrs){props.define(this,"$type",{value:name,enumerable:!0}),props.define(this,"$attrs",{value:{}}),props.define(this,"$parent",{writable:!0}),(0,_minDash.forEach)(attrs,(0,_minDash.bind)((function(val,key){this.set(key,val)}),this))}return ModdleElement.prototype=prototype,ModdleElement.hasType=prototype.$instanceOf=this.model.hasType,props.defineModel(ModdleElement,model),props.defineDescriptor(ModdleElement,descriptor),ModdleElement};var BUILTINS={String:!0,Boolean:!0,Integer:!0,Real:!0,Element:!0},TYPE_CONVERTERS={String:function(s){return s},Boolean:function(s){return"true"===s},Integer:function(s){return parseInt(s,10)},Real:function(s){return parseFloat(s)}};function isBuiltIn(type){return!!BUILTINS[type]}function parseName(name,defaultPrefix){var localName,prefix,parts=name.split(/:/);if(1===parts.length)localName=name,prefix=defaultPrefix;else{if(2!==parts.length)throw new Error("expected <prefix:localName> or <localName>, got "+name);localName=parts[1],prefix=parts[0]}return{name:name=(prefix?prefix+":":"")+localName,prefix,localName}}function DescriptorBuilder(nameNs){this.ns=nameNs,this.name=nameNs.name,this.allTypes=[],this.allTypesByName={},this.properties=[],this.propertiesByName={}}function Registry(packages,properties){this.packageMap={},this.typeMap={},this.packages=[],this.properties=properties,(0,_minDash.forEach)(packages,(0,_minDash.bind)(this.registerPackage,this))}function ensureAvailable(packageMap,pkg,identifierKey){var value=pkg[identifierKey];if(value in packageMap)throw new Error("package with "+identifierKey+" <"+value+"> already defined")}function Properties(model){this.model=model}function defineProperty(target,property,value){Object.defineProperty(target,property.name,{enumerable:!property.isReference,writable:!0,value,configurable:!0})}function Moddle(packages){this.properties=new Properties(this),this.factory=new Factory(this,this.properties),this.registry=new Registry(packages,this.properties),this.typeCache={}}DescriptorBuilder.prototype.build=function(){return(0,_minDash.pick)(this,["ns","name","allTypes","allTypesByName","properties","propertiesByName","bodyProperty","idProperty"])},DescriptorBuilder.prototype.addProperty=function(p,idx,validate){"boolean"==typeof idx&&(validate=idx,idx=void 0),this.addNamedProperty(p,!1!==validate);var properties=this.properties;void 0!==idx?properties.splice(idx,0,p):properties.push(p)},DescriptorBuilder.prototype.replaceProperty=function(oldProperty,newProperty,replace){var oldNameNs=oldProperty.ns,props=this.properties,propertiesByName=this.propertiesByName,rename=oldProperty.name!==newProperty.name;if(oldProperty.isId){if(!newProperty.isId)throw new Error("property <"+newProperty.ns.name+"> must be id property to refine <"+oldProperty.ns.name+">");this.setIdProperty(newProperty,!1)}if(oldProperty.isBody){if(!newProperty.isBody)throw new Error("property <"+newProperty.ns.name+"> must be body property to refine <"+oldProperty.ns.name+">");this.setBodyProperty(newProperty,!1)}var idx=props.indexOf(oldProperty);if(-1===idx)throw new Error("property <"+oldNameNs.name+"> not found in property list");props.splice(idx,1),this.addProperty(newProperty,replace?void 0:idx,rename),propertiesByName[oldNameNs.name]=propertiesByName[oldNameNs.localName]=newProperty},DescriptorBuilder.prototype.redefineProperty=function(p,targetPropertyName,replace){var nsPrefix=p.ns.prefix,parts=targetPropertyName.split("#"),name=parseName(parts[0],nsPrefix),attrName=parseName(parts[1],name.prefix).name,redefinedProperty=this.propertiesByName[attrName];if(!redefinedProperty)throw new Error("refined property <"+attrName+"> not found");this.replaceProperty(redefinedProperty,p,replace),delete p.redefines},DescriptorBuilder.prototype.addNamedProperty=function(p,validate){var ns=p.ns,propsByName=this.propertiesByName;validate&&(this.assertNotDefined(p,ns.name),this.assertNotDefined(p,ns.localName)),propsByName[ns.name]=propsByName[ns.localName]=p},DescriptorBuilder.prototype.removeNamedProperty=function(p){var ns=p.ns,propsByName=this.propertiesByName;delete propsByName[ns.name],delete propsByName[ns.localName]},DescriptorBuilder.prototype.setBodyProperty=function(p,validate){if(validate&&this.bodyProperty)throw new Error("body property defined multiple times (<"+this.bodyProperty.ns.name+">, <"+p.ns.name+">)");this.bodyProperty=p},DescriptorBuilder.prototype.setIdProperty=function(p,validate){if(validate&&this.idProperty)throw new Error("id property defined multiple times (<"+this.idProperty.ns.name+">, <"+p.ns.name+">)");this.idProperty=p},DescriptorBuilder.prototype.assertNotDefined=function(p,name){var propertyName=p.name,definedProperty=this.propertiesByName[propertyName];if(definedProperty)throw new Error("property <"+propertyName+"> already defined; override of <"+definedProperty.definedBy.ns.name+"#"+definedProperty.ns.name+"> by <"+p.definedBy.ns.name+"#"+p.ns.name+"> not allowed without redefines")},DescriptorBuilder.prototype.hasProperty=function(name){return this.propertiesByName[name]},DescriptorBuilder.prototype.addTrait=function(t,inherited){var typesByName=this.allTypesByName,types=this.allTypes,typeName=t.name;typeName in typesByName||((0,_minDash.forEach)(t.properties,(0,_minDash.bind)((function(p){p=(0,_minDash.assign)({},p,{name:p.ns.localName,inherited}),Object.defineProperty(p,"definedBy",{value:t});var replaces=p.replaces,redefines=p.redefines;replaces||redefines?this.redefineProperty(p,replaces||redefines,replaces):(p.isBody&&this.setBodyProperty(p),p.isId&&this.setIdProperty(p),this.addProperty(p))}),this)),types.push(t),typesByName[typeName]=t)},Registry.prototype.getPackage=function(uriOrPrefix){return this.packageMap[uriOrPrefix]},Registry.prototype.getPackages=function(){return this.packages},Registry.prototype.registerPackage=function(pkg){pkg=(0,_minDash.assign)({},pkg);var pkgMap=this.packageMap;ensureAvailable(pkgMap,pkg,"prefix"),ensureAvailable(pkgMap,pkg,"uri"),(0,_minDash.forEach)(pkg.types,(0,_minDash.bind)((function(descriptor){this.registerType(descriptor,pkg)}),this)),pkgMap[pkg.uri]=pkgMap[pkg.prefix]=pkg,this.packages.push(pkg)},Registry.prototype.registerType=function(type,pkg){var ns=parseName((type=(0,_minDash.assign)({},type,{superClass:(type.superClass||[]).slice(),extends:(type.extends||[]).slice(),properties:(type.properties||[]).slice(),meta:(0,_minDash.assign)(type.meta||{})})).name,pkg.prefix),name=ns.name,propertiesByName={};(0,_minDash.forEach)(type.properties,(0,_minDash.bind)((function(p){var propertyNs=parseName(p.name,ns.prefix),propertyName=propertyNs.name;isBuiltIn(p.type)||(p.type=parseName(p.type,propertyNs.prefix).name),(0,_minDash.assign)(p,{ns:propertyNs,name:propertyName}),propertiesByName[propertyName]=p}),this)),(0,_minDash.assign)(type,{ns,name,propertiesByName}),(0,_minDash.forEach)(type.extends,(0,_minDash.bind)((function(extendsName){var extended=this.typeMap[extendsName];extended.traits=extended.traits||[],extended.traits.push(name)}),this)),this.definePackage(type,pkg),this.typeMap[name]=type},Registry.prototype.mapTypes=function(nsName,iterator,trait){var type=isBuiltIn(nsName.name)?{name:nsName.name}:this.typeMap[nsName.name],self=this;function traverseTrait(cls){return traverseSuper(cls,!0)}function traverseSuper(cls,trait){var parentNs=parseName(cls,isBuiltIn(cls)?"":nsName.prefix);self.mapTypes(parentNs,iterator,trait)}if(!type)throw new Error("unknown type <"+nsName.name+">");(0,_minDash.forEach)(type.superClass,trait?traverseTrait:traverseSuper),iterator(type,!trait),(0,_minDash.forEach)(type.traits,traverseTrait)},Registry.prototype.getEffectiveDescriptor=function(name){var nsName=parseName(name),builder=new DescriptorBuilder(nsName);this.mapTypes(nsName,(function(type,inherited){builder.addTrait(type,inherited)}));var descriptor=builder.build();return this.definePackage(descriptor,descriptor.allTypes[descriptor.allTypes.length-1].$pkg),descriptor},Registry.prototype.definePackage=function(target,pkg){this.properties.define(target,"$pkg",{value:pkg})},Properties.prototype.set=function(target,name,value){var property=this.model.getPropertyDescriptor(target,name),propertyName=property&&property.name;void 0===value?property?delete target[propertyName]:delete target.$attrs[name]:property?propertyName in target?target[propertyName]=value:defineProperty(target,property,value):target.$attrs[name]=value},Properties.prototype.get=function(target,name){var property=this.model.getPropertyDescriptor(target,name);if(!property)return target.$attrs[name];var propertyName=property.name;return!target[propertyName]&&property.isMany&&defineProperty(target,property,[]),target[propertyName]},Properties.prototype.define=function(target,name,options){Object.defineProperty(target,name,options)},Properties.prototype.defineDescriptor=function(target,descriptor){this.define(target,"$descriptor",{value:descriptor})},Properties.prototype.defineModel=function(target,model){this.define(target,"$model",{value:model})},Moddle.prototype.create=function(descriptor,attrs){var Type=this.getType(descriptor);if(!Type)throw new Error("unknown type <"+descriptor+">");return new Type(attrs)},Moddle.prototype.getType=function(descriptor){var cache=this.typeCache,name=(0,_minDash.isString)(descriptor)?descriptor:descriptor.ns.name,type=cache[name];return type||(descriptor=this.registry.getEffectiveDescriptor(name),type=cache[name]=this.factory.createType(descriptor)),type},Moddle.prototype.createAny=function(name,nsUri,properties){var nameNs=parseName(name),element={$type:name,$instanceOf:function(type){return type===this.$type}},descriptor={name,isGeneric:!0,ns:{prefix:nameNs.prefix,localName:nameNs.localName,uri:nsUri}};return this.properties.defineDescriptor(element,descriptor),this.properties.defineModel(element,this),this.properties.define(element,"$parent",{enumerable:!1,writable:!0}),this.properties.define(element,"$instanceOf",{enumerable:!1,writable:!0}),(0,_minDash.forEach)(properties,(function(a,key){(0,_minDash.isObject)(a)&&void 0!==a.value?element[a.name]=a.value:element[key]=a})),element},Moddle.prototype.getPackage=function(uriOrPrefix){return this.registry.getPackage(uriOrPrefix)},Moddle.prototype.getPackages=function(){return this.registry.getPackages()},Moddle.prototype.getElementDescriptor=function(element){return element.$descriptor},Moddle.prototype.hasType=function(element,type){return void 0===type&&(type=element,element=this),type in element.$model.getElementDescriptor(element).allTypesByName},Moddle.prototype.getPropertyDescriptor=function(element,property){return this.getElementDescriptor(element).propertiesByName[property]},Moddle.prototype.getTypeDescriptor=function(type){return this.registry.typeMap[type]}},{"min-dash":219}],223:[function(require,module,exports){module.exports=require("./lib/refs"),module.exports.Collection=require("./lib/collection")},{"./lib/collection":224,"./lib/refs":225}],224:[function(require,module,exports){"use strict";module.exports.extend=function(collection,refs,property,target){var inverseProperty=property.inverse;return Object.defineProperty(collection,"remove",{value:function(element){var idx=this.indexOf(element);return-1!==idx&&(this.splice(idx,1),refs.unset(element,inverseProperty,target)),element}}),Object.defineProperty(collection,"contains",{value:function(element){return-1!==this.indexOf(element)}}),Object.defineProperty(collection,"add",{value:function(element,idx){var currentIdx=this.indexOf(element);if(void 0===idx){if(-1!==currentIdx)return;idx=this.length}-1!==currentIdx&&this.splice(currentIdx,1),this.splice(idx,0,element),-1===currentIdx&&refs.set(element,inverseProperty,target)}}),Object.defineProperty(collection,"__refs_collection",{value:!0}),collection},module.exports.isExtended=function(collection){return!0===collection.__refs_collection}},{}],225:[function(require,module,exports){"use strict";var Collection=require("./collection");function defineCollectionProperty(ref,property,target){var collection=Collection.extend(target[property.name]||[],ref,property,target);Object.defineProperty(target,property.name,{enumerable:property.enumerable,value:collection}),collection.length&&collection.forEach((function(o){ref.set(o,property.inverse,target)}))}function Refs(a,b){if(!(this instanceof Refs))return new Refs(a,b);a.inverse=b,b.inverse=a,this.props={},this.props[a.name]=a,this.props[b.name]=b}Refs.prototype.bind=function(target,property){if("string"==typeof property){if(!this.props[property])throw new Error("no property <"+property+"> in ref");property=this.props[property]}property.collection?defineCollectionProperty(this,property,target):function(ref,property,target){var inverseProperty=property.inverse,_value=target[property.name];Object.defineProperty(target,property.name,{configurable:property.configurable,enumerable:property.enumerable,get:function(){return _value},set:function(value){if(value!==_value){var old=_value;_value=null,old&&ref.unset(old,inverseProperty,target),_value=value,ref.set(_value,inverseProperty,target)}}})}(this,property,target)},Refs.prototype.ensureRefsCollection=function(target,property){var collection=target[property.name];return Collection.isExtended(collection)||defineCollectionProperty(this,property,target),collection},Refs.prototype.ensureBound=function(target,property){(function(e,property){return Object.prototype.hasOwnProperty.call(e,property.name||property)})(target,property)||this.bind(target,property)},Refs.prototype.unset=function(target,property,value){target&&(this.ensureBound(target,property),property.collection?this.ensureRefsCollection(target,property).remove(value):target[property.name]=void 0)},Refs.prototype.set=function(target,property,value){target&&(this.ensureBound(target,property),property.collection?this.ensureRefsCollection(target,property).add(value):target[property.name]=value)},module.exports=Refs},{"./collection":224}],226:[function(require,module,exports){"use strict";var p2s=/,?([a-z]),?/gi,toFloat=parseFloat,math=Math,PI=math.PI,mmin=math.min,mmax=math.max,pow=math.pow,abs=math.abs,pathCommand=/([a-z])[\s,]*((-?\d*\.?\d*(?:e[-+]?\d+)?[\s]*,?[\s]*)+)/gi,pathValues=/(-?\d*\.?\d*(?:e[-+]?\d+)?)[\s]*,?[\s]*/gi,isArray=Array.isArray||function(o){return o instanceof Array};function hasProperty(obj,property){return Object.prototype.hasOwnProperty.call(obj,property)}function clone(obj){if("function"==typeof obj||Object(obj)!==obj)return obj;var res=new obj.constructor;for(var key in obj)hasProperty(obj,key)&&(res[key]=clone(obj[key]));return res}function repush(array,item){for(var i=0,ii=array.length;i<ii;i++)if(array[i]===item)return array.push(array.splice(i,1)[0])}function paths(ps){var p=paths.ps=paths.ps||{};return p[ps]?p[ps].sleep=100:p[ps]={sleep:100},setTimeout((function(){for(var key in p)hasProperty(p,key)&&key!=ps&&(p[key].sleep--,!p[key].sleep&&delete p[key])})),p[ps]}function rectBBox(x,y,width,height){return 1===arguments.length&&(y=x.y,width=x.width,height=x.height,x=x.x),{x,y,width,height,x2:x+width,y2:y+height}}function pathToString(){return this.join(",").replace(p2s,"$1")}function pathClone(pathArray){var res=clone(pathArray);return res.toString=pathToString,res}function findDotsAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t){var t1=1-t,t13=pow(t1,3),t12=pow(t1,2),t3=t*t*t,y=t13*p1y+3*t12*t*c1y+3*t1*t*t*c2y+t3*p2y;return{x:fixError(t13*p1x+3*t12*t*c1x+3*t1*t*t*c2x+t3*p2x),y:fixError(y)}}function bezierBBox(points){var bbox=curveBBox.apply(null,points);return rectBBox(bbox.x0,bbox.y0,bbox.x1-bbox.x0,bbox.y1-bbox.y0)}function isPointInsideBBox(bbox,x,y){return x>=bbox.x&&x<=bbox.x+bbox.width&&y>=bbox.y&&y<=bbox.y+bbox.height}function base3(t,p1,p2,p3,p4){return t*(t*(-3*p1+9*p2-9*p3+3*p4)+6*p1-12*p2+6*p3)-3*p1+3*p2}function bezlen(x1,y1,x2,y2,x3,y3,x4,y4,z){null==z&&(z=1);for(var z2=(z=z>1?1:z<0?0:z)/2,Tvalues=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],Cvalues=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],sum=0,i=0;i<12;i++){var ct=z2*Tvalues[i]+z2,xbase=base3(ct,x1,x2,x3,x4),ybase=base3(ct,y1,y2,y3,y4),comb=xbase*xbase+ybase*ybase;sum+=Cvalues[i]*math.sqrt(comb)}return z2*sum}function intersectLines(x1,y1,x2,y2,x3,y3,x4,y4){if(!(mmax(x1,x2)<mmin(x3,x4)||mmin(x1,x2)>mmax(x3,x4)||mmax(y1,y2)<mmin(y3,y4)||mmin(y1,y2)>mmax(y3,y4))){var ny=(x1*y2-y1*x2)*(y3-y4)-(y1-y2)*(x3*y4-y3*x4),denominator=(x1-x2)*(y3-y4)-(y1-y2)*(x3-x4);if(denominator){var px=fixError(((x1*y2-y1*x2)*(x3-x4)-(x1-x2)*(x3*y4-y3*x4))/denominator),py=fixError(ny/denominator),px2=+px.toFixed(2),py2=+py.toFixed(2);if(!(px2<+mmin(x1,x2).toFixed(2)||px2>+mmax(x1,x2).toFixed(2)||px2<+mmin(x3,x4).toFixed(2)||px2>+mmax(x3,x4).toFixed(2)||py2<+mmin(y1,y2).toFixed(2)||py2>+mmax(y1,y2).toFixed(2)||py2<+mmin(y3,y4).toFixed(2)||py2>+mmax(y3,y4).toFixed(2)))return{x:px,y:py}}}}function fixError(number){return Math.round(1e11*number)/1e11}function findBezierIntersections(bez1,bez2,justCount){if(!function(bbox1,bbox2){return bbox1=rectBBox(bbox1),isPointInsideBBox(bbox2=rectBBox(bbox2),bbox1.x,bbox1.y)||isPointInsideBBox(bbox2,bbox1.x2,bbox1.y)||isPointInsideBBox(bbox2,bbox1.x,bbox1.y2)||isPointInsideBBox(bbox2,bbox1.x2,bbox1.y2)||isPointInsideBBox(bbox1,bbox2.x,bbox2.y)||isPointInsideBBox(bbox1,bbox2.x2,bbox2.y)||isPointInsideBBox(bbox1,bbox2.x,bbox2.y2)||isPointInsideBBox(bbox1,bbox2.x2,bbox2.y2)||(bbox1.x<bbox2.x2&&bbox1.x>bbox2.x||bbox2.x<bbox1.x2&&bbox2.x>bbox1.x)&&(bbox1.y<bbox2.y2&&bbox1.y>bbox2.y||bbox2.y<bbox1.y2&&bbox2.y>bbox1.y)}(bezierBBox(bez1),bezierBBox(bez2)))return justCount?0:[];for(var l1=bezlen.apply(0,bez1),l2=bezlen.apply(0,bez2),n1=isLine(bez1)?1:~~(l1/5)||1,n2=isLine(bez2)?1:~~(l2/5)||1,dots1=[],dots2=[],xy={},res=justCount?0:[],i=0;i<n1+1;i++){var p=findDotsAtSegment.apply(0,bez1.concat(i/n1));dots1.push({x:p.x,y:p.y,t:i/n1})}for(i=0;i<n2+1;i++)p=findDotsAtSegment.apply(0,bez2.concat(i/n2)),dots2.push({x:p.x,y:p.y,t:i/n2});for(i=0;i<n1;i++)for(var j=0;j<n2;j++){var key,di=dots1[i],di1=dots1[i+1],dj=dots2[j],dj1=dots2[j+1],ci=abs(di1.x-di.x)<.01?"y":"x",cj=abs(dj1.x-dj.x)<.01?"y":"x",is=intersectLines(di.x,di.y,di1.x,di1.y,dj.x,dj.y,dj1.x,dj1.y);if(is){if(xy[key=is.x.toFixed(9)+"#"+is.y.toFixed(9)])continue;xy[key]=!0;var t1=di.t+abs((is[ci]-di[ci])/(di1[ci]-di[ci]))*(di1.t-di.t),t2=dj.t+abs((is[cj]-dj[cj])/(dj1[cj]-dj[cj]))*(dj1.t-dj.t);t1>=0&&t1<=1&&t2>=0&&t2<=1&&(justCount?res++:res.push({x:is.x,y:is.y,t1,t2}))}}return res}function pathToAbsolute(pathArray){var pth=paths(pathArray);if(pth.abs)return pathClone(pth.abs);if(isArray(pathArray)&&isArray(pathArray&&pathArray[0])||(pathArray=function(pathString){if(!pathString)return null;var pth=paths(pathString);if(pth.arr)return clone(pth.arr);var paramCounts={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},data=[];return isArray(pathString)&&isArray(pathString[0])&&(data=clone(pathString)),data.length||String(pathString).replace(pathCommand,(function(a,b,c){var params=[],name=b.toLowerCase();for(c.replace(pathValues,(function(a,b){b&&params.push(+b)})),"m"==name&&params.length>2&&(data.push([b].concat(params.splice(0,2))),name="l",b="m"==b?"l":"L");params.length>=paramCounts[name]&&(data.push([b].concat(params.splice(0,paramCounts[name]))),paramCounts[name]););})),data.toString=paths.toString,pth.arr=clone(data),data}(pathArray)),!pathArray||!pathArray.length)return[["M",0,0]];var pa0,res=[],x=0,y=0,mx=0,my=0,start=0;"M"==pathArray[0][0]&&(mx=x=+pathArray[0][1],my=y=+pathArray[0][2],start++,res[0]=["M",x,y]);for(var r,pa,i=start,ii=pathArray.length;i<ii;i++){if(res.push(r=[]),(pa0=(pa=pathArray[i])[0])!=pa0.toUpperCase())switch(r[0]=pa0.toUpperCase(),r[0]){case"A":r[1]=pa[1],r[2]=pa[2],r[3]=pa[3],r[4]=pa[4],r[5]=pa[5],r[6]=+pa[6]+x,r[7]=+pa[7]+y;break;case"V":r[1]=+pa[1]+y;break;case"H":r[1]=+pa[1]+x;break;case"M":mx=+pa[1]+x,my=+pa[2]+y;default:for(var j=1,jj=pa.length;j<jj;j++)r[j]=+pa[j]+(j%2?x:y)}else for(var k=0,kk=pa.length;k<kk;k++)r[k]=pa[k];switch(pa0=pa0.toUpperCase(),r[0]){case"Z":x=+mx,y=+my;break;case"H":x=r[1];break;case"V":y=r[1];break;case"M":mx=r[r.length-2],my=r[r.length-1];default:x=r[r.length-2],y=r[r.length-1]}}return res.toString=pathToString,pth.abs=pathClone(res),res}function isLine(bez){return bez[0]===bez[2]&&bez[1]===bez[3]&&bez[4]===bez[6]&&bez[5]===bez[7]}function lineToCurve(x1,y1,x2,y2){return[x1,y1,x2,y2,x2,y2]}function qubicToCurve(x1,y1,ax,ay,x2,y2){return[1/3*x1+2/3*ax,1/3*y1+2/3*ay,1/3*x2+2/3*ax,1/3*y2+2/3*ay,x2,y2]}function arcToCurve(x1,y1,rx,ry,angle,large_arc_flag,sweep_flag,x2,y2,recursive){var xy,f,_120=120*PI/180,rad=PI/180*(+angle||0),res=[],rotate=(f=function(x,y,rad){return{x:x*math.cos(rad)-y*math.sin(rad),y:x*math.sin(rad)+y*math.cos(rad)}},function newf(){var arg=Array.prototype.slice.call(arguments,0),args=arg.join(""),cache=newf.cache=newf.cache||{},count=newf.count=newf.count||[];return hasProperty(cache,args)?(repush(count,args),cache[args]):(count.length>=1e3&&delete cache[count.shift()],count.push(args),cache[args]=f.apply(0,arg),cache[args])});if(recursive)f1=recursive[0],f2=recursive[1],cx=recursive[2],cy=recursive[3];else{x1=(xy=rotate(x1,y1,-rad)).x,y1=xy.y;var x=(x1-(x2=(xy=rotate(x2,y2,-rad)).x))/2,y=(y1-(y2=xy.y))/2,h=x*x/(rx*rx)+y*y/(ry*ry);h>1&&(rx*=h=math.sqrt(h),ry*=h);var rx2=rx*rx,ry2=ry*ry,k=(large_arc_flag==sweep_flag?-1:1)*math.sqrt(abs((rx2*ry2-rx2*y*y-ry2*x*x)/(rx2*y*y+ry2*x*x))),cx=k*rx*y/ry+(x1+x2)/2,cy=k*-ry*x/rx+(y1+y2)/2,f1=math.asin(((y1-cy)/ry).toFixed(9)),f2=math.asin(((y2-cy)/ry).toFixed(9));(f1=x1<cx?PI-f1:f1)<0&&(f1=2*PI+f1),(f2=x2<cx?PI-f2:f2)<0&&(f2=2*PI+f2),sweep_flag&&f1>f2&&(f1-=2*PI),!sweep_flag&&f2>f1&&(f2-=2*PI)}var df=f2-f1;if(abs(df)>_120){var f2old=f2,x2old=x2,y2old=y2;f2=f1+_120*(sweep_flag&&f2>f1?1:-1),res=arcToCurve(x2=cx+rx*math.cos(f2),y2=cy+ry*math.sin(f2),rx,ry,angle,0,sweep_flag,x2old,y2old,[f2,f2old,cx,cy])}df=f2-f1;var c1=math.cos(f1),s1=math.sin(f1),c2=math.cos(f2),s2=math.sin(f2),t=math.tan(df/4),hx=4/3*rx*t,hy=4/3*ry*t,m1=[x1,y1],m2=[x1+hx*s1,y1-hy*c1],m3=[x2+hx*s2,y2-hy*c2],m4=[x2,y2];if(m2[0]=2*m1[0]-m2[0],m2[1]=2*m1[1]-m2[1],recursive)return[m2,m3,m4].concat(res);for(var newres=[],i=0,ii=(res=[m2,m3,m4].concat(res).join().split(",")).length;i<ii;i++)newres[i]=i%2?rotate(res[i-1],res[i],rad).y:rotate(res[i],res[i+1],rad).x;return newres}function curveBBox(x0,y0,x1,y1,x2,y2,x3,y3){for(var a,b,c,t,t1,t2,b2ac,sqrtb2ac,tvalues=[],bounds=[[],[]],i=0;i<2;++i)if(0==i?(b=6*x0-12*x1+6*x2,a=-3*x0+9*x1-9*x2+3*x3,c=3*x1-3*x0):(b=6*y0-12*y1+6*y2,a=-3*y0+9*y1-9*y2+3*y3,c=3*y1-3*y0),abs(a)<1e-12){if(abs(b)<1e-12)continue;0<(t=-c/b)&&t<1&&tvalues.push(t)}else b2ac=b*b-4*c*a,sqrtb2ac=math.sqrt(b2ac),b2ac<0||(0<(t1=(-b+sqrtb2ac)/(2*a))&&t1<1&&tvalues.push(t1),0<(t2=(-b-sqrtb2ac)/(2*a))&&t2<1&&tvalues.push(t2));for(var mt,j=tvalues.length,jlen=j;j--;)mt=1-(t=tvalues[j]),bounds[0][j]=mt*mt*mt*x0+3*mt*mt*t*x1+3*mt*t*t*x2+t*t*t*x3,bounds[1][j]=mt*mt*mt*y0+3*mt*mt*t*y1+3*mt*t*t*y2+t*t*t*y3;return bounds[0][jlen]=x0,bounds[1][jlen]=y0,bounds[0][jlen+1]=x3,bounds[1][jlen+1]=y3,bounds[0].length=bounds[1].length=jlen+2,{x0:mmin.apply(0,bounds[0]),y0:mmin.apply(0,bounds[1]),x1:mmax.apply(0,bounds[0]),y1:mmax.apply(0,bounds[1])}}function pathToCurve(path){var pth=paths(path);if(pth.curve)return pathClone(pth.curve);for(var curvedPath=pathToAbsolute(path),attrs={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},processPath=function(path,d,pathCommand){var nx,ny;if(!path)return["C",d.x,d.y,d.x,d.y,d.x,d.y];switch(!(path[0]in{T:1,Q:1})&&(d.qx=d.qy=null),path[0]){case"M":d.X=path[1],d.Y=path[2];break;case"A":path=["C"].concat(arcToCurve.apply(0,[d.x,d.y].concat(path.slice(1))));break;case"S":"C"==pathCommand||"S"==pathCommand?(nx=2*d.x-d.bx,ny=2*d.y-d.by):(nx=d.x,ny=d.y),path=["C",nx,ny].concat(path.slice(1));break;case"T":"Q"==pathCommand||"T"==pathCommand?(d.qx=2*d.x-d.qx,d.qy=2*d.y-d.qy):(d.qx=d.x,d.qy=d.y),path=["C"].concat(qubicToCurve(d.x,d.y,d.qx,d.qy,path[1],path[2]));break;case"Q":d.qx=path[1],d.qy=path[2],path=["C"].concat(qubicToCurve(d.x,d.y,path[1],path[2],path[3],path[4]));break;case"L":path=["C"].concat(lineToCurve(d.x,d.y,path[1],path[2]));break;case"H":path=["C"].concat(lineToCurve(d.x,d.y,path[1],d.y));break;case"V":path=["C"].concat(lineToCurve(d.x,d.y,d.x,path[1]));break;case"Z":path=["C"].concat(lineToCurve(d.x,d.y,d.X,d.Y))}return path},fixArc=function(pp,i){if(pp[i].length>7){pp[i].shift();for(var pi=pp[i];pi.length;)pathCommands[i]="A",pp.splice(i++,0,["C"].concat(pi.splice(0,6)));pp.splice(i,1),ii=curvedPath.length}},pathCommands=[],pfirst="",pathCommand="",i=0,ii=curvedPath.length;i<ii;i++){curvedPath[i]&&(pfirst=curvedPath[i][0]),"C"!=pfirst&&(pathCommands[i]=pfirst,i&&(pathCommand=pathCommands[i-1])),curvedPath[i]=processPath(curvedPath[i],attrs,pathCommand),"A"!=pathCommands[i]&&"C"==pfirst&&(pathCommands[i]="C"),fixArc(curvedPath,i);var seg=curvedPath[i],seglen=seg.length;attrs.x=seg[seglen-2],attrs.y=seg[seglen-1],attrs.bx=toFloat(seg[seglen-4])||attrs.x,attrs.by=toFloat(seg[seglen-3])||attrs.y}return pth.curve=pathClone(curvedPath),curvedPath}module.exports=function(path1,path2,justCount){path1=pathToCurve(path1),path2=pathToCurve(path2);for(var x1,y1,x2,y2,x1m,y1m,x2m,y2m,bez1,bez2,res=justCount?0:[],i=0,ii=path1.length;i<ii;i++){var pi=path1[i];if("M"==pi[0])x1=x1m=pi[1],y1=y1m=pi[2];else{"C"==pi[0]?(bez1=[x1,y1].concat(pi.slice(1)),x1=bez1[6],y1=bez1[7]):(bez1=[x1,y1,x1,y1,x1m,y1m,x1m,y1m],x1=x1m,y1=y1m);for(var j=0,jj=path2.length;j<jj;j++){var pj=path2[j];if("M"==pj[0])x2=x2m=pj[1],y2=y2m=pj[2];else{"C"==pj[0]?(bez2=[x2,y2].concat(pj.slice(1)),x2=bez2[6],y2=bez2[7]):(bez2=[x2,y2,x2,y2,x2m,y2m,x2m,y2m],x2=x2m,y2=y2m);var intr=findBezierIntersections(bez1,bez2,justCount);if(justCount)res+=intr;else{for(var k=0,kk=intr.length;k<kk;k++)intr[k].segment1=i,intr[k].segment2=j,intr[k].bez1=bez1,intr[k].bez2=bez2;res=res.concat(intr)}}}}}return res}},{}],227:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Parser=function Parser(options){if(!this)return new Parser(options);var onText,onOpenTag,onCloseTag,onCDATA,onWarning,onComment,onQuestion,onAttention,nsUriToPrefix,proxy=options&&options.proxy,onError=throwFunc,getContext=noopGetContext,maybeNS=!1,isNamespace=!1,returnError=null,parseStop=!1;function handleError(err){err instanceof Error||(err=error(err)),returnError=err,onError(err,getContext)}function handleWarning(err){onWarning&&(err instanceof Error||(err=error(err)),onWarning(err,getContext))}function parse(xml){var _nsMatrix,x,y,q,w,v,xmlns,elementName,_elementName,elementProxy,cachedAttrs,nsMatrixStack=isNamespace?[]:null,nsMatrix=isNamespace?function(nsUriToPrefix){var uri,prefix,nsMatrix={};for(uri in nsUriToPrefix)prefix=nsUriToPrefix[uri],nsMatrix[prefix]=prefix,nsMatrix[uriPrefix(prefix)]=uri;return nsMatrix}(nsUriToPrefix):null,nodeStack=[],anonymousNsCount=0,tagStart=!1,tagEnd=!1,i=0,j=0,attrsString="",attrsStart=0;function getAttrs(){if(null!==cachedAttrs)return cachedAttrs;var nsUri,nsUriPrefix,nsName,hasNewMatrix,newalias,value,alias,name,skipAttr,w,j,defaultAlias=isNamespace&&nsMatrix.xmlns,attrList=isNamespace&&maybeNS?[]:null,i=attrsStart,s=attrsString,l=s.length,attrs={},seenAttrs={};parseAttr:for(;i<l;i++)if(skipAttr=!1,!(32===(w=s.charCodeAt(i))||w<14&&w>8)){for((w<65||w>122||w>90&&w<97)&&95!==w&&58!==w&&(handleWarning("illegal first char attribute name"),skipAttr=!0),j=i+1;j<l;j++)if(!((w=s.charCodeAt(j))>96&&w<123||w>64&&w<91||w>47&&w<59||46===w||45===w||95===w)){if(32===w||w<14&&w>8){handleWarning("missing attribute value"),i=j;continue parseAttr}if(61===w)break;handleWarning("illegal attribute name char"),skipAttr=!0}if("xmlns:xmlns"===(name=s.substring(i,j))&&(handleWarning("illegal declaration of xmlns"),skipAttr=!0),34===(w=s.charCodeAt(j+1)))-1===(j=s.indexOf('"',i=j+2))&&-1!==(j=s.indexOf("'",i))&&(handleWarning("attribute value quote missmatch"),skipAttr=!0);else if(39===w)-1===(j=s.indexOf("'",i=j+2))&&-1!==(j=s.indexOf('"',i))&&(handleWarning("attribute value quote missmatch"),skipAttr=!0);else for(handleWarning("missing attribute value quotes"),skipAttr=!0,j+=1;j<l&&!(32===(w=s.charCodeAt(j+1))||w<14&&w>8);j++);for(-1===j&&(handleWarning("missing closing quotes"),j=l,skipAttr=!0),skipAttr||(value=s.substring(i,j)),i=j;j+1<l&&!(32===(w=s.charCodeAt(j+1))||w<14&&w>8);j++)i===j&&(handleWarning("illegal character after attribute end"),skipAttr=!0);if(i=j+1,!skipAttr)if(name in seenAttrs)handleWarning("attribute <"+name+"> already defined");else if(seenAttrs[name]=!0,isNamespace)if(maybeNS){if(null!==(newalias="xmlns"===name?"xmlns":120===name.charCodeAt(0)&&"xmlns:"===name.substr(0,6)?name.substr(6):null)){if(nsUri=decodeEntities(value),nsUriPrefix=uriPrefix(newalias),!(alias=nsUriToPrefix[nsUri])){if("xmlns"===newalias||nsUriPrefix in nsMatrix&&nsMatrix[nsUriPrefix]!==nsUri)do{alias="ns"+anonymousNsCount++}while(void 0!==nsMatrix[alias]);else alias=newalias;nsUriToPrefix[nsUri]=alias}nsMatrix[newalias]!==alias&&(hasNewMatrix||(nsMatrix=cloneNsMatrix(nsMatrix),hasNewMatrix=!0),nsMatrix[newalias]=alias,"xmlns"===newalias&&(nsMatrix[uriPrefix(alias)]=nsUri,defaultAlias=alias),nsMatrix[nsUriPrefix]=nsUri),attrs[name]=value;continue}attrList.push(name,value)}else-1!==(w=name.indexOf(":"))?(nsName=nsMatrix[name.substring(0,w)])?("xsi:type"===(name=defaultAlias===nsName?name.substr(w+1):nsName+name.substr(w))&&(-1!==(w=value.indexOf(":"))?(nsName=value.substring(0,w),value=(nsName=nsMatrix[nsName]||nsName)+value.substring(w)):value=defaultAlias+":"+value),attrs[name]=value):handleWarning(missingNamespaceForPrefix(name.substring(0,w))):attrs[name]=value;else attrs[name]=value}if(maybeNS)for(i=0,l=attrList.length;i<l;i++){if(name=attrList[i++],value=attrList[i],-1!==(w=name.indexOf(":"))){if(!(nsName=nsMatrix[name.substring(0,w)])){handleWarning(missingNamespaceForPrefix(name.substring(0,w)));continue}"xsi:type"===(name=defaultAlias===nsName?name.substr(w+1):nsName+name.substr(w))&&(-1!==(w=value.indexOf(":"))?(nsName=value.substring(0,w),value=(nsName=nsMatrix[nsName]||nsName)+value.substring(w)):value=defaultAlias+":"+value)}attrs[name]=value}return cachedAttrs=attrs}for(getContext=function(){for(var match,data,splitsRe=/(\r\n|\r|\n)/g,line=0,column=0,startOfLine=0,endOfLine=j;i>=startOfLine&&(match=splitsRe.exec(xml))&&!((endOfLine=match[0].length+match.index)>i);)line+=1,startOfLine=endOfLine;return-1==i?(column=endOfLine,data=xml.substring(j)):0===j?data=xml.substring(j,i):(column=i-startOfLine,data=-1==j?xml.substring(i):xml.substring(i,j+1)),{data,line,column}},proxy&&(elementProxy=Object.create({},{name:getter((function(){return elementName})),originalName:getter((function(){return _elementName})),attrs:getter(getAttrs),ns:getter((function(){return nsMatrix}))}));-1!==j;){if(-1===(i=60===xml.charCodeAt(j)?j:xml.indexOf("<",j)))return nodeStack.length?handleError("unexpected end of file"):0===j?handleError("missing start tag"):void(j<xml.length&&xml.substring(j).trim()&&handleWarning("non-whitespace outside of root node"));if(j!==i)if(nodeStack.length){if(onText&&(onText(xml.substring(j,i),decodeEntities,getContext),parseStop))return}else if(xml.substring(j,i).trim()&&(handleWarning("non-whitespace outside of root node"),parseStop))return;if(33===(w=xml.charCodeAt(i+1))){if(91===(q=xml.charCodeAt(i+2))&&"CDATA["===xml.substr(i+3,6)){if(-1===(j=xml.indexOf("]]>",i)))return handleError("unclosed cdata");if(onCDATA&&(onCDATA(xml.substring(i+9,j),getContext),parseStop))return;j+=3;continue}if(45===q&&45===xml.charCodeAt(i+3)){if(-1===(j=xml.indexOf("--\x3e",i)))return handleError("unclosed comment");if(onComment&&(onComment(xml.substring(i+4,j),decodeEntities,getContext),parseStop))return;j+=3;continue}}if(63!==w){for(x=i+1;;x++){if(v=xml.charCodeAt(x),isNaN(v))return j=-1,handleError("unclosed tag");if(34===v)x=-1!==(q=xml.indexOf('"',x+1))?q:x;else if(39===v)x=-1!==(q=xml.indexOf("'",x+1))?q:x;else if(62===v){j=x;break}}if(33!==w){if(cachedAttrs={},47===w){if(tagStart=!1,tagEnd=!0,!nodeStack.length)return handleError("missing open tag");if(x=elementName=nodeStack.pop(),q=i+2+x.length,xml.substring(i+2,q)!==x)return handleError("closing tag mismatch");for(;q<j;q++)if(!(32===(w=xml.charCodeAt(q))||w>8&&w<14))return handleError("close tag")}else{if(47===xml.charCodeAt(j-1)?(x=elementName=xml.substring(i+1,j-1),tagStart=!0,tagEnd=!0):(x=elementName=xml.substring(i+1,j),tagStart=!0,tagEnd=!1),!(w>96&&w<123||w>64&&w<91||95===w||58===w))return handleError("illegal first char nodeName");for(q=1,y=x.length;q<y;q++)if(!((w=x.charCodeAt(q))>96&&w<123||w>64&&w<91||w>47&&w<59||45===w||95===w||46==w)){if(32===w||w<14&&w>8){elementName=x.substring(0,q),cachedAttrs=null;break}return handleError("invalid nodeName")}tagEnd||nodeStack.push(elementName)}if(isNamespace){if(_nsMatrix=nsMatrix,tagStart&&(tagEnd||nsMatrixStack.push(_nsMatrix),null===cachedAttrs&&(maybeNS=-1!==x.indexOf("xmlns",q))&&(attrsStart=q,attrsString=x,getAttrs(),maybeNS=!1)),_elementName=elementName,-1!==(w=elementName.indexOf(":"))){if(!(xmlns=nsMatrix[elementName.substring(0,w)]))return handleError("missing namespace on <"+_elementName+">");elementName=elementName.substr(w+1)}else xmlns=nsMatrix.xmlns;xmlns&&(elementName=xmlns+":"+elementName)}if(tagStart&&(attrsStart=q,attrsString=x,onOpenTag&&(proxy?onOpenTag(elementProxy,decodeEntities,tagEnd,getContext):onOpenTag(elementName,getAttrs,decodeEntities,tagEnd,getContext),parseStop)))return;if(tagEnd){if(onCloseTag&&(onCloseTag(proxy?elementProxy:elementName,decodeEntities,tagStart,getContext),parseStop))return;isNamespace&&(nsMatrix=tagStart?_nsMatrix:nsMatrixStack.pop())}j+=1}else{if(onAttention&&(onAttention(xml.substring(i,j+1),decodeEntities,getContext),parseStop))return;j+=1}}else{if(-1===(j=xml.indexOf("?>",i)))return handleError("unclosed question");if(onQuestion&&(onQuestion(xml.substring(i,j+2),getContext),parseStop))return;j+=2}}}this.on=function(name,cb){if("function"!=typeof cb)throw error("required args <name, cb>");switch(name){case"openTag":onOpenTag=cb;break;case"text":onText=cb;break;case"closeTag":onCloseTag=cb;break;case"error":onError=cb;break;case"warn":onWarning=cb;break;case"cdata":onCDATA=cb;break;case"attention":onAttention=cb;break;case"question":onQuestion=cb;break;case"comment":onComment=cb;break;default:throw error("unsupported event: "+name)}return this},this.ns=function(nsMap){if(void 0===nsMap&&(nsMap={}),"object"!=typeof nsMap)throw error("required args <nsMap={}>");var k,_nsUriToPrefix={};for(k in nsMap)_nsUriToPrefix[k]=nsMap[k];return _nsUriToPrefix["http://www.w3.org/2001/XMLSchema-instance"]="xsi",isNamespace=!0,nsUriToPrefix=_nsUriToPrefix,this},this.parse=function(xml){if("string"!=typeof xml)throw error("required args <xml=string>");return returnError=null,parse(xml),getContext=noopGetContext,parseStop=!1,returnError},this.stop=function(){parseStop=!0}},exports.decode=decodeEntities;var fromCharCode=String.fromCharCode,hasOwnProperty=Object.prototype.hasOwnProperty,ENTITY_PATTERN=/&#(\d+);|&#x([0-9a-f]+);|&(\w+);/gi,ENTITY_MAPPING={amp:"&",apos:"'",gt:">",lt:"<",quot:'"'};function replaceEntities(_,d,x,z){return z?hasOwnProperty.call(ENTITY_MAPPING,z)?ENTITY_MAPPING[z]:"&"+z+";":fromCharCode(d||parseInt(x,16))}function decodeEntities(s){return s.length>3&&-1!==s.indexOf("&")?s.replace(ENTITY_PATTERN,replaceEntities):s}Object.keys(ENTITY_MAPPING).forEach((function(k){ENTITY_MAPPING[k.toUpperCase()]=ENTITY_MAPPING[k]}));function error(msg){return new Error(msg)}function missingNamespaceForPrefix(prefix){return"missing namespace for prefix <"+prefix+">"}function getter(getFn){return{get:getFn,enumerable:!0}}function cloneNsMatrix(nsMatrix){var key,clone={};for(key in nsMatrix)clone[key]=nsMatrix[key];return clone}function uriPrefix(prefix){return prefix+"$uri"}function noopGetContext(){return{line:0,column:0}}function throwFunc(err){throw err}},{}],228:[function(require,module,exports){"use strict";function ensureImported(element,target){if(element.ownerDocument!==target.ownerDocument)try{return target.ownerDocument.importNode(element,!0)}catch(e){}return element}function appendTo(element,target){return target.appendChild(ensureImported(element,target))}Object.defineProperty(exports,"__esModule",{value:!0}),exports.append=function(target,node){return appendTo(node,target),target},exports.appendTo=appendTo,exports.attr=attr,exports.classes=function(el){return new ClassList(el)},exports.clear=clear,exports.clone=function(element){return element.cloneNode(!0)},exports.create=create,exports.innerSVG=function(element,svg){if(void 0!==svg){try{!function(element,svg){var parsed=parse(svg);if(clear(element),!svg)return;(function(node){return"#document-fragment"===node.nodeName})(parsed)||(parsed=parsed.documentElement);for(var nodes=(arr=parsed.childNodes,Array.prototype.slice.call(arr)),i=0;i<nodes.length;i++)appendTo(nodes[i],element);var arr}(element,svg)}catch(e){throw new Error("error parsing SVG: "+e.message)}return element}return function(element){var child=element.firstChild,output=[];for(;child;)serialize(child,output),child=child.nextSibling;return output.join("")}(element)},exports.prepend=function(target,node){return prependTo(node,target),target},exports.prependTo=prependTo,exports.remove=remove,exports.replace=function(element,replacement){return element.parentNode.replaceChild(ensureImported(replacement,element),element),replacement},exports.transform=function(node,transforms){var transformList=node.transform.baseVal;transforms&&(Array.isArray(transforms)||(transforms=[transforms]),function(transformList,transforms){var i,t;for(transformList.clear(),i=0;t=transforms[i];i++)transformList.appendItem(wrapMatrix(transformList,t))}(transformList,transforms));return transformList.consolidate()},exports.on=function(node,event,listener,useCapture){node.addEventListener(event,listener,useCapture)},exports.off=function(node,event,listener,useCapture){node.removeEventListener(event,listener,useCapture)},exports.createPoint=function(x,y){var point=node.createSVGPoint();switch(arguments.length){case 0:return point;case 2:x={x,y}}return extend(point,x)},exports.createMatrix=function(a,b,c,d,e,f){var matrix=node.createSVGMatrix();switch(arguments.length){case 0:return matrix;case 1:return extend(matrix,a);case 6:return extend(matrix,{a,b,c,d,e,f})}},exports.createTransform=function(matrix){return matrix?node.createSVGTransformFromMatrix(matrix):node.createSVGTransform()},exports.select=function(node,selector){return node.querySelector(selector)},exports.selectAll=function(node,selector){var nodes=node.querySelectorAll(selector);return[].map.call(nodes,(function(element){return element}))};var CSS_PROPERTIES={"alignment-baseline":1,"baseline-shift":1,clip:1,"clip-path":1,"clip-rule":1,color:1,"color-interpolation":1,"color-interpolation-filters":1,"color-profile":1,"color-rendering":1,cursor:1,direction:1,display:1,"dominant-baseline":1,"enable-background":1,fill:1,"fill-opacity":1,"fill-rule":1,filter:1,"flood-color":1,"flood-opacity":1,font:1,"font-family":1,"font-size":2,"font-size-adjust":1,"font-stretch":1,"font-style":1,"font-variant":1,"font-weight":1,"glyph-orientation-horizontal":1,"glyph-orientation-vertical":1,"image-rendering":1,kerning:1,"letter-spacing":1,"lighting-color":1,marker:1,"marker-end":1,"marker-mid":1,"marker-start":1,mask:1,opacity:1,overflow:1,"pointer-events":1,"shape-rendering":1,"stop-color":1,"stop-opacity":1,stroke:1,"stroke-dasharray":1,"stroke-dashoffset":1,"stroke-linecap":1,"stroke-linejoin":1,"stroke-miterlimit":1,"stroke-opacity":1,"stroke-width":2,"text-anchor":1,"text-decoration":1,"text-rendering":1,"unicode-bidi":1,visibility:1,"word-spacing":1,"writing-mode":1};function setAttribute(node,name,value){var hyphenated=name.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),type=CSS_PROPERTIES[hyphenated];type?(2===type&&"number"==typeof value&&(value=String(value)+"px"),node.style[hyphenated]=value):node.setAttributeNS(null,name,value)}function attr(node,name,value){if("string"==typeof name){if(void 0===value)return function(node,name){return CSS_PROPERTIES[name]?node.style[name]:node.getAttributeNS(null,name)}(node,name);setAttribute(node,name,value)}else!function(node,attrs){var i,name,names=Object.keys(attrs);for(i=0;name=names[i];i++)setAttribute(node,name,attrs[name])}(node,name);return node}function index(arr,obj){if(arr.indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i)if(arr[i]===obj)return i;return-1}var re=/\s+/,toString=Object.prototype.toString;function defined(o){return void 0!==o}function ClassList(el){if(!el||!el.nodeType)throw new Error("A DOM element reference is required");this.el=el,this.list=el.classList}function remove(element){var parent=element.parentNode;return parent&&parent.removeChild(element),element}function clear(element){for(var child;child=element.firstChild;)remove(child);return element}ClassList.prototype.add=function(name){if(this.list)return this.list.add(name),this;var arr=this.array();return~index(arr,name)||arr.push(name),defined(this.el.className.baseVal)?this.el.className.baseVal=arr.join(" "):this.el.className=arr.join(" "),this},ClassList.prototype.remove=function(name){if("[object RegExp]"===toString.call(name))return this.removeMatching(name);if(this.list)return this.list.remove(name),this;var arr=this.array(),i=index(arr,name);return~i&&arr.splice(i,1),this.el.className.baseVal=arr.join(" "),this},ClassList.prototype.removeMatching=function(re){for(var arr=this.array(),i=0;i<arr.length;i++)re.test(arr[i])&&this.remove(arr[i]);return this},ClassList.prototype.toggle=function(name,force){return this.list?(defined(force)?force!==this.list.toggle(name,force)&&this.list.toggle(name):this.list.toggle(name),this):(defined(force)?force?this.add(name):this.remove(name):this.has(name)?this.remove(name):this.add(name),this)},ClassList.prototype.array=function(){var arr=(this.el.getAttribute("class")||"").replace(/^\s+|\s+$/g,"").split(re);return""===arr[0]&&arr.shift(),arr},ClassList.prototype.has=ClassList.prototype.contains=function(name){return this.list?this.list.contains(name):!!~index(this.array(),name)};var ns_svg="http://www.w3.org/2000/svg",SVG_START='<svg xmlns="'+ns_svg+'"';function parse(svg){var unwrap=!1;"<svg"===svg.substring(0,4)?-1===svg.indexOf(ns_svg)&&(svg=SVG_START+svg.substring(4)):(svg=SVG_START+">"+svg+"</svg>",unwrap=!0);var parsed=function(svg){var parser;return(parser=new DOMParser).async=!1,parser.parseFromString(svg,"text/xml")}(svg);if(!unwrap)return parsed;for(var fragment=document.createDocumentFragment(),parent=parsed.firstChild;parent.firstChild;)fragment.appendChild(parent.firstChild);return fragment}function create(name,attrs){var element;return"<"===name.charAt(0)?(element=parse(name).firstChild,element=document.importNode(element,!0)):element=document.createElementNS(ns_svg,name),attrs&&attr(element,attrs),element}var node=create("svg");function extend(object,props){var i,k,keys=Object.keys(props);for(i=0;k=keys[i];i++)object[k]=props[k];return object}var TEXT_ENTITIES=/([&<>]{1})/g,ATTR_ENTITIES=/([\n\r"]{1})/g,ENTITY_REPLACEMENT={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"'"};function escape(str,pattern){return str.replace(pattern,(function(match,entity){return ENTITY_REPLACEMENT[entity]||entity}))}function serialize(node,output){var i,len,attrMap,attrNode,childNodes;switch(node.nodeType){case 3:output.push(escape(node.textContent,TEXT_ENTITIES));break;case 1:if(output.push("<",node.tagName),node.hasAttributes())for(i=0,len=(attrMap=node.attributes).length;i<len;++i)attrNode=attrMap.item(i),output.push(" ",attrNode.name,'="',escape(attrNode.value,ATTR_ENTITIES),'"');if(node.hasChildNodes()){for(output.push(">"),i=0,len=(childNodes=node.childNodes).length;i<len;++i)serialize(childNodes.item(i),output);output.push("</",node.tagName,">")}else output.push("/>");break;case 8:output.push("\x3c!--",escape(node.nodeValue,TEXT_ENTITIES),"--\x3e");break;case 4:output.push("<![CDATA[",node.nodeValue,"]]>");break;default:throw new Error("unable to handle node "+node.nodeType)}return output}function prependTo(node,target){return target.insertBefore(ensureImported(node,target),target.firstChild||null)}function wrapMatrix(transformList,transform){return transform instanceof SVGMatrix?transformList.createSVGTransformFromMatrix(transform):transform}},{}]},{},[1]);